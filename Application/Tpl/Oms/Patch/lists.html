<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="./Application/Tpl/Home/Public/utils/css/public.style.css">
    <!-- <link rel="stylesheet" href="./Application/Tpl/Home/Public/css/element-ui-2.2.css?v=<{$Think.const.V}>"> -->
    <link rel="stylesheet" href="./Application/Tpl/Home/Public/css/element-ui-2.2.css">
    <!--<link rel="stylesheet" href="https://unpkg.com/element-ui/lib/theme-chalk/index.css">-->
    <link rel="stylesheet" href="./Application/Tpl/Home/Public/css/normailize.css?v=<{$Think.const.V}>">
    <link rel="stylesheet" href="./Application/Tpl/Home/Public/css/default.css?v=<{$Think.const.V}>">
    <!-- <link rel="stylesheet" href="./Application/Tpl/Home/Public/icon/css/font-awesome.min.css?v=<{$Think.const.V}>"> -->
    <link rel="stylesheet" href="./Application/Tpl/Home/Public/icon/css/font-awesome.min.css">
    <link rel="stylesheet" href="./Application/Tpl/Oms/Public/css/list_common.css?v=<{$Think.const.V}>">
    <link rel="stylesheet" href="./Application/Tpl/Oms/Order/orderList.css?v=<{$Think.const.V}>">
    <!--[if IE 9]> <link rel="stylesheet" href="./Application/Tpl/Oms/Public/css/style.css"/><![endif]-->

    <title>待派单</title>
</head>
<style>
    @media screen and (-ms-high-contrast: active),
    (-ms-high-contrast: none) {
        .el-step {
            width: 230px !important;
        }
        .el-step__icon {
            display: inline-block
        }
        .el-step__icon-inner {
            margin-top: 3px !important;
        }
    }

    [v-cloak] {
        display: none;
    }

    .el-table .cell {
        padding-left: 5px;
    }

    #lists {
        visibility: hidden;
    }

    span.shopTag>span {
        position: absolute !important;
        bottom: 0px;
        right: 0px;
        border-radius: 0px;
        background-color: #f99c64;
        border: 1px solid rgb(231, 156, 116) !important;
    }

    .isOnlyOne .el-table__body-wrapper table {
        padding-bottom: 100px;
    }

    table .el-icon-d-arrow-left:hover {
        -webkit-transform: rotate(270deg);
        transform: rotate(270deg);
    }
    /* .country-logo {
        display: block;
        position: absolute;
        right: 0;
        bottom: 0;
        background: #f99c64;
        color: #FFF;
        padding: 2px 4px;
    } */

    .overflow {
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
        text-align: center;
    }

    .error-tips {
        position: absolute;
        padding: 10px 20px;
        height: auto;
        background: #fff;
        box-shadow: 0 0 5px #536d7a;
        width: 300px;
        color: #333;
        left: -90px;
        top: 90px;
        z-index: 100;
    }

    .choose-radius {
        width: 100%;
        display: flex;
        justify-content: center;
        padding-top: 30px;
        padding-bottom: 10px;
    }

    .order-list-table .el-checkbox {
        padding: 30px 10px;
    }

    .has-gutter tr th:nth-child(1) .el-checkbox {
        padding: 0 10px;
    }

    .el-table .cell,
    .el-table th div,
    .el-table--border td:first-child .cell,
    .el-table--border th:first-child .cell {
        padding-left: 0;
    }

    table i.save:before {
        color: #d01f1f;
    }

    .condition-choose .sort-item {
        margin: 2px 0px 20px 0px;
    }

    .edit-choose .el-select {
        padding: 0;
        margin-left: 20px;
    }

    /*.third-order-num .cell{

    }*/

    .el-table__body .el-table_1_column_3:nth-child(3) .third-order {
        height: 60px;
        /* line-height: 80px;
        margin-bottom: 20px; */
        display: flex;
        flex-direction: column;
        align-items: center;
        justify-content: center;
    }

    .el-table__body .el-table_1_column_3:nth-child(3) .to-detail-btn {
        /* display: inline-block;
        height: 60px;
        line-height: 20px;
        vertical-align: middle;
        padding-top: 20px;
        vertical-align: middle; */
    }

    .filter-order .el-scrollbar {
        /* height: 380px; */
    }

    .filter-order .el-select-dropdown__wrap {
        height: 100%;
    }

    .filter-order .el-scrollbar__wrap {
        /* overflow: visible; */
    }

    .filter-order::-webkit-scrollbar {
        display: none;
    }

    .filter-order .el-scrollbar__thumb {
        display: none;
    }

    .remote_area {
        position: absolute;
        padding: 4px;
        left: 0;
        top: 0;
        background-color: pink;
        color: orangered;
    }

    .orderLogo {
        position: absolute;
        right: 0;
        bottom: 2px;
    }

    .orderLogo span {
        margin-left: 1px;
        background: #f99c64;
        color: #FFF;
        padding: 2px 4px;
    }
    .thirdOrderStrong{
        color: rgb(0, 128, 0);
    }
    .address_tooltip{
        display: inline-block;
        position: absolute;
        top: 69px;
        left: 107px;
        width: 22px;
        height: 22px;
        line-height: 22px;
        background: #ddd;
    }
    .title-min{
        width: 155px !important;
        text-align: center;
        padding-left: 0 !important;
        color: #000 !important;
    }
    .el-select{
        padding: 0 !important;
    }

    .btn-search{
        background-color: #0375DE !important;
    }
    .auto{
        width: 37px;
        left: 92px;
        background: red;
        color: #ffffff;
    }
    .el-loading-spinner{
        top:300px;
        margin-top: -21px;
        position: fixed;
    }
    #dialog .el-dialog__header {
        display: block;
    }
    .search-item-i .contain-remark-overflow{
        padding: 0 5px;
        overflow: hidden;
        white-space: nowrap;
        text-overflow: ellipsis;
        vertical-align: bottom;
    }
    /* 地址校验标识 */
    .address_check {
        display: inline-block;
        position: absolute;
        bottom: 0;
        left: 0;
        height: 24px;
        padding: 0 10px;
        line-height: 24px;
        text-align: center;
        color: #ffffff;
    }
    .check_y {
        background: #0f9ae0;
    }
    .check_n {
        background: #E6A23C;
    }
    .el-select .el-tag{
        max-width: 255px;
        display: inline-block;
        overflow: hidden;
        text-overflow: ellipsis;
        white-space: nowrap;
    }
    /* 校验失败提示 */
    .tip-dialog .el-dialog__header {
        display: block;
    }
    .tip-dialog .el-dialog__body {
        padding: 20px !important;
    }
    .tip-dialog .el-dialog__footer .section-btn{
        width: 200px;
        height: 40px;
        text-align: center;
        line-height: 40px;
        border: 1px solid #DCDFE6;
        border-radius: 6px;
        display: inline-block;
        cursor: pointer;
    }
    .tip-dialog .el-dialog__footer .section-btn:nth-last-child(1) {
        margin-left: 30px;
    }
    .batchEditingDialog .el-dialog__header{
        display: block;
    }
    .batchEditingDialog .el-dialog__title{
        color:#D01F1F;
    }
    /*.batchEditingDialog .el-dialog__close{*/
    /*    font-weight: bold;*/
    /*    font-size: 22px;*/
    /*}*/
    .el-message-box__title span{
        color:#D01F1F;
    }
    .el-message-box__message p{
        display: flex;
        justify-content: center;
    }
    .el-icon-close{
        font-weight: bold;
        font-size: 22px;
    }
    .el-scrollbar__wrap {
        margin-bottom: 0px !important;
    }
</style>

<body class="orderList">
<div id="lists" class="list-common" v-cloak style="margin-bottom:220px" v-loading="shipLoading">
    <div class="step-content">
        <el-steps :active="active" align-center>
            <el-step :title="$lang('派单推荐')"></el-step>
            <el-step :title="$lang('待派单')"></el-step>
            <el-step :title="$lang('待获取运单号')"></el-step>
            <el-step :title="$lang('待拣货')"></el-step>
            <el-step :title="$lang('待分拣')"></el-step>
            <el-step :title="$lang('待核单')"></el-step>
            <el-step :title="$lang('待出库')"></el-step>
            <el-step :title="$lang('已出库')"></el-step>
        </el-steps>
    </div>
    <!-- 搜索查询 start-->
    <div class="orderList-search search-common">
        <!-- 平台 start-->
        <div class="search-toggle">
            <el-row type="flex">
                <el-col :span="4" class="title-info-container">
                    <div class="title-info">{{$lang('平台渠道')}}</div>
                </el-col>
                <el-col :span="22" class="search-item-i">
                    <span :class="{active:!form.platform.length}" @click="selectChannel()">{{$lang('全部')}}</span>
                    <span :class="{active:item.checked}" class="channel-item" v-for="item in baseData.channel"
                          @click="selectChannel(item)">{{$lang(item.CD_VAL)}}</span>
                </el-col>
            </el-row>
            <!-- 平台 end-->
            <!--站点 start-->
            <el-row type="flex"
                    style="background-color: #F5F5F5;margin-left: 87px; padding: 15px 0px 15px 0px;border-radius:4px;">
                <el-col :span="4" class="title-info-container title-min">
                    <div class="title-info" style="color:#000">{{$lang('站点')}}</div>
                </el-col>
                <el-col :span="22" class="search-item-i">
                    <span :class="{active:!form.siteData.length }" class="tab-item-border" @click="selectSite()"
                          style="float: left;">{{$lang('全部')}}</span>
                    <div class="search-item-i" style="padding-right: 140px;">
                        <el-button v-show="sites.length>= 8" @click="showMore = !showMore"
                                   style="position: absolute;right: 35px;" type="text">{{showMore ?$lang('收起') : $lang('展开')}}<i
                                :class="showMore ? 'el-icon-arrow-up' : 'el-icon-arrow-down'"
                                class="el-icon--right"></i>
                        </el-button>

                        <span :class="{active:site.checked}" class="tab-item-border" v-for="site in sites.slice(0,7)"
                              :data-cd="site.CD" @click="selectSite(site)">{{$lang(site.CD_VAL)}}</span>

                        <span v-show="showMore" class="tab-item-border" :class="{active:site.checked}"
                              v-for="site in sites.slice(7)" :data-cd="site.CD" @click="selectSite(site)">{{$lang(site.CD_VAL)}}</span>
                    </div>
                    <!-- <div class="search-item-i" v-show="showMore">
                        <span :class="{active:site.checked}" v-for="site in sites.slice(7)" :data-cd="site.CD" @click="selectSite(site)">{{$lang(site.CD_VAL)}}</span>
                    </div> -->

                </el-col>
            </el-row>
            <!-- 售后类型 start-->
            <el-row type="flex">
                <el-col :span="4" class="title-info-container">
                    <div class="title-info">{{$lang('售后类型')}}</div>
                </el-col>
                <el-col :span="22" class="search-item-i">
                    <span :class="{active:selectaftersalesTypeStatus == ''}" class="tab-item-min"
                          @click="selectaftersalesType('')">{{$lang('全部')}}</span>
                    <span :class="{active:selectaftersalesTypeStatus == '1'}" class="tab-item-min"
                          @click="selectaftersalesType('1')">{{$lang('补发')}}</span>
                    <span :class="{active:selectaftersalesTypeStatus == '2'}" class="tab-item-min"
                          @click="selectaftersalesType('2')">{{$lang('换货')}}</span>
                </el-col>
            </el-row>
            <!-- 售后类型 end -->

            <!-- 推荐类型 -->
            <el-row type="flex">
                <el-col :span="4" class="title-info-container">
                    <div class="title-info">{{$lang('推荐类型')}}</div>
                </el-col>
                <el-col :span="22" class="search-item-i">
                    <span :class="{active:!form.recommend.length}" class="tab-item-min" @click="selectGudsType()">{{$lang('全部')}}</span>
                    <span :class="{active:item.checked}" class="dispatch-item tab-item-min"
                          v-for="item in baseData.recommendType"
                          @click="selectGudsType(item)">{{$lang(item.CD_VAL)}}</span>
                </el-col>
            </el-row>
            <!-- 派单异常 -->
            <el-row type="flex">
                <el-col :span="4" class="title-info-container">
                    <div class="title-info">{{$lang('派单异常')}}</div>
                </el-col>
                <el-col :span="22" class="search-item-i">
                    <span :class="{active:!form.orderErrStatus.length}" class="tab-item-min" @click="sendOrderErr()">{{$lang('全部')}}</span>
                    <span :class="{active:item.checked}" class="dispatch-item tab-item-min"
                          v-for="item in baseData.orderErr" @click="sendOrderErr(item)">{{$lang(item.CD_VAL)}}</span>
                </el-col>
            </el-row>
        </div>
        <!-- 排序方式 start-->
        <el-row type="flex">
            <el-col :span="4" class="title-info-container">
                <div class="title-info">{{$lang('排序方式')}}</div>
            </el-col>
            <el-col :span="22" class="search-item-i">
                <span class="sort-type tab-item-min" v-for="item in baseData.sort"
                      :class="{active: item.CD == form.sort}" @click="selectSort(item.CD)">{{$lang(item.CD_VAL)}}</span>
                <span class="contain-remark" :class="{isActive: this.form.remarkHave}" @click="toggleRemark">{{$lang('含备注')}}</span>
                <span class="contain-remark" :class="{isActive: this.form.risk_value}" @click="toggleRisk">{{$lang('含高风险备注')}}</span>
                <span class="contain-remark" :class="{isActive: this.form.skuNoMate}" @click="skuDefault">{{$lang('SKU未匹配')}}</span>
                <span class="contain-remark" :class="{isActive: this.form.directionMsg}" @click="directionMsgPartial">{{$lang('收件人信息不全')}}</span>
                <span class="contain-remark" :class="{isActive: !!this.form.is_remote_area}" @click="toggleArea">{{$lang('偏远地区')}}</span>
                <span class="contain-remark" :class="{isActive: this.third_status}" @click="deliverStatus">{{$lang('标记发货')}}</span>
                <span class="contain-remark" :class="{isActive: this.third_status_doing}" @click="deliverStatusDoing">{{$lang('等待平台反馈')}}</span>
                <el-tooltip content="等待平台反馈（两分钟未收到反馈，可以重新标记）" placement="top" effect="dark">
                    <span class="contain-remark contain-remark-overflow" :class="{isActive: this.third_status_err}"
                          @click="deliverStatusErr">
                        {{$lang('等待平台反馈（两分钟未收到反馈，可以重新标记）')}}
                    </span>
                </el-tooltip>
                <span class="contain-remark contain-remark-overflow" :class="{isActive: this.markShipmentFailedStatus}"
                      @click="markShipmentFailed">{{$lang('标记发货失败')}}</span>
                <!-- <span class="contain-remark" :class="{isActive: this.form.third_deliver_status}" @click="deliverStatus">{{$lang('标记发货')}}</span> -->

                <!--  <span class="contain-remark" :class="{isActive: this.form.hasDefaultWarehouse}" @click="toggleDefault"><{$Think.lang.默认仓库}></span>
             <span class="contain-remark" :class="{isActive: this.form.thirdDeliverStatus}" @click="toggleThirdDeliverStatus"><{$Think.lang.已标记发货}></span> -->
            </el-col>
        </el-row>
        <!-- 排序方式 end-->
        <!-- 搜索查询 start-->
        <div class='cls' style="height:auto;">
            <el-col :span="4" class="title-info-container" style="height:100%;">
                <div class="title-info">{{$lang('条件筛选')}}</div>
            </el-col>
            <el-col :span="22" class="search-item-i" style=" width: calc(100% - 80px);">
                <div class="fl sort-item">
                    <el-select :popper-append-to-body=false filterable size="small" :multiple-limit=10
                               v-model="form.country" multiple collapse-tags :placeholder="$lang('国家')"
                               style="width:300px;">
                        <el-option v-for="item in baseData.country" :key="item.id" :label="$lang(item.NAME)"
                                   :value="item.id"></el-option>
                    </el-select>
                </div>
                <div class="fl sort-item">
                    <el-select :popper-append-to-body=false filterable size="small" :multiple-limit=10
                               v-model="form.shop" multiple collapse-tags :placeholder="$lang('店铺')"
                               style="width:300px;">
                        <el-option v-for="item in baseData.shop" :key="item.CD" :label="$lang(item.CD_VAL)"
                                   :value="item.CD"></el-option>
                    </el-select>
                </div>
                <div class="fl sort-item">
                    <el-select :popper-append-to-body=false filterable size="small" :multiple-limit=10
                               v-model="form.warehouse" multiple collapse-tags :placeholder="$lang('仓库')"
                               style="width:300px;">
                        <el-option v-for="item in baseData.warehouse" :key="item.CD" :label="$lang(item.CD_VAL)" :value="item.CD"></el-option>
                        <!-- 增加其他筛选项  固定写死 -->
                        <el-option :label="$lang('其他')" value="NON"></el-option>
                    </el-select>
                </div>
                <div class="fl sort-item">
                    <el-select :popper-append-to-body=false filterable size="small" :multiple-limit=10
                               v-model="form.logisticsCompany" multiple collapse-tags :placeholder="$lang('物流公司')"
                               style="width:300px;" @change="changeLogCom">
                        <el-option v-for="(item,key) in baseData.logisticsCompany" :key="key"
                                   :label="$lang(item.CD_VAL)" :value="item.CD"></el-option>
                    </el-select>
                </div>
                <div class="fl sort-item">
                    <el-select :popper-append-to-body=false filterable size="small" :multiple-limit=10
                               v-model="form.logisticsMethod" multiple collapse-tags :placeholder="$lang('物流方式')"
                               style="width:300px;">
                        <el-option v-for="(item,index) in baseData.shipping" :key="index" :label="$lang(item.CD_VAL)"
                                   :value="item.ID"></el-option>
                    </el-select>
                </div>
                <div class="fl sort-item">
                    <el-select :popper-append-to-body=false filterable size="small" :multiple-limit=10
                               v-model="form.salesTeam" multiple collapse-tags :placeholder="$lang('销售团队')"
                               style="width:300px;">
                        <el-option v-for="item in baseData.salesTeam" :key="item.CD" :label="$lang(item.CD_VAL)"
                                   :value="item.CD"></el-option>
                    </el-select>
                </div>
                <div class="fl sort-item">
                    <el-select :popper-append-to-body=false filterable size="small" :multiple-limit=10
                               v-model="form.surfaceWayGet" multiple collapse-tags :placeholder="$lang('面单获取方式')"
                               style="width:300px;">
                        <el-option v-for="item in baseData.surfaceWayGet" :key="item.CD" :label="$lang(item.CD_VAL)"
                                   :value="item.CD"></el-option>
                    </el-select>
                </div>
                <div class="fl sort-item">
                    <el-select :popper-append-to-body=false filterable size="small" :multiple-limit=10 v-model="form.sell_small_team" multiple collapse-tags :placeholder="$lang('销售小团队（仅支持TPP平台搜索）')" style="width:300px;">
                        <el-option v-for="item in baseData.sell_small_team" :key="item.CD" :label="$lang(item.CD_VAL)" :value="item.CD"></el-option>
                    </el-select>
                </div>
                <!--<div class="fl sort-item">
                    <el-select :popper-append-to-body=false filterable size="small" :multiple-limit=10
                               v-model="form.logisticsSingle" multiple collapse-tags :placeholder="$lang('面单获取情况')"
                               style="width:300px;">
                        <el-option v-for="item in baseData.logisticsSingle" :key="item.CD" :label="$lang(item.CD_VAL)"
                                   :value="item.CD"></el-option>
                    </el-select>
                </div>-->

                <div class="fl sort-item">
                    <el-select :popper-append-to-body=false size="small" :multiple-limit=10
                               v-model="form.chooseRepertory" multiple collapse-tags :placeholder="$lang('库存是否充足')"
                               style="width:300px;" @change="selseRepertory">
                        <el-option v-for="item in isHaveRepertory" :key="item.id" :label="$lang(item.value)"
                                   :value="item.id">
                        </el-option>
                    </el-select>
                </div>
                <div class="fl sort-item">
                    <el-select :popper-append-to-body=false size="small" :multiple-limit=10 v-model="form.orderState"
                               multiple collapse-tags :placeholder="$lang('订单状态')" style="width:300px;">
                        <el-option v-for="item in baseData.orderStatus" :key="item.CD" :label="$lang(item.CD_VAL)"
                                   :value="item.CD">
                        </el-option>
                    </el-select>
                </div>
                <!--<div class="fl sort-item">
                    <el-select :popper-append-to-body=false size="small" v-model="form.address_valid_status" multiple collapse-tags :placeholder="$lang('收货地址校验')" style="width:300px;" clearable>
                        <el-option :label="$lang('校验有误')" value="1"></el-option>
                        <el-option :label="$lang('校验正确')" value="2"></el-option>
                    </el-select>
                </div>-->
                <div class="fl sort-item">
                    <div>
                        <el-select :popper-append-to-body=false filterable size="small" v-model="form.timeSort">
                            <el-option v-for="item in baseData.sort" :key="item.CD" :label="$lang(item.CD_VAL)" :value="item.CD">
                            </el-option>
                        </el-select>
                        <el-date-picker value-format="yyyy-MM-dd HH:mm:ss" size="small" v-model="form.dateRange" type="datetimerange" :default-time="['00:00:00', '23:59:59']" align="right" unlink-panels :range-separator="$lang('至')" :start-placeholder="$lang('开始日期')" :end-placeholder="$lang('结束日期')" :picker-options="pickerOptions"></el-date-picker>
                    </div>
                </div>
                <div class="fl sort-item">
                    <el-select :popper-append-to-body=false filterable size="small" v-model="form.addressUserAddress1" :placeholder="$lang('地址1是否为空')" style="width:200px;" clearable>
                        <el-option  :label="$lang('地址1不为空')" value="1"></el-option>
                        <el-option  :label="$lang('地址1为空')" value="2"></el-option>
                    </el-select>
                </div>
            </el-col>
        </div>
        <div class="search-btn-container">
            <div class="btns" style="padding-left: 80px;">
                <el-select class="filter-order" :popper-append-to-body=false filterable size="small"
                           v-model="formSecond.downQuery" :placeholder="$lang('请选择')" style="width:150px">
                    <el-option v-for="item in baseData.downQuery" :key="item.CD" :label="$lang(item.CD_VAL)"
                               :value="item.CD"></el-option>
                </el-select>
                <el-input size="small" style="width: 290px;" class="search-keywords"
                          @keyup.enter.native="submit_keywords" v-model="formSecond.keywords"></el-input>
                <button @click="doSearch" id="doSearchBtn" class="btn-search" name="search">{{$lang('搜索')}}</button>
                <button @click="doReset" class="btn-reset" name="reset">{{$lang('重置')}}</button>
            </div>
        </div>
        <!-- 搜索查询 end-->
    </div>
    <!-- 分割线 start-->
    <div class="orderList-line line-split"></div>
    <!-- 分割线 end-->

    <!-- 订单表格主体 start-->
    <div class="orderList-Main list-common-main">
        <header style="height: auto;margin: 0;">
            <el-row>
                <el-col :span="8">
                    {{$lang('搜索结果:共')}}
                    <span class="num-bold">{{form.chooseRepertory.length == 0 ? totalCount : listData.length}}</span>
                    {{$lang('条记录')}}
                    <el-button style="margin-left:5px" @click="exportOrder" type="text">{{$lang('导出')}}</el-button>
                    <?php if(ButtonAction::hidden()){ ?>
                    <el-button style="margin-left:5px" @click="importOrder" type="text">{{$lang('导入')}}</el-button>
                    <form id="otherImport" action="/index.php?g=OMS&m=Patch&a=importExcel" method="post"
                          enctype="multipart/form-data" style="display:none">
                        <input type="file" name="expe" id="activeImport" onchange="$('#otherImport').submit()">
                    </form>
                    <?php } ?>
                    <el-button style="margin-left:5px" @click="downTmep" type="text">{{$lang('模板下载')}}</el-button>
                    <?php if (checkPermissions('Oms/order', 'logisicsEdit')) { ?>
                    <el-button style="margin-left:5px" @click="editExcel" type="text">{{$lang('Excel编辑')}}</el-button>
                    <?php } ?>
                    <form id="importEditExcel" action="/index.php?g=oms&m=order&amp;a=logisicsEdit" method="post" enctype="multipart/form-data" style="display:none">
                        <input type="file" name="expe" id="excelFile" onchange="$('#importEditExcel').submit()">
                    </form>
                    <el-button style="margin-left:10px;color: #d01f1f;" @click="deleOrder" type="text">
                        {{$lang('删除订单')}}
                    </el-button>
                </el-col>
                <el-col :span="11" v-if="popIsShow" class="condition-choose edit-choose">
                    <div class="fl">
                        <el-select :popper-append-to-body=false size="small" @change="selectEditWarehouse" filterable
                                   :multiple-limit=10 v-model="chooseWarehouse" collapse-tags :placeholder="$lang('仓库')"
                                   style="width:170px;">
                            <el-option v-for="item in baseData.warehouse" :key="item.CD" :label="$lang(item.CD_VAL)"
                                       :value="item.CD"></el-option>
                        </el-select>
                    </div>
                    <div class="fl">
                        <el-select :popper-append-to-body=false size="small" @change="selectLogisticsCompany" filterable
                                   :multiple-limit=10 v-model="selectCompany" collapse-tags :placeholder="$lang('物流公司')"
                                   style="width:170px;">
                            <el-option v-for="(item,key) in baseData.logisticsCompany" :key="key"
                                       :label="$lang(item.CD_VAL)" :value="item.CD"></el-option>
                        </el-select>
                    </div>
                    <div class="fl">
                        <el-select :popper-append-to-body=false size="small" @change="logisticsWayChange"
                                   :multiple-limit=10 v-model="logisticsWay" filterable collapse-tags
                                   :placeholder="$lang('物流方式')" style="width:170px;">
                            <el-option v-for="(item,index) in logisticsWayData" :key="index" :label="$lang(item.CD_VAL)"
                                       :value="item.ID"></el-option>
                        </el-select>
                    </div>

                    <div class="fl">
                        <el-select :popper-append-to-body=false size="small" @change="faceSheetChange"
                                   :multiple-limit=10 v-model="faceSheet" filterable collapse-tags
                                   :placeholder="$lang('面单情况')" style="width:170px;">
                            <el-option v-for="(item,index) in faceSheetData" :key="index" :label="$lang(item.CD_VAL)"
                                       :value="item.CD"></el-option>
                        </el-select>
                    </div>
                </el-col>
                <el-col :span="8" v-if="remarkEdit">
                    <el-input v-model="batchRemarks" :placeholder="$lang('运营备注')" @input="remarksChange"></el-input>
                </el-col>
                <el-col :span="16" class="text-right" v-if="!batchEdit && !addressEdit && !remarkEdit">
                    <el-button class="blue-btn" type="primary" @click="batchFn('editRemark')">{{$lang('编辑备注')}}
                    </el-button>
                    <el-button class="blue-btn" type="primary" @click="centerDialogVisible = true">{{$lang('延迟发货')}}
                    </el-button>
                    <?php if(ButtonAction::hidden()){ ?>
                    <el-button class="blue-btn" type="primary" @click="batchFn('addressEdit')">{{$lang('修改地址')}}
                    </el-button>
                    <?php } ?>
                    <?php if(ButtonAction::hidden()){ ?>
                    <el-button class="blue-btn" type="primary" @click="ship">{{$lang('标记发货')}}</el-button>
                    <?php } ?>
                    <?php if (ButtonAction::hidden() && checkPermissions('Oms/Patch', 'waitLogisticsUpdate')) { ?>
                    <el-button class="blue-btn" type="primary" @click="batchFn('edit')">{{$lang('批量编辑')}}</el-button>
                    <?php } ?>
                    <?php if(ButtonAction::hidden()){ ?>
                    <el-button class="common-btn" @click="batchFn('assgin')"
                               v-loading.fullscreen.lock="fullscreenLoading">{{$lang('批量派单')}}
                    </el-button>
                    <el-button class="common-btn" @click="batchFn('AKeyToGet')"
                               v-loading.fullscreen.lock="fullscreenLoading">{{$lang('批量派单+获取单号')}}
                    </el-button>
                    <?php } ?>
                </el-col>
                <el-col :span="popIsShow ? 4 : 6" class="text-right" v-if="batchEdit" style="float: right;">
                    <el-button class="border-btn" round plain @click="doSearch">{{$lang('批量取消')}}</el-button>
                    <!--batchFnCancel本来是这个-->
                    <?php if(ButtonAction::hidden()){ ?>
                    <button class="common-btn" :disabled="isBtnLoading" @click="batchFn('save')">{{$lang('批量保存')}}
                    </button>
                    <?php } ?>
                </el-col>
                <el-col :span="6" v-if="remarkEdit">
                    <el-button class="border-btn" round plain @click="batchCancelRemarks">{{$lang('批量取消')}}</el-button>
                    <el-button class="border-btn" round plain @click="batchFn('remarkSave')">{{$lang('批量保存')}}</el-button>
                </el-col>
                <el-col :span="6" class="text-right" v-if="addressEdit" style="float: right;">
                    <el-button class="border-btn" round plain @click="doSearch">{{$lang('取消修改')}}</el-button>
                    <?php if(ButtonAction::hidden()){ ?>
                    <button class="common-btn" :disabled="isBtnLoading" @click="batchFn('addressSave')">
                        {{$lang('保存修改')}}
                    </button>
                    <?php } ?>
                </el-col>
                <el-col :span="24">
                    <b>{{$lang('已选择')}}</b>&nbsp;&nbsp;{{isCheck}}&nbsp;&nbsp;
                    <el-button type="text" @click="inverseSelection">{{$lang('反选')}}</el-button>
                </el-col>
            </el-row>
        </header>
        <el-dialog :visible.sync="delePop" width="30%">
            <span style="display: block;padding: 10px 0 0 20px;">{{$lang('删除订单')}}</span>
            <div class="choose-radius">
                <el-radio v-model="deleChoose" label="1">{{$lang('取消订单（订单列表可查询)')}}</el-radio>
                <el-radio v-model="deleChoose" label="2">{{$lang('删除订单（仅导入订单）')}}</el-radio>
            </div>
            <span slot="footer" class="dialog-footer">
                        <el-button @click="delePop = false">{{$lang('取 消')}}</el-button>
                        <el-button type="primary" @click="deleOrderConfirm">{{$lang('确 定')}}</el-button>
                    </span>
            </span>
        </el-dialog>
        <!-- 获取单号有万邑通发往德国的前置操作弹窗 -->

        <el-dialog :visible="warehouseTipShow" width="500px" :title="$lang('提示')" class="tip-dialog" center :show-close="false" >
            <div style="position:relative;">{{$lang('订单')}}
                <el-tooltip class="item" effect="light" placement="top-start"  v-if="verificationFailedList.length >5">
                    <div slot="content" style="width: 420px;word-wrap: break-word;word-break: normal;">
                        <span v-for="(item,index) in verificationFailedList" :key="index">{{item}},</span>
                    </div>
                    <span>
                        （
                        <span v-for="(item,index) in verificationFailedList" :key="index" v-if="index<5">{{item}},</span>
                        <span v-if="verificationFailedList.length > 5">....</span>
                        ）
                    </span>
                </el-tooltip>
                <span v-else>
                    （<span v-for="(item,index) in verificationFailedList" :key="index">{{item}},</span>）
                </span>
                {{$lang('共')}}{{verificationFailedList.length}}{{$lang('单，走万邑通仓发往德国且校验地址有误，请确认！')}}
                <i class="el-icon-close" @click="warehouseTipShow = false" style="position: absolute;right: 0;top: -60px;cursor: pointer;font-size: 22px;"></i>
            </div>
            <div style="color: #888;">（{{$lang('可全部获取运单，但万邑通会收取相应的地址校验费！ 详情咨询仓库人员，部分获取是只获取地址正常的订单，过滤地址有误的订单')}}）</div>
            <div slot="footer">
                <div class="section-btn" @click="queryClick('part')" v-if="multipleSelection.length-verificationFailedList.length > 0">{{$lang('部分获取')}}（{{$lang('共')}}{{multipleSelection.length-verificationFailedList.length}}{{$lang('单')}}）</div>
                <div class="section-btn" @click="queryClick('all')">{{$lang('全部获取')}}（{{$lang('共')}}{{multipleSelection.length}}{{$lang('单')}}）</div>
            </div>
        </el-dialog>


        <el-dialog
                :title="$lang('注意！')"
                :visible.sync="dialogBatchDditing"
                class="batchEditingDialog"
                width="40%"
                :before-close="closeBatchDditing">
            <!-- <div style="padding: 15px;color:#D01F1F;">注意！</div> -->
            <ul style="padding: 0 30px;font-size: 12px;max-height: 200px;overflow: auto;" v-if="dialogBatchDditingData.type == 'edit'">
                <li v-for="(item,index) in dialogBatchDditingData.data" style="margin-bottom: 8px"> <span style="font-weight: bold;color: red; ">{{item.order_no}} : </span>{{$lang('已经向第三方物流公司')}}"{{item.logistic_name}}"{{$lang('获取单号，请注意不要重复发货！')}}</li>
            </ul>
            <ul style="padding: 0px 30px 16px 30px;font-size: 12px;max-height: 200px;overflow: auto;" v-if="dialogBatchDditingData.type == 'save'">
                <li v-for="(item,index) in dialogBatchDditingData.data" style="white-space:nowrap;margin-bottom: 8px">
                    <span style="font-weight: bold;color: red">{{item.order_no}} : </span>{{$lang('在已经操作“获取单号”的前提下')}}，
                    <span v-if="item.change.delivery_warehouse|| item.change.logistics_company || item.change.shipping_methods">{{$lang('由')}}< <span v-if="item.change.delivery_warehouse">{{item.change.delivery_warehouse.old}}</span><span v-if="item.change.logistics_company">-{{item.change.logistics_company.old}}</span><span v-if="item.change.shipping_methods">-{{item.change.shipping_methods.old}}</span> > {{$lang('变为')}} < <span v-if="item.change.delivery_warehouse">{{item.change.delivery_warehouse.new}}</span><span v-if="item.change.logistics_company">-{{item.change.logistics_company.new}}</span><span v-if="item.change.shipping_methods">-{{item.change.shipping_methods.new}}</span> >，
                    </span>
                    <span v-if="item.change.waybill_number">{{$lang('运单号由')}}< {{item.change.waybill_number.old}} > {{$lang('变成了')}} < {{item.change.waybill_number.new}} >，</span>
                    {{$lang('请注意！')}}
                </li>
            </ul>
            <span slot="footer" class="dialog-footer">
                <!-- <el-button @click="dialogBatchDditing = false">下载提示结果</el-button> -->
                <el-button v-if="dialogBatchDditingData.type == 'edit'" @click="cancelBatchDditing">{{$lang('取消')}}</el-button>
                <el-button v-if="dialogBatchDditingData.type == 'edit'" type="primary" @click="goonBatchDditing">{{$lang('继续操作')}}</el-button>
                <el-button v-if="dialogBatchDditingData.type == 'save' && dialogBatchDditingData.partNum > 0" @click="saveBatchDditing('part')">{{$lang('部分保存')}}({{$lang('共')}}{{dialogBatchDditingData.partNum}}{{$lang('单')}})</el-button>
                <el-button v-if="dialogBatchDditingData.type == 'save' && dialogBatchDditingData.partNum == 0" @click="cancelBatchDditing">{{$lang('取消')}}</el-button>
                <el-button v-if="dialogBatchDditingData.type == 'save'" type="primary" @click="saveBatchDditing('all')">{{$lang('全部保存')}}({{$lang('共')}}{{dialogBatchDditingData.allNum}}{{$lang('单')}})</el-button>
            </span>
        </el-dialog>


        <!-- 列表区域 -->
        <el-table border show-header ref="multipleTable" :data="listData" tooltip-effect="dark" @select="seleItem"
                  @select-all="selectAllItem" @selection-change="handleSelectionChange" v-loading="tableLoading"
                  class="order-list-table table-common">
            <el-table-column type="selection" width="40"></el-table-column>
            <el-table-column :label="$lang('站点&店铺')" width="80">
                <template slot-scope=scope>
                    <div style="margin-bottom: 5px">{{$lang(scope.row.platform)}}</div>
                    <div>{{$lang(scope.row.shop)}}</div>
                </template>
            </el-table-column>
            <!-- <el-table-column prop="sales_team" label="<{$Think.lang.销售团队}>"></el-table-column> -->
            <el-table-column :label="$lang('平台订单号')" width="120">
                <template slot-scope="scope">
                    <div class="third-order">
                        <span>{{scope.row.third_party_order_number?scope.row.third_party_order_number:scope.row.third_order_number}}</span>
                        <a class="to-detail-btn"
                           @click="toDetail(scope.row.third_party_order_number,scope.row.third_order_number, scope.row.plat_cd)">{{$lang('查看')}}</a>
                    </div>
                    <span v-if="+scope.row.is_remote_area" class="remote_area">{{$lang('偏远地区')}}</span>
                    <div class="orderLogo">
                        <span v-show="scope.row.addressUserCountryIdNm">{{$lang(scope.row.addressUserCountryIdNm)}}</span>
                        <span v-if="scope.row.after_sale_type == '1'">{{$lang('补发')}}</span>
                        <span v-if="scope.row.after_sale_type == '2'">{{$lang('换货')}}</span>
                        <!-- <span v-if="scope.row.after_sale_type == ''"></span> -->
                    </div>
                </template>
            </el-table-column>
            <!-- <el-table-column prop="currency" label="<{$Think.lang.币种}>" width="60"></el-table-column> -->
            <el-table-column :label="$lang('价格')">
                <template slot-scope="scope">
                    <div>
                        {{scope.row.price}}
                    </div>
                    <div v-if="scope.row.currency">
                        ( {{scope.row.currency}} )
                    </div>
                </template>
            </el-table-column>
            <el-table-column label="<{$Think.lang.时间}>" width="180">
                <template slot-scope="scope">
                    <div v-if="!!scope.row.order_time">{{$lang('下单时间')}}：{{scope.row.order_time | formatDate}}</div>
                    <div v-if="!!scope.row.payment_time">{{$lang('付款时间')}}：{{scope.row.payment_time | formatDate}}</div>
                    <div v-if="!!scope.row.shipping_time">{{$lang('平台发货时间')}}：{{scope.row.shipping_time | formatDate}}
                    </div>
                </template>
            </el-table-column>
            <el-table-column :label="$lang('商品名称')" width="120">
                <template slot-scope="scope">
                    <span class="shopTag" v-if="scope.row.thirdDeliverStatus == 0">
                                <!--<el-tag size="mini" style="background-color: #a64848; border: 1px solid rgb(38, 148, 120) !important;color: #FFFFFF;">{{$lang('待标记发货')}}</el-tag>-->
                            </span>
                    <span class="shopTag" v-if="scope.row.thirdDeliverStatus == 1">
                                <el-tag size="mini"
                                        style="background-color: #557c72; border: 1px solid rgb(38, 148, 120) !important;color: #FFFFFF;">{{$lang('已标记发货')}}</el-tag>
                            </span>
                    <span class="shopTag" v-if="scope.row.thirdDeliverStatus == 2">
                                <el-tag size="mini"
                                        style="background-color: #557c72; border: 1px solid rgb(38, 148, 120) !important;color: #FFFFFF;">{{$lang('等待平台反馈')}}</el-tag>
                            </span>
                    <span class="shopTag" v-if="scope.row.thirdDeliverStatus == 3">
                        <el-tooltip content="等待平台反馈（两分钟未收到反馈，可以重新标记）" placement="top" effect="dark">
                            <el-tag size="mini"
                                    style="background-color: #557c72; border: 1px solid rgb(38, 148, 120) !important;color: #FFFFFF;width: 110px;text-overflow: ellipsis;overflow: hidden;white-space: nowrap">
                                {{$lang('等待平台反馈（两分钟未收到反馈，可以重新标记）')}}
                            </el-tag>
                        </el-tooltip>
                    </span>

                    <span class="shopTag" v-if="scope.row.thirdDeliverStatus == 4">
                        <el-tag size="mini"
                                style="background-color: #557c72; border: 1px solid rgb(38, 148, 120) !important;color: #FFFFFF;">
                            {{$lang('标记发货失败')}}
                        </el-tag>
                    </span>
                    <div v-if="scope.row.guds.length" :title="$lang(scope.row.guds[0].product_name)">
                        <div class="overflow"> {{$lang(scope.row.guds[0].product_name)}}</div>
                        <div class="overflow" v-if="scope.row.guds[0].optNameValueStr">( <span
                                v-html="scope.row.guds[0].optNameValueStr"></span> )
                        </div>
                    </div>
                    <el-popover placement="bottom" width="260" trigger="click" style="padding:0;"
                                v-if="scope.row.guds.length > 1">
                        <div v-for="item in scope.row.guds">
                            <div class="overflow">{{$lang(item.product_name)}}</div>
                            <div class="overflow" v-if="item.optNameValueStr">( <span
                                    v-html="item.optNameValueStr"></span> )
                            </div>
                        </div>
                        <div slot="reference" class="name-wrapper">
                            <i class='el-icon-d-arrow-left' slot="reference"></i>
                        </div>
                    </el-popover>
                </template>
            </el-table-column>
            <el-table-column :label="$lang('库存')">
                <template slot-scope="scope">
                    <div>
                        <span v-if="scope.row.stock_adequate == 1">{{$lang('库存充足')}}</span>
                        <span v-if="scope.row.warehouse && scope.row.stock_adequate == 0" style="color: #d01f1f;">{{$lang('库存不足')}}</span>
                    </div>
                    <el-popover placement="bottom" width="300" trigger="click" style="padding:0;"
                                v-if="scope.row.warehouse">
                        <div>
                            <el-table size="small " border show-header :data="scope.row.stock" tooltip-effect="dark"
                                      class="order-list-table table-common">
                                <el-table-column width="100" label="SKU ID" prop="sku"></el-table-column>
                                <el-table-column width="100" :label="$lang('需求数')" prop="need_num"></el-table-column>
                                <el-table-column width="100" :label="$lang('可售库存')"
                                                 prop="available_inventory"></el-table-column>
                            </el-table>
                        </div>
                        <div slot="reference" class="name-wrapper">
                            <i class='el-icon-d-arrow-left' slot="reference"
                               :class="{'save': scope.row.stock_adequate == 0}"></i>
                        </div>
                    </el-popover>
                </template>
            </el-table-column>
            <el-table-column prop="freight" :label="$lang('运费试算')"></el-table-column>
            <el-table-column prop="warehouse" :label="$lang('下发仓库')" width="125">
                <template slot-scope="scope">
                    <div v-if="!scope.row.edit && scope.row.warehouse">{{$lang(scope.row.warehouse_name)}}</div>
                    <div v-if="scope.row.edit">
                        <el-select class="select-value"
                                   :disabled="scope.row.isDisabled"
                                   filterable
                                   @change="changeWarehouse(scope.row.warehouse,scope.row)"
                                   :popper-append-to-body=false
                                   v-model="scope.row.warehouse" :placeholder="$lang('下发仓库')">
                            <el-option v-for="item in scope.row.allWarehouse" :key="item.cd" :label="$lang(item.name)"
                                       :value="item.cd"></el-option>
                        </el-select>
                    </div>
                </template>
            </el-table-column>
            <el-table-column :label="$lang('物流公司')" width="125">
                <template slot-scope="scope">
                    <!-- {{scope.row.warehouse}} -->
                    <div v-if="!scope.row.edit">{{$lang(scope.row.logistics_company_name)}}</div>
                    <div v-if="scope.row.edit">
                        <!-- scope.row.logistics_company chooseModel editCompany -->
                        <el-select :popper-append-to-body=false
                                   :disabled="scope.row.isDisabled"
                                   filterable
                                   v-model="scope.row.logistics_company"
                                   @change="changeLogCompany(scope.row, scope.row.logistics_company)"
                                   :placeholder="$lang('物流公司')" @focus="selHouse(scope.row)">
                            <el-option v-for="item in scope.row.logisticsCompany" :key="item.logisticsCode"
                                       :label="$lang(item.logisticsName)" :value="item.logisticsCode">
                            </el-option>
                        </el-select>
                    </div>
                </template>
            </el-table-column>
            <el-table-column :label="$lang('物流方式')" width="125">
                <template slot-scope="scope">
                    <!-- {{scope.row.logistics_company}} -->
                    <div v-if="!scope.row.edit">{{$lang(scope.row.logistics_type_name)}}</div>
                    <div v-if="scope.row.edit">
                        <el-select :popper-append-to-body=false
                                   :disabled="scope.row.isDisabled"
                                   filterable v-model="scope.row.logistics_type"
                                   :placeholder="$lang('物流方式')" @focus="selCom(scope.row)"
                                   @change="changeLogMethod(scope.row, scope.row.logistics_type)">
                            <el-option v-for="item in scope.row.logisticsMethod" :key="item.id"
                                       :label="$lang(item.logisticsMode)" :value="item.id"></el-option>
                        </el-select>
                    </div>
                </template>
            </el-table-column>
            <el-table-column prop="waybill_number" :label="$lang('运单号')" width="125">
                <template slot-scope="scope">
                    <!-- {{scope.row.logistics_type}} -->
                    <div v-if="!scope.row.edit">{{scope.row.waybill_number}}</div>
                    <div v-if="scope.row.edit">
                        <el-input v-model="scope.row.waybill_number"
                                  :disabled="scope.row.isDisabled"
                                  @change="change_waybill_number(scope.row)"
                                  :placeholder="$lang('运单号')"></el-input>
                    </div>
                </template>
            </el-table-column>
            <el-table-column prop="electronic_single" :label="$lang('面单')" width="125">
                <template slot-scope="scope">
                    <div @mouseenter="showTips(scope.row)" @mouseleave="showTips(scope.row)">
                        <div class="error-tips"
                             v-if="scope.row.logisticsSingleStatuCdNm === $lang('获取面单失败') && scope.row.isShow && scope.row.logisticsSingleErrorMsg !== '' && scope.row.surfaceWayGetCd !== 'N002010200'">
                            {{$lang(scope.row.logisticsSingleErrorMsg)}}
                        </div>
                        <div v-if="!scope.row.edit">
                            <div>{{$lang(scope.row.surfaceWayGetCdNm)}}</div>
                            <div v-if="scope.row.surfaceWayGetCd == 'N002010100'"
                                 :style="{color: scope.row.logisticsSingleStatuCdNm == $lang('获取面单失败') ? '#d01f1f' : '#606266'}">
                                {{$lang(scope.row.logisticsSingleStatuCdNm)}}
                            </div>
                        </div>
                        <div v-if="scope.row.edit">
                            <el-select :popper-append-to-body=false
                                       :disabled="scope.row.isDisabled"
                                       @change="expressSheetChange(scope.row, scope.row.surfaceWayGetCd)"
                                       v-model="scope.row.surfaceWayGetCd" :placeholder="$lang('面单获取')"
                                       @focus="selOrder(scope.row)">
                                <el-option v-for="item in scope.row.faceData" :key="item.CD" :label="$lang(item.CD_VAL)"
                                           :value="item.CD"></el-option>
                            </el-select>
                        </div>
                        <span class="address_tooltip auto" v-if="scope.row.is_auto_get_no">自动</span>
                    </div>
                </template>
            </el-table-column>
            <!-- <el-table-column prop="address" :label="$lang('面单失败信息')" width="100">
                <template slot-scope="scope">
                    &lt;!&ndash;  @mouseenter="showTips2(scope.row)" @mouseleave="showTips2(scope.row)" 该方法不存在，避免保存 &ndash;&gt;
                    <div>
                        <div style="display:-webkit-box;-webkit-line-clamp:3;-webkit-box-orient:vertical;overflow:hidden;"
                             v-if="(scope.row.logisticsSingleStatuCdNm === '获取面单失败' || scope.row.logisticsSingleStatuCdNm === '单号获取中（待）') && scope.row.surfaceWayGetCd !== 'N002010200'">
                             <el-tooltip class="item" effect="dark" :content="scope.row.logisticsSingleErrorMsg" placement="top-start">
                                <span>
                                    {{scope.row.logisticsSingleErrorMsg}}
                                </span>
                              </el-tooltip>
                        </div>
                        <div class="error-tips"
                             v-if="(scope.row.logisticsSingleStatuCdNm === '获取面单失败' || scope.row.logisticsSingleStatuCdNm === '单号获取中（待）') && scope.row.isShow2 && scope.row.logisticsSingleErrorMsg !== '' && scope.row.surfaceWayGetCd !== 'N002010200'">
                            {{$lang(scope.row.logisticsSingleErrorMsg)}}
                        </div>
                    </div>
                </template>
            </el-table-column> -->
            <el-table-column prop="address" :label="$lang('地址1')" width="100">
                <template slot-scope="scope">
                    <div v-if="!scope.row.addressEdit" style="padding-bottom: 15px;">
                        {{scope.row.address}}
                        <span class="address_tooltip" v-if="scope.row.address">{{scope.row.address.length}}</span>
                        <span class="address_check check_n" v-if="scope.row.address_valid_status == 1">{{$lang('校验有误')}}</span>
                        <span class="address_check check_y" v-if="scope.row.address_valid_status == 2">{{$lang('校验正常')}}</span>
                    </div>
                    <div v-if="scope.row.addressEdit">
                        <el-input v-model="scope.row.address" :placeholder="$lang('地址1')"></el-input>
                    </div>
                </template>
            </el-table-column>
            <el-table-column prop="doorplate" :label="$lang('门牌号')" width="100">
                <template slot-scope="scope">
                    <div v-if="!scope.row.addressEdit">{{scope.row.doorplate}}</div>
                    <div v-if="scope.row.addressEdit">
                        <el-input v-model="scope.row.doorplate" :placeholder="$lang('门牌号')"></el-input>
                    </div>
                </template>
            </el-table-column>
            <!-- <el-table-column prop="send_ord_msg" label="<{$Think.lang.派单异常}>"></el-table-column> -->
            <el-table-column :label="$lang('备注')" width="110">
                <template slot-scope="scope">
                    <div>
                        <el-input v-model="scope.row.remarks" type="textarea" :row="3" :placeholder="$lang('运营备注')" v-if="scope.row.remarkEdit"></el-input>
                        <div class="do-remark" @click="doRemark(scope.row)" v-else>
                            <span v-if="scope.row.use_remarks">{{$lang(scope.row.use_remarks)}}</span>
                            <span v-if="!scope.row.use_remarks && scope.row.remarks">{{$lang(scope.row.remarks)}}</span>
                            <span v-if="!scope.row.use_remarks && !scope.row.remarks">{{$lang('备注')}}</span>
                        </div>
                    </div>
                    
                    <el-dialog :visible.sync="dialogVisible" :show-close="false" width="420px">
                        <el-tabs type="border-card">
                            <el-tab-pane :label="$lang('用户备注')">
                                <div class="use_remarks_content">{{$lang(formThird.use_remarks)}}</div>
                            </el-tab-pane>
                            <el-tab-pane :label="$lang('运营备注')">
                                <textarea class="operate-remark" cols="40" rows="10"
                                          v-model="formThird.remarks"></textarea>
                                <div class="btns remark-btn">
                                    <?php if(ButtonAction::hidden()){ ?>
                                    <button class="save-remark-btn" @click="saveRemark(scope.row)">{{$lang('保存')}}
                                    </button>
                                    <?php } ?>
                                    <button class="cancel-remark-btn" @click='cancelRemark()'>{{$lang('取消')}}</button>
                                </div>
                            </el-tab-pane>
                        </el-tabs>

                    </el-dialog>
                </template>
            </el-table-column>
            <el-table-column
                    :label="$lang('操作')">
                <template slot-scope="scope">
                    <div v-if="!scope.row.edit">
                        <div style="margin-bottom:10px">
                            <?php if(ButtonAction::hidden()){ ?>
                            <el-button class="blue-btn no-ml" type="primary" size="small"
                                       style="width:70px;text-align:center;padding:7px 0;"
                                       @click="singleFn('assgin',scope.row)">{{$lang('派单')}}
                            </el-button>
                            <?php } ?>
                        </div>
                        <div>
                            <?php if(ButtonAction::hidden()){ ?>
                            <el-button class="common-btn no-ml"
                                       v-if="scope.row.is_spilt == 0 && scope.row.is_sup_spilt == 1" size="small"
                                       style="width:70px;text-align:center;padding:7px 0;"
                                       @click="singleFn('tear',scope.row)">{{$lang('拆单')}}
                            </el-button>
                            <?php } ?>
                            <?php if(ButtonAction::hidden()){ ?>
                            <el-button class="border-btn no-ml" v-if="scope.row.is_spilt == 1" size="small"
                                       style="width:70px;text-align:center;padding:7px 0;"
                                       @click="singleFn('cancelTear',scope.row)">{{$lang('取消拆单')}}
                            </el-button>
                            <?php } ?>
                        </div>
                    </div>
                </template>
            </el-table-column>
        </el-table>

        <el-pagination background @size-change="handleSizeChange" @current-change="handleCurrentChange"
                       :current-page.sync="currentPage" :page-sizes="[10, 30, 50, 100]" :page-size="pageSize"
                       layout="sizes,prev, pager, next, jumper" :total="totalCount"></el-pagination>
    </div>
    <!-- 订单表格主体 end-->
    <el-dialog
            id="dialog"
            title="延迟发货时间选择"
            :visible.sync="centerDialogVisible"
            width="30%"
            center>
        <div style="display: flex;
    justify-content: center;
    align-items: center;">
            <span>选择发货时间 </span>
            <el-date-picker
                    v-model="time"
                    type="date"
                    format="yyyy-MM-dd"
                    value-format="yyyy-MM-dd"
                    :picker-options="pickerOptions0"
                    placeholder="选择日期">
            </el-date-picker>
        </div>
        <span slot="footer" class="dialog-footer">
    <el-button @click="centerDialogVisible = false">取 消</el-button>
    <el-button type="primary" @click="delayInShipment();centerDialogVisible = false">确 定</el-button>
  </span>
    </el-dialog>
</div>
<!--引入js-->


<script type="text/javascript" src="./Application/Tpl/Home/Public/lib/jquery/1.9.1/jquery.min.js"></script>
<script type="text/javascript" src="./Application/Tpl/Home/Public/js/H-ui.js?v=<{$Think.const.V}>"></script>
<script type="text/javascript" src="./Application/Tpl/Home/Public/js/H-ui.admin.js?v=<{$Think.const.V}>"></script>
<script type="text/javascript" src="./Application/Tpl/Home/Public/utils/utils.js"></script>
<script type="text/javascript" src="./Application/Tpl/Home/Public/js/vue.2.5.13.js"></script>
<script type="text/javascript" src="./Application/Tpl/Home/Public/js/axios.min.js"></script>
<script type="text/javascript" src="./Application/Tpl/Home/Public/js/element-ui-2.6.3.js"></script>
<script type="text/javascript" src="./Application/Tpl/Home/Public/js/element-en.js"></script>
<script>
    if (getCookie('think_language') !== "zh-cn") {
        ELEMENT.locale(ELEMENT.lang.en)
    }
    var lists = new Vue({
        el: '#lists',
        data: {
            comparedSelection: [],
            time: '',
            centerDialogVisible: false,
            pickerOptions0: {
                disabledDate(time) {
                    return time.getTime() < Date.now() - 8.64e7;
                }
            },
            bool: true,
            warehouseList: [
                'N000686800',
                'N000687900',
                'N000688400',
                'N000689100',
                'N000689200',
                'N000689458',
                'N000689460',
                'N000689465',
                'N000689471'
            ],
            active: 1, //节点激活状态
            dialogVisible: false,
            fullscreenLoading: false,
            totalCount: 10,
            multipleSelection: [],
            deleChoose: '1',
            batchEdit: false,
            addressEdit: false,
            remarkEdit: false,
            isRemarks: false,
            selectRemarkArr: [],
            batchRemarks: '',
            delePop: false, // dialog弹窗
            tearType: true,
            isBtnLoading: false,
            btnLoading:false,
            isCheck: 0,
            baseData: {
                channel: {},
                sort: {},
                // dispatch: {},
                country: {},
                shop: {},
                warehouse: {},
                logisticsCompany: {},
                shipping: {},
                salesTeam: {},
                sell_small_team: {},
                downQuery: {},
                recommendType: {},
                orderStatus: {},
                orderErr: {}
            },
            isHaveRepertory: [{
                id: '0',
                value: '库存不足(当前页)'
            }, {
                id: '1',
                value: '库存充足(当前页)'
            }],
            seleDeleOrderData: [],
            isShow: true,
            sites: [],
            showMore: false,
            currentPage: 1,
            pageSize: 10,
            form: {
                is_remote_area: 0,
                platform: [],
                siteData: [],
                sort: 'order_time',
                chooseRepertory: [],
                country: [],
                shop: [],
                recommend: [],
                remarkHave: false,
                risk_value: false,
                skuNoMate: false,
                warehouse: [],
                logisticsCompany: [],
                logisticsMethod: [],
                salesTeam: [],
                sell_small_team: [],
                timeSort: 'order_time',
                addressUserAddress1: '',
                dateRange: [],
                logisticsSingle: [],
                orderState: [],
                address_valid_status: [],
                surfaceWayGet: [],
                orderErrStatus: [],
                directionMsg: false,
                third_deliver_status: '',
                isPlenty: '',
                selectaftersalesType: '',
                after_sale_type: ''
            },
            third_status: false,
            third_status_doing: false,
            third_status_err: false,
            markShipmentFailedStatus: false,
            iTimer: null,
            isShow: false,
            formSecond: {
                downQuery: 'thr_order_no',
                keywords: ''
            },
            formThird: {
                use_remarks: '',
                remarks: '' //运营备注
            },
            repertoryData: [],
            listData: [],
            stashData: [],
            tableLoading: false,
            shipLoading: false,
            pickerOptions: {},
            popIsShow: false,
            chooseWarehouse: '',
            editWarehouse: '',
            chooseModel: 0,
            selectModel: 0,
            selectCompany: '',
            editCompany: '',
            logisticsWayData: [],
            logisticsWay: '',
            faceSheetData: [],
            faceSheet: '',
            chooseData: [],
            chooseCompanyData: [],
            selelogData: [],
            changeWarehous: false,
            getOrderResultData: [],
            selectaftersalesTypeStatus: '',
            warehouseTipShow: false, // 有地址校验失败弹窗
            verificationFailedList: [], // 校验有误数据
            dialogBatchDditing:false,
            dialogBatchDditingData:{
                type:'',
                data:[]
            },
            isdialogBatchDditingData:false
        },
        created: function created() {
            // window.onscroll = function () {
            //     if (document.documentElement.scrollTop != 0) {
            //         sessionStorage.setItem("OrderPatchOffsetTop", document.documentElement.scrollTop);
            //     }
            // }
            this.pickerOptions = {
                shortcuts: [{
                    text: this.$lang('最近一周'),
                    onClick: function onClick(picker) {
                        var end = new Date();
                        var start = new Date();
                        start.setTime(start.getTime() - 3600 * 1000 * 24 * 7);
                        picker.$emit('pick', [start, end]);
                    }
                }, {
                    text: this.$lang('最近一个月'),
                    onClick: function onClick(picker) {
                        var end = new Date();
                        var start = new Date();
                        start.setTime(start.getTime() - 3600 * 1000 * 24 * 30);
                        picker.$emit('pick', [start, end]);
                    }
                }, {
                    text: this.$lang('最近三个月'),
                    onClick: function onClick(picker) {
                        var end = new Date();
                        var start = new Date();
                        start.setTime(start.getTime() - 3600 * 1000 * 24 * 90);
                        picker.$emit('pick', [start, end]);
                    }
                }]
            }
            this.getBaseData();
            this.getSite();
            this.flowJump();
        },
        methods: {
            /**
             * 获取单号
             *  multipleSelection  选中的数据
             **/
            getOrderCode(multipleSelection) {
                var param = {
                    data: {
                        orders: []
                    }
                };
                var _this = this;
                multipleSelection.forEach(function(item) {
                    param.data.orders.push({
                        thr_order_id: item.third_order_number,
                        // CHILD_ORDER_ID: row.CHILD_ORDER_ID,
                        b5c_logistics_cd: item.logistics_company,
                        plat_cd: item.plat_cd,
                        service_code: item.logistics_type
                    });
                });
                axios.post("/index.php?g=OMS&m=Patch&a=waitElectronicOrder", param).then(function(res) {
                    if (res.data.status == 200000) {
                        lists.$message({
                            dangerouslyUseHTMLString: true,
                            type: "warning",
                            message: "<div style='text-align:center'>" + _this.$lang('面单获取中...') + "</div>" + "<div>" + _this.$lang('获取成功后可执行派单操作，请稍候') + "</div>"
                        });
                    } else {
                        lists.$message({
                            dangerouslyUseHTMLString: true,
                            type: "warning",
                            //message: "<div style='text-align:center'>" + _this.$lang('获取失败...') + "</div>" + "<div>" + _this.$lang('请检测数据是否异常') + "</div>"
                            message: "<div style='text-align:center'>" + _this.$lang(res.data.info) + "</div>"
                        });
                    }
                    _this.$refs.multipleTable.clearSelection();
                });
            },
            // 有从万邑通发往德国的提示点击获取单号
            queryClick(type) {
                this.warehouseTipShow = false;
                if(type == 'all') {
                    this.getOrderCode(this.multipleSelection)
                } else {
                    for(var i = 0; i < this.verificationFailedList.length; i++) {
                        for(var j = 0; j < this.multipleSelection.length; j++) {
                            if(this.verificationFailedList[i] === this.multipleSelection[j].third_order_number) {
                                this.multipleSelection.splice(j,1)
                            }
                        }
                    }
                    this.getOrderCode(this.multipleSelection)
                }
            },
            stop: function () {
                var _this = this;
                var arr = []
                for (var x = 0; x < this.seleDeleOrderData.length; x++) {
                    var obj = {
                        id: this.seleDeleOrderData[x].id,
                        plat_cd: this.seleDeleOrderData[x].plat_cd,
                        order_id: this.seleDeleOrderData[x].third_order_number
                    }
                    arr.push(obj)
                }
                if (arr.length === 0) {
                    for (var x = 0; x < this.listData.length; x++) {
                        var obj = {
                            id: this.listData[x].id,
                            plat_cd: this.listData[x].plat_cd,
                            order_id: this.listData[x].third_order_number
                        }
                        arr.push(obj)
                    }
                }
                axios.post("/index.php?g=OMS&m=Patch&a=cancelGcAutoGetFaceOrder", arr).then(function (res) {
                    if (res.data.code == 200) {
                        _this.$message({
                            type: 'success',
                            message: '操作成功'
                        });
                        if (_this.seleDeleOrderData.length === 0) {
                            for (var x = 0; x < _this.listData.length; x++) {
                                _this.listData[x].is_auto_get_no = ''
                            }
                        } else {
                            for (var x = 0; x < _this.seleDeleOrderData.length; x++) {
                                _this.seleDeleOrderData[x].is_auto_get_no = ''
                            }
                        }
                    } else {
                        _this.$message({
                            type: 'error',
                            message: res.data.msg
                        });
                    }
                });
            },
            start: function () {
                var _this = this;
                var arr = []
                for (var x = 0; x < this.seleDeleOrderData.length; x++) {
                    var obj = {
                        id: this.seleDeleOrderData[x].id,
                        plat_cd: this.seleDeleOrderData[x].plat_cd,
                        order_id: this.seleDeleOrderData[x].third_order_number
                    }
                    arr.push(obj)
                }
                if (arr.length === 0) {
                    this.$message({
                        type: 'error',
                        message: this.$lang('请选择订单!')
                    });
                    return
                }
                axios.post("/index.php?g=OMS&m=Patch&a=autoGetGcFaceOrder", arr).then(function (res) {
                    if (res.data.code == 200) {
                        _this.$message({
                            type: 'success',
                            message: '操作成功'
                        });
                    } else {
                        _this.$message({
                            type: 'error',
                            message: res.data.msg
                        });
                    }
                });
            },
            getSite: function getSite(type, val) {
                var _this = this;
                axios.post("/index.php?g=oms&m=order&a=getSite", {
                    plat_cd: type === 'search' ? val : []
                }).then(function (res) {
                    if (res.data && res.data.code == 2000) {
                        _this.sites = res.data.data ? res.data.data : [];
                    } else {
                        _this.$message.error(res.data.msg || '获取站点异常');
                    }
                    _this.getStore();
                    if (type === 'search') {
                        _this.getListData(_this.searchData, 'all')
                    }
                }).catch(function (error) {
                    _this.$message.error('获取站点异常');
                    _this.getStore();
                    if (type === 'search') {
                        _this.getListData(_this.searchData, 'all')
                    }
                });
            },
            getBaseData: function getBaseData() {
                axios.get("/index.php?g=OMS&m=Patch&a=listMenu").then(function (res) {
                    if (res.status == 200) {
                        var baseData = res.data.data;
                        lists.baseData.channel = baseData.site_cd;
                        lists.baseData.sort = baseData.sort;
                        lists.baseData.country = baseData.country_status;
                        lists.baseData.shop = baseData.shop_status;
                        lists.baseData.warehouse = baseData.warehouse_status;
                        lists.baseData.logisticsCompany = baseData.logistics_company_status;
                        lists.baseData.shipping = baseData.shipping_methods_status;
                        lists.stashData = baseData.shipping_methods_status;
                        lists.baseData.salesTeam = baseData.sales_team_status;
                        lists.baseData.sell_small_team = baseData.sell_small_team;
                        lists.baseData.downQuery = baseData.down_query_status;
                        lists.baseData.surfaceWayGet = baseData.surfaceWayGetStatus;
                        lists.baseData.logisticsSingle = baseData.logisticsSingleStatus;
                        lists.baseData.recommendType = baseData.recommend_type;
                        lists.baseData.orderStatus = baseData.order_status;
                        lists.baseData.orderErr = baseData.patch_err;
                        lists.$set(lists.baseData.downQuery, 'remark_msg', {
                            CD: "remark_msg",
                            CD_VAL: "备注",
                            ETc: "",
                            SORT_NO: "0",
                        })
                        lists.getListData();
                        $('#lists').css('visibility', 'visible');
                    }
                });
            },
            inverseSelection: function () {
                var _this = this;
                _this.$refs.multipleTable.data.forEach(function (item) {
                    _this.$refs.multipleTable.toggleRowSelection(item);
                })
            },
            getListData: function getListData(page, type) {
                this.listData = [];
                this.popIsShow = false;
                // lists.tableLoading = true;
                this.chooseWarehouse = '';
                this.selectCompany = '';
                this.logisticsWay = '';
                this.faceSheet = '';
                var param = {
                    data: {
                        platform: this.form.siteData,
                        sort: this.form.sort,
                        recommend_type: this.form.recommend,
                        country: this.form.country,
                        order_status: this.form.orderState,
                        address_valid_status: this.form.address_valid_status,
                        patch_err: this.form.orderErrStatus,
                        shop: this.form.shop,
                        warehouse: this.form.warehouse,
                        logistics_company: this.form.logisticsCompany,
                        logistics_method: this.form.logisticsMethod,
                        sales_team: this.form.salesTeam,
                        sell_small_team: this.form.sell_small_team,
                        search_time_type: this.form.timeSort,
                        addressUserAddress1: this.form.addressUserAddress1,
                        search_time_left: this.form.dateRange && this.form.dateRange.length ? this.form.dateRange[0] : null,
                        search_time_right: this.form.dateRange && this.form.dateRange.length ? this.form.dateRange[1] : null,
                        search_condition: this.formSecond.downQuery,
                        search_value: $.trim(this.formSecond.keywords),
                        surfaceWayGetCd: this.form.surfaceWayGet,
                        logisticsSingleStatuCd: this.form.logisticsSingle,
                        remark_have: this.form.remarkHave ? 1 : 0,
                        risk_value: this.form.risk_value ? 1 : 0,
                        sku_is_null: this.form.skuNoMate ? 1 : 0,
                        addressee_msg_null: this.form.directionMsg ? 1 : 0,
                        third_deliver_status: this.form.third_deliver_status,
                        is_remote_area: this.form.is_remote_area,
                        after_sale_type: this.form.after_sale_type
                    },
                    page: {
                        this_page: page ? page : this.currentPage,
                        page_count: this.pageSize
                    }
                };

                if (type == 'all') {
                    if (this.form.platform.length == 0 && this.form.siteData.length == 0) {
                        param.data.platform = [];
                    } else {
                        param.data.platform = [];
                        this.sites.forEach(function (element) {
                            param.data.platform.push(element.CD)
                        })
                    }

                }


                lists.shipLoading = true;
                axios.post("/index.php?g=OMS&m=Patch&a=lists", param).then((res)=> {
                    lists.shipLoading = false;
                    if (res.status == 200) {
                        // lists.tableLoading = false;
                        let data = res.data.data.data;
                        // console.log("listdata数据",res.data);

                        lists.listData = lists.sites.length || !type ? res.data.data.data : [];
                        // 释放内存
                        this.listData.forEach((value => {
                            value.allWarehouse=[];
                            value.findOrderJson = null;
                        }));

                        lists.totalCount = lists.sites.length || !type ? +res.data.data.page.count : 0;

                        lists.batchEdit && lists.batchFn();
                        if (lists.form.chooseRepertory.length == 0 || lists.form.chooseRepertory.length == 2) {
                            lists.listData = lists.sites.length || !type ? data : [];
                            return false;
                        }
                        //  过滤出是否有库存
                        var noRepertoryData = lists.listData.filter(function (item) {
                            return item.stock_adequate == 0;
                        })
                        var haveRepertoryData = lists.listData.filter(function (item) {
                            return item.stock_adequate == 1;
                        })
                        if (lists.form.chooseRepertory == '0') {
                            lists.listData = lists.sites.length || !type ? noRepertoryData : [];
                        } else if (lists.form.chooseRepertory == '1') {
                            lists.listData = lists.sites.length || !type ? haveRepertoryData : [];
                            if(lists.listData.length === 0 && (lists.totalCount/lists.pageSize+1>lists.currentPage)){
                              lists.handleCurrentChange(Number(lists.currentPage)+1)
                            }
                        }
                    }
                });
            },
            showTips: function showTips(item) {
                Vue.set(item, "isShow", !item.isShow)
            },
            //checked 设为false
            setCheck: function setCheck(data) {
                for (var key in data) {
                    data[key].checked = false;
                }
            },
            selseRepertory: function selseRepertory(value) {
                if (lists.form.chooseRepertory[0] == '0') {
                    lists.form.isPlenty = '0';
                } else if (lists.form.chooseRepertory[1] == '1') {
                    lists.form.isPlenty = '1';
                }
                if(this.form.siteData.length === 0){
                  this.getListData('','all');
                }else{
                  lists.getListData();
                }
            },
            deleOrder: function deleOrder() {
                if (lists.seleDeleOrderData.length == 0) {
                    lists.$message({
                        type: 'warn',
                        message: this.$lang('请选择订单!')
                    });
                    return false;
                }
                this.delePop = true;
            },
            deleOrderConfirm: function deleOrderConfirm() {
                var params = {};
                var data = []
                lists.seleDeleOrderData.forEach(function (item) {
                    data.push({
                        "id": item.id
                    });
                });
                params = {
                    "data": data
                };
                var _this = this;
                if (this.deleChoose == 2) {
                    axios.post('/index.php?g=Oms&m=Patch&a=deletePatchOrderIds', params).then(function (res) {
                        if (res.status == 200) {
                            if (res.data.code == 400) {
                                lists.$message({
                                    type: 'info',
                                    message: _this.$lang(res.data.info)
                                });
                                return false;
                            }
                            if (res.data.code == 3000) {
                                lists.$message({
                                    type: 'info',
                                    message: _this.$lang(res.data.info)
                                });
                                return false;
                            }
                            lists.getListData();
                            lists.$message({
                                type: 'success',
                                message: _this.$lang('删除成功!')
                            });
                            lists.seleDeleOrderData = [];
                            _this.delePop = false;
                        }
                    })
                } else {
                    axios.post('/index.php?g=Oms&m=Patch&a=cancelOrders', params).then(function (res) {
                        if (res.status == 200) {
                            if (res.data.code == 400) {
                                lists.$message({
                                    type: 'info',
                                    message: _this.$lang(res.data.info)
                                });
                                return false;
                            }
                            if (res.data.code == 3000) {
                                lists.$message({
                                    type: 'info',
                                    message: _this.$lang(res.data.info)
                                });
                                return false;
                            }
                            lists.getListData();
                            lists.$message({
                                type: 'success',
                                message: _this.$lang('取消成功!')
                            });
                            lists.seleDeleOrderData = [];
                            _this.delePop = false;
                        }
                    })
                    // this.delePop = false;
                }
            },
            seleItem: function (option, row) {
                lists.seleDeleOrderData = option;
            },
            selectAllItem: function selectAllItem(option) {
                lists.seleDeleOrderData = option;
            },
            selectGudsType: function selectGudsType(item) {
                var _this = this;
                if (!item) {
                    this.form.recommend = [];
                    this.setCheck(this.baseData.recommendType);
                } else {
                    item.checked = !item.checked;
                    if (item.checked) {
                        this.form.recommend.push(item.CD);
                    } else {
                        this.form.recommend.forEach(function (val, index) {
                            if (val == item.CD) {
                                _this.form.recommend.splice(index, 1);
                            }
                        })
                    }
                }
            },
            // 选择售后类型
            selectaftersalesType: function (item) {
                var _this = this;
                _this.selectaftersalesTypeStatus = item
                _this.form.after_sale_type = item
            },
            sendOrderErr: function (item) {
                var _this = this;
                if (!item) {
                    this.form.orderErrStatus = [];
                    this.setCheck(this.baseData.orderErr);
                } else {
                    item.checked = !item.checked;
                    if (item.checked) {
                        this.form.orderErrStatus.push(item.CD);
                    } else {
                        this.form.orderErrStatus.forEach(function (val, index) {
                            if (val == item.CD) {
                                _this.form.orderErrStatus.splice(index, 1);
                            }
                        })
                    }
                }
            },
            selectEditWarehouse: function (warehouseData) {
                var _this = this;
                var changeData = [];
                this.multipleSelection.forEach(function (item, index) {
                    var json = item.findOrderJson
                    var warehouse = JSON.parse(json).warehouse;
                    // console.log("仓库里的数据",warehouse);
                    item.ischange1 = false;
                    if (warehouse) {
                        for (var i = 0, len = warehouse.length; i < len; i++) {
                            if (warehouse[i].cd == warehouseData) {
                                item.warehouse = warehouseData;
                                item.logistics_company = '';
                                item.logistics_type = '';
                                item.logisticsCompany = warehouse[i].lgtModel;
                                item.ischange1 = true;
                                break;
                            } else {
                                item.warehouse = item.warehouse;
                            }
                        }
                    }
                    if (item.ischange1 == false) {
                        _this.$refs.multipleTable.toggleRowSelection(item);
                        item.warehouse = '';
                        item.logistics_company = '';
                        item.logistics_type = '';
                    }
                    if (item.ischange1 == true) {
                        changeData.push(item)
                    }
                })

                var params = {};
                params.data = [];
                changeData.forEach(function (item) {
                    params.data.push({
                        'id': item.id,
                        'third_order_number': item.third_order_number,
                        'third_party_order_number': item.third_party_order_number,
                        'plat_cd': item.plat_cd,
                        'sales_team_cd': item.sales_team_cd,
                        'warehouse': item.warehouse,
                        'opOrderGuds': item.opOrderGuds
                    })
                })

                axios.post("/index.php?g=Oms&m=Patch&a=getWarehouseStock", JSON.stringify(params)).then(function (res) {
                    if (res.data.code == 200) {
                        var data = res.data.data;
                        _this.multipleSelection.forEach(function (item) {
                            data.forEach(function (val) {
                                if (item.id == val.id) {
                                    item.stock = val.stock;
                                    item.stock_adequate = val.stock_adequate;
                                }
                            })
                        })
                    }
                })
            },
            selectLogisticsCompany: function selectLogisticsCompany(seleCompany) {
                this.logisticsWayData = [];
                this.faceSheetData = [];
                this.logisticsWay = '';
                this.faceSheet = '';
                var _this = this;
                this.multipleSelection.forEach(function (item) {
                    item.ischange2 = false;
                    if (item.ischange1 == true) {
                        var warehouse = JSON.parse(item.findOrderJson).warehouse;
                        if (item.logisticsCompany) {
                            var list = item.logisticsCompany;
                            for (var j = 0; j < list.length; j++) {
                                if (list[j].logisticsCode == seleCompany) {
                                    item.logistics_company = seleCompany;
                                    item.logistics_type = '';
                                    for (var k = 0; k < list[j].logisticsMethod.length; k++) {
                                        list[j].logisticsMethod[k].id = +list[j].logisticsMethod[k].id;
                                    }
                                    _this.$set(item, 'logisticsMethod', list[j].logisticsMethod)
                                    item.ischange2 = true;
                                    break;
                                }
                            }
                        }
                    } else {
                        return;
                    }
                    if (item.ischange2 == false) {
                        _this.$refs.multipleTable.toggleRowSelection(item);
                        item.logistics_company = '';
                        item.logistics_type = '';
                    }
                })

                axios.post("index.php?g=Oms&m=OrderPresent&a=get_log_company", {
                    company_code: [_this.selectCompany]
                }).then((res) =>{
                    if (res.data.code == 200) {
                        _this.logisticsWayData = res.data.data;
                    }
                });

            },
            logisticsWayChange: function logisticsWayChange(value) {
                let _this = this;
                this.faceSheetData = [];
                let  logistic_model_id = null;
                this.multipleSelection.forEach((item) =>{
                    if (item.ischange1 == true && item.ischange2 == true) {
                        item.ischange3 = false;
                        let warehouse = JSON.parse(item.findOrderJson).warehouse;
                        if (item.logisticsMethod) {
                            let listData = item.logisticsMethod;
                            for (var k = 0; k < listData.length; k++) {
                                if (listData[k].id == value) {
                                    item.logistics_type = +value;
                                    item.ischange3 = true;
                                    logistic_model_id = item.logistics_type;
                                    break;
                                }


                            }

                        }
                        if (item.ischange3 == false) {
                            _this.$refs.multipleTable.toggleRowSelection(item);
                            item.logistics_type = '';
                        }
                    }
                })

                let param = {
                    "logistic_model_id": logistic_model_id
                }
                axios.post("/index.php?g=OMS&m=Patch&a=faceOrderGet", param).then( (res) =>{
                    let data = res.data;
                    if (data.status == 200000) {
                        _this.faceSheetData = data.data;
                        this.multipleSelection.forEach((item)=>{
                            if (data.data.length) {
                                this.$set(item, 'surfaceWayGetCdNm', data.data[0].CD_VAL);
                                this.$set(item, 'surfaceWayGetCd', data.data[0].CD);
                            } else {
                                this.$set(item, 'surfaceWayGetCdNm', '');
                                this.$set(item, 'surfaceWayGetCd', '');

                            }
                            this.$set(item, 'faceData', data.data);
                        })

                    } else {
                        this.multipleSelection.forEach((item)=>{
                            this.$set(item, 'faceData', data.data);
                            item.surfaceWayGetCd = '';
                        })
                    }
                })
            },
            faceSheetChange(faceSheetChangeData) {
                var _this = this;
                this.multipleSelection.forEach(function (item, index) {
                    item.ischange4 = false;
                    if (item.ischange1 == true && item.ischange2 == true && item.ischange3 == true) {
                        item.surfaceWayGetCd = faceSheetChangeData;
                        item.ischange4 = true;


                        var list = _this.multipleSelection.filter(function (item) {
                            return item.ischange1 && item.ischange2 && item.ischange3 && item.ischange4;
                        })
                        if (list.length > 0) {
                            lists.$message({
                                type: 'success',
                                center: true,
                                message: lists.$lang('共编辑了') + list.length + lists.$lang('条数据，待保存!')
                            });
                        } else {
                            lists.$message({
                                type: 'warning',
                                center: true,
                                message: lists.$lang('无编辑成功订单')
                            });
                        }
                    } else {
                        return;
                    }
                })
            },
            changeWarehouse: function changeWarehouse(value, item) {
                this.multipleSelection.forEach(function (val, index) {
                    if (item == val) {
                        item.warehouse = value;
                        // 重新选择仓库清除其余选项
                        item.logistics_company = '';
                        item.logistics_type = '';
                        item.surfaceWayGetCd = '';
                        item.ischange1 = true;
                        item.ischange2 = false;
                        item.ischange3 = false;
                    }
                })
                var params = {
                    'data': [{
                        'id': item.id,
                        'third_order_number': item.third_order_number,
                        'third_party_order_number': item.third_party_order_number,
                        'plat_cd': item.plat_cd,
                        'sales_team_cd': item.sales_team_cd,
                        'warehouse': item.warehouse,
                        'opOrderGuds': item.opOrderGuds
                    }]
                }
                axios.post("/index.php?g=Oms&m=Patch&a=getWarehouseStock", params).then(function (res) {
                    if (res.data.code == 200) {
                        var data = res.data.data;
                        data.forEach(function (val) {
                            item.stock = val.stock;
                            item.stock_adequate = val.stock_adequate;
                        })
                    }
                })
            },
            changeLogCompany: function changeLogCompany(item, value) {
                this.multipleSelection.forEach(function (val, index) {
                    console.log("表格物流公司",value);
                    if (val == item) {
                        item.logistics_company = value;
                        // 重新选择物流公司清除其余选项
                        item.logistics_type = '';
                        item.surfaceWayGetCd = '';
                        item.ischange2 = true;
                        item.ischange3 = false;
                    }
                })

            },
            changeLogMethod: function changeLogMethod(item, value) {
                console.log("表格物流方式数据",item);
                console.log("表格物流value",value);
                var _this = this;
                this.multipleSelection.forEach((val, index)=> {
                    if (item == val) {
                        item.logisticsMode = value;
                        // 重新选择物流方式清除其余选项
                        item.surfaceWayGetCd = '';
                        item.ischange3 = true;

                    }
                })

                item.logisticsMethod.forEach((val)=> {
                    if (val.id == item.logistics_type) {
                        this.$set(item, 'freight', val.fright);
                    }
                })

                let param = {
                    "logistic_model_id": item.logistics_type
                }

                axios.post("/index.php?g=OMS&m=Patch&a=faceOrderGet", param).then( (res)=> {
                    let data = res.data;
                    console.log("面单数据",data);
                    if (data.status == 200000) {
                        if (data.data.length) {
                            console.log("面单方式1")
                            this.$set(item, 'surfaceWayGetCdNm', data.data[0].CD_VAL);
                            this.$set(item, 'surfaceWayGetCd', data.data[0].CD);
                        } else {
                            console.log("面单方式2")
                            this.$set(item, 'surfaceWayGetCdNm', '');
                            this.$set(item, 'surfaceWayGetCd', '');
                        }
                        this.$set(item, 'faceData', data.data);
                    } else {
                        this.$set(item, 'faceData', data.data);
                        item.surfaceWayGetCd = '';
                    }
                })
            },
            change_waybill_number: function (item) {
                this.multipleSelection.forEach(function (val, index) {
                    if (item == val) {
                        item.ischange1 = true;
                        item.ischange2 = true;
                        item.ischange3 = true;
                    }
                })

            },
            expressSheetChange: function (item, value) {
                this.multipleSelection.forEach(function (val, index) {
                    if (item == val) {
                        item.surfaceWayGetCd = value;
                        item.ischange1 = true;
                        item.ischange2 = true;
                        item.ischange3 = true;
                    }
                })
            },
            getStore: function getStore() {
                var _this = this;
                var postData = [];
                if (!this.form.siteData.length) {
                    this.sites.forEach(function (element) {
                        postData.push(element.CD)
                    })
                } else {
                    postData = this.form.siteData
                }
                axios.post('/index.php?g=Oms&m=Order&a=storesGet', {
                    "plat_form": postData
                }).then(function (response) {
                    if (response.data.status == 200000) {
                        lists.baseData.shop = response.data.data;
                    } else {
                        lists.$message.error(response.data.info);
                    }
                }).catch(function (err) {
                    console.log(err);
                });
            },
            selectSite: function selectSite(item) {
                var _this = this;
                if (!item) {
                    _this.form.siteData = [];
                    for (var i in _this.sites) {
                        _this.sites[i].checked = false;
                    }
                    _this.getListData(1, 'all')

                } else {
                    item.checked = !item.checked;
                    if (item.checked) {
                        if (_this.form.siteData.length === _this.sites.length) {
                            _this.form.siteData = [];
                        }
                        _this.form.siteData.push(item.CD);

                    } else {
                        _this.form.siteData.forEach(function (val, index) {
                            if (val == item.CD) {
                                _this.form.siteData.splice(index, 1);
                            }
                        });
                        if (!_this.form.siteData.length) {
                            _this.getListData(1, 'all')
                        }
                    }
                }
                this.getStore();

            },
            //选择平台渠道
            selectChannel: function selectChannel(item) {
                var _this2 = this;
                if (!item) {
                    this.form.platform = [];
                    // 平台渠道点击全部,亦需要清楚站点的选中的tab数据
                    this.form.siteData = [];
                    this.setCheck(this.baseData.channel);

                } else {
                    this.form.siteData = [];
                    item.checked = !item.checked;
                    if (item.checked) {
                        this.form.platform.push(item.CD);
                    } else {
                        this.form.platform.forEach(function (val, index) {
                            if (val == item.CD) {
                                _this2.form.platform.splice(index, 1);
                            }
                        });
                    }
                }
                this.sites = [];
                this.getSite('search', this.form.platform)

                //平台、店铺联动

            },
            selectSort: function (val) {
                this.form.sort = val;
            },
            toggleRemark: function toggleRemark() {
                this.form.remarkHave = !this.form.remarkHave;
            },
            toggleRisk: function toggleRisk() {
                this.form.risk_value = !this.form.risk_value;
            },
            skuDefault: function skuDefault() {
                this.form.skuNoMate = !this.form.skuNoMate;
            },
            directionMsgPartial: function directionMsgPartial() {
                this.form.directionMsg = !this.form.directionMsg;
            },
            deliverStatus: function deliverStatus() {
                if (this.form.third_deliver_status != 1) {
                    this.form.third_deliver_status = 1
                    this.third_status = true
                    this.third_status_doing = false
                    this.third_status_err = false
                    this.markShipmentFailedStatus = false;
                } else {
                    this.form.third_deliver_status = 0
                    this.third_status = false
                }
                // this.form.third_deliver_status = !this.form.third_deliver_status;
            },
            deliverStatusDoing: function deliverStatusDoing() {
                if (this.form.third_deliver_status != 2) {
                    this.form.third_deliver_status = 2
                    this.third_status_doing = true
                    this.third_status_err = false
                    this.third_status = false
                    this.markShipmentFailedStatus = false;
                } else {
                    this.form.third_deliver_status = 0
                    this.third_status_doing = false
                }
                // this.form.third_deliver_status = !this.form.third_deliver_status;
            },
            deliverStatusErr: function deliverStatusErr() {
                if (this.form.third_deliver_status != 3) {
                    this.form.third_deliver_status = 3
                    this.third_status_err = true
                    this.third_status_doing = false
                    this.third_status = false
                    this.markShipmentFailedStatus = false;
                } else {
                    this.form.third_deliver_status = 0
                    this.third_status_err = false
                }
                // this.form.third_deliver_status = !this.form.third_deliver_status;
            },
            markShipmentFailed: function markShipmentFailed() {
                if (this.form.third_deliver_status != 4) {
                    this.form.third_deliver_status = 4
                    this.markShipmentFailedStatus = true;
                    this.third_status_err = false
                    this.third_status_doing = false
                    this.third_status = false
                } else {
                    this.form.third_deliver_status = 0
                    this.markShipmentFailedStatus = false
                }
                // this.form.third_deliver_status = !this.form.third_deliver_status;
            },
            toggleArea: function () {
                this.form.is_remote_area = this.form.is_remote_area == 1 ? 0 : 1;
            },
            doSearch: function doSearch(num) {
                if (this.form.siteData.length) {
                    this.getListData(num?num:1);
                } else {
                    this.getListData(num?num:1, 'all');

                }
                this.batchEdit = false;
                this.addressEdit = false;
                this.popIsShow = false;


            },
            doReset: function doReset() {
                window.location.reload()
            },
            handleSizeChange: function handleSizeChange(val) {
                this.pageSize = val;
            },
            handleCurrentChange: function handleCurrentChange(val) {
                if (this.batchEdit) {
                    this.batchEdit = false
                    this.currentPage = val;
                    if (this.form.siteData.length > 0) {
                        this.getListData()
                    } else {
                        this.getListData('', 'all')
                    }
                } else {
                    this.currentPage = val;
                    if (this.form.siteData.length > 0) {
                        this.getListData()
                    } else {
                        this.getListData('', 'all')
                    }
                }
            },
            handleSelectionChange: function handleSelectionChange(val) {
                this.isCheck = val.length;
                this.multipleSelection = val;
                this.comparedSelection = JSON.stringify(val);
            },
            /*
             *  备注
             *  doRemark 打开备注对话框
             *  saveRemark 保存备注
             */
            doRemark: function doRemark(row) {
                this.formThird = row;
                this.dialogVisible = true;
            },
            cancelRemark: function cancelRemark() {
                this.dialogVisible = false;
                this.getListData();
            },
            saveRemark: function saveRemark(item) {
                var _this = this;
                var data = {
                    'thr_order_id': this.formThird.third_order_number,
                    'plat_cd': this.formThird.plat_cd,
                    'remarks_type': 'operate',
                    'remarks_msg': this.formThird.remarks
                };
                axios.post('/index.php?g=oms&m=order&a=orderRemarks', data).then(function (response) {
                    if (response.data.status === 200000) {
                        _this.dialogVisible = !_this.dialogVisible;
                        _this.$message.success(this.$lang('保存成功'));
                        _this.getListData();
                    } else {
                        _this.$message.error(response.data.info);
                    }
                }).catch(function (err) {
                    console.log(err);
                });
            },
            //跳转详情页
            toDetail: function toDetail(order_no, title, result) {
                var dom = document.createElement('a');
                var _href = "/index.php?g=OMS&m=Order&a=orderDetail&order_no=" + order_no + "&thrId=" + title + "&platCode=" + result+"&isShowEditButtonByOmsListEntry="+true;
                dom.setAttribute("onclick", "opennewtab(this,'" + this.$lang('订单详情') + "')");
                dom.setAttribute("_href", _href);
                dom.click();
            },
            toOrderDetail: function toOrderDetail(title, result) {
                console.log(title)
                var dom = document.createElement("a"),
                    _href = "/index.php?g=oms&m=patch&a=showLogs&result=" + result;
                dom.setAttribute("onclick", "opennewtab(this,'" + this.$lang(title) + "')");
                dom.setAttribute("_href", _href);
                dom.onclick();
            },
            /**
             * 导出  exportOrder
             * 导入  importOrder
             * 模板下载 downTmep
             * */
            exportOrder: function exportOrder() {
                var _this = this;
                var siteData = [];
                if (!this.form.siteData.length) {
                    this.sites.forEach(function (el) {
                        siteData.push(el.CD)
                    })
                } else {
                    siteData = this.form.siteData;
                }
                var param = {
                    wheres: {
                        platform: siteData,
                        recommend_type: this.form.recommend,
                        logistics_status: this.form.orderErrStatus,
                        order_status: this.form.orderState,
                        address_valid_status: this.form.address_valid_status,
                        sort: this.form.sort,
                        remark_have: this.form.remarkHave ? 1 : 0,
                        risk_value: this.form.risk_value ? 1 : 0,
                        sku_is_null: this.form.skuNoMate ? 1 : 0,
                        is_remote_area: this.form.is_remote_area,
                        addressee_msg_null: this.form.directionMsg ? 1 : 0,
                        country: this.form.country,
                        patch_err: this.form.orderErrStatus,
                        shop: this.form.shop,
                        warehouse: this.form.warehouse,
                        surfaceWayGetCd: this.form.surfaceWayGet,
                        logistics_company: this.form.logisticsCompany,
                        logistics_method: this.form.logisticsMethod,
                        logisticsSingleStatuCd: this.form.logisticsSingle,
                        sales_team: this.form.salesTeam,
                        sell_small_team: this.form.sell_small_team,
                        search_time_type: this.form.timeSort,
                        addressUserAddress1: this.form.addressUserAddress1,
                        search_time_left: this.form.dateRange && this.form.dateRange.length ? this.form.dateRange[0] : null,
                        search_time_right: this.form.dateRange && this.form.dateRange.length ? this.form.dateRange[1] : null,
                        // third_deliver_status:this.form.third_deliver_status ? 1 : 0,
                        third_deliver_status: this.form.third_deliver_status,
                        search_condition: this.formSecond.downQuery,
                        search_value: this.formSecond.keywords,
                        after_sale_type: this.form.after_sale_type
                    },
                    ids: [],
                    type: 'patch'
                };
                for (var i = 0; i < this.multipleSelection.length; i++) {
                    param.ids.push(this.multipleSelection[i].id);
                }

                var tmep = document.createElement('form');
                tmep.action = '/index.php?g=OMS&m=Patch&a=exportOrder';
                tmep.method = "post";
                tmep.style.display = "none";
                var opt = document.createElement("input");
                opt.name = 'post_data';
                opt.value = JSON.stringify(param);
                tmep.appendChild(opt);
                document.body.appendChild(tmep);
                tmep.submit();
                tmep.remove();
                tmep = null;
                console.log(tmep)
            },
            editExcel: function editExcel() {
                document.getElementById('excelFile').click();
            },
            importOrder: function importOrder() {
                document.getElementById('activeImport').click();
            },
            downTmep: function downTmep() {
                var form = document.createElement('form');
                form.action = '/index.php?g=OMS&m=Patch&a=down';
                form.method = "post";
                form.style.display = "none";
                form.innerHTML = '<input type="text" name="post_data" value=\'{"file_name":"import.xlsx"}\'>';
                document.body.appendChild(form);
                form.submit();
                form.remove();
                // console.log(form)
                form = null;
            },

            closeBatchDditing:function(done){
                done();
                this.doSearch()
            },
            goonBatchDditing:function(){
                this.dialogBatchDditing = false
                this.isdialogBatchDditingData = true
                this.batchFn('edit')
            },
            cancelBatchDditing:function(){
                this.dialogBatchDditing = false
                this.doSearch()
            },
            saveBatchDditing:function(type){
                this.$confirm("确定要保存吗？","提示",{
                    distinguishCancelAndClose: true,
                    confirmButtonText: '确定',
                    cancelButtonText: '全部取消',
                }).then(()=>{
                    this.dialogBatchDditing = false
                    this.isdialogBatchDditingData = true
                    if(type == 'all'){
                        this.dialogBatchDditingData.saveType = 'all'
                    }else{
                        this.dialogBatchDditingData.saveType = 'part'
                    }
                    this.batchFn('save')
                }).catch(action =>{
                    console.log("类型",action);
                    if(action === "cancel"){ //全部取消
                        console.log("全部取消了");
                        this.dialogBatchDditing = false;
                        this.doSearch()
                    }else {
                        console.log("取消了");
                    }
                })
            },

            /**
             *  批量操作
             *  edit    批量编辑
             *  save    批量保存
             *  assgin  批量派单
             *  defualt 批量取消
             **/
            batchFnCancel: function batchFnCancel() {
                this.popIsShow = false;
                this.chooseWarehouse = '';
                this.selectCompany = '';
                this.logisticsWay = '';
                this.faceSheet = '';
                this.getListData();
                this.batchEdit = false;

            },
            remarksChange(val) {
                this.listData.forEach((value)=> {
                    this.selectRemarkArr.forEach( (item) =>{
                        if (item == value) {
                            this.$set(value, 'remarks', val);
                        }
                    });
                });
            },
            batchCancelRemarks() {
                this.batchRemarks = '';
                this.remarkEdit = false;
                this.doSearch();
            },
            remarkSave() {
                let param = [];
                this.listData.forEach((value)=> {
                    this.selectRemarkArr.forEach( (item) =>{
                        if (item == value) {
                            param.push({
                                id: value.id,
                                remark_msg: value.remarks
                            });
                        }
                    });
                });
                this.shipLoading = true;
                axios.post('/index.php?g=OMS&m=Order&a=batchUpdateOrderOperateRemark',param).then(res => {
                    console.log(res);
                    this.shipLoading = false;
                    if(res.status == 200 && res.data.code == 2000) {
                        this.$message.success(this.$lang('编辑成功'));
                        this.batchRemarks = '';
                        this.remarkEdit = false;
                        
                        this.listData.forEach((value)=> {
                            this.selectRemarkArr.forEach( (item) =>{
                                if (item == value) {
                                    this.$set(value, 'remarkEdit', false);
                                }
                            });
                        });
                        this.$refs.multipleTable.clearSelection();
                    } else {
                        this.$message.warning(this.$lang(res.data.msg));
                    }
                }).catch(err => {
                    console.log(err)
                })
            },
            batchFn: function batchFn(type) {
                var _this = this;
                if (this.multipleSelection.length) {
                    switch (type) {
                        case 'AKeyToGet':
                          _this.$confirm(lists.$lang('确认将以下订单派单并且获取单号吗（派单后下发仓库无法修改）？'), this.$lang('派单+获取单号'), {
                            confirmButtonText: _this.$lang('确定'),
                            cancelButtonText: _this.$lang('取消')
                          }).then(function () {
                            let assginParam = [];
                            _this.fullscreenLoading = true;
                            lists.multipleSelection.forEach(function (item) {
                              assginParam.push({
                                thr_order_id: item.third_order_number,
                                plat_cd: item.plat_cd,
                                warehouse: item.warehouse,
                                b5c_logistics_cd: item.logistics_company,
                                service_code: item.logistics_type
                              });
                            });
                            axios.post("/index.php?g=OMS&m=Patch&a=patchsAndElectronicOrder", {data:{orders:assginParam}}).then(
                              function (res) {
                                _this.fullscreenLoading = false;
                                var data = res.data;
                                lists.getListData(1, 'all');
                                if (data.data.body) {
                                  sessionStorage.setItem('assginResult', JSON.stringify(res.data));
                                  setTimeout(function () {
                                    lists.getListData(1, 'all');
                                  }, 3000)
                                  lists.toOrderDetail('批量派单结果页', 'showResult');
                                } else {
                                  lists.$message.error(_this.$lang(data.data.info))
                                }
                              })
                          }).catch(function () {
                            _this.fullscreenLoading = false;
                            return false
                          });
                         break;
                        case 'editRemark':
                            this.remarkEdit = true;
                            this.isRemarks = false; // 默认没有运营备注
                            this.selectRemarkArr = Object.create(lists.multipleSelection) // 深拷贝选中的数据
                            this.listData.forEach((value)=> {
                                lists.multipleSelection.forEach( (item) =>{
                                    if(item.remarks){
                                        this.isRemarks = true;  // 存在运营备注
                                    }
                                    if (item == value) {
                                        this.$set(value, 'remarkEdit', true);
                                    }
                                });
                            });
                            break;
                        case 'remarkSave':
                            if(this.isRemarks) { // 存在运营备注
                                this.$confirm(this.$lang('选中订单已经存在运营备注，确定要覆盖吗？'), this.$lang('提示'), {
                                    confirmButtonText: this.$lang('确定'),
                                    cancelButtonText: this.$lang('取消'),
                                    center: true,
                                    type: 'warning'
                                }).then(() => {
                                    this.remarkSave();
                                })
                            } else {
                                this.remarkSave();
                            }
                            break;
                        case 'addressEdit':
                            this.addressEdit = true;
                            let addressEditParam = {
                                datas: []
                            };
                            this.listData.forEach((value)=> {
                                lists.multipleSelection.forEach( (item) =>{
                                    if (item == value) {
                                        this.$set(value, 'addressEdit', true);
                                        addressEditParam.datas.push({
                                            thr_order_id: value.third_order_number,
                                            plat_cd: value.plat_cd
                                        });
                                    }
                                });
                            });
                            break;
                        case 'edit':
                            // this.btnLoading = true;
                            // this.tableLoading = true;
                            // 批量编辑已勾选的 设置对应的下拉选项
                            this.listData.forEach((v)=> {
                                this.$set(v, 'allWarehouse', [{
                                    cd: v.warehouse,
                                    name: v.warehouse_name
                                }]);
                                this.$set(v, 'logisticsCompany', [{
                                    logisticsCode: v.logistics_company,
                                    logisticsName: v.logistics_company_name
                                }]);
                                this.$set(v, 'logisticsMethod', [{
                                    id: v.logistics_type,
                                    logisticsMode: v.logistics_type_name
                                }]);
                                this.$set(v, 'faceData', [{
                                    CD: v.surfaceWayGetCd,
                                    CD_VAL: v.surfaceWayGetCdNm
                                }]);
                            });

                            let editParam = {
                                datas: []
                            };
                            let editLogisticsStatus = {
                                id: []
                            };
                            // GTH250034248 GTH250034250 米家智能摄像机 云台
                            this.listData.forEach((value)=> {
                                lists.multipleSelection.forEach((item)=>{
                                    if (item == value) {
                                        editParam.datas.push({
                                            thr_order_id: value.third_order_number,
                                            plat_cd: value.plat_cd
                                        });
                                        editLogisticsStatus.id.push(value.id)
                                        // 将需要批量编辑数据的对应输入框显示出来
                                        this.$set(value, 'edit', true);
                                        this.$set(value, 'isDisabled', true);
                                    }
                                });
                            });

                            if(this.isdialogBatchDditingData){
                                batchEditing()
                            }else{
                                axios.post('/index.php?g=OMS&m=Patch&a=checkLogisticsStatus', editLogisticsStatus)
                                    .then(function (res) {
                                        console.log(res.data.data);
                                        if (res.data.status == 200000) {
                                            if(res.data.data.length == 0){
                                                batchEditing()
                                            }else{
                                                lists.dialogBatchDditingData.data = res.data.data
                                                lists.dialogBatchDditing = true
                                                lists.dialogBatchDditingData.type = 'edit'
                                            }
                                        } else {
                                            lists.$message.error(res.data.info);
                                        }

                                    })
                            }


                        function batchEditing() {
                            lists.btnLoading = true;
                            lists.tableLoading = true;
                            lists.isdialogBatchDditingData = false

                            axios.post("/index.php?g=OMS&m=Patch&a=logisticsGet", editParam).then((res) =>{
                                let response = res.data;
                                console.log("编辑获取物流相关的数据",res);
                                // 内存释放
                                editParam.datas = null;

                                if (response.status == 200000 && response.data) {
                                    lists.btnLoading = false;
                                    lists.tableLoading = false;

                                    var edit = true;

                                    lists.popIsShow = true;
                                    // 显示仓库、物流相关的下拉框
                                    lists.batchEdit = true;

                                    let storeId = null;
                                    let allWarehouse = [];
                                    let findOrderJson ={};
                                    // this.getOrderResultData = res.data;
                                   let warehouses = {};
                                  response.data.forEach(function(v){
                                    if(!warehouses[v.storeId]){
                                      warehouses[v.storeId] = v.data.warehouse
                                    }
                                  })
                                    response.data.forEach((item) =>{
                                        lists.multipleSelection.forEach((value, k)=> {
                                            if (item.orderId == value.third_order_number && item.code === 2000) {
                                                value.allWarehouse=[];
                                                value.findOrderJson = null;


                                                // 根据storeId 来判断
                                                if(item.hasOwnProperty("storeId") && !storeId){ //第一次
                                                    storeId = item.storeId;
                                                    allWarehouse = warehouses[storeId];
                                                    findOrderJson = JSON.stringify({warehouse:warehouses[storeId]});
                                                    console.log("1");
                                                    value.allWarehouse = allWarehouse;
                                                    value.findOrderJson = findOrderJson
                                                }else if(item.hasOwnProperty("storeId") ){
                                                    value.allWarehouse = warehouses[item.storeId];
                                                    value.findOrderJson = JSON.stringify({warehouse:warehouses[storeId]});
                                                    console.log("2");

                                                } else {
                                                    storeId = null;
                                                    allWarehouse = [];
                                                    console.log("3");
                                                    value.allWarehouse = item.data.warehouse;

                                                    value.findOrderJson = JSON.stringify(item.data);
                                                }


                                                // this.$set(value, 'allWarehouse', item.data.warehouse);
                                                // this.$set(value,"findOrderJson",JSON.stringify(item.data));

                                                edit = false;
                                                lists.$set(value, 'isDisabled', false);
                                            } else if (item.orderId == value.third_order_number && item.code !== 2000) {
                                                lists.$refs.multipleTable.toggleRowSelection(value);
                                                !lists.multipleSelection.length && (lists.batchEdit = false);
                                            }
                                            if (item.data.orderId === value.order_id && item.code !== 2000) {
                                                _lists.$refs.multipleTable.toggleRowSelection(value)
                                            }
                                        });
                                        if (item.code !== 2000) {
                                            lists.$message.error(item.data.orderId + ' ' + item.msg)
                                        }
                                    });
                                    // console.log("点击编辑后的数据",lists.listData);
                                    edit && lists.$message.error(lists.$lang('已选择订单无可编辑内容'));
                                } else {
                                    lists.$message.error(lists.$lang(response.info));
                                    lists.btnLoading = false;
                                    lists.tableLoading = false;
                                }
                            }).catch(()=>{
                                lists.btnLoading = false;
                                lists.tableLoading = false;

                            });
                        }




                            break;
                        case 'assgin':
                            var _this = this;
                            this.$confirm(lists.$lang('确认将以下订单派单吗（派单后下发仓库无法修改）？'), this.$lang('派单'), {
                                confirmButtonText: this.$lang('确定'),
                                cancelButtonText: this.$lang('取消')
                            }).then(function () {
                                let assginParam = [];
                                _this.fullscreenLoading = true;
                                lists.multipleSelection.forEach(function (item) {
                                    assginParam.push({
                                        thr_order_id: item.third_order_number,
                                        plat_cd: item.plat_cd,
                                        warehouse: item.warehouse,
                                        id: item.id
                                    });
                                });
                                axios.post("/index.php?g=OMS&m=Patch&a=patchs", assginParam).then(
                                    function (res) {
                                        var data = res.data;
                                      lists.doSearch(_this.currentPage);
                                        if (data.data.body) {
                                            sessionStorage.setItem('assginResult', JSON.stringify(res.data));
                                            setTimeout(function () {
                                              lists.doSearch(_this.currentPage);
                                            }, 3000)
                                            lists.toOrderDetail('批量派单结果页', 'showResult');
                                        } else {
                                            lists.$message.error(_this.$lang(data.data.info))
                                        }
                                        _this.fullscreenLoading = false;
                                    })
                            }).catch(function () {
                                _this.fullscreenLoading = false;
                                return false
                            });
                            break;
                        case 'addressSave':
                            this.tableLoading = true;
                            this.isBtnLoading = true;
                            let addressSaveParam = [];
                            var _this = this;
                            lists.multipleSelection.forEach(function (val) {
                                addressSaveParam.push({
                                    address: val.address,
                                    doorplate: val.doorplate,
                                    thr_order_id: val.third_order_number,
                                    plat_cd: val.plat_cd,
                                });
                            })
                            axios.post("/index.php?g=oms&m=order&a=updateOrderAddres", addressSaveParam).then(function (res) {
                                if (res.data.status == 200000) {
                                    lists.$message({
                                        type: 'success',
                                        message: _this.$lang('成功保存'),
                                        center: true
                                    });
                                    setTimeout(function () {
                                        lists.isBtnLoading = false;
                                        lists.tableLoading = false;
                                        lists.doSearch()
                                        lists.currentPage = 1
                                    }, 3000)
                                } else {
                                    lists.$message({
                                        type: 'error',
                                        message: _this.$lang('保存失败'),
                                        center: true
                                    });
                                    lists.tableLoading = false;
                                    lists.isBtnLoading = false;
                                }
                            });
                            break;
                        case 'save':
                            this.chooseWarehouse = '';
                            this.selectCompany = '';
                            // this.tableLoading = true;
                            // this.isBtnLoading = true;
                            this.logisticsWay = '';
                            this.faceSheet = '';
                            let saveParam = {
                                orders: []
                            };
                            var _this = this;
                            var list = [];
                            this.listData.forEach((value) =>{
                                lists.multipleSelection.forEach((item) =>{
                                    if (item == value) {
                                        this.$set(value, 'edit', false);
                                        list = lists.multipleSelection.filter(function (item, index) {
                                            return item.ischange1 == true || item.ischange2 == true || item.ischange3 == true
                                        })
                                        // console.log(lists.multipleSelection);
                                    }
                                });
                            });
                            // console.log(lists.multipleSelection,JSON.parse(lists.comparedSelection))
                            let comparedSelection = JSON.parse(lists.comparedSelection)
                            lists.multipleSelection.forEach(function (val,index) {
                                console.log(index);
                                saveParam.orders.push({
                                    thr_order_id: val.third_order_number,
                                    plat_cd: val.plat_cd,
                                    delivery_warehouse_code: val.warehouse,
                                    logistics_company_code: val.logistics_company,
                                    shipping_methods_code: val.logistics_type,
                                    waybill_number: val.waybill_number,
                                    patch_freight: val.freight,
                                    electronic_single_code: val.surfaceWayGetCd,
                                    id: val.id,
                                    is_change_logistics: comparedSelection[index].logistics_company == val.logistics_company && comparedSelection[index].logistics_type == val.logistics_type ? 0 : 1, // 判断物流方式或者物流公司是否发生改变
                                });
                            })

                            if(this.isdialogBatchDditingData){
                                bulkSave()
                            }else{
                                axios.post('/index.php?g=OMS&m=Patch&a=checkLogisticsBySave', saveParam)
                                    .then(function (res) {
                                        console.log(res.data.data);
                                        if (res.data.status == 200000) {
                                            if(res.data.data.data.length == 0){
                                                bulkSave()
                                            }else{
                                                lists.dialogBatchDditingData.data = res.data.data.data
                                                lists.dialogBatchDditing = true
                                                lists.dialogBatchDditingData.type = 'save'
                                                lists.dialogBatchDditingData.allNum = lists.multipleSelection.length
                                                lists.dialogBatchDditingData.partNum = lists.multipleSelection.length - res.data.data.data.length
                                            }
                                        } else {
                                            lists.$message.error(res.data.info);
                                        }

                                    })
                            }



                        function bulkSave() {
                            lists.tableLoading = true;
                            lists.isBtnLoading = true;
                            lists.isdialogBatchDditingData = false

                            if(lists.dialogBatchDditingData.saveType == 'part'){
                                var partDataArr = saveParam.orders
                                var partData = lists.dialogBatchDditingData.data
                                for (const item in partData) {
                                    partDataArr.splice(partDataArr.findIndex(item2 => item2.thr_order_id === partData[item].order_no), 1)
                                }
                                saveParam.orders = partDataArr
                            }


                            axios.post("/index.php?g=OMS&m=Patch&a=waitLogisticsUpdate", saveParam).then((res)=> {
                                // 释放内存
                                lists.listData.forEach((value => {
                                    value.allWarehouse=[];
                                    value.findOrderJson = null;
                                }))

                                if (res.data.status == 200000) {
                                    lists.$message({
                                        type: 'success',
                                        message: _this.$lang('成功编辑 :') + _this.$lang(res.data.data.order) + _this.$lang('条'),
                                        center: true
                                    });
                                    // _this.$lang('保存失败 :') + _this.$lang(res.data.data.error) + _this.$lang('条'),
                                    setTimeout(function () {
                                        lists.isBtnLoading = false;
                                        lists.tableLoading = false;
                                        lists.doSearch()
                                        lists.currentPage = 1
                                    }, 3000)
                                } else if (res.data.status == 400000) {
                                    lists.$message({
                                        type: 'error',
                                        message: _this.$lang(res.data.data),
                                        center: true
                                    });
                                    lists.isBtnLoading = false;
                                    lists.tableLoading = false;
                                } else {
                                    lists.$message({
                                        type: 'error',
                                        message: _this.$lang('保存失败'),
                                        center: true
                                    });
                                    lists.isBtnLoading = false;
                                    lists.tableLoading = false;
                                }
                            });
                        }



                            break;
                        case 'face':
                            // 地址校验前置条件，是否打开了校验配置
                            axios.get("/index.php?g=OMS&m=Patch&a=listMenu").then((res) => {
                                if (res.status == 200) {
                                    let baseData = res.data.data;
                                    if(baseData.address_valid_conf) {
                                        let param = {
                                            data: {
                                                orders: []
                                            }
                                        };
                                        this.multipleSelection.forEach(function(item) {
                                            param.data.orders.push({
                                                thr_order_id: item.third_order_number, // 第三方订单 ID
                                                plat_cd: item.plat_cd, // 平台 CODE
                                            });
                                        });
                                        axios.post("/index.php?g=OMS&m=Patch&a=checkOrderAddressValidMult", param).then(res=> {
                                            console.log(res);
                                            if(res.data.status == 200000) {
                                                this.getOrderCode(this.multipleSelection);
                                            } else {
                                                this.verificationFailedList = res.data.data.err_order;
                                                this.warehouseTipShow = true;
                                            }
                                        })
                                    } else {
                                        this.getOrderCode(this.multipleSelection);
                                    }
                                }
                            })
                            break;
                        default:
                            this.popIsShow = false;
                            this.chooseWarehouse = '';
                            this.selectCompany = '';
                            this.logisticsWay = '';
                            this.faceSheet = '';
                            this.getListData();
                            this.batchEdit = false;
                            this.$refs.multipleTable.clearSelection();
                            this.listData.forEach( (value) =>{
                                this.$set(value, 'edit', false);
                            });
                            break;
                    }
                } else {
                    this.$message.warning(this.$lang('请先勾选条目'));
                }
            },
            delayInShipment: function () {
                var _this = this;
                var param = {
                    orders: []
                };
                this.multipleSelection.forEach(function (item) {
                    param.orders.push({
                        order_id: item.third_order_number,
                        plat_cd: item.plat_cd,
                        delay_delivery_time: _this.time
                    });
                });
                axios.post("/index.php?g=OMS&m=Patch&a=batchChangeDelayDeliveryTime", param).then(function (res) {
                    if (res.data.status == 2000) {
                        lists.$message.success(lists.$lang(res.data.info));
                    } else {
                        res.data.info.forEach(function (v) {
                            lists.$message.error(lists.$lang(v));
                        })
                    }
                });
                _this.time = ''
            },
            ship: function () {

                var param = {
                    data: []
                };
                this.multipleSelection.forEach(function (item) {
                    param.data.push({
                        order_id: item.third_order_number,
                        plat_cd: item.plat_cd,
                    });
                });

                if (this.multipleSelection.length) {
                    this.shipLoading = true;
                    axios.post("/index.php?g=OMS&m=Patch&a=signSendOut", param).then(function (res) {
                        lists.shipLoading = false;
                        if (res.data.code == 200) {
                            sessionStorage.setItem('shipResult', JSON.stringify(res.data.body));
                            setTimeout(function () {
                                lists.doSearch()
                            }, 1500)
                            var scrollTop = $(window).scrollTop()
                            // sessionStorage.setItem('scrollTop', scrollTop)
                            // sessionStorage.setItem("OrderPatchOffsetTop", document.documentElement.scrollTop);
                            newTab('/index.php?g=OMS&m=Patch&a=ship_result', lists.$lang('标记发货结果'));
                        } else {
                            lists.$message.error(lists.$lang(res.data.info));
                        }
                    });
                } else {
                    this.$message.warning(this.$lang('请先勾选条目'));
                }
            },
            changeLogCom: function changeLogCom() {
                var _this4 = this;
                axios.post("index.php?g=Oms&m=OrderPresent&a=get_log_company", {
                    company_code: this.form.logisticsCompany
                }).then(function (res) {
                    if (res.data.code == 200) {
                        _this4.baseData.shipping = res.data.data;
                    } else {
                        _this4.baseData.shipping = _this4.stashData;
                    }
                });
            },
            //选择仓库
            selHouse: function selHouse(row) {
                var allHouse = row.allWarehouse,
                    selectHouse = row.warehouse;
                allHouse.forEach(function (item) {
                    if (item.cd == selectHouse) {
                        Vue.set(row, 'logisticsCompany', item.lgtModel);
                    }
                });

            },
            //选择物流公司
            selCom: function selCom(row) {
                this.selHouse(row);
                var _this = this;
                var allCom = row.logisticsCompany,
                    selectCom = row.logistics_company;
                allCom.forEach(function (item) {
                    if (item.logisticsCode == selectCom) {
                        Vue.set(row, 'logisticsMethod', item.logisticsMethod);
                    }
                });
            },
            //获取面单
            selOrder: function selOrder(row) {
                var param = {
                    "logistic_model_id": row.logistics_type
                };
                axios.post("/index.php?g=OMS&m=Patch&a=faceOrderGet", param).then(function (res) {
                    var data = res.data;
                    if (data.status == 200000) {
                        Vue.set(row, 'faceData', data.data);
                    } else {
                        Vue.set(row, 'faceData', []);
                        row.surfaceWayGetCd = ''

                    }
                });
            },
            /**
             *  单个
             *  tear        拆单
             *  cancelTear  取消拆单
             *  save        保存
             *  assgin      派单
             *  defualt     取消
             **/
            singleFn: function singleFn(type, item) {
                switch (type) {
                    case 'assgin':
                        this.$confirm(this.$lang('确认将以下订单派单吗（派单后下发仓库无法修改）？'), this.$lang('派单'), {
                            confirmButtonText: this.$lang('确定'),
                            cancelButtonText: this.$lang('取消')
                        }).then(function () {
                            axios.post("/index.php?g=OMS&m=Patch&a=patchs", [{
                                thr_order_id: item.third_order_number,
                                plat_cd: item.plat_cd,
                                warehouse: item.warehouse,
                                id: item.id
                            }]).then(function (res) {
                                var data = res.data;
                                if (data.data.body) {
                                    if (data.data.body.orderlist_success) {
                                        lists.$message.success(lists.$lang('派单成功'));
                                        setTimeout(function () {
                                            lists.getListData();
                                        }, 1500)
                                    } else {
                                        lists.$message.error(lists.$lang(data.data.body.message_orders[0].msg));
                                    }
                                } else {
                                    lists.$message.error(lists.$lang(data.data.info));
                                }
                            });
                        }).catch(function () {
                            return false;
                        });
                        break;
                    case 'tear':


                        axios.post("/index.php?g=OMS&m=Order&a=examine", {
                            third_party_order_id: item.third_order_number
                        }).then(function (res) {
                            if (res.data.is_hint) {
                                lists.$confirm('已和第三方物流公司“' + '<span class="thirdOrderStrong">' + item.logistics_company_name + '</span>' + '”交互完成，拆单请注意！运单号:' + '<span class="thirdOrderStrong">' + item.waybill_number + '</span>' + ' 面单：' + '<span class="thirdOrderStrong">' + item.surfaceWayGetCdNm + '</span>', lists.$lang('注意！'), {
                                    dangerouslyUseHTMLString: true,
                                    confirmButtonText: lists.$lang('确定'),
                                    cancelButtonText: lists.$lang('取消')
                                }).then(function () {
                                    axios.post("/index.php?g=Oms&m=OrderPresent&a=spilt_order", {
                                        condition: {
                                            orderId: item.third_order_number,
                                            platCd: item.plat_cd
                                        }
                                    }).then(function (res) {
                                        var data = res.data;
                                        if (data.code == 200) {
                                            sessionStorage.setItem('takeOrders', JSON.stringify(data.data));
                                            lists.toOrderDetail(lists.$lang('派单-拆单'));
                                            setTimeout(function () {
                                                lists.doSearch()
                                            }, 2000)
                                        } else {
                                            lists.$message.error(lists.$lang(data.msg));
                                        }
                                    });
                                }).catch(function () {
                                    return false;
                                });

                            } else {
                                axios.post("/index.php?g=Oms&m=OrderPresent&a=spilt_order", {
                                    condition: {
                                        orderId: item.third_order_number,
                                        platCd: item.plat_cd
                                    }
                                }).then(function (res) {
                                    var data = res.data;
                                    if (data.code == 200) {
                                        sessionStorage.setItem('takeOrders', JSON.stringify(data.data));
                                        lists.toOrderDetail(lists.$lang('派单-拆单'));
                                        setTimeout(function () {
                                            lists.doSearch()
                                        }, 2000)
                                    } else {
                                        lists.$message.error(lists.$lang(data.msg));
                                    }
                                });

                            }
                        });


                        break;
                    case 'cancelTear':


                        axios.post("/index.php?g=OMS&m=Order&a=examine", {
                            third_party_order_id: item.third_order_number
                        }).then(function (res) {
                            if (res.data.is_hint) {
                                lists.$confirm('已和第三方物流公司“' + '<span class="thirdOrderStrong">' + item.logistics_company_name + '</span>' + '”交互完成，取消拆单请注意！运单号:' + '<span class="thirdOrderStrong">' + item.waybill_number + '</span>' + ' 面单：' + '<span class="thirdOrderStrong">' + item.surfaceWayGetCdNm + '</span>', lists.$lang('注意！'), {
                                    dangerouslyUseHTMLString: true,
                                    confirmButtonText: lists.$lang('确定'),
                                    cancelButtonText: lists.$lang('取消')
                                }).then(function () {
                                    lists.$confirm(lists.$lang('确认将该订单取消拆单吗（相关子订单都将取消）？'), lists.$lang('取消拆单'), {
                                        confirmButtonText: lists.$lang('确定'),
                                        cancelButtonText: lists.$lang('取消')
                                    }).then(function () {
                                        var param = {
                                            condition: {
                                                order_id: item.third_order_number,
                                                plat_cd: item.plat_cd
                                            }
                                        };
                                        axios.post("/index.php?g=Oms&m=OrderPresent&a=cancel_split", param).then(function (res) {
                                            if (res.data.code == 2000) {
                                                lists.$message.success(lists.$lang(res.data.msg));
                                                setTimeout(function () {
                                                    lists.doSearch()
                                                }, 1000)
                                            } else {
                                                lists.$message.error(lists.$lang(res.data.msg));
                                            }
                                        });
                                    }).catch(function () {
                                        return false;
                                    });
                                }).catch(function () {
                                    return false;
                                });

                            } else {
                                lists.$confirm(lists.$lang('确认将该订单取消拆单吗（相关子订单都将取消）？'), lists.$lang('取消拆单'), {
                                    confirmButtonText: lists.$lang('确定'),
                                    cancelButtonText: lists.$lang('取消')
                                }).then(function () {
                                    var param = {
                                        condition: {
                                            order_id: item.third_order_number,
                                            plat_cd: item.plat_cd
                                        }
                                    };
                                    axios.post("/index.php?g=Oms&m=OrderPresent&a=cancel_split", param).then(function (res) {
                                        if (res.data.code == 2000) {
                                            lists.$message.success(lists.$lang(res.data.msg));
                                            setTimeout(function () {
                                                lists.doSearch()
                                            }, 1000)
                                        } else {
                                            lists.$message.error(lists.$lang(res.data.msg));
                                        }
                                    });
                                }).catch(function () {
                                    return false;
                                });
                            }
                        });


                        break;
                    case 'save':
                        var _this = this;
                        var param = {
                            orders: [{
                                thr_order_id: item.third_order_number,
                                plat_cd: item.plat_cd,
                                delivery_warehouse_code: item.warehouse,
                                logistics_company_code: item.logistics_company,
                                shipping_methods_code: item.logistics_type,
                                waybill_number: item.waybill_number,
                                patch_freight: item.freight,
                                electronic_single_code: item.surfaceWayGetCd,
                                id: item.id,
                            }]
                        };
                        axios.post("/index.php?g=OMS&m=Patch&a=waitLogisticsUpdate", param).then(function(res) {
                            if (res.data.status == 200000 && res.data.data.order[0]) {
                                lists.$message.success(_this.$lang('保存成功'));
                                lists.$refs.multipleTable.toggleRowSelection(item);
                                !lists.multipleSelection.length && (lists.batchEdit = false);
                                Vue.set(item, 'edit', false);
                            } else {
                                lists.$message.error(_this.$lang(res.data.data));
                            }
                        });
                        break;
                    default:
                        this.getListData();
                        this.$refs.multipleTable.toggleRowSelection(item);
                        !this.multipleSelection.length && (this.batchEdit = false);
                        Vue.set(item, 'edit', false);
                        break;
                }
            },
            flowJump: function flowJump(e) {
                var _this5 = this;

                var path = [{
                    m: 'order_present',
                    a: 'OrderPresentList',
                    title: this.$lang('待预派')
                }, {
                    m: 'patch',
                    a: 'lists',
                    title: this.$lang('待派单')
                }, {
                    m: 'pending_order',
                    a: 'pending_list',
                    title: this.$lang('待获取运单号')
                }, {
                    m: 'picking',
                    a: 'pickingList',
                    title: this.$lang('待拣货')
                }, {
                    m: 'pick_apart',
                    a: 'PickApartList',
                    title: this.$lang('待分拣')
                }, {
                    m: 'check_order',
                    a: 'checkingList',
                    title: this.$lang('待核单')
                }, {
                    m: 'out_going',
                    a: 'outList',
                    title: this.$lang('待出库')
                }, {
                    m: 'out_storage',
                    a: 'listPage',
                    title: this.$lang('已出库')
                }];

                setTimeout(function () {
                    var url = 'index.php?g=oms&m=order_present&a=OrderPresentList';
                    $('.el-step__head').each(function (i, e) {
                        $(e).click(function () {
                            if (_this5.active == i) {
                                window.location.reload();
                            } else {
                                var scrollTop = $(window).scrollTop()
                                // sessionStorage.setItem('scrollTop', scrollTop)
                                // sessionStorage.setItem("OrderPatchOffsetTop", document.documentElement.scrollTop);
                                url = '/index.php?g=oms&m=' + path[i].m + '&a=' + path[i].a;
                                newTab(url, path[i].title);
                            }
                        });
                    });
                }, 1000);
            },
            submit_keywords: function () {
                lists.doSearch()
            }
        },
        //监听数据
        watch: {
            seleDeleOrderData: function () {
                let _this = this;
                let timer = null;
                clearTimeout(timer);

                timer =  setTimeout(function () {
                    var bool = false;
                    for (var x = 0; x < _this.seleDeleOrderData.length; x++) {
                        if (_this.warehouseList.indexOf(_this.seleDeleOrderData[x].warehouse) < 0) {
                            bool = true
                        }
                    }
                    _this.bool = bool
                }, 20)
            },
            form: {
                handler: function handler(newValue, oldValue) {
                    this.currentPage = 1;
                    if (this.form.siteData.length) {
                        clearTimeout(lists.iTimer)
                        lists.iTimer = setTimeout(function () {
                            lists.getListData();
                        }, 500)
                    }
                    this.batchEdit = false;
                },
                deep: true
            },
            pageSize: {
                handler: function handler(newValue, oldValue) {
                    if (this.form.siteData.length > 0) {
                        this.getListData()
                    } else {
                        this.getListData('', 'all')
                    }
                }
            }
        },
        //过滤器
        filters: {
            formatDate: function formatDate(time) {
                if (time) {
                    return utils.dateFormat(new Date(time), 'yyyy-MM-dd hh:mm:ss');
                }
            }
        }
    });
</script>

</body>

</html>