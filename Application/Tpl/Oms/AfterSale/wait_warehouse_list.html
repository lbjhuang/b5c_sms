<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="./Application/Tpl/Home/Public/utils/css/public.style.css?v=<{$Think.const.V}>">
    <link rel="stylesheet" href="./Application/Tpl/Home/Public/css/element-ui-2.8.2.css?v=<{$Think.const.V}>">
    <link rel="stylesheet" href="./Application/Tpl/Home/Public/css/normailize.css?v=<{$Think.const.V}>">
    <link rel="stylesheet" href="./Application/Tpl/Home/Public/css/default.css?v=<{$Think.const.V}>">
    <link rel="stylesheet" href="./Application/Tpl/Home/Public/icon/css/font-awesome.min.css?v=<{$Think.const.V}>">
    <link rel="stylesheet" href="./Application/Tpl/Oms/Public/css/list_common.css?v=<{$Think.const.V}>">
    <link rel="stylesheet" href="./Application/Tpl/Oms/Order/orderList.css?v=<{$Think.const.V}>">
    <link rel="stylesheet" href="/Application/Tpl/Oms/Order/orderDetail.css?v=<{$Think.const.V}>">
    <title>$lang('退货待入库')</title>
    <style>
        span.shopTag>span {
            position: absolute !important;
            top: 0px;
            left: 0px;
            border-radius: 0px;
            background-color: #f99c64;
            border: 1px solid rgb(231, 156, 116) !important;
        }

        [v-cloak]{
            display: none;
        }
        
        .el-popover {
            text-align: left !important;
        }
        
        .guds-item {
            width: 156px;
            float: left;
            padding: 5px 0px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
        
        .count-item {
            padding: 5px 0px;
            float: right;
            font-weight: 600;
            font-size: 14px
        }
        
        .el-table .cell {
            word-break: break-word !important;
        }
        
        .ellipsis {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            cursor: pointer;
        }

        /* 物流轨迹样式 */
        .text-left{
            position: relative;
            margin: 0;
        }
        .track-tile{
            text-align: left;
        }
        .track-center{
            position: absolute;
            background: #fff;
            z-index: 2;
            top: 0;
            left: 125px;
        }
        .track-center .dot-wrap{
            display: inline-block;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            border: 1px solid #ccc;
            text-align: center;
            line-height: 16px;
        }
        .track-center .dot-wrap .dot{
            width: 10px;
            height: 10px;
            display: inline-block;
            background: #ccc;
            border-radius: 50%;
        }
        .track-center .dot-wrap .dot.active{
            background: orange;
        }
        .track-right {
            display: inline-block;
            width: 130px;
            vertical-align: top;
            font-size: 13px;
            padding-bottom: 10px;
        }
        .text-left .track-left{
            padding-bottom: 10px;
            border-left: 1px solid #ccc;
            padding-left: 16px;
            min-height: 46px;
        }
        .track-left {
            display: inline-block;
            width: 260px;
            vertical-align: top;
            font-size: 13px;
            padding-left: 15px;
        }
        .track-color {
            color: orange;
        }
        
        .el-popover.el-popper div {
            text-align: center;
        }
        .el-popover__title {
            text-align: left !important;
            font-weight: 600;
            font-size: 15px;
            padding: 5px 14px;
            margin: 0;
        }
        /* 结束 */

        /*商品表格样式*/
        .goods-box {
            overflow: hidden;
        }
        .goods-box .img-box {
            float: left;
            width: 75px;
            margin-top: 10px;
        }
        .goods-box .text-box {
            float: left;
            width: 190px;
            text-align: left !important;
        }
        .sale-team {
            width: 100%;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
            cursor: pointer;
        }
        
        .title-info-container .title-info {
            /*text-align: right;*/
            padding-left: 12px;
            height: 20px;
            line-height: 20px;
        }
        .third-order{
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .third-order a{
            width: fit-content;
        }
        .el-loading-spinner{
            top:300px;
            margin-top: -21px;
            position: fixed;
        }
        .el-select{
            width: 100% !important;
        }
        .table-searh-header .el-button--primary{
            background: #0375DE;
            border-color: #0375DE;
        }
        .table-searh-header .el-button--primary.is-disabled{
            background: #a0cfff;
            border-color: #a0cfff;
        }
        .notClick{
            background-color: #F5F7FA;
            border-color: #E4E7ED;
            color: #C0C4CC;
            pointer-events: none;
        }
        .notAllowed{
            cursor: not-allowed;
        }
        .custom-dialog-body {
            padding: 30px 20px;
            color: #606266;
            font-size: 14px;
            word-break: break-all;
        }
        .custom-dialog-body .el-dialog__header {
            display: block;
        }
    </style>
</head>

<body class="orderList">
    <div id="order-list" class="list-common" v-cloak style="margin-bottom:220px;" v-loading="tableLoading">
        <div class='cls' style="height:auto;">
            <div class='cls' style="height:auto;">
                <el-col :span="4" class="title-info-container" style="height:100%;">
                    <div class="title-info">{{$lang('商品编码')}}</div>
                </el-col>
                <el-col :span="4" class="search-item-i">
                    <div class="fl sort-item">
                        <el-input size="small" :placeholder="$lang('商品编码')" v-model="search.sku_id"></el-input>
                    </div>
                </el-col>
                <el-col :span="4" class="title-info-container" style="height:100%;">
                    <div class="title-info">{{$lang('订单号')}}</div>
                </el-col>
                <el-col :span="4" class="search-item-i">
                    <div class="fl sort-item">
                        <el-input size="small" :placeholder="$lang('订单号')" v-model="search.order_no"></el-input>
                    </div>
                </el-col>
                <el-col :span="4" class="title-info-container" style="height:100%;">
                    <div class="title-info">{{$lang('物流单号')}}</div>
                </el-col>
                <el-col :span="4" class="search-item-i">
                    <div class="fl sort-item">
                        <el-input size="small" :placeholder="$lang('物流单号')" v-model="search.logistics_no"></el-input>
                    </div>
                </el-col>
                <el-col :span="4" class="title-info-container" style="height:100%;">
                    <div class="title-info">{{$lang('退入仓库')}}</div>
                </el-col>
                <el-col :span="4" class="search-item-i">
                    <div class="fl sort-item">
                        <el-select
                            v-model="search.warehouse_code"
                            multiple
                            collapse-tags
                            filterable
                            :placeholder="$lang('请选择仓库')">
                            <el-option
                            v-for="item in warehousesOption"
                            :key="item.CD"
                            :label="$lang(item.CD_VAL)"
                            :value="item.CD">
                            </el-option>
                        </el-select>
                    </div>
                </el-col>
            </div>
            <div class='cls' style="height:auto;">
                <el-col :span="4" class="title-info-container" style="height:100%;">
                    <div class="title-info">{{$lang('售后单号')}}</div>
                </el-col>
                <el-col :span="4" class="search-item-i">
                    <div class="fl sort-item">
                        <el-input size="small" :placeholder="$lang('售后单号')" v-model="search.after_sale_no"></el-input>
                    </div>
                </el-col>
                <el-col :span="4" class="title-info-container" style="height:100%;">
                    <div class="title-info">{{$lang('物流方式')}}</div>
                </el-col>
                <el-col :span="4" class="search-item-i">
                    <div class="fl sort-item">
                        <el-input size="small" :placeholder="$lang('物流方式')" v-model="search.logistics_way_code"></el-input>
                    </div>
                </el-col>
                <el-col :span="4" class="title-info-container" style="height:100%;">
                    <div class="title-info">{{$lang('申请人')}}</div>
                </el-col>
                <el-col :span="4" class="search-item-i">
                    <div class="fl sort-item">
                        <el-input size="small" :placeholder="$lang('申请人')" v-model="search.created_by"></el-input>
                    </div>
                </el-col>
            </div>
            <div class='cls' style="height:auto;">
                <el-col :span="6" class="title-info-container" style="height:100%;">
                    <div class="title-info">{{$lang('发起时间')}}</div>
                </el-col>
                <el-col :span="6" class="search-item-i">
                    <div class="fl sort-item">
                        <div>
                            <el-date-picker value-format="yyyy-MM-dd HH:mm:ss" size="small" v-model="dateRange" type="datetimerange" :default-time="['00:00:00', '23:59:59']" align="right" unlink-panels :range-separator="$lang('至')" :start-placeholder="$lang('开始日期')" :end-placeholder="$lang('结束日期')" :picker-options="pickerOptions">
                            </el-date-picker>
                        </div>
                    </div>
                </el-col>
            </div>
            <div class="search-btn-container">
                <div class="btns">
                    <button @click="doSearch" class="btn-search" name="search">{{$lang('搜索')}}</button>
                    <button @click="doReset" class="btn-reset" name="reset">{{$lang('重置')}}</button>
                </div>
            </div>
        </div>
        <!-- 分割线 start-->
        <div class="orderList-line line-split"></div>
        <!-- 分割线 end-->

        <!-- 订单表格主体 start-->
        <div class="orderList-Main list-common-main">
            <header class="table-searh-header">
                {{$lang('搜索结果')}}:{{$lang('共')}}
                <span class="num-bold">{{totalCount}}</span> {{$lang('条记录')}}
                <el-button :disabled="bathQuery" style="margin-left: 40px;" type="primary" @click="bathQueryClick">{{$lang('批量退货入库')}}</el-button>
                <el-button :disabled="bathRefuse" style="margin-right: 40px;" type="primary" @click="bathRefuseClick">{{$lang('批量拒绝入库')}}</el-button>
                <el-button type="button" @click="bathCancelClick">{{$lang('取消')}}</el-button>
                <el-button type="primary" @click="queryClick">{{$lang('确认')}}</el-button>
                <el-button type="primary" @click="downloadExcelTemp">{{$lang('EXCEL退货入库模板')}}</el-button>
                <el-button type="primary" @click="doExcelReturnToWarehouse" :loading="bLoading">{{$lang('EXCEL退货入库')}}</el-button>
                <form id="importEditExcel" action="/index.php?m=Stock&amp;a=import_bill" method="post" enctype="multipart/form-data" style="display:none">
                    <input type="file" name="file" id="excelFile" @change="handleFileUpload">
                </form>
                <div v-if="bathQuery" style="display: inline-block;float: right">
                    <el-button v-if="!bathQuery_b" type="primary" @click="change">{{$lang('批量编辑入库原因')}}</el-button>
                    <div  v-if="bathQuery_b" style="display: flex">
                        <el-input v-model="info" style="margin-right: 10px"></el-input>
                        <el-button type="primary" @click="write">{{$lang('写入')}}</el-button>
                        <el-button type="button" @click="bathQuery_b = false">{{$lang('取消')}}</el-button>
                    </div>
                </div>
            </header>
            <el-table  border ref="multipleTable" show-header ref="multipleTable" :data="tableData" tooltip-effect="dark" style="width: 100%" class="order-list-table table-common" v-loading="fullscreenLoading" @selection-change="selectionChange" @sort-change="sortChange">
                <el-table-column type="selection" width="55">
                </el-table-column>
                <el-table-column :label="$lang('售后单号')" prop="after_sale_no">
                </el-table-column>
                <el-table-column :label="$lang('物流方式')">
                    <template slot-scope="scope">
                        {{$lang(scope.row.logistics_way_code)}}
                    </template>
                </el-table-column>
                <el-table-column :label="$lang('物流单号')" prop="logistics_no">
                    <template slot-scope="scope">
                        <div id="order-number">
                            <el-popover placement="bottom" width="520" :title="$lang('物流动态')" trigger="manual" v-model="scope.row.popoverValue" append-to-body @hide="hideChange">
                                <div style="padding-left:15px;overflow: auto;max-height: 550px;">
                                    <i class="el-icon-close close" style="position: absolute; top:15px; right:15px;font-size: 22px;cursor: pointer" @click="scope.row.popoverValue = false"></i>
                                    <p class="track-tile">
                                        <span class="track-right">{{$lang('时间')}}</span>
                                        <span class="track-left">{{$lang('地点和跟踪进度')}}</span>
                                    </p>
                                    <p v-if="key<trackIndex" class="text-left" v-for="(item,key) in trackData" :key="key" :class="{'track-color':!key}">
                                        <span class="track-right">[ {{item.day || '-'}} ]
                                        </br>
                                        {{$lang(item.week)}} &nbsp;&nbsp; {{item.time}}
                                        </span>
                                        <span class="track-left">{{item.remark || '-'}}</span>
                                        <span class="track-center">
                                            <i class="dot-wrap">
                                                <span class="dot" :class="{active:!key}" v-if="key===0||key ===trackData.length-1"></span>
                                                <span class="el-icon-arrow-up" v-else></span>
                                            </i>
                                        </span>
                                    </p>
                                    <!--  v-if="trackData.length>3" -->
                                    <p style="text-align: right;cursor: pointer;" @click="seeTrack" v-if="trackData && trackData.length>trackIndex">{{$lang('展开')}}</p>
                                    <p style="text-align: right;cursor: pointer;" @click="closeTrack" v-if="trackIndex>4">{{$lang('收起')}}</p>
                                    <p v-show="!trackData" style=" color: #999; font-size: 14px;">
                                        {{$lang('暂无物流信息')}}
                                    </p>
                                </div>
                                <a href="javascript:void(0);" class="to-detail-btn" style="text-decoration: none" slot="reference" type="text" @click="getTrack(scope.row)">{{scope.row.logistics_no}}</a>
                            </el-popover>
                        </div>
                    </template>
                </el-table-column>
                <el-table-column :label="$lang('SKU编码')">
                    <template slot-scope="scope">
                        <div v-if="scope.row.product_info && scope.row.product_info.hasOwnProperty('sku_id')">{{scope.row.product_info.sku_id}}</div>
                    </template>
                </el-table-column>
                <el-table-column :label="$lang('条形码')">
                    <template slot-scope="scope">
                        <div v-if="scope.row.product_info && scope.row.product_info.hasOwnProperty('upc_id')">{{scope.row.product_info.upc_id}}</div>
                    </template>
                </el-table-column>
                <el-table-column :label="$lang('订单号')">
                    <template slot-scope="scope">
                            <div class="third-order">
                                <span >{{scope.row.order_no}}</span>
                                <a class="to-detail-btn" @click="toOrderDetail(scope.row.order_no,scope.row.order_id,scope.row.platform_country_code)">{{$lang('查看')}}</a>
                            </div>
                        <!-- {{scope.row.order_no}} -->
                    </template>
                </el-table-column>
                <el-table-column :label="$lang('商品')" width="290px" algin="left">
                    <template slot-scope="scope">
                        <div class="goods-box">
                            <div class="img-box" v-if="scope.row.product_info">
                                <el-tooltip class="item" effect="dark" placement="left">
                                    <div slot="content">
                                        <img :src="scope.row.product_info.thumbnail" width="300" height="300" alt="">
                                    </div>

                                    <img :src="scope.row.product_info.thumbnail" width="60" height="60" alt="">
                                </el-tooltip>
                            </div>
                            <div class="text-box" v-if="scope.row.product_info">
                                <div>SKU：{{scope.row.product_info.sku_id}} x {{scope.row.order_goods_num}}</div>
                                <div>{{scope.row.pay_currency}}：{{scope.row.pay_total_price}}</div>
                                <div>{{$lang(scope.row.product_info.spu_name)}}</div>
                                <div>{{scope.row.product_info.product_attr}}</div>
                            </div>
                        </div>
                    </template>
                </el-table-column>
                <!-- <el-table-column :label="$lang('商品名称')">
                    <template slot-scope="scope">
                            <div v-if="scope.row.product_info && scope.row.product_info.hasOwnProperty('spu_name')">{{scope.row.product_info.spu_name}}</div>
                    </template>
                </el-table-column>
                <el-table-column :label="$lang('商品属性')">
                    <template slot-scope="scope">
                        <div v-if="scope.row.product_info && scope.row.product_info.hasOwnProperty('product_attr')">{{scope.row.product_info.product_attr}}</div>
                    </template>
                </el-table-column>
                <el-table-column :label="$lang('商品图片')" style="position: relative;">
                    <template slot-scope="scope">
                        <img v-if="scope.row.product_info && scope.row.product_info.hasOwnProperty('thumbnail')" :src="scope.row.product_info.thumbnail" style="cursor: pointer;" width="80" height="80" @mouseenter="showImg(scope.row)" @mouseleave="showImg(scope.row)">
                        <div style="position: absolute; top: 10px; left: 100%; box-shadow: 0 0 5px #536d7a;z-index:999" v-if="scope.row.bigImg">
                            <img :src="scope.row.product_info.thumbnail" width="300" height="300">
                        </div>
                    </template>
                </el-table-column> -->
                <el-table-column :label="$lang('退入仓库')">
                    <template slot-scope="scope">
                        <div v-if="scope.row.warehouse_code_val">{{$lang(scope.row.warehouse_code_val)}}</div>
                    </template>
                </el-table-column>
                <el-table-column prop="over_warehouse_num" :label="$lang('待入库数量')"></el-table-column>
                <el-table-column prop="created_at" :label="$lang('发起日期')" sortable="custom"></el-table-column>

                <el-table-column :label="$lang('正品件数/拒绝入库数量')" width="140px">
                    <template slot-scope="scope">
                        <p>
                            <el-input :disabled="scope.row.confirm_storage?false:true" v-model="scope.row.warehouse_num" :placeholder="$lang('正品件数')"></el-input>
                        </p>
                        <el-input :disabled="scope.row.refuse_entry?false:true" v-model="scope.row.warehouse_num_refuse" :placeholder="$lang('拒绝入库数量')"></el-input>
                    </template>
                </el-table-column>
                <el-table-column :label="$lang('次品件数/拒绝入库原因')" width="140px">
                    <template slot-scope="scope">
                        <p>
                            <el-input :disabled="scope.row.confirm_storage?false:true" v-model="scope.row.warehouse_num_broken" :placeholder="$lang('次品件数')"></el-input>
                        </p>
                        <el-input :disabled="scope.row.refuse_entry?false:true" v-model="scope.row.refuse_reason" :placeholder="$lang('拒绝入库原因')"></el-input>
                    </template>
                </el-table-column>

                <el-table-column :label="$lang('操作')" width="200">
                    <template slot-scope="scope">
                        <!-- <el-button type="primary" size="mini" @click="returnInto(scope.row.return_goods_id)">{{$lang('退货入库')}}</el-button>
                        <el-button type="info" size="mini" @click="refuseInto(scope.row.return_goods_id)">{{$lang('拒绝入库')}}</el-button> -->
                        <div  :class="scope.row.bath_opt ? 'notAllowed' : ''">
                            <div :class="scope.row.bath_opt ? 'notClick' : ''">
                                <div style="margin-bottom: 15px;">
                                    <el-checkbox v-model="scope.row.confirm_storage" @change="radioChange(scope.row,scope.row.confirm_storage)">{{$lang('退货入库')}}</el-checkbox>
                                    <el-button type="primary" size="mini" :disabled="scope.row.confirm_storage || scope.row.refuse_entry ? false : true" @click="querywarehouse(scope.$index, scope.row)">{{$lang('确定')}}</el-button>
                                </div>
                                <div>
                                    <!-- <el-radio label="2"></el-radio> -->
                                    <el-checkbox v-model="scope.row.refuse_entry" @change="radioChange2(scope.row,scope.row.confirm_storage)">{{$lang('拒绝入库')}}</el-checkbox>
                                    <el-button type="info" size="mini" :disabled="scope.row.confirm_storage || scope.row.refuse_entry ? false : true" @click="cancelwarehouse(scope.row)">{{$lang('取消')}}</el-button>
                                </div>
                            </div>
                        </div>
                    </template>
                </el-table-column>
            </el-table>
            <el-pagination background @size-change="handleSizeChange" @current-change="handleCurrentChange" :current-page.sync="pages.current_page" :page-sizes="[10, 30, 50, 100]" :page-size="pages.per_page" layout="sizes,prev, pager, next, jumper" :total="totalCount">
            </el-pagination>
        </div>
        <!-- 订单表格主体 end-->
        <el-dialog :visible.sync="returnDialogVisible" width="800px">
            <div class="order-basic-info" style="padding-bottom:5px;">
                <header style="margin-top:10px">
                    {{$lang('退货入库')}}
                </header>
                <table border="0" cellspacing="0" cellpadding="0" class="order-basic-table">
                    <tbody>
                        <tr>
                            <td class="info-title">
                                <div class="cell">
                                    {{$lang('售后单号')}}
                                </div>
                            </td>
                            <td>
                                <span>{{returnIntoData.after_sale_no}}</span>
                            </td>
                            <td class="info-title">
                                <div class="cell">
                                    {{$lang('物流单号')}}
                                </div>
                            </td>
                            <td>
                                <span>{{returnIntoData.logistics_no}}</span>
                            </td>
                        </tr>
                        <tr>
                            <td class="info-title">
                                <div class="cell">
                                    {{$lang('订单号')}}
                                </div>
                            </td>
                            <td>
                                <span>{{returnIntoData.order_no}}</span>
                            </td>
                            <td class="info-title">
                                <div class="cell">
                                    {{$lang('SKU编码')}}
                                </div>
                            </td>
                            <td>
                                <span>{{returnIntoData.sku_id}}</span>
                            </td>
                        </tr>
                        <tr>
                            <td class="info-title">
                                <div class="cell">
                                    {{$lang('条形码')}}
                                </div>
                            </td>
                            <td>
                                <span>{{returnIntoData.upc_id}}</span>
                            </td>
                            <td class="info-title">
                                <div class="cell">
                                    {{$lang('商品名称')}}
                                </div>
                            </td>
                            <td>
                                <div v-if="returnIntoData.product_info && returnIntoData.product_info.hasOwnProperty('spu_name')" style="white-space: normal;">{{returnIntoData.product_info.spu_name}}</div>
                            </td>
                        </tr>
                        <tr>
                            <td class="info-title">
                                <div class="cell">
                                    {{$lang('属性')}}
                                </div>
                            </td>
                            <td>
                                <div v-if="returnIntoData.product_info && returnIntoData.product_info.hasOwnProperty('product_attr')">{{returnIntoData.product_info.product_attr}}</div>
                            </td>
                            <td class="info-title">
                                <div class="cell">
                                    {{$lang('商品图片')}}
                                </div>
                            </td>
                            <td>
                                <img v-if="returnIntoData.product_info && returnIntoData.product_info.hasOwnProperty('thumbnail')" :src="returnIntoData.product_info.thumbnail" style="cursor: pointer;" width="80" height="80">
                            </td>
                        </tr>
                        <tr>
                            <td class="info-title">
                                <div class="cell">
                                    {{$lang('退回仓库')}}
                                </div>
                            </td>
                            <td>
                                <span>{{returnIntoData.warehouse_code_val}}</span>
                            </td>
                            <td class="info-title">
                                <div class="cell">
                                    {{$lang('服务费')}}
                                </div>
                            </td>
                            <td>
                                <span>{{returnIntoData.service_fee_currency_code_val}} {{returnIntoData.service_fee}}</span>
                            </td>
                        </tr>
                        <tr>
                            <td class="info-title">
                                <div class="cell">
                                    <span style="color:#f56c6c">*</span> {{$lang('正品件数')}}
                                </div>
                            </td>
                            <td>
                                <el-input v-model="returnIntoData.warehouse_num" style="width:90%"></el-input>
                            </td>
                            <td class="info-title">
                                <div class="cell">
                                    {{$lang('残次品件数')}}
                                </div>
                            </td>
                            <td>
                                <el-input v-model="returnIntoData.warehouse_num_broken" style="width:90%"></el-input>
                            </td>
                        </tr>
                        <tr>
                            <td class="info-title">
                                <div class="cell">
                                    {{$lang('发起日期')}}
                                </div>
                            </td>
                            <td>
                                <span>{{returnIntoData.updated_at}}</span>
                            </td>
                            <td class="info-title">
                                <div class="cell">
                                    {{$lang('物流方式')}}
                                </div>
                            </td>
                            <td>
                                <span>{{returnIntoData.logistics_way_code}}</span>
                            </td>
                        </tr>
                        <tr>
                            <td class="info-title">
                                <div class="cell">
                                    {{$lang('预计物流费用')}}
                                </div>
                            </td>
                            <td>
                                <span>{{returnIntoData.logistics_fee_currency_code_val}} {{returnIntoData.logistics_fee}}</span>
                            </td>
                            <td class="info-title">
                                <div class="cell">
                                    {{$lang('待入库数量')}}
                                </div>
                            </td>
                            <td>
                                <span>{{returnIntoData.over_warehouse_num}}</span>
                            </td>
                        </tr>
                        <tr>
                            <td class="info-title">
                                <div class="cell">
                                    {{$lang('售后原因')}}
                                </div>
                            </td>
                            <td>
                                <span style="white-space: normal;">{{returnIntoData.return_reason}}</span>
                            </td>
                            <td class="info-title">

                            </td>
                            <td>

                            </td>
                        </tr>
                    </tbody>
                </table>
                <div class="btn-item text-center" style="margin:15px 0;">
                    <el-button @click="returnCancel">{{$lang('取消')}}</el-button>
                    <el-button type="primary" @click="returnSubmit" v-loading.fullscreen="fullscreenLoading">{{$lang('确认')}}</el-button>
                </div>
            </div>
        </el-dialog>
        <!--拒绝入库-->
        <el-dialog :visible.sync="refuseDialogVisible" width="800px">
            <div class="order-basic-info" style="padding-bottom:5px;">
                <header style="margin-top:10px">
                    {{$lang('拒绝入库')}}
                </header>
                <table border="0" cellspacing="0" cellpadding="0" class="order-basic-table">
                    <tbody>
                        <tr>
                            <td class="info-title">
                                <div class="cell">
                                    {{$lang('SKU编码')}}
                                </div>
                            </td>
                            <td>
                                <span>{{refuseIntoData.sku_id}}</span>
                            </td>
                            <td class="info-title">
                                <div class="cell">
                                    {{$lang('条形码')}}
                                </div>
                            </td>
                            <td>
                                <span>{{refuseIntoData.upc_id}}</span>
                            </td>
                        </tr>
                        <tr>
                            <td class="info-title">
                                <div class="cell">
                                    {{$lang('订单号')}}
                                </div>
                            </td>
                            <td>
                                <span>{{refuseIntoData.order_no}}</span>
                            </td>
                            <td class="info-title">
                                <div class="cell">
                                    {{$lang('售后单号')}}
                                </div>
                            </td>
                            <td>
                                <span>{{refuseIntoData.after_sale_no}}</span>
                            </td>
                        </tr>
                        <tr>
                            <td class="info-title">
                                <div class="cell">
                                    {{$lang('商品名称')}}
                                </div>
                            </td>
                            <td>
                                <div v-if="refuseIntoData.product_info && refuseIntoData.product_info.hasOwnProperty('spu_name')" style="white-space: normal;">{{refuseIntoData.product_info.spu_name}}</div>
                            </td>
                            <td class="info-title">
                                <div class="cell">
                                    {{$lang('属性')}}
                                </div>
                            </td>
                            <td>
                                <div v-if="refuseIntoData.product_info && refuseIntoData.product_info.hasOwnProperty('product_attr')">{{refuseIntoData.product_info.product_attr}}</div>
                            </td>
                        </tr>
                        <tr>
                            <td class="info-title">
                                <div class="cell">
                                    {{$lang('商品图片')}}
                                </div>
                            </td>
                            <td>
                                <img v-if="refuseIntoData.product_info && refuseIntoData.product_info.hasOwnProperty('thumbnail')" :src="refuseIntoData.product_info.thumbnail" style="cursor: pointer;" width="80" height="80">
                            </td>
                            <td class="info-title">
                                <div class="cell">
                                    {{$lang('待入库数量')}}
                                </div>
                            </td>
                            <td>
                                <span>{{refuseIntoData.over_warehouse_num}}</span>
                            </td>
                        </tr>
                        <tr>
                            <td class="info-title">
                                <div class="cell">
                                    {{$lang('物流方式')}}
                                </div>
                            </td>
                            <td>
                                <span>{{refuseIntoData.logistics_way_code}}</span>
                            </td>
                            <td class="info-title">
                                <div class="cell">
                                    {{$lang('发起日期')}}
                                </div>
                            </td>
                            <td>
                                <span>{{refuseIntoData.updated_at}}</span>
                            </td>
                        </tr>
                        <tr>
                            <td class="info-title">
                                <div class="cell">
                                    <span style="color:#f56c6c">*</span> {{$lang('拒绝入库数量')}}
                                </div>
                            </td>
                            <td>
                                <el-input v-model="refuseIntoData.warehouse_num_refuse" style="width:90%"></el-input>
                            </td>
                            <td class="info-title">
                                <div class="cell">
                                    {{$lang('退回仓库')}}
                                </div>
                            </td>
                            <td>
                                <span>{{refuseIntoData.warehouse_code_val}}</span>
                            </td>
                        </tr>
                        <tr>
                            <td class="info-title">
                                <div class="cell">
                                    {{$lang('售后原因')}}
                                </div>
                            </td>
                            <td>
                                <span style="white-space: normal;">{{refuseIntoData.return_reason}}</span>
                            </td>
                            <td class="info-title">
                                <div class="cell">
                                    <span style="color:#f56c6c">*</span> {{$lang('拒绝入库原因')}}
                                </div>
                            </td>
                            <td>
                                <el-input v-model="refuseIntoData.refuse_reason" style="width:90%"></el-input>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <div class="btn-item text-center" style="margin:15px 0;">
                    <el-button @click="refuseCancel">{{$lang('取消')}}</el-button>
                    <el-button type="primary" @click="refuseSubmit">{{$lang('确认')}}</el-button>
                </div>
            </div>
        </el-dialog>
        <!-- Excel 退货入库错误提示 -->
        <el-dialog :title="$lang('Excel退货入库异常')"  :visible.sync="returnStockError" :custom-class="'custom-dialog-body'">
          <el-table :data="errorData" border class="order-list-table table-common">
              <el-table-column :label="$lang('错误列')" prop="key">
                  <template slot-scope="scope">
                      <div>{{Object.keys(scope.row)[0]}}</div>
                  </template>
              </el-table-column>
              <el-table-column :label="$lang('错误信息')" prop="value">
                  <template slot-scope="scope">
                      <div>{{Object.values(scope.row)[0]}}</div>
                  </template>
              </el-table-column>
          </el-table>
      </el-dialog>
    </div>
    <!--引入js-->
    <script type="text/javascript" src="./Application/Tpl/Home/Public/lib/jquery/1.9.1/jquery.min.js"></script>
    <script type="text/javascript" src="./Application/Tpl/Home/Public/js/H-ui.js"></script>
    <script type="text/javascript" src="./Application/Tpl/Home/Public/js/H-ui.admin.js?v=<{$Think.config.VER_NUM}>"></script>
    <script type="text/javascript" src="./Application/Tpl/Home/Public/js/vue.2.5.13.js"></script>
    <script type="text/javascript" src="./Application/Tpl/Home/Public/js/axios.min.js"></script>
    <script type="text/javascript" src="./Application/Tpl/Home/Public/js/element-ui-2.8.2.js"></script>
    <script type="text/javascript" src="./Application/Tpl/Home/Public/js/element-en.js"></script>
    <script type="text/javascript" src="./Application/Tpl/Home/Public/js/queryString.js?v=<{$Think.config.VER_NUM}>"></script>
    <script>

        if (getCookie('think_language') !== "zh-cn") {
            ELEMENT.locale(ELEMENT.lang.en)
        }
        var VM = new Vue({
            el: '#order-list',
            components: {},
            data: {
                info:'',
                bathQuery: false,
                bathQuery_b:false,
                bathRefuse: false,  // 批量操作禁用状态
                bathCount: 0,
                messageStr: '',
                trackData: [], //物流轨迹数据 
                trackIndex: 4, // 物流轨迹显示多少条标识
                tableLoading: true,
                fullscreenLoading: false,
                search: {
                    sku_id: "",
                    upc_id: "",
                    order_no: "",
                    logistics_no: "",
                    created_by: "",
                    after_sale_no: "",
                    order_by:"created_at",
                    warehouse_code: [], // 仓库code
                    order_type:'',
                    created_at: {
                        start: '',
                        end: '',
                    },
                    logistics_way_code: '',
                },
                pages: {
                    per_page: 10,
                    current_page: 1
                },
                totalCount: 0, //总条数
                tableData: [], //查询返回数据
                bigImg: false,
                total_status_code: '',
                dateRange: '',
                pickerOptions: {

                },
                returnDialogVisible: false,
                refuseDialogVisible: false,
                returnIntoData: {},
                refuseIntoData: {},
                warehousesOption: [],
                selectionArray: [],
                selectionLength: 0,
                bLoading: false,
                returnStockError: false,
                errorData: [],
            },
            methods: {
              checkdata:function(){
                return false
                var bool = false;
                for(var x = 0;x<this.selectionArray.length;x++){
                  if(this.selectionArray[x].platform_cd === 'N000832500'){
                    this.$refs.multipleTable.toggleRowSelection(this.selectionArray[x],false)
                    x--
                    bool = true
                  }
                }
                if(bool){
                  this.$message.error('Amazon订单会自动退货入库，不允许手动操作')
                }
                return bool
              },
              downloadExcelTemp() {
                var a = document.createElement('a')
                a.setAttribute('id', 'excelTemp')
                a.href = '/index.php?m=Stock&a=download&name=return_in.xlsx'
                a.download = 'excelReturnToWarehouseTemp'
                $('body').append(a)
                a.click();
                $(a).remove()
              },
              doExcelReturnToWarehouse() {
                document.getElementById('excelFile').click();
              },
              // 处理Excel上传
              handleFileUpload() {
                  var form = new FormData();
                  var config = {
                    headers: {'Content-type': 'multipart/form-data'}
                  }
                  form.append('file', $(event.currentTarget)[0]['files'][0]);
                  form.append('type', 3);
                  event.target.value = null;
                  this.bLoading = true;
                  axios.post('/index.php?m=Stock&a=import_bill', form, config).then(res => {
                      var result = res.data;
                      this.bLoading = false;
                      if (result.code !== 2000) {
                          if (Array.isArray(result.data) && result.code == 3000) {
                              this.returnStockError = true;
                              this.errorData = result.data;
                          } else {
                              this.$message.error(result.msg);
                          }
                      } else {
                          return this.$message.success(this.$lang('导入成功'));
                      }
                  })
              },
              change:function(){
                this.bathQuery_b = true
              },
              write:function(){
                if(this.checkdata()){
                  return
                }
                var _this = this;
                this.selectionArray.forEach(function(v){
                  v.refuse_reason = _this.info
                })
                this.$message.success(this.$lang('写入成功')+': '+this.$lang('共写入')+this.selectionArray.length+this.$lang('条数据'))
                this.bathQuery_b = false
              },
                sortChange:function(obj){
                    if(!obj.order){
                        this.search.order_type = ''
                    }else if(obj.order.indexOf('desc')){
                        this.search.order_type = 'desc'
                    }else if(obj.order.indexOf('asc')){
                        this.search.order_type = 'asc'
                    }
                    this.doSearch()
                },
                // 批量拒绝入库
                bathRefuseClick() {
                  if(this.checkdata()){
                    return
                  }
                var _this = this;
                    this.bathQuery = true;
                    if(this.selectionArray.length > 0) {
                        for(i = 0;i<this.selectionArray.length;i++) {
                          this.selectionArray[i].refuse_entry = true;
                          this.selectionArray[i].confirm_storage = false;
                          this.selectionArray[i].bath_opt = true;
                        }
                    } else {
                      var arr = JSON.parse(JSON.stringify(this.tableData))
                        for(var i =0;i<arr.length;i++){
                          arr[i].refuse_entry = true;
                          arr[i].confirm_storage = false;
                          arr[i].bath_opt = true;
                        }
                        var a = formatArr(arr,30)
                      this.tableData = a[0];
                      var q = 1
                      for(let x = 1;x<a.length;x++){
                        setTimeout(function(){
                          console.time('a'+q)
                          _this.tableData.push(...a[x])
                          console.timeEnd('a'+q)
                          q++
                        },1000)
                      }

                    }
                },
                // 批量退货入库
                bathQueryClick() {
                  if(this.checkdata()){
                    return
                  }
                    this.bathRefuse =true;
                    // 区分批量操作是先勾选还是后勾选
                    if(this.selectionArray.length > 0) {
                        for(i = 0;i<this.selectionArray.length;i++) {

                                    this.selectionArray[i].confirm_storage = true;
                                    this.selectionArray[i].refuse_entry = false;
                                    this.selectionArray[i].bath_opt = true;

                        }
                    } else {
                        for(var i =0;i<this.tableData.length;i++){
                            this.tableData[i].confirm_storage = true;
                            this.tableData[i].refuse_entry = false;
                            this.tableData[i].bath_opt = true;
                        }
                    }
                },
                bathCancelClick() {
                    this.bathQuery = false;
                    this.bathRefuse =false;
                    for(var i =0;i<this.tableData.length;i++){
                        this.tableData[i].confirm_storage = false;
                        this.tableData[i].refuse_entry = false;
                        this.tableData[i].bath_opt = false;
                    }
                },
                queryClick() {
                    if(this.selectionArray.length > 0) {
                        
                        this.selectionLength = this.selectionArray.length;
                        if(this.bathRefuse) {
                            for(i = 0;i<this.selectionArray.length;i++) {
                                // ((i)=>{
                                //     setTimeout(()=>{  // 避免同时调用存在相同sku后端冲突
                                //         this.bathQueryRequst(this.selectionArray[i]);
                                //     },i*300)
                                // })(i)
                                this.bathQueryRequst(this.selectionArray[i]);
                            }
                        } else if (this.bathQuery) {
                            
                            for(i = 0;i<this.selectionArray.length;i++) {
                                // ((i)=>{
                                //     setTimeout(()=>{  // 避免同时调用存在相同sku后端冲突
                                //         this.bathRefuseRequst(this.selectionArray[i]);
                                //     },i*300)
                                // })(i)
                                this.bathRefuseRequst(this.selectionArray[i]);
                            }
                        } else {
                            this.$message.warning('请先选择需要的操作') 
                        }
                    } else {
                        this.$message.warning('请先勾选需要操作的数据')
                    }

                    
                },
                // 批量拒绝请求
                bathRefuseRequst(item) {
                    var data = {
                        return_id: item.id,
                        return_goods_id: item.return_goods_id,
                        sku_id: item.sku_id,
                        warehouse_num_refuse: item.warehouse_num_refuse,
                        refuse_reason: item.refuse_reason
                    }
                    this.fullscreenLoading = true;
                    axios.post('/index.php?g=OMS&m=afterSale&a=refuseReturnWarehouseSubmit', data).then((res) => {
                        this.bathCount++;
                        if (res.data.code == 200) {
                            // this.$message.warning(this.$lang());
                            this.messageStr+=`<p>售后单号${item.after_sale_no}，${item.warehouse_code_val}拒绝入库成功，拒绝数量为${item.warehouse_num_refuse}</p>`;
                            this.tableData.splice(this.getArrayIndex(this.tableData,item.id),1);
                            this.totalCount = this.totalCount -1;
                            
                            
                        } else {
                            // this.$message.error(this.$lang(res.data.msg));
                            this.$notify.error({
                                title: 'error',
                                message: this.$lang(res.data.msg)
                            });
                        }
                        if(this.bathCount == this.selectionLength){
                            this.fullscreenLoading = false;
                            this.bathCancelClick();
                            this.bathCount = 0;
                            this.$refs.multipleTable.clearSelection();
                            if(this.messageStr) {
                                this.$message({
                                    dangerouslyUseHTMLString: true,
                                    message: this.messageStr,
                                    type: 'warning'
                                })
                            }
                            
                            this.messageStr = "";
                        }
                        
                    }).catch((err) => {
                        console.log(err);
                        this.bathCount++;
                        if(this.bathCount == this.selectionLength){
                            this.fullscreenLoading = false;
                            this.bathCancelClick()
                            this.bathCount = 0;
                            this.$refs.multipleTable.clearSelection();
                        }
                        this.$message.error('error');
                    });
                },
                // 批量退货请求
                bathQueryRequst(item,i) {
                    var data = {
                        return_id: item.id,
                        return_goods_id: item.return_goods_id,
                        sku_id: item.sku_id,
                        order_id: item.order_id,
                        warehouse_num: item.warehouse_num,
                        warehouse_num_broken: item.warehouse_num_broken
                    }
                    this.fullscreenLoading = true;
                    axios.post('/index.php?g=OMS&m=afterSale&a=returnWarehouseSubmit', data).then((res) => {
                        this.bathCount++;
                        if (res.data.code == 200) {
                            // this.$message.success(this.$lang(`${item.warehouse_code_val}退货入库成功，数量 +${Number(item.warehouse_num)+Number(item.warehouse_num_broken)}`));
                            this.messageStr+=`<p>售后单号${item.after_sale_no}，${item.warehouse_code_val}退货入库成功，数量+ ${Number(item.warehouse_num)+Number(item.warehouse_num_broken)}</p>`;
                            this.tableData.splice(this.getArrayIndex(this.tableData,item.id),1);
                            this.totalCount = this.totalCount -1;
                        } else {
                            // this.$message.error(this.$lang(res.data.msg));
                            this.$notify.error({
                                title: 'error',
                                message: this.$lang(res.data.msg)
                            });
                        }
                        if(this.bathCount == this.selectionLength){
                            this.fullscreenLoading = false;
                            this.bathCancelClick();
                            this.bathCount = 0;
                            this.$refs.multipleTable.clearSelection();
                            if(this.messageStr) {
                                this.$message({
                                    dangerouslyUseHTMLString: true,
                                    message: this.messageStr,
                                    type: 'success'
                                })
                            }
                            this.messageStr = "";
                        }
                        
                        
                    }).catch((err) => {
                        console.log(err);
                        this.bathCount++;
                        if(this.bathCount == this.selectionLength){
                            this.fullscreenLoading = false;
                            this.bathCancelClick()
                            this.bathCount = 0;
                            this.$refs.multipleTable.clearSelection();
                        }
                        this.$message.error('error');
                    });
                },
                selectionChange(selection) {
                    this.selectionArray = selection;
                },
                // 获取下标
                getArrayIndex(arr, obj) {
                    var i = arr.length;
                    while (i--) {
                        if (arr[i].id === obj) {
                            return i;
                        }
                    }
                    return -1;
                },
                radioChange(item,val) {
                    if(!val) {
                        item.warehouse_num = item.over_warehouse_num;
                        item.warehouse_num_broken = 0;
                    }
                    if(item.confirm_storage){
                        item.refuse_entry = false
                    }
                },
                radioChange2(item,val) {
                    if(!val){
                        item.warehouse_num_refuse = item.warehouse_num;
                        item.refuse_reason = '';
                    }
                    if(item.refuse_entry){
                        item.confirm_storage = false
                    }
                },
                // 确认
                querywarehouse(index,item) {
                    if(item.confirm_storage == true) {
                        var _this = this;
                        _this.fullscreenLoading = true;
                        var data = {
                            return_id: item.id,
                            return_goods_id: item.return_goods_id,
                            sku_id: item.sku_id,
                            order_id: item.order_id,
                            warehouse_num: item.warehouse_num,
                            warehouse_num_broken: item.warehouse_num_broken
                        }
                        axios.post('/index.php?g=OMS&m=afterSale&a=returnWarehouseSubmit', data).then(function(res) {
                            if (res.data.code == 200) {
                                _this.$message.success(_this.$lang(`售后单号${item.after_sale_no}，${item.warehouse_code_val}退货入库成功，数量 +${Number(item.warehouse_num)+Number(item.warehouse_num_broken)}`));
                                _this.tableData.splice(index,1);
                                _this.totalCount = _this.totalCount -1;
                            } else {
                                _this.$message.error(_this.$lang(res.data.msg));
                            }
                            
                            _this.fullscreenLoading = false;
                        }).catch(function(err) {
                            console.log(err);
                        });
                    } else if(item.refuse_entry == true) {
                        var _this = this;
                        _this.fullscreenLoading = true;
                        var data = {
                            return_id: item.id,
                            return_goods_id: item.return_goods_id,
                            sku_id: item.sku_id,
                            warehouse_num_refuse: item.warehouse_num_refuse,
                            refuse_reason: item.refuse_reason
                        }
                        axios.post('/index.php?g=OMS&m=afterSale&a=refuseReturnWarehouseSubmit', data).then(function(res) {
                            if (res.data.code == 200) {
                                _this.$message.warning(_this.$lang(`售后单号${item.after_sale_no}，${item.warehouse_code_val}拒绝入库成功，拒绝数量为${item.warehouse_num_refuse}`));
                                _this.tableData.splice(index,1);
                                _this.totalCount = _this.totalCount -1;
                                
                            } else {
                                _this.$message.error(_this.$lang(res.data.msg));
                            }
                            
                            _this.fullscreenLoading = false;
                        }).catch(function(err) {
                            console.log(err);
                        });
                    } else {
                        this.$message.error('请先勾选操作类型')
                    }
                },
                cancelwarehouse(item) {
                    item.confirm_storage = false;
                    item.refuse_entry = false;
                    item.warehouse_num = item.over_warehouse_num;
                    item.warehouse_num_broken = 0;
                    item.warehouse_num_refuse = 0;
                    item.refuse_reason = '';
                },
                // 获取公共数据-仓库
                getConmonData() {
                    var _this = this;
                    var param = {
                        cd_type: {
                            "warehouse": "true", 
                        }
                    };
                    axios.post("/index.php?g=common&m=index&a=get_cd", param).then(function (res) {
                        console.log(res);
                        
                        if (res.data.code == 2000) {
                            _this.warehousesOption = res.data.data.warehouse;
                            
                        }
                    });
                },
                hideChange() {
                    this.trackIndex = 4;
                },
                // 展开/收起物流轨迹
                seeTrack: function() {
                    this.trackIndex = this.trackData.length;
                },
                closeTrack: function() {
                    this.trackIndex = 4;
                },
                // 切换页面是关闭弹窗
                handleScroll() {
                    if (document.documentElement.scrollTop === 0) {
                        for (var i = 0;i<document.getElementsByClassName('el-popover').length; i++) {
                        document.getElementsByClassName('el-popover')[i].style.display = 'none';
                        }
                    }
                },
                // 获取物流轨迹
                getTrack: function (item) {
                item.popoverValue = true
                    this.trackData = [];
                    var _this = this;
                    var param = {
                        data: {
                        query: {
                            orderId: item.order_no,
                            trackingNumber: item.logistics_no,
                            platCd: item.platform_country_code
                        }
                        }
                    };
                    axios.post("/index.php?g=oms&m=OutStorage&a=feeding", param).then(function (res) {
                        console.log(res);
                        
                        var weekArray = new Array("星期日", "星期一", "星期二", "星期三", "星期四", "星期五", "星期六");
                        if (res.data.code == 2000) {
                            _this.trackData = res.data.data.pageData;
                            if (_this.trackData) {
                            _this.trackData.forEach(function (ele, ind) {
                                _this.$set(ele, "week", weekArray[new Date(ele.date.split(' ')[0]).getDay()]);
                                _this.$set(ele, "day", ele.date.split(' ')[0]);
                                _this.$set(ele, "time", ele.date.split(' ')[1]);
                            });
                            _this.trackData.reverse();
                            }
                        }
                    });
                },
                getAfterOrderList: function getAfterOrderList() {
                    var _this = this;
                    _this.tableData = []
                    var param = {
                        search: _this.search,
                        pages: _this.pages
                    }
                    _this.tableLoading = true;
                    this.bathCancelClick(); // 清空批量操作状态
                    axios.post('/index.php?g=OMS&m=afterSale&a=waitReturnList', param).then(function(res) {
                        if (res.data.code == 200) {
                            _this.tableData = res.data.data.data;
                            for(var i =0;i<_this.tableData.length;i++){
                                _this.$set(_this.tableData[i], 'warehouse_num', _this.tableData[i].over_warehouse_num);
                                _this.$set(_this.tableData[i], 'warehouse_num_broken', 0);
                                _this.$set(_this.tableData[i], 'warehouse_num_refuse', _this.tableData[i].over_warehouse_num);
                                _this.$set(_this.tableData[i], 'confirm_storage', false);
                                _this.$set(_this.tableData[i], 'refuse_entry', false);
                                _this.$set(_this.tableData[i], 'bath_opt', false);
                                _this.$set(_this.tableData[i], 'refuse_reason', '');
                                // _this.tableData[i].warehouse_num = _this.tableData[i].over_warehouse_num;
                                // _this.tableData[i].warehouse_num_broken = 0;
                                // _this.tableData[i].warehouse_num_refuse = 0;
                                // _this.tableData[i].confirm_storage = false;
                                // _this.tableData[i].refuse_entry = false;
                            }
                            _this.totalCount = parseInt(res.data.data.pages.total);
                            setTimeout(function() {
                                _this.tableLoading = false;
                            }, 1000);
                        } else {
                            _this.$message.error(_this.$lang(res.data.info));
                        }
                    }).catch(function(err) {
                        console.log(err);
                    });
                },
                handleSizeChange: function handleSizeChange(val) {
                    this.pages = {
                        per_page: val,
                        current_page: 1
                    };
                    this.getAfterOrderList();
                },
                handleCurrentChange: function handleCurrentChange(val) {
                    this.pages.current_page = val
                    this.getAfterOrderList();
                },
                doSearch: function onSubmit() {
                    this.pages.current_page = 1;
                    this.pages.per_page = 10;
                    this.getAfterOrderList();
                },
                doReset() {
                    this.search = {
                        sku_id: "",
                        upc_id: "",
                        order_no: "",
                        logistics_no: "",
                        created_by: "",
                        after_sale_no: "",
                        logistics_way_code: '',
                        warehouse_code: [],
                        created_at: {
                            start: '',
                            end: '',
                        }
                    };
                    this.dateRange = '';
                    this.pages.current_page = 1;
                    this.pages.per_page = 10;
                    this.getAfterOrderList();
                },
                showImg: function showImg(item) {
                    Vue.set(item, 'bigImg', !item.bigImg);
                },
                // 退货入库
                returnInto: function returnInto(item) {
                    var _this = this;
                    _this.returnDialogVisible = true;
                    var data = {
                        return_goods_id: item,
                    }
                    axios.post('/index.php?g=OMS&m=afterSale&a=returnWarehouseDetail', data).then(function(res) {
                        if (res.data.code == 200) {
                            _this.returnIntoData = res.data.data;
                            _this.returnIntoData.warehouse_num = res.data.data.over_warehouse_num;
                            _this.returnIntoData.warehouse_num_broken = 0;
                        } else {
                            _this.$message.error(_this.$lang(res.data.msg));
                        }
                    }).catch(function(err) {
                        console.log(err);
                    });
                },
                // 拒绝入库
                refuseInto: function refuseInto(item) {
                    var _this = this;
                    _this.refuseDialogVisible = true;
                    var data = {
                        return_goods_id: item,
                    }
                    axios.post('/index.php?g=OMS&m=afterSale&a=returnWarehouseDetail', data).then(function(res) {
                        if (res.data.code == 200) {
                            _this.refuseIntoData = res.data.data;
                            _this.refuseIntoData.warehouse_num_refuse = 0;
                        } else {
                            _this.$message.error(_this.$lang(res.data.msg));
                        }
                    }).catch(function(err) {
                        console.log(err);
                    });
                },
                returnCancel: function returnCancel() {
                    this.returnDialogVisible = false;
                },
                refuseCancel: function returnCancel() {
                    this.refuseDialogVisible = false;
                },
                returnSubmit: function returnSubmit() {
                    var _this = this;
                    _this.fullscreenLoading = true;
                    var data = {
                        return_id: _this.returnIntoData.id,
                        return_goods_id: _this.returnIntoData.return_goods_id,
                        sku_id: _this.returnIntoData.sku_id,
                        order_id: item.order_id,
                        warehouse_num: _this.returnIntoData.warehouse_num,
                        warehouse_num_broken: _this.returnIntoData.warehouse_num_broken
                    }
                    axios.post('/index.php?g=OMS&m=afterSale&a=returnWarehouseSubmit', data).then(function(res) {
                        if (res.data.code == 200) {
                            _this.$message.success(_this.$lang(res.data.msg));
                            _this.returnDialogVisible = false;
                            _this.doReset();
                        } else {
                            _this.$message.error(_this.$lang(res.data.msg));
                        }
                        _this.fullscreenLoading = false;
                    }).catch(function(err) {
                        console.log(err);
                    });
                },
                refuseSubmit: function refuseSubmit() {
                    var _this = this;
                    _this.fullscreenLoading = true;
                    var data = {
                        return_id: _this.refuseIntoData.id,
                        return_goods_id: _this.refuseIntoData.return_goods_id,
                        sku_id: _this.refuseIntoData.sku_id,
                        warehouse_num_refuse: _this.refuseIntoData.warehouse_num_refuse,
                        refuse_reason: _this.refuseIntoData.refuse_reason
                    }
                    axios.post('/index.php?g=OMS&m=afterSale&a=refuseReturnWarehouseSubmit', data).then(function(res) {
                        if (res.data.code == 200) {
                            _this.$message.success(_this.$lang(res.data.msg));
                            _this.refuseDialogVisible = false;
                            _this.doReset();
                        } else {
                            _this.$message.error(_this.$lang(res.data.msg));
                        }
                        _this.fullscreenLoading = false;
                    }).catch(function(err) {
                        console.log(err);
                    });
                },
                //跳转详情页
                toOrderDetail: function toOrderDetail(order_no, thirdId, platCD) {
                    var dom = document.createElement('a');
                    var _href = "/index.php?g=OMS&m=Order&a=orderDetail&order_no=" + order_no + "&thrId=" + thirdId + "&platCode=" + platCD;
                    dom.setAttribute("onclick", "opennewtab(this,'" + this.$lang('订单详情') + "')");
                    dom.setAttribute("_href", _href);
                    dom.click();
                },
                
            },
            mounted: function mounted() {
                // window.addEventListener('scroll', this.handleScroll)
            },
            created: function created() {
                this.getAfterOrderList();
                this.getConmonData();
                this.pickerOptions = {
                    shortcuts: [{
                        text: this.$lang('最近一周'),
                        onClick: function onClick(picker) {
                            var end = new Date();
                            var start = new Date();
                            start.setTime(start.getTime() - 3600 * 1000 * 24 * 7);
                            picker.$emit('pick', [start, end]);
                        }
                    }, {
                        text: this.$lang('最近一个月'),
                        onClick: function onClick(picker) {
                            var end = new Date();
                            var start = new Date();
                            start.setTime(start.getTime() - 3600 * 1000 * 24 * 30);
                            picker.$emit('pick', [start, end]);
                        }
                    }, {
                        text: this.$lang('最近三个月'),
                        onClick: function onClick(picker) {
                            var end = new Date();
                            var start = new Date();
                            start.setTime(start.getTime() - 3600 * 1000 * 24 * 90);
                            picker.$emit('pick', [start, end]);
                        }
                    }]
                }
            },
            watch: {
              bathQuery:function(v){
                if(!v){
                  this.bathQuery_b= false
                }
              },
                dateRange: {
                    handler: function handler(newValue, oldValue) {
                        if (newValue) {
                            this.$set(this.search.created_at, "start", newValue[0]);
                            this.$set(this.search.created_at, "end", newValue[1]);
                        } else {
                            this.$set(this.search.created_at, "start", newValue);
                            this.$set(this.search.created_at, "end", newValue);
                        }
                    },
                    deep: true
                },
            },
        });

        function formatArr(arr,num) {
          //最后返回的结果为一个二维数组
          var newArr = new Array(Math.ceil(arr.length/num));
          for (let i = 0; i < newArr.length; i++) {
            newArr[i] = [];
          }
          for (let i = 0; i < arr.length; i++) {
            newArr[parseInt(i/num)][i%num] = arr[i];
          }
          return newArr;
        }
    </script>
</body>

</html>