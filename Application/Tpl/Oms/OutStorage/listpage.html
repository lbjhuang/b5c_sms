<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="./Application/Tpl/Home/Public/utils/css/public.style.css?v=<{$Think.const.V}>">
    <link rel="stylesheet" href="./Application/Tpl/Home/Public/css/element-ui-2.2.css?v=<{$Think.const.V}>">
    <link rel="stylesheet" href="./Application/Tpl/Home/Public/css/normailize.css?v=<{$Think.const.V}>">
    <link rel="stylesheet" href="./Application/Tpl/Home/Public/css/default.css?v=<{$Think.const.V}>">
    <link rel="stylesheet" href="./Application/Tpl/Home/Public/icon/css/font-awesome.min.css?v=<{$Think.const.V}>">
    <link rel="stylesheet" href="./Application/Tpl/Oms/Public/css/list_common.css?v=<{$Think.const.V}>">
    <link rel="stylesheet" href="./Application/Tpl/Oms/Order/orderList.css?v=<{$Think.const.V}>">
    <link rel="stylesheet" href="./Application/Tpl/Oms/OutGoing/outGoingList.css?v=<{$Think.const.V}>">
    <!--[if IE 9]> <link rel="stylesheet" href="./Application/Tpl/Oms/Public/css/style.css"/><![endif]-->
    <title>{{$lang('已出库')}}</title>
    <style>
        @media screen and (-ms-high-contrast: active),
        (-ms-high-contrast: none) {
            .el-step {
                width: 230px !important;
            }
            .el-step__icon {
                display: inline-block
            }
            .el-step__icon-inner {
                margin-top: 3px !important;
            }
        }
        
        [v-cloak] {
            display: none;
        }
        
        #list-page {
            visibility: hidden;
        }
        
        .selectStatus .el-dialog {
            padding: 10px 20px;
        }
        
        .tableStatus .el-dialog {
            padding: 20px;
        }
        
        .selectStatus .el-dialog__header {
            display: inline-block;
            margin-bottom: 12px;
        }
        
        .selectStatus .el-button.el-button--default {
            background-color: #fff !important;
        }
        
        .selectStatus .el-button,
        .tableStatus .el-button {
            padding: 8px 12px !important;
        }
        
        .isError {
            color: red;
        }
        
        .isOnlyOne .el-table__body-wrapper table {
            padding-bottom: 160px;
        }
        
        .el-popover.el-popper div {
            text-align: center;
        }
        
        .export-order {
            height: 28px;
            padding: 0 12px;
            background-color: #2ba384;
            border: none;
            margin-left: 20px;
            border-radius: 4px;
            color: #fff;
            cursor: pointer;
            border: none;
            outline: none;
        }
        
        .export-order:active {
            -webkit-box-shadow: none;
            box-shadow: none;
            background-color: #2dbda8;
        }
        
        .export-order:hover {
            background-color: #2dbda8;
        }
        
        .freight .el-select--small {
            margin-left: 6px !important;
        }
        
        .freight-show {
            background: #f99c64;
            padding: 2px 4px;
            position: absolute;
            right: 0;
            bottom: 0;
            color: #fff;
        }
        .text-left{
            position: relative;
            margin: 0;
        }
        .track-tile{
            text-align: left;
        }
        .track-center{
            position: absolute;
            background: #fff;
            z-index: 2;
            top: 0;
            left: 125px;
        }
        .track-center .dot-wrap{
            display: inline-block;
            width: 16px;
            height: 16px;
            border-radius: 50%;
            border: 1px solid #ccc;
            text-align: center;
            line-height: 16px;
        }
        .track-center .dot-wrap .dot{
            width: 10px;
            height: 10px;
            display: inline-block;
            background: #ccc;
            border-radius: 50%;
        }
        .track-center .dot-wrap .dot.active{
            background: orange;
        }
        .track-right {
            display: inline-block;
            width: 130px;
            vertical-align: top;
            font-size: 13px;
            padding-bottom: 10px;
        }
        .text-left .track-left{
            padding-bottom: 10px;
            border-left: 1px solid #ccc;
            padding-left: 16px;
            min-height: 46px;
        }
        .track-left {
            display: inline-block;
            width: 260px;
            vertical-align: top;
            font-size: 13px;
            padding-left: 15px;
        }
        .track-color {
            color: orange;
        }
        
        .el-popover__title {
            text-align: left !important;
            font-weight: 600;
            font-size: 15px;
            padding: 5px 14px;
            margin: 0;
        }
        
        #order-number .el-button {
            white-space: pre-wrap;
        }
        
        .orderLogo {
            position: absolute;
            right: 0;
            bottom: 0;
        }
        
        .orderLogo span {
            margin-left: 1px;
            background: #f99c64;
            color: #FFF;
            padding: 2px 4px;
        }
        
        .dialog_wrap .el-dialog {
            padding: 20px;
        }
        
        .dialog_inner {
            text-align: center;
            margin-top: 10px;
        }
        
        .title-min{
            width: 155px !important;
            text-align: center;
            padding-left: 0 !important;
            color: #000 !important;
        }
        .el-select{
            padding: 0 !important;
        }
        
        .btn-search{
            background-color: #0375DE !important;
        }
        .third-order{
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .third-order a{
            width: fit-content;
        }
        .el-loading-spinner{
            top:300px;
            margin-top: -21px;
            position: fixed;
        }
        .downloadDialog .el-dialog__header{
            display: block;
        }
        .downloadDialog .el-dialog--center .el-dialog__body{
            text-align: center;
        }
        .logistics__status{
            position: absolute;
            top: 0px;
            right: 5px;
        }
        .logistics__status p{
           color: red;
        }
    </style>
</head>

<body class="outGoingList">

    <div id='list-page' v-cloak class='list-common' v-loading="tableLoading">
        <div class="step-content">
            <el-steps :active="active" align-center>
                <el-step :title="$lang('派单推荐')"></el-step>
                <el-step :title="$lang('待派单')"></el-step>
                <el-step :title="$lang('待获取运单号')"></el-step>
                <el-step :title="$lang('待拣货')"></el-step>
                <el-step :title="$lang('待分拣')"></el-step>
                <el-step :title="$lang('待核单')"></el-step>
                <el-step :title="$lang('待出库')"></el-step>
                <el-step :title="$lang('已出库')"></el-step>
            </el-steps>
        </div>
        <!-- 搜索查询 start-->
        <div class="pickingList-search search-common">
            <!-- 平台 start-->
            <div class="search-toggle">
                <el-row type="flex">
                    <el-col :span="4" class="title-info-container">
                        <div class="title-info">{{$lang('平台渠道')}}</div>
                    </el-col>
                    <el-col :span="22" class="search-item-i">
                        <span :class="{active:isChannelALL}" @click="channelALL">{{$lang('全部')}}</span>
                        <span class="channel-item" v-for="channel in channels" :data-cd="channel.cd" @click="selectChannel(channel.cd)">{{$lang(channel.cdVal)}}</span>
                    </el-col>
                </el-row>
                <!-- 平台 end-->

            </div>
            <!--站点 start-->
            <el-row type="flex" style="background-color: #F5F5F5;margin-left: 87px; padding: 15px 0px 15px 0px;border-radius:4px;">
                <el-col :span="4" class="title-info-container title-min">
                    <div class="title-info" style="color:#000">{{$lang('站点')}}</div>
                </el-col>
                <el-col :span="22" class="search-item-i">
                    <span :class="{active:isSiteAll}" @click="siteAll()" class="tab-item-border" style="float: left;">{{$lang('全部')}}</span>
                    <div class="search-item-i" style="padding-right: 140px;">
                        <el-button v-show="sites.length>= 8" @click="showMore = !showMore" style="position: absolute;right: 75px;" type="text">{{showMore ?'收起' : '展开'}}
                            <i :class="showMore ? 'el-icon-arrow-up' : 'el-icon-arrow-down'" class="el-icon--right"></i>
                        </el-button>

                        <span :class="{'site-item':true,active:site.checked}" v-for="site in sites.slice(0,7)" :data-cd="site.CD" @click="selectSite(site.CD)" class="tab-item-border">{{$lang(site.CD_VAL)}}</span>
                        
                        <span v-show="showMore" :class="{'site-item':true,active:site.checked}" v-for="site in sites.slice(7)" :data-cd="site.CD" @click="selectSite(site.CD)" class="tab-item-border">{{$lang(site.CD_VAL)}}</span>
                    </div>
                    <!-- <div class="search-item-i" v-show="showMore">
                    </div> -->

                </el-col>
            </el-row>
            <!--站点 end-->
            <!-- 售后类型 start-->
            <el-row type="flex">
                <el-col :span="4" class="title-info-container">
                    <div class="title-info">{{$lang('售后类型')}}</div>
                </el-col>
                <el-col :span="22" class="search-item-i">
                    <span :class="{active:selectaftersalesTypeStatus == ''}" class="tab-item-min" @click="selectaftersalesType('')">{{$lang('全部')}}</span>
                    <span :class="{active:selectaftersalesTypeStatus == '1'}" class="tab-item-min" @click="selectaftersalesType('1')">{{$lang('补发')}}</span>
                    <span :class="{active:selectaftersalesTypeStatus == '2'}" class="tab-item-min" @click="selectaftersalesType('2')">{{$lang('换货')}}</span>
                </el-col>
            </el-row>
            <!-- 售后类型 end -->
            <el-row>
                <el-col :span="4" class="title-info-container">
                    <div class="title-info">{{$lang('物流状态')}}</div>
                </el-col>
                <el-col :span="22" class="search-item-i">
                    <span :class="{active:!selectLog.length}" @click="selectSuccess()" class="tab-item-min">{{$lang('全部')}}</span>
                    <span :class="{active:item.checked}" class="channel-item tab-item-min" v-for="(item,key) in logicSuccess" :data-cd="key" @click="selectSuccess(item)">{{$lang(item.cdVal)}}</span>
                </el-col>
            </el-row>
            <el-row>
                <el-col :span="4" class="title-info-container">
                    <div class="title-info">{{$lang('物流异常')}}</div>
                </el-col>
                <el-col :span="22" class="search-item-i">
                    <span :class="{active:!selectLogFail.length}" @click="selectFail()" class="tab-item-min">{{$lang('全部')}}</span>
                    <span :class="{active:item.checked}" class="channel-item tab-item-min" v-for="(item,key) in logicFail" :data-cd="key" @click="selectFail(item)">{{$lang(item.cdVal)}}</span>
                </el-col>
            </el-row>

            <!-- 排序方式 start-->
            <el-row>
                <el-col :span="4" class="title-info-container">
                    <div class="title-info">{{$lang('排序方式')}}</div>
                </el-col>
                <el-col :span="22" class="search-item-i">
                    <span class="sort-type tab-item-min" v-for="(item,key) in sort" :data-CD="key" :class="{active: key == 'orderTime'}" @click="selectSort(key)">{{$lang(item)}}</span>
                    <span class="contain-remark" @click="toggleRemark">{{$lang('含备注')}}</span>
                    <span class="contain-error" @click="toggleError">{{$lang('出库异常')}}</span>
                </el-col>
            </el-row>
            <!-- 排序方式 end-->
            <div class='cls' style="height:auto;">
                <el-col :span="4" class="title-info-container" style="height:100%;">
                    <div class="title-info">{{$lang('条件筛选')}}</div>
                </el-col>
                <el-col :span="22" class="search-item-i">
                    <div class="fl sort-item">
                        <el-select :popper-append-to-body=false :multiple-limit=10 filterable size="small" v-model="selectedCountries" multiple collapse-tags :placeholder="$lang('国家')" style="width:300px">
                            <el-option v-for="(countryItem,key) in countryStatus" :key="key" :label="$lang(countryItem.NAME)" :value="countryItem.id">
                            </el-option>
                        </el-select>
                    </div>
                    <div class="fl sort-item">
                        <el-select :popper-append-to-body=false :multiple-limit=10 filterable size="small" v-model="selectedShops" multiple collapse-tags :placeholder="$lang('店铺')" style="width:300px">
                            <el-option v-for="(shopItem,key) in shopStatus" :key="key" :label="$lang(shopItem.STORE_NAME)" :value="shopItem.ID">
                            </el-option>
                        </el-select>
                    </div>
                    <div class="fl sort-item">
                        <el-select :popper-append-to-body=false :multiple-limit=10 filterable size="small" v-model="selectedWarehouses" multiple collapse-tags :placeholder="$lang('仓库')" style="width:300px">
                            <el-option v-for="(warehouseItem,key) in warehouseStatus" :key="key" :label="$lang(warehouseItem.CD_VAL)" :value="warehouseItem.CD">
                            </el-option>
                        </el-select>
                    </div>
                    <div class="fl sort-item">
                        <el-select :popper-append-to-body=false clearable size="small" v-model="deliveryStatus" collapse-tags :placeholder="$lang('系统对接')" style="width:300px">
                            <el-option value="1" :label="$lang('已对接')"> </el-option>
                            <el-option value="0" :label="$lang('未对接')"> </el-option>
                        </el-select>
                    </div>
                    <div class="fl sort-item">
                        <el-select :popper-append-to-body=false @change="selectCompany" :multiple-limit=10 filterable size="small" v-model="selectedLogisticsCompanys" multiple collapse-tags :placeholder="$lang('物流公司')" style="width:300px">
                            <el-option v-for="(logisticsCompanyItem,key) in logisticsCompanyStatus" :key="key" :label="$lang(logisticsCompanyItem.cdVal)" :value="logisticsCompanyItem.cd">
                            </el-option>
                        </el-select>
                    </div>
                    <div class="fl sort-item">
                        <el-select :popper-append-to-body=false :multiple-limit=10 filterable size="small" v-model="selectedShippingMethods" multiple collapse-tags :placeholder="$lang('物流方式')" style="width:300px">
                            <el-option v-for="(shippingMethodsItem,key) in shippingMethodsStatus" :key="key" :label="$lang(shippingMethodsItem.logisticsMode)" :value="shippingMethodsItem.id">
                            </el-option>
                        </el-select>
                        <el-select :popper-append-to-body=false :multiple-limit=10 filterable size="small" v-model="selectedFreightType" multiple collapse-tags :placeholder="$lang('估重运费')" style="width:300px;margin-left: 6px;">
                            <el-option v-for="(freight,key) in selectedFreight" :key="key" :label="$lang(freight.cdVal)" :value="freight.cd"> </el-option>
                        </el-select>
                        <el-select :popper-append-to-body=false :multiple-limit=10 filterable size="small" v-model="selectedSalesTeam" multiple collapse-tags :placeholder="$lang('销售团队')" style="width:300px;margin-left: 6px;">
                            <el-option v-for="(item,key) in salesTeamStatus" :key="key" :label="$lang(item)" :value="key"> </el-option>
                        </el-select>
                    </div>
                    <div class="fl sort-item">
                        <div>
                            <el-select :popper-append-to-body=false filterable size="small" v-model="timeSort">
                                <el-option v-for="(timeItem,key) in time" :key="key" :label="$lang(timeItem)" :value="key">
                                </el-option>
                            </el-select>
                            <el-date-picker value-format="yyyy-MM-dd HH:mm:ss" size="small" v-model="dateRange" type="datetimerange" :default-time="['00:00:00', '23:59:59']" align="right" unlink-panels :range-separator="$lang('至')" :start-placeholder="$lang('开始日期')" :end-placeholder="$lang('结束日期')" :picker-options="pickerOptions">
                            </el-date-picker>
                        </div>
                    </div>
                    <div class="fl sort-item">
                        <div>
                            <el-select style="width: 220px" size="small" v-model="logistics_abnormal_status" :placeholder="$lang('全部（发货状态）')" multiple clearable collapse-tags>
                                <el-option :label="$lang('扫描超时')" value="1"></el-option>
                                <el-option :label="$lang('妥投超时')" value="2"></el-option>
                            </el-select>
                        </div>
                    </div>
                </el-col>
            </div>
            <div class="search-btn-container">
                <div class="btns" style="padding-left:80px;">
                    <el-select :popper-append-to-body=false filterable size="small" v-model="selectedDownQuery" :placeholder="$lang('请选择')" style="width:150px">
                        <el-option v-for="(downQueryItem,key) in downQueryStatus" :key="key" :label="$lang(downQueryItem)" :value="key">
                        </el-option>
                    </el-select>
                    <el-input size="small" class="search-keywords" v-model="searchKeywords"></el-input>
                    <button @click="doSearch" class="btn-search" name="search">{{$lang('搜索')}}</button>
                    <button @click="doReset" class="btn-reset" name="reset">{{$lang('重置')}}</button>
                </div>
            </div>

            <!-- 搜索查询 end-->

        </div>
        <!-- 分割线 start-->
        <div class="orderList-line line-split"></div>
        <!-- 分割线 end-->
        <!-- 订单表格主体 start-->
        <div class="orderList-Main list-common-main">
            <header>{{$lang('搜索结果:共')}}
                <span class="num-bold">{{totalCount}}</span> {{$lang('条记录')}}
                <!-- <button style="margin-left:20px" v-if="!isEditState" @click="exportOrder" type="text" class="export-order"> {{$lang('导出')}}</button> -->
                <el-button type="success" style="margin-left:20px" v-if="!isEditState" @click="exportOrder" type="text">{{$lang('导出')}}</el-button>
                <!-- <el-button type="info" style="margin-left:20px" @click="showDoBack" type="text">{{$lang('退回')}}</el-button> -->
                <el-tooltip class="item" effect="dark" :content="$lang('费用模板&批量退货模板')" placement="top">
                    <el-button style="margin-left:20px" @click="downloadTemp" type="text">{{$lang('模板下载')}}</el-button>
                </el-tooltip>
                <form action="import" class=" excel-delivery" @click="clickUploadFile" style="z-index:1;">
                    <el-button id="excel-btn-content" style="margin-left:20px" type="text">{{$lang('运费、关税、补贴导入')}}</el-button>
                    <input type="file" class="update-file-content" @change="updatePic" style="display: none">
                    </a>
                    
                    <el-progress style="width:150px;display: inline-block;" :text-inside="true" v-show="filePercentageShow" :stroke-width="18" :percentage="percentage"></el-progress>
                </form>
                
                    <el-button style="margin-left:20px" @click="clickReturnGoodsUploadFile" type="text">{{$lang('批量退货导入')}}</el-button>
                    <input type="file" class="return-file-content" ref="return-goods-upload" @change="returnGoodsChange" style="display: none">
                    
                    <el-progress style="width:150px;display: inline-block;" :text-inside="true" v-show="percentageShow" :stroke-width="18" :percentage="percentage"></el-progress> 
                <!-- Table -->
            </header>
            <el-dialog :title="$lang('模板下载')" :visible.sync="TemplateDownloadDialog" width="500px" center class="downloadDialog">
                <el-radio v-model="TemplateDownRadio" label="1">{{$lang('运费、关税、补贴模板')}}</el-radio>
                <el-radio v-model="TemplateDownRadio" label="2">{{$lang('批量退货模板')}}</el-radio>
                <span slot="footer" class="dialog-footer">
                    <el-button @click="TemplateDownloadDialog = false">{{$lang('取消')}}</el-button>
                    <el-button type="primary" @click="TemplateDownQuery">{{$lang('确定')}}</el-button>
                </span>
            </el-dialog>
            <el-dialog
                title="提示"
                :visible.sync="downloadDialog"
                width="30%"
                class="downloadDialog"
                center>
                <span>{{$lang('正在下载中，请前往“下载列表”页面查看')}}</span>
                <span slot="footer" class="dialog-footer">
                    <el-button @click="downloadDialog = false">{{$lang('知道了')}}</el-button>
                    <el-button type="primary" @click="toDownload">{{$lang('前往')}}</el-button>
                </span>
            </el-dialog>
            <el-dialog
                title="提示"
                :visible.sync="bathloadDialog"
                width="30%"
                class="downloadDialog"
                center>
                <span>{{$lang('批量退货成功，请前往“退货待入库”页面查看')}}</span>
                <span slot="footer" class="dialog-footer">
                    <el-button @click="bathloadDialog = false">{{$lang('知道了')}}</el-button>
                    <el-button type="primary" @click="toBathload">{{$lang('前往')}}</el-button>
                </span>
            </el-dialog>
            <!-- <el-dialog class="selectStatus" :title="$lang('订单退回')" :visible.sync="dialogVisible01" width="40%" :before-close="handleClose">
                <el-radio-group v-model="backToStatus" size="medium">
                    <el-radio label="N001821000">{{$lang('待派单')}}</el-radio>
                    <el-radio label="N001820500">{{$lang('待拣货')}}</el-radio>
                    <el-radio label="N001820600">{{$lang('待分拣')}}</el-radio>
                    <el-radio label="N001820700">{{$lang('待核单')}}</el-radio>
                    <el-radio label="N001820700">{{$lang('待出库')}}</el-radio>
                </el-radio-group>
                <el-dialog
                    title="提示"
                    :visible.sync="innerVisible"
                    width="30%"
                    append-to-body
                    class="dialog_wrap">
                    <span style="display: flex; justify-content: center;">只有实际仓库没有发货的订单才可以退回</span>
                    <div style="display: flex;justify-content: space-around;margin-top: 10px;padding: 10px 20px 20px;" class="dialog_inner">
                        <el-button @click="backPatch()">未发货</el-button>
                        <el-button type="primary" @click="innerVisible = false">已发货</el-button>
                    </div>
                </el-dialog>
                <span slot="footer" class="dialog-footer">
                    <el-button size="small" @click="cancelStatus">{{$lang('取 消')}}</el-button>
                    <el-button size="small" type="primary" @click="doStatus">{{$lang('确 定')}}</el-button>
                </span>
            </el-dialog> -->
            <el-dialog :title="$lang('回退结果')" :visible.sync="dialogTableVisible" class="tableStatus">
                <el-table :data="gridData" border>
                    <el-table-column :label="$lang('订单号')" v-if="false">
                        <template slot-scope="scope">
                            <div :class="{'isError':(scope.row.code != '2000')}">{{scope.row.b5cOrderNo}}</div>
                        </template>
                    </el-table-column>
                    <el-table-column :label="$lang('回退状态')">
                        <template slot-scope="scope">
                            <div :class="{'isError':(scope.row.code != '2000')}">{{$lang(scope.row.msg)}}</div>
                        </template>
                    </el-table-column>
                </el-table>
                <span slot="footer" class="dialog-footer">
                        <el-button size="small" type="primary" @click="finishedStatus">{{$lang('确 定')}}</el-button>
                    </span>
            </el-dialog>
            <el-table border show-header ref="multipleTable" :data="tableData" tooltip-effect="dark" style="width: 100%" @selection-change="handleSelectionChange " :class="{isOnlyOne:(tableData.length<4 && isEditState),'picking-list-table':true, 'table-common':true}">
                <el-table-column type="selection" width="55">
                </el-table-column>
                <el-table-column :label="$lang('站点&店铺')" width="100">
                    <template slot-scope="scope">
                        <div style="margin-bottom: 5px">{{$lang(scope.row.platName)}}</div>
                        <div>{{$lang(scope.row.storeName)}}</div>
                    </template>
                </el-table-column>
                <el-table-column prop="b5cOrderNo" :label="$lang('订单号')" width="135">
                </el-table-column>
                <el-table-column :label="$lang('平台订单号')" width="135">
                    <template slot-scope="scope">
                         <!-- v-bind:_href="'/index.php?g=OMS&m=Order&a=orderDetail&thrId='+scope.row.orderId+'&platCode='+scope.row.platCd" -->
                         <div class="third-order">
                            <span :data-plat="scope.row.platCd" >{{scope.row.orderNo?scope.row.orderNo:scope.row.orderId}}</span>
                            <a class="to-detail-btn" :data-plat="scope.row.platCd" @click="toOrderDetail(scope.row.orderId, scope.row.platCd, scope.row.orderNo)">{{$lang('查看')}}</a>
                         </div>
                        <div class="orderLogo">
                            <span v-if="scope.row.after_sale_type == '1'">{{$lang('补发')}}</span>
                            <span v-if="scope.row.after_sale_type == '2'">{{$lang('换货')}}</span>
                            <span v-if="scope.row.after_sale_type == ''"></span>
                        </div>
                    </template>
                </el-table-column>
                <el-table-column :label="$lang('时间')" width='220'>
                    <template slot-scope="scope">
                        <div v-if="!!scope.row.order_time">{{$lang('下单时间')}} ：{{scope.row.order_time | formatDate}}</div>
                        <div v-if="!!scope.row.payment_time">{{$lang('付款时间')}} ：{{scope.row.payment_time | formatDate}}</div>
                        <div v-if="!!scope.row.shipping_time">{{$lang('平台发货时间')}}：{{scope.row.shipping_time | formatDate}}</div>
                        <div v-if="!!scope.row.send_ord_time">{{$lang('派单时间')}}：{{scope.row.send_ord_time | formatDate}}</div>
                        <div v-if="!!scope.row.sendout_time">{{$lang('出库时间')}}：{{scope.row.sendout_time | formatDate}}</div>
                    </template>
                </el-table-column>
                <el-table-column :label="$lang('商品名称')" width="110">
                    <template slot-scope="scope">
                        <div v-if="(scope.row.skuIds.length>1)?false:true">{{transName(scope.row.skuIds[0])}}</div>
                        <el-popover class='sku-content' placement="bottom" width="150px" trigger="hover" v-if="(scope.row.skuIds.length>1)?true:false">
                            <div v-for="(item,index) in scope.row.skuIds">{{transName(item)}}</div>
                            <div slot="reference" class="name-wrapper">
                                <div>{{transName(scope.row.skuIds[0])}}</div>
                                <i class='el-icon-d-arrow-left' slot="reference"></i>
                            </div>
                        </el-popover>
                    </template>
                </el-table-column>
                <!-- <el-table-column prop="warehouseNm" label="$lang('仓库')">
                </el-table-column> -->
                <el-table-column :label="$lang('仓库')">
                    <template slot-scope="scope">
                        {{$lang(scope.row.warehouseNm)}}
                    </template>
                </el-table-column>
                <el-table-column :label="$lang('发货系统')">
                    <template slot-scope="scope">
                        <div v-if="isFinished01 && isFinished02">
                            <div v-if="systemDock[scope.row.systemDocking]">{{(systemDock[scope.row.systemDocking]).cdVal}}</div>
                            <div>{{scope.row.deliveryStatus == "0"? $lang('未对接'):$lang('已对接')}}</div>
                        </div>
                    </template>
                </el-table-column>
                <el-table-column prop="expeCompany" :label="$lang('物流公司')" width="135">
                    <template slot-scope="scope">
                        <div v-if="!scope.row.edit">{{$lang(scope.row.expeCompany)}}</div>
                        <div v-if="scope.row.edit">
                            <el-select :popper-append-to-body=false v-model="scope.row.expeCompanyCd" size="small" :placeholder="$lang('请选择')" @change="changeExpeCom(scope.row)">
                                <el-option v-for="item in scope.row.expeCompanyDatas" :key="item.logisticsCode" :label="$lang(item.logisticsName)" :value="item.logisticsCode">
                                </el-option>
                            </el-select>
                        </div>
                    </template>
                </el-table-column>
                <el-table-column prop="logisticModel" :label="$lang('物流方式')" width="135">
                    <template slot-scope="scope">
                        <div v-if="!scope.row.edit">{{$lang(scope.row.logisticModel)}}</div>
                        <div v-if="scope.row.edit">
                            <el-select :popper-append-to-body=false v-model="scope.row.logisticModelId" size="small" :placeholder="$lang('请选择')">
                                <el-option v-for="item in scope.row.logisticDatas" :key="item.id" :label="$lang(item.logisticsMode)" :value="item.id"></el-option>
                            </el-select>
                        </div>
                    </template>
                </el-table-column>
                <el-table-column :label="$lang('运单号')" width="180">
                    <template slot-scope="scope">
                        <div v-if="!scope.row.edit" id="order-number">
                            <el-popover width="520" :title="$lang('物流动态')" placement="bottom" :ref="`popover-${scope.$index}`"   trigger="click" append-to-body  @hide="hideChange">
                            <!-- <el-popover placement="bottom" width="520" :title="$lang('物流动态')" trigger="click" v-model="scope.row.popoverValue" append-to-body @hide="hideChange"> -->
                                <div style="padding-left:15px;overflow: auto;max-height: 550px;">
                                    <!-- <i class="el-icon-close close" style="position: absolute; top:15px; right:15px;font-size: 22px;cursor: pointer" @click="scope.row.popoverValue = false"></i> -->
                                    <i class="el-icon-close close" style="position: absolute; top:15px; right:15px;font-size: 22px;cursor: pointer"  @click="scope._self.$refs[`popover-${scope.$index}`].doClose()" ></i>
                                    <p class="track-tile">
                                        <span class="track-right">{{$lang('时间')}}</span>
                                        <span class="track-left">{{$lang('地点和跟踪进度')}}</span>
                                    </p>
                                    <p v-if="key<trackIndex" class="text-left" v-for="(item,key) in trackData" :key="key" :class="{'track-color':!key}">
                                        <span class="track-right">[ {{item.day || '-'}} ]
                                        </br>
                                        {{$lang(item.week)}} &nbsp;&nbsp; {{item.time}}
                                        </span>
                                        <span class="track-left">{{item.remark || '-'}}</span>
                                        <span class="track-center">
                                            <i class="dot-wrap">
                                                <span class="dot" :class="{active:!key}" v-if="key===0||key ===trackData.length-1"></span>
                                                <span class="el-icon-arrow-up" v-else></span>
                                            </i>
                                        </span>
                                    </p>
                                    <!--  v-if="trackData.length>3" -->
                                    <p style="text-align: right;cursor: pointer;" @click="seeTrack" v-if="trackData && trackData.length>trackIndex">{{$lang('展开')}}</p>
                                    <p style="text-align: right;cursor: pointer;" @click="closeTrack" v-if="trackIndex>4">{{$lang('收起')}}</p>
                                    <p v-show="!trackData" style=" color: #999; font-size: 14px;">
                                        {{$lang('暂无物流信息')}}
                                    </p>
                                </div>
                                <a href="javascript:void(0);" class="to-detail-btn" style="text-decoration: none" slot="reference" type="text" @click="getTrack(scope.row)">{{scope.row.trackingNumber}}</a>
                            </el-popover>
                        </div>
                        <div v-if="scope.row.edit">
                            <el-input size="small" :disabled="scope.row.disabled" v-model="scope.row.trackingNumber"></el-input>
                        </div>
                        <div class="logistics__status ">
                            <template v-for="(item,index) in scope.row.logistics_abnormal_status_name">
                                <p :key="index">{{item}}</p>
                            </template>
                        </div>
                    </template>
                </el-table-column>
                <el-table-column :label="$lang('实重（kg）')" prop="weight" width="120">
                </el-table-column>
                <el-table-column :label="$lang('头程运费')" prop="amountFreight" width="100">
                    <template slot-scope="scope">
                            {{scope.row.preFreightCurrency}} {{scope.row.preAmountFreight}}
                    </template>
                </el-table-column>
                <el-table-column :label="$lang('保险费')" prop="insuranceFee" width="100">
                    <template slot-scope="scope">
                        {{scope.row.insuranceCurrency}} {{scope.row.insuranceFee}}
                    </template>
                </el-table-column>
                <el-table-column :label="$lang('运费试算')" prop="freight" width="120">
                    <template slot-scope="scope">
                        <div>
                            <span v-if="scope.row.freight">{{scope.row.freight_currency}}</span>
                            <span>{{scope.row.freight || ''}}</span>
                        </div>
                        <div class="freight-show" v-if="scope.row.amount_freight !== null">{{$lang(scope.row.freightTypeNm)}}</div>
                    </template>
                </el-table-column>
                <!-- <el-table-column :label="$lang('结算运费')" prop="amountFreight" width="120"> </el-table-column> -->
                <el-table-column :label="$lang('尾程物流派送关税')" width="140">
                    <template slot-scope="scope">
                        <div>
                            {{scope.row.carry_tariff_currency }} {{scope.row.carry_tariff }}
                        </div>
                    </template>
                </el-table-column>
                <el-table-column prop="preAmountFreight" width="100px" :label="$lang('VAT费用')">
                    <template slot-scope="scope">
                        {{scope.row.vatFeeCurrency}}
                        {{scope.row.vatFee}}
                    </template>
                </el-table-column>
                <el-table-column prop="preAmountFreight" width="120px" :label="$lang('支付手续费')">
                    <template slot-scope="scope">
                        {{scope.row.paypalFeeCurrency}}
                        {{scope.row.paypalFee}}
                    </template>
                </el-table-column>
                <el-table-column prop="preAmountFreight" width="120px" :label="$lang('流量活动费用')">
                    <template slot-scope="scope">
                        {{scope.row.leagueFeeCurrency}}
                        {{scope.row.leagueFee}}
                    </template>
                </el-table-column>
                <el-table-column prop="preAmountFreight" width="120px" :label="$lang('采购返佣金')">
                    <template slot-scope="scope">
                        {{scope.row.purReturnFeeCurrency}}
                        {{scope.row.purReturnFee}}
                    </template>
                </el-table-column>
                <el-table-column :label="$lang('平台活动补贴')" width="120">
                    <template slot-scope="scope">
                        <div>
                            {{scope.row.subsidy_currency }} {{scope.row.subsidy }}
                        </div>
                    </template>
                </el-table-column>
                <el-table-column prop="preAmountFreight" width="120px" :label="$lang('售后费用')">
                    <template slot-scope="scope">
                        {{scope.row.saleAfterFeeCurrencyCny}}
                        {{scope.row.saleAfterFeeCny}}
                    </template>
                </el-table-column>
                <el-table-column :label="$lang('面单')" width="135">
                    <template slot-scope="scope">
                        <div v-if="!scope.row.edit">{{$lang(scope.row.surfaceWayGetCdNm)}}</div>
                        <!-- <div v-if="!scope.row.edit && scope.row.surfaceWayGetCd =='N002010200'">{{scope.row.logisticsSingleStatuCdNm}}</div> -->
                        <div v-if="!scope.row.edit && scope.row.surfaceWayGetCd =='N002010100'">{{$lang(scope.row.logisticsSingleStatuCdNm)}}</div>
                        <div v-if="scope.row.edit">
                            <el-select :popper-append-to-body=false v-model="scope.row.surfaceWayGetCd" size="small" :placeholder="$lang('请选择')" @change="changeSurface(scope.row)">
                                <el-option v-for="item in surfaceWayGet" :key="item.cd" :label="item.cdVal" :value="item.cd">
                                </el-option>
                            </el-select>
                        </div>
                    </template>
                </el-table-column>
                <el-table-column prop="remarkMsg" :label="$lang('备注')">
                    <template slot-scope="scope">
                                <!-- <div v-show="scope.row.remarkMsg" @click="doRemark(scope.row)" class="remarks-content">{{scope.row.remarkMsg}}</div> -->
                                <div v-show="scope.row.use_remarks" @click="doRemark(scope.row)" class="remarks-content">{{$lang(scope.row.use_remarks)}}</div>
                                <div v-show="scope.row.remarkMsg && !scope.row.use_remarks" @click="doRemark(scope.row)" class="remarks-content">{{$lang(scope.row.remarkMsg)}}</div>
                                <div v-show="!scope.row.remarkMsg && !scope.row.use_remarks" class="do-remark" @click="doRemark(scope.row)">{{$lang('备注')}}</div>
                                <el-dialog :visible.sync="dialogVisible" :show-close="false" width="420px" id="remark-dialog">
                                    <el-tabs type="border-card">
                                        <el-tab-pane :label="$lang('用户备注')">
                                            <div class="use_remarks_content">{{$lang(form.use_remarks)}}</div>
                                        </el-tab-pane>
                                        <el-tab-pane :label="$lang('运营备注')">
                                            <textarea class="operate-remark" name="" id="" cols="40" rows="10" v-model="form.remarkMsg" :data-order="scope.row.orderId"
                                                :data-plat="scope.row.platCd"></textarea>
                                            <div class="btns remark-btn" >
                                                <?php if(ButtonAction::hidden()){ ?>
                                                <button class="save-remark-btn" @click="saveRemark(scope.$index, scope.row)">{{$lang('保存')}}</button>
                                                 <?php } ?>
                                                <button class="cancel-remark-btn" @click='cancelRemark'>{{$lang('取消')}}</button>
                                            </div>
                                        </el-tab-pane>
                                    </el-tabs>

                                </el-dialog>
                            </template>
                </el-table-column>
                <el-table-column :label="$lang('操作')" width="100px">
                    <template slot-scope="scope">
                            <div class="third-order-num">
                                <el-button type="primary" v-if="scope.row.is_create_compen === 1" size="mini" style="margin: 10px 0;" @click="createCompensation(scope.row)">{{$lang('新建赔付')}}</el-button>
                                <el-button type="primary" size="mini" @click="toAfterSale(scope.row.orderNo,scope.row.warehouse,scope.row.orderId,scope.row.platCd)">{{$lang('售后')}}</el-button>
                            </div>
                        </template>
                </el-table-column>
            </el-table>

            <el-pagination background @size-change="handleSizeChange" @current-change="handleCurrentChange" :current-page.sync="currentPage" :page-size="searchData.data.query.pageSize " :page-sizes="[20, 50, 100]" layout="sizes , prev, pager, next, jumper" :total="totalCount">
            </el-pagination>
        </div>
        <a id="download" href="/index.php?g=OMS&m=AfterSale&a=readyExcel" style="display: none" download></a>
        <!-- 订单表格主体 end-->

    </div>
    <script type="text/javascript" src="./Application/Tpl/Home/Public/lib/jquery/1.9.1/jquery.min.js"></script>
    <script type="text/javascript" src="./Application/Tpl/Home/Public/js/jquery.base64.js?v=<{$Think.const.V}>"></script>
    <script type="text/javascript" src="./Application/Tpl/Home/Public/js/H-ui.js"></script>
    <script type="text/javascript" src="./Application/Tpl/Home/Public/js/H-ui.admin.js?v=<{$Think.config.VER_NUM}>"></script>
    <script type="text/javascript" src="./Application/Tpl/Home/Public/js/vue.2.5.13.js"></script>
    <script type="text/javascript" src="./Application/Tpl/Home/Public/js/axios.min.js"></script>
    <script type="text/javascript" src="./Application/Tpl/Home/Public/js/element-ui-2.6.3.js"></script>
    <script type="text/javascript" src="./Application/Tpl/Home/Public/js/element-en.js"></script>
    <script type="text/javascript" src="./Application/Tpl/Oms/OutStorage/listPage.js?v=<{$Think.const.V}>+1"></script>
</body>

</html>