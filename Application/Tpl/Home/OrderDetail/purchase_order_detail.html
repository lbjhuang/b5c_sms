<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="/Application/Tpl/Home/Public/utils/css/public.style.css?v=<{$Think.const.V}>">
    <link rel="stylesheet" href="/Application/Tpl/Home/Public/css/element-ui-2.2.css?v=<{$Think.const.V}>">
    <link rel="stylesheet" href="/Application/Tpl/Home/Public/css/normailize.css?v=<{$Think.const.V}>">
    <link rel="stylesheet" href="/Application/Tpl/Home/Public/css/default.css?v=<{$Think.const.V}>">
    <link rel="stylesheet" href="/Application/Tpl/Home/Public/icon/css/font-awesome.min.css?v=<{$Think.const.V}>">
    <link rel="stylesheet" href="/Application/Tpl/Home/B2b/css/detail.css?v=<{$Think.const.V}>">
    <title>采购订单详情</title>
    <style>
        [v-cloak] {
            display: none;
        }
        
        .is_added_btn {
            display: inline-block;
            width: 70px;
            height: 40px;
            line-height: 40px;
        }
        
        .order_dialog .el-dialog {
            max-height: 720px;
            overflow: hidden;
        }
        
        .order_dialog .el-dialog table {
            max-width: 500px;
            overflow: auto
        }
        
        .order_dialog .inline-td td {
            padding: 8px 6px;
        }
        
        .order_dialog .inline-td td span {
            white-space: normal;
        }
        
        .table_box {
            overflow: auto;
            height: 400px;
        }
        
        .el-tabs__nav-wrap::after,
        .el-tabs__active-bar {
            height: 0;
        }
        
        .el-tabs__nav div {
            font-size: 26px;
            font-weight: 600;
        }
        
        .right-btn {
            float: right;
            margin-right: 20px;
        }
        
        .main-basic-table td,
        .child-basic-table td {
            padding: 4px 10px;
            white-space: normal;
            line-height: 20px;
        }
        
        .el-pagination {
            margin-top: 20px;
            margin-bottom: 120px;
        }
        
        .log-table td {
            padding: 12px 0 !important;
        }
        
        .right-btn .el-dialog .el-select,
        .right-btn .el-dialog .el-input {
            width: 100%;
        }
        
        .right-btn .el-dialog .el-select .el-input {
            width: 100%;
        }
        
        .el-dialog__body {
            padding: 30px 40px;
        }
    </style>

</head>

<body>
    <div id="main-detail" v-cloak style="padding: 20px;" v-loading="!detailData.order.procurement_number || isLoaded">
        <div v-if="detailData.relevance" class="main-content">
            <el-tabs v-model="activeName">
                <el-tab-pane :label="$lang('采购订单详情')" name="first">
                    <div class="main-basic-info">
                        <header style="margin-top:10px">
                            {{$lang('基本信息')}} <span v-if="isFinishedStatus">（{{$lang('已取消')}}）</span>
                        </header>
                        <table border="0" cellspacing="0" cellpadding="0" class="main-basic-table" style="table-layout: auto;width: 100%;">
                            <tbody>
                                <tr>
                                    <td class="info-title">
                                        <div class="cell">
                                            {{$lang('采购类型')}}
                                        </div>
                                    </td>
                                    <td>
                                        <span>{{detailData.order.purchase_type_val}}</span>
                                    </td>
                                    <td class="info-title">
                                        <div class="cell">
                                            {{$lang('采购单号')}}
                                        </div>
                                    </td>
                                    <td>
                                        <span>{{detailData.order.procurement_number}}</span>
                                    </td>
                                    <td class="info-title">
                                        <div class="cell">
                                            {{$lang('供应商')}}
                                        </div>
                                    </td>
                                    <td>
                                        <span>{{detailData.order.supplier_id}}</span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="info-title">
                                        <div class="cell">
                                            {{$lang('供应商（EN）')}}
                                        </div>
                                    </td>
                                    <td>
                                        <span>{{detailData.order.supplier_id_en}}</span>
                                    </td>
                                    <td class="info-title">
                                        <div class="cell">
                                            {{$lang('PO金额')}}
                                        </div>
                                    </td>
                                    <td>
                                        <span>{{detailData.order.amount_currency_val}} {{detailData.order.amount | separatNum}}</span>
                                    </td>
                                    <td class="info-title">
                                        <div class="cell">
                                            {{$lang('采购团队')}}
                                    </td>
                                    <td>
                                        <span>{{detailData.order.payment_company_val}}</span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="info-title">
                                        <div class="cell">
                                            {{$lang('发票信息')}}
                                        </div>
                                    </td>
                                    <td>
                                        <span>{{detailData.order.invoice_type_val}} - {{detailData.order.tax_rate_val}}</span>
                                    </td>
                                    <td class="info-title">
                                        <div class="cell">
                                            {{$lang('采购合同')}}
                                        </div>
                                    </td>
                                    <td>
                                        <span>{{detailData.order.contract_number}}</span>
                                    </td>
                                    <td class="info-title">
                                        <div class="cell">
                                            {{$lang('货源国家')}}
                                        </div>
                                    </td>
                                    <td>
                                        <span>{{detailData.order.source_country_val}}</span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="info-title">
                                        <div class="cell">
                                            {{$lang('我方公司')}}
                                        </div>
                                    </td>
                                    <td>
                                        <span>{{$lang(detailData.order.our_company_val)}}</span>
                                    </td>
                                    <td class="info-title">
                                        <div class="cell">
                                            {{$lang('交货方式')}}
                                        </div>
                                    </td>
                                    <td>
                                        <span>{{detailData.order.delivery_type_val}}</span>
                                    </td>
                                    <td class="info-title">
                                        <div class="cell">
                                            {{$lang('预计到货日期')}}
                                        </div>
                                    </td>
                                    <td>
                                        <span>{{detailData.order.arrival_date}}</span>
                                    </td>
                                </tr>

                                <tr>
                                    <td class="info-title">
                                        <div class="cell">
                                            {{$lang('采购网站')}}
                                        </div>
                                    </td>
                                    <td>
                                        <span>{{$lang(detailData.order.online_purchase_website_val)}}</span>
                                    </td>
                                    <td class="info-title">
                                        <div class="cell">
                                            {{$lang('下单账号')}}
                                        </div>
                                    </td>
                                    <td>
                                        <span>{{detailData.order.online_purchase_account}}</span>
                                    </td>
                                    <td class="info-title">
                                        <div class="cell">
                                            {{$lang('PO单号')}}
                                        </div>
                                    </td>
                                    <td>
                                        <span>{{detailData.order.online_purchase_order_number}}</span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="info-title">
                                        <div class="cell">
                                            {{$lang('销售团队')}}
                                        </div>
                                    </td>
                                    <td>
                                        <span>{{detailData.order.sell_team_val}}</span>
                                    </td>
                                    <td class="info-title">
                                        <div class="cell">
                                            {{$lang('向供应商支付的服务费用')}}
                                        </div>
                                    </td>
                                    <td>
                                        <span>{{detailData.order.currency_val}} {{detailData.order.expense | separatNum}}</span>
                                    </td>
                                    <td class="info-title">
                                        <div class="cell">
                                            {{$lang('预计发货日期')}}
                                        </div>
                                    </td>
                                    <td>
                                        <span>{{detailData.order.delivery_time}}</span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="info-title">
                                        <div class="cell" v-if="detailData.order.pre_pay === null && detailData.order.end_pay === null">
                                            {{$lang('付款账期')}}
                                        </div>
                                        <div class="cell" v-else>
                                            {{$lang('预付款')}}
                                        </div>
                                    </td>
                                    <td>
                                        <template v-if="detailData.order.pre_pay === null && detailData.order.end_pay === null">
                                  {{detailData.order.payment_type == '0' ? $lang('指定时间付款') : $lang('实际状况付款')}}
                                </template>
                                        <template v-else-if="detailData.order.pre_pay === null">{{$lang('无')}}</template>
                                        <template v-else>
                                    <div v-for="item in detailData.order.pre_pay">
                                        <template v-if="item.action_type_cd === 'N002860001'">
                                            <el-row>
                                              <el-col :span="6">{{$lang('订单创建后')}}{{item.days}}{{$lang('天')}}</el-col>
                                              <el-col :span="9">{{$lang('付PO金额')}}{{item.percent}}%</el-col>
                                              <el-col :span="9">{{$lang('预计')}}{{item.pre_paid_date}}</el-col>
                                            </el-row> 
                                        </template>
                                        <template v-else-if="item.action_type_cd === 'N002860002'">
                                            <el-row>
                                                <el-col :span="6">{{$lang('指定日期')}}</el-col>
                                                <el-col :span="9">{{$lang('付PO金额')}}{{item.percent}}%</el-col>
                                                <el-col :span="9">{{item.pre_paid_date}}</el-col>
                                            </el-row>
                                        </template>
                                        </div>
                                        </template>
                                    </td>
                                    <td class="info-title">
                                        <div class="cell" v-if="detailData.order.pre_pay === null && detailData.order.end_pay === null">
                                            {{$lang('具体节点')}}
                                        </div>
                                        <div class="cell" v-else>
                                            {{$lang('尾款')}}
                                        </div>
                                    </td>
                                    <td colspan="3">
                                        <template v-if="detailData.order.pre_pay === null && detailData.order.end_pay === null">
                                  <div v-if="payment_infos.length">
                                    <div v-if="detailData.order.payment_type == '0' " v-for="item in payment_infos">
                                      {{$lang('预计付款时间')}} : {{item.payment_date}} {{$lang('付款比例')}} :
                                      {{item.payment_percent}}%
                                    </div>
                                    <div v-if="detailData.order.payment_type == '1'" v-for="item in payment_infos">
                                      {{item.payment_node_val}} {{item.payment_days}}天 {{$lang('付款比例')}}
                                      {{item.payment_percent}}% {{$lang('预计付款时间')}} {{item.payment_date_estimate}}
                                    </div>
                                  </div>
                                </template>
                                        <template v-else-if="detailData.order.end_pay === null">{{$lang('无')}}</template>
                                        <template v-else>
                                  <template v-if="detailData.order.end_pay.action_type_cd === 'N001390200'">
                                    <el-row>
                                      <el-col :span="6">{{$lang('每次发货后')}}{{detailData.order.end_pay.days}}{{$lang('天内付货值部分金额')}}</el-col>
                                      <el-col :span="6">{{$lang('平均预计')}}{{detailData.order.end_pay.pre_paid_date}}</el-col>
                                    </el-row>
                                  </template>
                                        <template v-else-if="detailData.order.end_pay.action_type_cd === 'N001390400'">
                                    <el-row>
                                      <el-col :span="6">{{$lang('每次入库后')}}{{detailData.order.end_pay.days}}{{$lang('天内付货值部分金额')}}
                                      </el-col>
                                      <el-col :span="6">{{$lang('平均预计')}}{{detailData.order.end_pay.pre_paid_date}}</el-col>
                                    </el-row>
                                  </template>
                                        </template>



                                    </td>
                                </tr>
                                <tr>
                                    <td class="info-title">
                                        <div class="cell">
                                            {{$lang('附件')}}
                                        </div>
                                    </td>
                                    <td colspan="5">
                                        <a class="file_type" style="display: block" v-for="item in detailData.order.attachmentArr" target="_blank" :href="'/index.php?m=order_detail&a=download&file='+item.save_name">{{item.original_name}}</a>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="info-title">
                                        <div class="cell">
                                            {{$lang('备注')}}
                                        </div>
                                    </td>
                                    <td colspan="5">
                                        <span>{{detailData.order.order_remark}}</span>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <div class="main-basic-info">
                        <header>
                            {{$lang('状态信息')}}
                        </header>
                        <table border="0" cellspacing="0" cellpadding="0" class="main-basic-table" v-if="detailData.relevance">
                            <tbody>
                                <tr>
                                    <td class="info-title">
                                        <div class="cell">{{$lang('应付状态')}}</div>
                                    </td>
                                    <td>
                                        <span>{{detailData.relevance.payment_status == '0' ? $lang('待付款'):
                                    (detailData.relevance.payment_status == '1' ? $lang('部分付款 ') : $lang('付款完成'))}}</span>
                                    </td>
                                    <td class="info-title">
                                        <div class="cell">
                                            {{$lang('发货状态')}}
                                        </div>
                                    </td>
                                    <td>
                                        <span>{{detailData.relevance.ship_status == '0' ? $lang('待发货'):
                                    (detailData.relevance.ship_status == '1' ? $lang('部分发货 ') : $lang('发货完成'))}}</span>
                                        <el-button style="margin-left: 20px;" v-if="!isFinishedStatus && detailData.relevance.ship_status != '2'" type="primary" size="small" @click="toDetail('ship')">{{$lang('发货')}}
                                        </el-button>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="info-title">
                                        <div class="cell">
                                            {{$lang('入库状态')}}
                                        </div>
                                    </td>
                                    <td>
                                        <span>{{detailData.relevance.warehouse_status == '0' ? $lang('未入库'):
                                    (detailData.relevance.warehouse_status == '1' ? $lang('部分入库') : $lang('入库完成'))
                                    }}</span>
                                    </td>
                                    <td class="info-title">
                                        <div class="cell">
                                            {{$lang('开票状态')}}
                                        </div>
                                    </td>
                                    <td>
                                        <span>{{detailData.relevance.invoice_status == '0' ? $lang('未开票'):
                                    (detailData.relevance.invoice_status == '1' ? $lang('部分开票') : $lang('已开票'))}}</span>
                                        <el-button style="margin-left: 20px;" v-if="!isFinishedStatus && detailData.relevance.invoice_status != '2'" type="primary" size="small" @click="toDetail('invoice')">{{$lang('收到发票')}}
                                        </el-button>
                                    </td>

                                </tr>
                                <tr>
                                    <td class="info-title">
                                        <div class="cell">
                                            {{$lang('退货情况')}}

                                        </div>
                                    </td>
                                    <td>
                                        <span>{{detailData.relevance.has_return_goods == '0' ? $lang('无退货') :$lang('有退货')}}</span>
                                        <el-button style="margin-left: 20px;" type="primary" size="small" @click="toDetail('return')" v-if="!isFinishedStatus">{{$lang('发起退货')}}
                                        </el-button>
                                    </td>
                                    <td class="info-title">
                                        <div class="cell">
                                            {{$lang('退款情况')}}
                                        </div>
                                    </td>
                                    <td>
                                        <span>{{detailData.relevance.has_refund == '0' ? $lang('无退款') :$lang('有退款')}}</span>
                                        <el-button style="margin-left: 20px;" type="primary" size="small" @click="toDetail('refund')" v-if="!isFinishedStatus">{{$lang('退款认领')}}
                                        </el-button>
                                    </td>
                                </tr>
                            </tbody>

                        </table>
                    </div>
                    <div class="main-basic-info">
                        <header>
                            {{$lang('商品信息')}}
                        </header>
                        <table border="0" cellspacing="0" cellpadding="0" class="child-basic-table" v-if="detailData.goods">
                            <thead>
                                <tr>
                                    <th>{{$lang('No')}}</th>
                                    <th>{{$lang('SKU编码/条形码')}}</th>
                                    <th>{{$lang('商品名称')}}</th>
                                    <th>{{$lang('属性')}}</th>
                                    <th>{{$lang('图片')}}</th>
                                    <th>{{$lang('单价(含增值税)')}}</th>
                                    <th>{{$lang('单价(不含增值税)')}}</th>
                                    <th>{{$lang('PO内费用单价')}}</th>
                                    <th>{{$lang('订单数量')}}</th>
                                    <th v-if="isSellSmallTeam">{{$lang('各小团队数量')}}</th>
                                    <th>{{$lang('累计发货数量')}}</th>
                                    <th>{{$lang('累计入库数量')}}</th>
                                    <th>{{$lang('待发货')}}</th>
                                    <th>{{$lang('待入货')}}</th>
                                    <th>{{$lang('标记发货完结')}}</th>
                                    <th>{{$lang('退货数量')}}</th>
                                    <th>{{$lang('Hotness')}}</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="(item,index) in detailData.goods">
                                    <td>{{index + 1}}</td>
                                    <td>
                                        <div>{{item.sku_information}}</div>
                                        <div>{{item.upc_id}}</div>
                                        <el-button  type="primary" size="mini" @click="searchProductKey(item)">Product Key</el-button>
                                    </td>
                                    <td>{{item.spu_name}}</td>
                                    <td>{{item.attributes}}</td>
                                    <td style="position:relative">
                                        <img v-if="!!item.image_url" :src="item.image_url" style="cursor: pointer;" width="80" height="80" @mouseenter="showImg(item)" @mouseleave="showImg(item)">
                                        <div style="position: absolute; top: 10px; left: 200px; box-shadow: 0 0 5px #536d7a;z-index:999" v-if="item.bigImg">
                                            <img :src="item.image_url" width="300" height="300">
                                        </div>
                                    </td>
                                    <td>{{detailData.order.amount_currency_val}} {{item.unit_price | separatNum }}</td>
                                    <td>{{detailData.order.amount_currency_val}} {{item.unit_price_not_contain_tax | separatNum}}</td>
                                    <td>{{detailData.order.amount_currency_val}} {{item.unit_expense |separatNum}}</td>
                                    <td>{{item.goods_number}}</td>
                                    <td v-if="isSellSmallTeam">
                                        <div v-for="item in item.sell_small_team_arr">
                                            <span>{{item.small_team_name}} : {{item.number}}</span>
                                        </div>
                                    </td>
                                    <td>{{item.shipped_number}}</td>
                                    <td>
                                        <div>{{$lang('正常品')}}：{{item.warehouse_number ? item.warehouse_number : 0}}</div>
                                        <div>{{$lang('残次品')}}：{{item.warehouse_number_broken ? item.warehouse_number_broken:0}}</div>
                                    </td>
                                    <td>{{+item.goods_number + +item.return_number - +item.ship_end_number - +item.shipped_number}}
                                    </td>
                                    <!--<td>{{+item.shipped_number - (+item.warehouse_number + +item.warehouse_number_broken)}}</td>-->
                                    <td>{{item.unwarehoused_number ? item.unwarehoused_number:0}}</td>
                                    <td>{{item.ship_end_number}}</td>
                                    <td>
                                        <div>{{$lang('发起退货')}}：{{+item.return_number}}</div>
                                        <div>{{$lang('退货出库')}}：{{+item.return_out_store_number}}</div>
                                    </td>
                                    <td>{{item.hotness}}</td>
                                </tr>
                                <tr>
                                    <td>{{$lang('合计')}}</td>
                                    <td></td>
                                    <td></td>
                                    <td></td>
                                    <td>{{$lang('订单币种')}} : {{detailData.order.amount_currency_val}}</td>
                                    <td>{{detailData.order.amount_currency_val}} {{countTotal.unit_price | separatNum}}</td>
                                    <td>{{detailData.order.amount_currency_val}} {{countTotal.unit_price_not_contain_tax | separatNum}}</td>
                                    <td>{{detailData.order.amount_currency_val}} {{countTotal.unit_expense | separatNum}}</td>
                                    <td>{{countTotal.goods_number}}</td>
                                    <td v-if="isSellSmallTeam">{{countTotal.sell_small_team_number}}</td>
                                    <td>{{countTotal.shipped_number}}</td>
                                    <td>
                                        <div>{{$lang('正常品')}}：{{countTotal.warehouse_number}}</div>
                                        <div>{{$lang('残次品')}}：{{countTotal.warehouse_number_broken}}</div>
                                    </td>
                                    <td>{{countTotal.delivered_number}}</td>
                                    <td>{{countTotal.out_number}}</td>
                                    <td>{{countTotal.ship_end_number}}</td>
                                    <td>
                                        <div>{{$lang('发起退货')}}：{{+countTotal.return_number}}</div>
                                        <div>{{$lang('退货出库')}}：{{+countTotal.return_out_store_number}}</div>
                                    </td>
                                    <td></td>
                                </tr>
                            </tbody>

                        </table>
                    </div>
                    <div class="main-basic-info">
                        <header>
                            {{$lang('付款信息')}}
                        </header>
                        <table border="0" cellspacing="0" cellpadding="0" class="child-basic-table" v-if="detailData.payment">
                            <thead>
                                <tr>
                                    <th>{{$lang('应付单号')}}</th>
                                    <th>{{$lang('触发操作')}}</th>
                                    <th>{{$lang('适用条款')}}</th>
                                    <th>{{$lang('关联单据号')}}</th>
                                    <th>{{$lang('应付状态')}}</th>
                                    <th>{{$lang('预计付款日期')}}</th>
                                    <th>{{$lang('付款确认日期')}}</th>
                                    <th>{{$lang('确认前-本期应付金额')}}</th>
                                    <th>{{$lang('确认后-本期应付金额')}}</th>
                                    <th>{{$lang('实际付款出账金额')}}</th>
                                    <th>{{$lang('付款手续费')}}</th>
                                    <th>{{$lang('操作')}}</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="item in detailData.payment">
                                    <td>{{item.payment_no}}</td>
                                    <td>{{item.action_type_cd_val}}</td>
                                    <td>{{item.clause}}</td>
                                    <td>{{item.bill_no}}</td>
                                    <td>{{paymentState[item.status]}}</td>
                                    <td>{{item.payable_date_after}}</td>
                                    <td>{{item.payment_at ? item.payment_at :item.billing_at}}</td>
                                    <td>
                                        <!--<span v-if="item.status != '0'">{{detailData.order.amount_currency_val}} {{item.amount_payable_split ? +item.amount_payable_split + +item.amount_difference :+item.amount_payable + +item.amount_difference| separatNum}}</span>-->
                                        <span>{{detailData.order.amount_currency_val}} {{item.amount_payable_split ? item.amount_payable_split : item.amount_payable | separatNum}}</span>
                                        <!--<span >{{detailData.order.amount_currency_val}} {{item.amount_payable| separatNum}}</span>-->

                                    </td>
                                    <td>
                                        <span v-if="item.status != '0'">{{detailData.order.amount_currency_val}} {{item.amount_confirm | separatNum}}
                                </span>
                                    </td>
                                    <td><span v-if="item.status == '3'">{{item.billing_currency_cd_val}} {{item.amount_account | separatNum}}</span>
                                    </td>
                                    <td><span v-if="item.status == '3'">{{item.billing_currency_cd_val}} {{item.expense | separatNum}}</span>
                                    </td>
                                    <td>
                                        <el-button size="small" type="primary" @click="toDetail('payment',item.id)" v-if="!isFinishedStatus">
                                            {{$lang('查看')}}
                                        </el-button>
                                        <el-button size="small" type="default" @click="toDetail('moneySure',item.id)" v-if="!isFinishedStatus && item.status == '0'">
                                            {{$lang('金额确认')}}
                                        </el-button>
                                    </td>
                                </tr>
                            </tbody>

                        </table>
                    </div>
                    <div class="main-basic-info">
                        <header>
                            {{$lang('物流信息')}}
                            <span class="right-btn">
                            <el-button size="small" v-if="!isFinishedStatus && countTotal.delivered_number == '0' && countTotal.ship_end_number !='0'" type="primary" v-loading.fullscreen.lock="backFinishedDataLoading" @click="backFinished()"
                            >{{$lang('撤回发货完结')}}</el-button>
                            <el-dialog
                                    :title="$lang('提示')"
                                    :visible.sync="backFinishedDialog"
                                    width="30%">
                              <span>{{$lang('本操作将生成应付金：')}} ({{backFinishedData.currency_type}}) {{backFinishedData.amount}}</span>
                            <span slot="footer" class="dialog-footer">
                                <el-button @click="backFinishedDialog = false">{{$lang('取消')}}</el-button>
                                <el-button type="primary" @click="doBackFinish">{{$lang('确认')}}</el-button>
                              </span>
                            </el-dialog>
                            <el-button size="small" v-if="!isFinishedStatus && detailData.relevance.ship_status != '2'" type="primary" @click="toDetail('ship')">{{$lang('发货')}}</el-button>
                            <el-button size="small" v-if="!isFinishedStatus && countTotal.delivered_number != '0'" type="default" @click="confirmDialog = true">{{$lang('标记发货完结')}}</el-button>
                            <el-dialog :title="$lang('提示')" :visible.sync="confirmDialog" width="30%">
                                <span>{{$lang('确认不再继续发货，并且收到供应商退款，才可标记完结。标记完结后不可恢复！')}}</span>
                                <span slot="footer" class="dialog-footer">
                                <el-button @click="confirmDialog = false">{{$lang('取消')}}</el-button>
                                <el-button type="primary" v-loading.fullscreen.lock="shipFinishedLoading" @click="shipFinished">{{$lang('确认')}}</el-button>
                              </span>
                            </el-dialog>
                            <el-dialog :title="$lang('提示')" :visible.sync="shipFinishedDialog" width="30%">
                                <span>{{$lang('本操作将生成抵扣金：')}} ({{shipFinishedData.currency_type}}) {{shipFinishedData.amount}}</span>
                                <span slot="footer" class="dialog-footer">
                                <el-button @click="shipFinishedDialog = false">{{$lang('取消')}}</el-button>
                                <el-button type="primary" @click="doShipFinish">{{$lang('确认')}}</el-button>
                              </span>
                            </el-dialog>
                            </span>
                        </header>
                        <table border="0" cellspacing="0" cellpadding="0" class="child-basic-table" v-if="detailData.ship">
                            <thead>
                                <tr>
                                    <th>{{$lang('发货编号')}}</th>
                                    <th>{{$lang('入库状态')}}</th>
                                    <th>{{$lang('提单号')}}</th>
                                    <th>{{$lang('是否入我方仓库')}}</th>
                                    <th>{{$lang('入库仓库')}}</th>
                                    <th>{{$lang('预计到货/到港时间)')}}</th>
                                    <th>{{$lang('发货数量')}}</th>
                                    <th>{{$lang('已入库数量')}}</th>
                                    <th>{{$lang('入库单号')}}</th>
                                    <th>{{$lang('入库确认人')}}</th>
                                    <th>{{$lang('入库确认时间')}}</th>
                                    <th>{{$lang('操作')}}</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="item in detailData.ship">
                                    <td>{{item.warehouse_id}}</td>
                                    <td>
                                        <span>{{item.warehouse_status == '0' ? $lang('未入库'):
                                    (item.warehouse_status == '2' ? $lang('部分入库') : $lang('入库完成'))
                                    }}</span>
                                    </td>
                                    <td>{{item.bill_of_landing}}</td>
                                    <td>{{item.need_warehousing == '0' ? $lang('不需要') : $lang('需要')}}</td>
                                    <td>{{item.warehouse_val}}</td>
                                    <td>{{item.arrival_date}}</td>
                                    <td>{{item.shipping_number}}</td>
                                    <td>{{item.warehouse_number}}</td>
                                    <td>{{item.warehouse_code}}</td>
                                    <td>{{item.warehouse_user}}</td>
                                    <td>{{item.warehouse_time}}</td>
                                    <td>
                                        <el-button size="small" type="primary" @click="toDetail('shipDetail',item.id)" v-if="!isFinishedStatus">
                                            {{$lang('查看')}}
                                        </el-button>
                                        <el-button v-if="!isFinishedStatus && item.warehouse_status == '0'" @click="backReturn(item.id)" size="small" type="default">{{$lang('撤回')}}
                                        </el-button>
                                    </td>
                                </tr>
                            </tbody>

                        </table>
                    </div>
                    <div class="main-basic-info">
                        <header>
                            {{$lang('退款信息')}}
                            <span class="right-btn">
                            <el-button size="small" type="primary"
                                       v-if="!isFinishedStatus"
                                       @click="toDetail('refund')">{{$lang('退款认领')}}</el-button>
                        </span>
                        </header>
                        <table border="0" cellspacing="0" cellpadding="0" class="child-basic-table" v-if="detailData.refund">
                            <thead>
                                <tr>
                                    <th>{{$lang('流水ID')}}</th>
                                    <th>{{$lang('流水币种')}}</th>
                                    <th>{{$lang('退款金额')}}</th>
                                    <th>{{$lang('操作')}}</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="item in detailData.refund">
                                    <td>{{item.account_transfer_no}}</td>
                                    <td>{{item.currency_code_val}}</td>
                                    <td>{{item.claim_amount}}</td>

                                    <td>
                                        <el-button size="small" type="primary" v-if="!isFinishedStatus" @click="toDetail('claim',item.account_transfer_no)">{{$lang('查看')}}
                                        </el-button>
                                    </td>
                                </tr>
                            </tbody>

                        </table>
                    </div>
                    <div class="main-basic-info">
                        <header>
                            {{$lang('退货信息')}}
                            <span class="right-btn">
                            <el-button size="small" type="primary"
                                       v-if="!isFinishedStatus"
                                       @click="toDetail('return')">{{$lang('发起退货')}}</el-button>
                        </span>
                        </header>
                        <table border="0" cellspacing="0" cellpadding="0" class="child-basic-table" v-if="detailData.return">
                            <thead>
                                <tr>
                                    <th>{{$lang('采购退货单号')}}</th>
                                    <th>{{$lang('发出仓库')}}</th>
                                    <th>{{$lang('退货状态')}}</th>
                                    <th>{{$lang('退货数量')}}</th>
                                    <th>{{$lang('供应商理货数量')}}</th>
                                    <th>{{$lang('理货差异损失')}}</th>
                                    <th>{{$lang('出库人')}}</th>
                                    <th>{{$lang('出库时间')}}</th>
                                    <th>{{$lang('理货确认时间')}}</th>
                                    <th>{{$lang('操作')}}</th>

                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="item in detailData.return">
                                    <td>{{item.return_no}}</td>
                                    <td>{{item.warehouse_cd_val}}</td>
                                    <td>{{item.status_cd_val}}</td>
                                    <td>
                                        <div>{{$lang('正品')}} : {{item.return_number}}</div>
                                        <div>{{$lang('残次品')}} : {{item.return_number_broken}}</div>
                                    </td>
                                    <td>
                                        <div>{{$lang('正品')}} : {{item.tally_number}}</div>
                                        <div>{{$lang('残次品')}} : {{item.tally_number_broken}}</div>
                                    </td>
                                    <td>{{item.compensation_currency_cd_val}} {{item.compensation | separatNum }}</td>
                                    <td>{{item.out_of_stock_user}}</td>
                                    <td>{{item.out_of_stock_time}}</td>
                                    <td>{{item.tally_at}}</td>
                                    <td>
                                        <el-button size="small" type="primary" v-if="!isFinishedStatus" @click="toDetail('returnDetail',item.id)">
                                            {{$lang('查看退货单')}}
                                        </el-button>
                                        <el-button v-if="!isFinishedStatus && item.status_cd === 'N002640200'" size="small" @click="toDetail('tally',item.id)">{{$lang('去理货')}}
                                        </el-button>
                                    </td>
                                </tr>
                            </tbody>

                        </table>
                    </div>
                    <div class="main-basic-info">
                        <header>
                            {{$lang('发票信息')}}
                            <span class="right-btn" v-if="!isFinishedStatus">
                            <el-button size="small" type="primary" v-if="detailData.relevance.invoice_status == '2' && detailData.relevance.is_marking_end_billing == '1'"
                                       @click="invoiceEndWithdraw">{{$lang('撤回开票完结')}}</el-button>
                            <el-button size="small" type="primary"
                                       @click="toDetail('invoiceDetail')">{{$lang('查看')}}</el-button>
                            <el-button size="small" type="primary"
                                       v-if="detailData.relevance.invoice_status != '2'"
                                       @click="toDetail('invoice')">{{$lang('收到发票')}}</el-button>
                            <el-button size="small" type="default" @click="confirmDialogInvoice = true"
                                       v-if="detailData.relevance.invoice_status != '2'">{{$lang('标记收发票完结')}}</el-button>
                            <el-dialog
                                    :title="$lang('提示')"
                                    :visible.sync="confirmDialogInvoice"
                                    width="30%">
                              <span>{{$lang('该订单实际收到发票的金额没有达到订单应收的发票金额，是否确认发票收取完结？')}}</span>
                            <span slot="footer" class="dialog-footer">
                                <el-button @click="confirmDialogInvoice = false">{{$lang('取消')}}</el-button>
                                <el-button type="primary" @click="doInvoiceFinish">{{$lang('确定')}}</el-button>
                              </span>
                            </el-dialog>
                            </span>
                        </header>
                        <table border="0" cellspacing="0" cellpadding="0" class="child-basic-table" v-if="detailData.invoice">
                            <thead>
                                <tr>
                                    <th>{{$lang('操作编号')}}</th>
                                    <th>{{$lang('发票状态')}}</th>
                                    <th>{{$lang('发票号')}}</th>
                                    <th>{{$lang('发票总金额')}}</th>
                                    <th>{{$lang('发票类型')}}</th>
                                    <th>{{$lang('税点')}}</th>
                                    <th>{{$lang('财务确认人')}}</th>
                                    <th>{{$lang('财务确认时间')}}</th>
                                    <th>{{$lang('操作')}}</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="item in detailData.invoice">
                                    <td>{{item.action_no}}</td>
                                    <td>{{item.status == '0' ? $lang('待确认') : $lang('已确认')}}</td>
                                    <td>
                                        <div v-if="item.invoice_no">
                                            <span v-for="item in JSON.parse(item.invoice_no)">
                                                {{item.no}}
                                            </span>
                                        </div>
                                    </td>
                                    <td>{{detailData.order.amount_currency_val}} {{item.invoice_money | separatNum}}</td>
                                    <td>{{item.invoice_type_val}}</td>
                                    <td>{{item.tax_rate_val}}</td>
                                    <td>{{item.confirm_user }}</td>
                                    <td><span v-if="item.status == '1'">{{item.confirm_time}}</span></td>
                                    <td>
                                        <el-button size="small" type="primary" v-if="!isFinishedStatus" @click="toDetail('invoiceItem',item.id)">
                                            {{$lang('查看')}}
                                        </el-button>
                                    </td>
                                </tr>
                            </tbody>

                        </table>
                    </div>
                    <div class="main-basic-info">
                        <header>
                            {{$lang('采购余额变动信息')}}
                            <span class="right-btn" v-if="!isFinishedStatus">
                            <!-- <el-button size="small" type="primary"
                                       @click="showAddDialog">{{$lang('多余金额算作抵扣金')}}
                            </el-button> -->
                            <el-button size="small" type="primary"
                                        @click="showDetail('purchaseBalance')">{{$lang('查看账户信息')}}
                            </el-button>
                            
                            </span>
                        </header>
                        <table border="0" cellspacing="0" cellpadding="0" class="child-basic-table" v-if="detailData.deduction">
                            <thead>
                                <tr>
                                    <th>{{$lang('金额')}}</th>
                                    <th>{{$lang('触发操作')}}</th>
                                    <th>{{$lang('适用条款')}}</th>
                                    <th>{{$lang('关联单据号')}}</th>
                                    <th>{{$lang('变动时间')}}</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="item in detailData.deduction" style="height:40px;">
                                    <td> {{item.turnover_type == '1' ? '-' : '+'  }}  {{detailData.order.amount_currency_val}} {{item.deduction_amount | separatNum}}</td>
                                    <td>{{$lang(item.action_type_cd_val)}}</td>
                                    <td>{{$lang(item.clause)}}</td>
                                    <td>{{$lang(item.bill_no_label)}} {{item.bill_no}}</td>
                                    <td>{{item.created_at}}</td>
                                </tr>
                            </tbody>

                        </table>
                    </div>
                    <div class="main-basic-info">
                        <header>
                            {{$lang('返利赔偿金变动信息')}}
                            <span class="right-btn" v-if="!isFinishedStatus">
                            <el-button size="small" type="primary"
                                       @click="showAddDialog">{{$lang('多余金额算作抵扣金')}}
                            </el-button>
                            <el-button size="small" type="primary"
                                        @click="showDetail('rebate')">{{$lang('查看账户信息')}}
                            </el-button>
                            <el-dialog
                                    :title="$lang('多余金额算作抵扣金')"
                                    :visible.sync="addDeductibleDialog"
                                    width="50%">
                              <el-form :model="deductibleForm" label-position="left" :rules="rulesDeductible"
                                       ref="deductibleForm" label-width="140px"
                                       class="demo-ruleForm">
                                  <el-form-item :label="$lang('类型')" prop="deduction_type_cd">
                                    <el-select v-model="deductibleForm.deduction_type_cd" :placeholder="$lang('请选择类型')">
                                        <el-option v-if="detailData.order.pre_pay === null && detailData.order.end_pay === null" :label="$lang('多付未退款')" value="N002660100"></el-option>
                                        <el-option :label="$lang('供应商赔偿（非残次少货）')" value="N002660201"></el-option>
                                        <el-option :label="$lang('供应商返利')" value="N002660200"></el-option>
                                    </el-select>
                                  </el-form-item>
                                  <el-form-item :label="$lang('金额')" prop="deduction_amount">
                                      <el-input type="number" v-model="deductibleForm.deduction_amount">
                                        <template slot="prepend">{{detailData.order.amount_currency_val}}</template>
                                      </el-input>
                                  </el-form-item>
                                    <el-form-item :label="$lang('备注')" prop="remark">
                                    <el-input v-model="deductibleForm.remark"></el-input>
                                  </el-form-item>
                                  </el-form-item>
                                  <el-form-item :label="$lang('上传沟通凭证')" prop="deduction_voucher">
                                    <el-upload
                                            class="deductible-demo"
                                            action="/index.php?m=order_detail&a=file_upload"
                                            :on-success="handleSuccessDeductible"
                                            :on-remove="handleRemoveDeductible"
                                            :before-upload="beforeUpload"
                                            multiple
                                            :file-list="deductibleForm.deduction_voucher">
                                      <el-button size="small" type="primary">{{$lang('点击上传')}}</el-button>
                                    </el-upload>
                                  </el-form-item>
                              </el-form>
                              <span slot="footer" class="dialog-footer">
                                <el-button @click="addDeductibleDialog = false">{{$lang('取消')}}</el-button>
                                <el-button type="primary" @click="doAddDeduction">{{$lang('确定')}}</el-button>
                              </span>
                            </el-dialog>
                            </span>
                        </header>
                        <table border="0" cellspacing="0" cellpadding="0" class="child-basic-table" v-if="detailData.deduction">
                            <thead>
                                <tr>
                                    <th>{{$lang('来源')}}</th>
                                    <th>{{$lang('金额')}}</th>
                                    <th>{{$lang('备注')}}</th>
                                    <th>{{$lang('凭证文件')}}</th>
                                    <th>{{$lang('变动时间')}}</th>
                                    <th>{{$lang('操作')}}</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="item in detailData.compensation" style="height:40px;">
                                    <!-- <td>{{item.turnover_type == '1' ? $lang('使用抵扣金') : $lang('算作抵扣金')}}</td> -->
                                    <!-- <td>{{detailData.order.amount_currency_val}} {{item.deduction_amount | separatNum}}</td> -->
                                    <!-- <td>{{item.deduction_type_cd_val}}</td> -->
                                    <td>{{$lang(item.deduction_type_cd_val)}}</td>
                                    <td>{{item.deduction_amount}}</td>
                                    <td>{{item.remark}}</td>
                                    <!-- <td>{{item.deduction_voucher}}</td> -->
                                    <!-- <td>{{item.remark}}</td> -->
                                    <td>
                                        <span v-if="item.deduction_voucher">
                                            <a class="file_type" style="display: block"
                                            v-for="i in JSON.parse(item.deduction_voucher)"
                                            target="_blank" :href="'/index.php?m=order_detail&a=download&file='+i.savename">{{i.name}}</a>
                                        </span>
                                    </td>
                                    <td>{{item.created_at}}</td>
                                    <td>
                                        <el-button v-if="item.deduction_type_cd_val != '应付单使用'" size="small" type="primary" @click="cancelDeduction(item.id)">
                                            {{$lang('取消')}}
                                        </el-button>
                                    </td>
                                </tr>
                            </tbody>

                        </table>
                    </div>
                    <div class="main-basic-info">
                        <header>
                            {{$lang('财务指标')}}
                        </header>
                        <table border="0" cellspacing="0" cellpadding="0" class="main-basic-table" v-if="detailData.finance">
                            <tbody>
                                <tr>
                                    <td class="info-title">
                                        <div class="cell">
                                            <span :title="$lang('综合付款金额 = 付款金额 - 退款金额')">{{$lang('综合付款金额')}}
                                    <i style="cursor: pointer" class="el-icon-info"></i>
                                        </span>
                                        </div>
                                    </td>
                                    <td>
                                        <span>{{detailData.order.amount_currency_val}} {{detailData.finance.money_paid_over_all | separatNum}}</span>
                                    </td>
                                    <td class="info-title">
                                        <div class="cell">
                                            {{$lang('付款金额')}}
                                        </div>
                                    </td>
                                    <td>
                                        <span>+ {{detailData.order.amount_currency_val}} {{detailData.finance.money_paid | separatNum}} </span>
                                    </td>
                                    <td class="info-title">
                                        <div class="cell">
                                            {{$lang('退款金额')}}
                                        </div>
                                    </td>
                                    <td>
                                        <span>- {{detailData.order.amount_currency_val}} {{detailData.finance.money_refund | separatNum}}</span>
                                    </td>

                                </tr>
                                <!-- <tr>
                                    <td class="info-title">
                                        <div class="cell">
                                            {{$lang('使用抵扣金金额')}}
                                        </div>
                                    </td>
                                    <td>
                                        <span>+ {{detailData.order.amount_currency_val}} {{detailData.finance.money_deduction_use | separatNum}} </span>
                                    </td>
                                    <td class="info-title">
                                        <div class="cell">
                                            {{$lang('算作抵扣金金额（返利、赔偿除外）')}}
                                        </div>
                                    </td>
                                    <td>
                                        <span>- {{detailData.order.amount_currency_val}} {{detailData.finance.money_deduction_create | separatNum}}</span>
                                    </td>
                                </tr> -->
                                <tr>

                                    <td class="info-title">
                                        <div class="cell">
                                            <span :title="$lang('综合入库金额 = 入库金额 - 退货金额')">{{$lang('综合入库金额')}}
                                    <i style="cursor: pointer" class="el-icon-info"></i>
                                        </span>
                                        </div>
                                    </td>
                                    <td>
                                        <span>{{detailData.order.amount_currency_val}} {{detailData.finance.money_warehouse_over_all | separatNum}}</span>
                                    </td>
                                    <td class="info-title">
                                        <div class="cell">
                                            {{$lang('入库金额')}}
                                        </div>
                                    </td>
                                    <td>
                                        <span>+ {{detailData.order.amount_currency_val}} {{detailData.finance.money_warehouse | separatNum}}</span>
                                    </td>
                                    <td class="info-title">
                                        <div class="cell">
                                            {{$lang('退货金额')}}
                                        </div>
                                    </td>
                                    <td>
                                        <span>- {{detailData.order.amount_currency_val}} {{detailData.finance.money_return | separatNum}}</span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="info-title">
                                        <div class="cell">
                                            <span :title="$lang('综合收发票金额 = 收发票金额 - 发票冲销金额')">{{$lang('综合收发票金额')}}
                                    <i style="cursor: pointer" class="el-icon-info"></i>
                                        </span>
                                        </div>
                                    </td>
                                    <td>
                                        <span>{{detailData.order.amount_currency_val}} {{detailData.finance.money_invoice_over_all | separatNum}}</span>
                                    </td>
                                    <td class="info-title">
                                        <div class="cell">
                                            {{$lang('收发票金额')}}
                                        </div>
                                    </td>
                                    <td>
                                        <span>+ {{detailData.order.amount_currency_val}} {{detailData.finance.money_invoice | separatNum}}</span>
                                    </td>
                                    <td class="info-title">
                                        <div class="cell">
                                            {{$lang('发票冲销金额')}}
                                        </div>
                                    </td>
                                    <td>
                                        <span>- {{detailData.order.amount_currency_val}} {{detailData.finance.money_invoice_write_off | separatNum}}</span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="info-title">
                                        <div class="cell">
                                            <span :title="$lang('在途库存金额 = 综合付款金额 - 综合入库金额')">{{$lang('在途库存金额')}}
                                    <i style="cursor: pointer" class="el-icon-info"></i>
                                        </span>
                                        </div>
                                    </td>
                                    <td>
                                        <span>{{detailData.order.amount_currency_val}} {{detailData.finance.money_on_way | separatNum}}</span>
                                    </td>
                                    <td class="info-title">
                                        <div class="cell">
                                            <span :title="$lang('在途发票金额 = 综合付款金额 - 综合收发票金额')">{{$lang('在途发票金额')}}
                                    <i style="cursor: pointer" class="el-icon-info"></i>
                                        </span>
                                        </div>
                                    </td>
                                    <td>
                                        <span>{{detailData.order.amount_currency_val}} {{detailData.finance.money_invoice_on_way | separatNum}}</span>
                                    </td>
                                    <td class="info-title">
                                        <div class="cell">
                                            {{$lang('对账备注')}}
                                        </div>
                                    </td>
                                    <td>
                                        <span>{{detailData.relevance.reconciliation_remark}}</span>
                                    </td>
                                </tr>
                            </tbody>

                        </table>
                    </div>
                    <div class="main-basic-info">
                        <header>
                            {{$lang('流程信息')}}
                        </header>
                        <table border="0" cellspacing="0" cellpadding="0" class="main-basic-table" v-if="detailData.relevance">
                            <tbody>
                                <tr>
                                    <td class="info-title">
                                        <div class="cell">{{$lang('采购人')}}</div>
                                    </td>
                                    <td><span>{{detailData.relevance.prepared_by}}</span>
                                    </td>
                                    <td class="info-title">
                                        <div class="cell">
                                            {{$lang('创建时间')}}
                                        </div>
                                    </td>
                                    <td>
                                        <span>{{detailData.relevance.prepared_time}}</span>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="info-title">
                                        <div class="cell">
                                            {{$lang('最新修改人')}}
                                        </div>
                                    </td>
                                    <td>
                                        {{detailData.relevance.last_update_user}}
                                    </td>
                                    <td class="info-title">
                                        <div class="cell">
                                            {{$lang('更新时间')}}
                                        </div>
                                    </td>
                                    <td>
                                        {{detailData.relevance.last_update_time}}
                                    </td>
                                </tr>
                            </tbody>

                        </table>
                    </div>
                    <div class="use-btn" v-if="!isFinishedStatus">
                        <el-button @click="cancelDialog = true">{{$lang('取消采购单')}}</el-button>
                        <el-dialog :title="$lang('提示')" :visible.sync="cancelDialog">
                            <el-form :model="cancelForm">
                                <el-form-item :label="$lang('取消凭证')" label-width="120">
                                    <el-upload class="upload-demo" action="/index.php?m=order_detail&a=file_upload" :on-success="handleSuccess" :limit="1" :multiple="false" :file-list="fileList">
                                        <el-button size="small" type="primary">{{$lang('点击上传')}}</el-button>
                                    </el-upload>
                                </el-form-item>
                                <el-form-item :label="$lang('取消原因')" label-width="120">
                                    <el-input style="width:400px;" v-model="cancelForm.cancel_reason"></el-input>
                                </el-form-item>
                            </el-form>
                            <div slot="footer" class="dialog-footer">
                                <el-button @click="cancelDialog = false">{{$lang('取消')}}</el-button>
                                <el-button type="primary" @click="doCancelOrder">{{$lang('确定')}}</el-button>
                            </div>
                        </el-dialog>
                    </div>
                </el-tab-pane>
                <el-tab-pane :label="$lang('操作日志')" name="second">
                    <div class="main-basic-info">
                        <header>
                            {{$lang('操作日志')}}
                        </header>
                        <table border="0" cellspacing="0" cellpadding="0" class="child-basic-table log-table">
                            <thead>
                                <tr>
                                    <th>{{$lang('时间')}}</th>
                                    <th>{{$lang('提交人')}}</th>
                                    <th>{{$lang('详细信息')}}</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr v-for="item in logData">
                                    <td>{{item.time}}</td>
                                    <td>{{item.user}}</td>
                                    <td>{{item.info}}</td>
                                </tr>
                            </tbody>

                        </table>
                        <div class="use-row">
                            <div class="col-100 text-right">
                                <el-pagination @size-change="handleSizeChange" @current-change="handleCurrentChange" :current-page.sync="logSearch.p" :page-sizes="[20, 50, 100, 200,300]" :page-size="logSearch.rows" layout="sizes, prev, pager, next,jumper" :total="totalCount"></el-pagination>
                            </div>
                        </div>
                    </div>
                </el-tab-pane>
            </el-tabs>
        </div>
        <el-dialog id="ProductKey" title="Product Key" :visible.sync="dialogTableVisible" width="900">
            <table style="border:1px #cccccc solid;border-collapse: collapse;text-align: center;width:100%">
                <tr v-for="(v,k) in ProductKeyData" style="border:1px #cccccc solid">
                    <td style="border:1px #cccccc solid;padding: 10px;width: 20%;">{{v[0]?v[0].product_key:''}}</td>
                    <td style="border:1px #cccccc solid;padding: 10px;width: 20%;">{{v[1]?v[1].product_key:''}}</td>
                    <td style="border:1px #cccccc solid;padding: 10px;width: 20%;">{{v[2]?v[2].product_key:''}}</td>
                    <td style="border:1px #cccccc solid;padding: 10px;width: 20%;">{{v[3]?v[3].product_key:''}}</td>
                    <td style="border:1px #cccccc solid;padding: 10px;width: 20%;">{{v[4]?v[4].product_key:''}}</td>
                </tr>
            </table>
            <div v-if="ProductKeyData.length === 0" style="line-height: 60px;text-align: center">
                暂无数据
            </div>
        </el-dialog>
    </div>
    <!--引入js-->
    <script type="text/javascript" src="/Application/Tpl/Home/Public/lib/jquery/1.9.1/jquery.min.js"></script>
    <script type="text/javascript" src="/Application/Tpl/Home/Public/utils/utils.js"></script>
    <script type="text/javascript" src="/Application/Tpl/Home/Public/js/H-ui.js"></script>
    <script type="text/javascript" src="/Application/Tpl/Home/Public/js/H-ui.admin.js?v=<{$Think.const.V}>"></script>
    <script type="text/javascript" src="/Application/Tpl/Home/Public/js/vue.2.5.13.js?<{$Think.config.VER_NUM}>"></script>
    <script type="text/javascript" src="/Application/Tpl/Home/Public/js/axios.min.js"></script>
    <script type="text/javascript" src="/Application/Tpl/Home/Public/js/element-ui-2.2.js"></script>
    <script>
        var VM = new Vue({
            el: '#main-detail',
            components: {},
            data: {
                prouductUrl:location.host === 'erp.gshopper.com'? '//data.gshopper.com/search/purchaseProductKey':'//data.gshopper.stage.com/search/purchaseProductKey',
                ProductKeyData:[],
                dialogTableVisible:false,
                activeName: 'first',
                isFinishedStatus: true,
                confirmDialog: false,
                confirmDialogInvoice: false,
                backFinishedDialog: false,
                backFinishedDataLoading: false,
                backFinishedData: '',
                shipFinishedDialog: false,
                shipFinishedLoading: false,
                shipFinishedData: '',
                showOrder: true,
                cancelDialog: false,
                fileList: [],
                isLoaded: false,
                logSearch: {
                    p: 1,
                    rows: 20
                },
                cancelForm: {
                    relevance_id: '',
                    cancel_voucher: {},
                    cancel_reason: ''
                },
                logData: [],
                totalCount: 0,
                payment_infos: [],
                detailData: {
                    finance: {},
                    goods: [],
                    invoice: {},
                    order: {
                        end_pay: {
                            action_type_cd: ''
                        }
                    },
                    payment: [],
                    refund: [],
                    relevance: {},
                    return: {},
                    ship: {}
                },
                paymentState: {
                    0: '待确认',
                    1: '待付款',
                    2: '待出账',
                    3: '已完成',
                    4: '待会计审核',
                    5: '已删除',
                    6: '待业务审核'
                },
                relevance_id: '',
                rulesDeductible: {
                    deduction_type_cd: [{
                        required: true,
                        message: '请选择类型',
                        trigger: 'change'
                    }],
                    deduction_amount: [{
                        required: true,
                        message: '请输入算作抵扣金金额',
                        trigger: 'change'
                    }],
                    deduction_voucher: [{
                        required: true,
                        message: '请上传沟通凭证',
                        trigger: 'change'
                    }]
                },
                deductibleForm: {
                    deduction_type_cd: '',
                    deduction_amount: '',
                    remark: '',
                    deduction_voucher: []
                },
                addDeductibleDialog: false,
                isSellSmallTeam:false

            },
            created() {
                this.relevance_id = getQueryVariable('relevance_id');
                this.getBaseData();
                this.getLog();
                this.getDetail();
            },
            computed: {
                /**
                 * 计算合计
                 * @returns {{shipped_number: number, goods_number: number, out_number: number, unit_expense: number, unit_price_not_contain_tax: number, warehouse_number_broken: number, return_out_store_number: number, unit_price: number, warehouse_number: number, return_number: number, delivered_number: number, ship_end_number: number}}
                 */
                countTotal: function() {
                    var tempTotal = {
                        unit_price: 0,
                        unit_price_not_contain_tax: 0,
                        unit_expense: 0,
                        goods_number: 0,
                        shipped_number: 0,
                        warehouse_number: 0,
                        warehouse_number_broken: 0,
                        delivered_number: 0,
                        out_number: 0,
                        ship_end_number: 0,
                        return_number: 0,
                        return_out_store_number: 0,
                        sell_small_team_number: 0
                    };
                    this.detailData.goods.forEach(function(item) {
                        for (var key in tempTotal) {
                            if (key === 'delivered_number') {
                                tempTotal[key] += +item.goods_number + +item.return_number - +item.ship_end_number - +item.shipped_number;
                            } else if (key === 'out_number') {
                                tempTotal[key] += +item.unwarehoused_number;
                            } else if (key === 'unit_price') {
                                tempTotal[key] += +item.unit_price * +item.goods_number;
                            } else if (key === 'unit_price_not_contain_tax') {
                                tempTotal[key] += +item.unit_price_not_contain_tax * +item.goods_number;
                            } else if (key === 'unit_expense') {
                                tempTotal[key] += +item.unit_expense * +item.goods_number;
                            } else if (key === 'sell_small_team_number') {
                                var sell_small_team_arr = item.sell_small_team_arr
                                var sum = 0
                                for (const item2 in sell_small_team_arr) {
                                    sum += Number(sell_small_team_arr[item2].number)
                                }
                                tempTotal[key] += sum;
                            } else {
                                tempTotal[key] += +item[key]
                            }
                        }
                    });
                    return tempTotal
                }
            },
            methods: {
                /**
                 * 数组分割方法
                 */
                spilt:function(arr){
                    var result = [];
                    for(var i=0,len=arr.length;i<len;i+=5){
                        result.push(arr.slice(i,i+5));
                    }
                    return result
                },
                /**
                 *  查询ProductKey
                 */
                searchProductKey:function(data){
                    var _this = this;
                    axios.post(this.prouductUrl,{
                        "search":{
                            "sku_id":data.sku_information,
                            "order_id":_this.detailData.order.order_id
                        }}).then(function(res) {
                        if(res.data.code === 200){
                            _this.dialogTableVisible = true;
                            var arr = res.data.data.product_keys
                            _this.ProductKeyData = _this.spilt(arr)
                        }
                    }).catch(function(err) {console.log(err)});
                },
                handleSizeChange: function(size) {
                    this.logSearch.rows = size;
                    this.getLog();
                },
                handleCurrentChange: function(currentPage) {
                    this.logSearch.p = currentPage;
                    this.getLog();
                },
                handleSuccess: function(res, file, fileList) {
                    this.fileList = fileList;
                    this.cancelForm.cancel_voucher = {
                        save_name: res.info.savename,
                        original_name: res.info.name
                    }
                },
                handleSuccessDeductible: function(res, file, fileList) {
                    console.log(fileList)
                    this.deductibleForm.deduction_voucher = fileList;
                    // this.deductibleForm.deduction_voucher = {
                    //   savename: res.info.savename,
                    //   name: res.info.name
                    // }
                },
                handleRemoveDeductible: function(file, fileList) {
                    this.deductibleForm.deduction_voucher = fileList;
                },
                /**
                 * 过滤同名文件
                 * */

                beforeUpload: function(file) {
                    var flag = true;
                    var _this = this;
                    var length = this.deductibleForm.deduction_voucher.length;
                    if (length) {
                        for (var i = 0; i < length; i++) {
                            if (file.name === _this.deductibleForm.deduction_voucher[i].name) {
                                flag = false;
                            }
                        }
                    }
                    if (!flag) {
                        _this.$message({
                            message: _this.$lang('不能上传同名文件'),
                            type: 'error'
                        });
                    }
                    return flag;
                },
                /**
                 * 待付款、待发货、待入库、无退款、无退货的采购单可以取消
                 */
                doCancelOrder: function() {
                    var _this = this;
                    this.cancelForm.relevance_id = _this.relevance_id;
                    if (this.detailData.relevance.ship_status != '0' ||
                        this.detailData.relevance.warehouse_status != '0' ||
                        this.detailData.relevance.payment_status != '0' ||
                        this.detailData.relevance.has_refund != '0' ||
                        this.detailData.relevance.has_return_goods != '0') {
                        _this.$message({
                            message: _this.$lang('只有 待付款、待发货、待入库、无退款、无退货的采购单可以取消'),
                            type: 'error'
                        });
                    } else {
                        axios.post("/index.php?m=order_detail&a=order_cancel", _this.cancelForm).then(function(res) {
                            if (res.data.code == 2000) {
                                _this.$message({
                                    message: res.data.msg,
                                    type: 'success'
                                });
                                setTimeout(function() {
                                    window.location.reload();
                                }, 2000)
                            } else {
                                _this.$message({
                                    message: res.data.msg,
                                    type: 'error'
                                });
                            }
                        })
                    }
                },
                /**
                 * 获取日志信息
                 */
                getLog: function() {
                    var _this = this;
                    var param = {
                        relevance_id: this.relevance_id,
                        p: this.logSearch.p,
                        rows: this.logSearch.rows
                    };
                    axios.post("/index.php?g=purchase&m=relevance&a=action_log", param).then(function(res) {
                        if (res.data.code == 2000) {
                            _this.logData = res.data.data.list;
                            _this.totalCount = +res.data.data.page.total_rows;
                        }
                    })
                },
                // 显示商品大图
                showImg: function showImg(item) {
                    Vue.set(item, 'bigImg', !item.bigImg);
                },
                // 获取基础数据
                getBaseData: function() {
                    var _this = this;
                    var param = {
                        cd_type: {
                            deduction_type: false
                        }
                    };
                    axios.post("/index.php?g=common&m=index&a=get_cd", param).then(function(res) {
                        if (res.data.code == 2000) {
                            _this.baseData = res.data.data;
                        }
                    })
                },
                /**
                 * 跳转页面
                 * @param type 页面类型
                 * @param id 传入id
                 */
                toDetail(type, id) {
                    var _this = this;
                    var _href = '';
                    var _title = '';
                    switch (type) {
                        case 'ship':
                            _href = '/index.php?m=order_detail&a=ship&id=' + _this.relevance_id;
                            _title = _this.$lang('发货操作页');
                            break;
                        case 'invoice':
                            _href = '/index.php?m=order_detail&a=invoice_add&relevance_id=' + _this.relevance_id;
                            _title = _this.$lang('收到发票详情页');
                            break;
                        case 'return':
                            _href = '/index.php?m=order_detail&a=initiate_return';
                            _title = _this.$lang('发起退货');
                            break;
                        case 'refund':
                            _href = '/index.php?m=b2b&a=receipt_claim_list';
                            _title = _this.$lang('收款认领列表');
                            break;
                        case 'payment':
                            _href = '/index.php?m=order_detail&a=payable_detail&id=' + id;
                            _title = _this.$lang('应付详情页');
                            break;
                        case 'moneySure':
                            _href = '/index.php?m=order_detail&a=payable_confirm&id=' + id;
                            _title = _this.$lang('金额确认页');
                            break;
                        case 'shipDetail':
                            _href = '/index.php?m=order_detail&a=warehouse_detail&id=' + id;
                            _title = _this.$lang('入库详情页');
                            break;
                        case 'claim':
                            _href = '/index.php?m=b2b&a=receipt_claim_detail&account_transfer_no=' + id;
                            _title = _this.$lang('收款认领详情页');
                            break;
                        case 'returnDetail':
                            _href = '/index.php?m=order_detail&a=return_detail&id=' + id;
                            _title = _this.$lang('退货详情页');
                            break;
                        case 'tally':
                            _href = '/index.php?m=order_detail&a=return_detail&id=' + id + '&do=do';
                            _title = _this.$lang('理货详情页');
                            break;
                        case 'invoiceDetail':
                            _href = '/index.php?m=order_detail&a=invoice_info&relevance_id=' + _this.relevance_id;
                            _title = _this.$lang('发票详情页');
                            break;
                        case 'invoiceItem':
                            _href = '/index.php?m=order_detail&a=invoice_detail&id=' + id;
                            _title = _this.$lang('收发票记录的详情');
                            break;
                        default:
                            break;
                    }
                    var dom = document.createElement('a');
                    dom.setAttribute("onclick", "opennewtab(this,'" + _title + "')");
                    dom.setAttribute("_href", _href);
                    dom.click();
                },
                /**
                 * 标记完结发货
                 */
                shipFinished: function() {
                    var _this = this;
                    _this.confirmDialog = false;
                    _this.shipFinishedLoading = true;

                    /*
                     ** 撤回前弹框提示用户本次操作将生成的应付金
                     */
                    const postData = {
                        action_type_cd: 'N002870017',
                        money_type: '2',
                        relevance_id: _this.relevance_id
                    }

                    // 通过接口获取抵扣金
                    axios.post('/index.php?m=order_detail&a=get_operation_amount', postData).then((res) => {
                        if (res.data.code === 200) {
                            // 弹框提示本次操作将产生的应付金
                            _this.shipFinishedData = res.data.data.end_pay_info;
                            if (res.data.data.is_show == '1' || res.data.data.is_show == 1) {
                                _this.shipFinishedDialog = true;
                            } else {
                                _this.doShipFinish();
                            }
                        } else {
                            this.$message.error(this.$lang(res.data.msg));
                        }
                        _this.shipFinishedLoading = false;
                    }).catch(() => {})
                },
                doShipFinish: function doShipFinish() {
                    var _this = this;
                    _this.shipFinishedDialog = false;
                    var param = {
                        relevance_id: this.relevance_id
                    };
                    _this.isLoaded = true;
                    axios.post('/index.php?m=order_detail&a=ship_end', param)
                        .then(function(response) {
                            if (response.data.code == 2000) {
                                _this.$message.success(_this.$lang(response.data.msg));
                                _this.getDetail()
                            } else {
                                _this.$message.error(_this.$lang(response.data.msg));
                            }
                            setTimeout(function() {
                                _this.isLoaded = false;
                            }, 100)

                        }).catch(function(err) {
                            _this.isLoaded = false;
                            console.log(err);
                        });
                },
                /**
                 * 撤回
                 * @param id
                 */
                backReturn: function(id) {
                    var _this = this;

                    /*
                     ** 撤回前弹框提示用户本次操作将生成的抵扣金
                     */
                    const postData = {
                        action_type_cd: 'N002870013',
                        money_type: '2',
                        money_id: id
                    }
                    let tipString = this.$lang('本操作将生成采购余额')+'：'

                    // 通过接口获取抵扣金
                    axios.post('/index.php?m=order_detail&a=get_operation_amount', postData).then((res) => {
                        const resData = res.data.data
                        if (res.data.code === 200) {

                            // 弹框提示本次操作将产生的抵扣金
                            tipString = tipString + resData.end_pay_info.currency_type + resData.end_pay_info.amount
                            if (resData.is_show == '1') {
                                this.$confirm(tipString, '提示', {
                                    confirmButtonText: '确定',
                                    cancelButtonText: '取消',
                                    type: 'info'
                                }).then(() => {
                                    var param = {
                                        id: id
                                    };
                                    axios.post('/index.php?m=order_detail&a=ship_revoke', param)
                                        .then(function(response) {
                                            if (response.data.code == 2000) {
                                                _this.$message.success(_this.$lang(response.data.msg));
                                                setTimeout(function() {
                                                    window.location.reload()
                                                }, 1500)
                                            } else {
                                                _this.$message.error(_this.$lang(response.data.msg));
                                            }
                                        }).catch(function(err) {
                                            console.log(err);
                                        });
                                }).catch(() => {});
                            } else {
                                var param = {
                                    id: id
                                };
                                axios.post('/index.php?m=order_detail&a=ship_revoke', param)
                                    .then(function(response) {
                                        if (response.data.code == 2000) {
                                            _this.$message.success(_this.$lang(response.data.msg));
                                            setTimeout(function() {
                                                window.location.reload()
                                            }, 1500)
                                        } else {
                                            _this.$message.error(_this.$lang(response.data.msg));
                                        }
                                    }).catch(function(err) {
                                        console.log(err);
                                    });
                            }

                        } else {
                            this.$message.error(this.$lang(res.data.msg));
                        }
                    }).catch(() => {})

                },
                /**
                 * 收到发票
                 */
                doInvoiceFinish: function() {
                    var _this = this;
                    var param = {
                        relevance_id: this.relevance_id
                    };
                    axios.post('/index.php?m=order_detail&a=invoice_end', param)
                        .then(function(response) {
                            if (response.data.code == 2000) {
                                _this.$message.success(_this.$lang(response.data.msg));
                                setTimeout(function() {
                                    window.location.reload()
                                }, 1500)
                            } else {
                                _this.$message.error(_this.$lang(response.data.msg));
                            }
                        }).catch(function(err) {
                            console.log(err);
                        });
                },
                /**
                 * 撤回开票完结
                 */
                invoiceEndWithdraw: function() {
                    var _this = this;
                    var param = {
                        relevance_id: this.relevance_id
                    };
                    axios.post('/index.php?m=order_detail&a=invoiceEndWithdraw', param)
                        .then(function(response) {
                            if (response.data.code == 2000) {
                                _this.$message.success(_this.$lang(response.data.msg));
                                setTimeout(function() {
                                    window.location.reload()
                                }, 1500)
                            } else {
                                _this.$message.error(_this.$lang(response.data.msg));
                            }
                        }).catch(function(err) {
                            console.log(err);
                        });
                },
                // 获取详情信息
                getDetail: function getDetail(data) {
                    var _this = this;
                    var param = {
                        relevance_id: this.relevance_id
                    };
                    axios.post('/index.php?g=purchase&m=relevance&a=order_detail', param)
                        .then(function(response) {
                            if (response.data.code == 2000) {
                                _this.detailData = response.data.data;
                                // 已取消订单所有按钮不显示
                                _this.isFinishedStatus = response.data.data.relevance.order_status === 'N001320500';
                                var temp = _this.detailData.order.payment_info;
                                if (_this.detailData.order.attachment) {
                                    _this.detailData.order.attachmentArr = JSON.parse(_this.detailData.order.attachment);
                                }

                                if(_this.detailData.order.has_small_team == 'Y'){
                                    _this.isSellSmallTeam = true
                                }
                                
                                // if(_this.detailData.goods.length != 0){
                                //     var goodsArr = _this.detailData.goods
                                //     for (var item in goodsArr) {
                                //       if(goodsArr[item].sell_small_team_arr.length != 0){
                                //         _this.isSellSmallTeam = true
                                //       }
                                //     }
                                // }
                                var tempArr = [];
                                for (var key in temp) {
                                    tempArr.push(temp[key])
                                }
                                _this.payment_infos = tempArr;
                            } else {
                                _this.$message.error(_this.$lang(response.data.info));
                            }
                        });
                },

                doAddDeduction: function() {
                    var _this = this;
                    var voucher = [];
                    this.deductibleForm.deduction_voucher.forEach(function(el) {
                        voucher.push({
                            name: el.response.info.name,
                            savename: el.response.info.savename
                        })
                    });
                    var param = {
                        "supplier_new_id": this.detailData.order.supplier_new_id,
                        "sp_charter_no": this.detailData.order.sp_charter_no,
                        "supplier_name_cn": this.detailData.order.supplier_id,
                        "supplier_name_en": this.detailData.order.supplier_id_en,
                        "our_company_cd": this.detailData.order.our_company,
                        "our_company_name": this.detailData.order.our_company_val,
                        "deduction_currency_cd": this.detailData.order.amount_currency,
                        "deduction_type_cd": this.deductibleForm.deduction_type_cd,
                        "deduction_amount": this.deductibleForm.deduction_amount,
                        "remark": this.deductibleForm.remark,
                        "deduction_voucher": voucher,
                        "order_no": this.detailData.order.procurement_number,
                        "turnover_type": "2"
                    };
                    this.$refs['deductibleForm'].validate((valid) => {
                        if (valid) {
                            axios.post('/index.php?g=purchase&m=deduction&a=addDeductionAmount', param)
                            // axios.post('/index.php?m=order_detail&a=addDeductionAmount', param)
                                .then(function(response) {
                                    if (response.data.code == 200) {
                                        _this.$message.success(_this.$lang(response.data.msg));
                                        _this.addDeductibleDialog = false;
                                        _this.getDetail();
                                    } else {
                                        _this.$message.error(_this.$lang(response.data.msg));
                                    }
                                }).catch(function(err) {
                                    console.log(err);
                                });

                        } else {
                            console.log('error submit!!');
                            return false;
                        }
                    });
                },
                /**
                 * 取消 抵扣金
                 * @param id 抵扣金 ID
                 */
                cancelDeduction: function(id) {
                    var _this = this;
                    var param = {
                        "deduction_detail_id": id
                    };
                    axios.post('/index.php?g=purchase&m=deduction&a=cancelDeductionAmount', param)
                    // axios.post('/index.php?m=order_detail&a=cancelDeductionAmount', param)
                        .then(function(response) {
                            if (response.data.code == 200) {
                                _this.$message.success(_this.$lang(response.data.msg));
                                _this.getDetail();
                            } else {
                                _this.$message.error(_this.$lang(response.data.msg));
                            }
                        }).catch(function(err) {
                            console.log(err);
                        });
                },
                showAddDialog: function() {
                    var _this = this;
                    this.addDeductibleDialog = true;
                    setTimeout(function() {
                        _this.$refs['deductibleForm'].resetFields();
                    }, 50);
                },
                showDetail:function(type){
                    if(type == 'purchaseBalance'){
                        _href = '/index.php?m=order_detail&a=deduction_list&supplier_new_id=' + this.detailData.order.supplier_new_id + '&our_company=' + this.detailData.order.our_company + '&currency=' + this.detailData.order.currency;
                        _title = this.$lang('采购余额列表');
                    }else{
                        _href = '/index.php?m=order_detail&a=compensation_rebates_list&procurement_number=' + this.detailData.order.procurement_number;
                        _title = this.$lang('返利、赔偿金列表');
                    }
                    var dom = document.createElement('a');
                    dom.setAttribute("onclick", "opennewtab(this,'" + _title + "')");
                    dom.setAttribute("_href", _href);
                    dom.click();
                },
                // 撤销发货完结
                backFinished: function() {
                    var _this = this;
                    _this.backFinishedDataLoading = true;

                    /*
                     ** 撤回前弹框提示用户本次操作将生成的应付金
                     */
                    const postData = {
                        action_type_cd: 'N002870018',
                        money_type: '1',
                        relevance_id: _this.relevance_id
                    }

                    // 通过接口获取抵扣金
                    axios.post('/index.php?m=order_detail&a=get_operation_amount', postData).then((res) => {
                        if (res.data.code === 200) {
                            // 弹框提示本次操作将产生的应付金 
                            _this.backFinishedData = res.data.data.pre_pay_info;
                            if (res.data.data.is_show == '1' || res.data.data.is_show == 1) {
                                _this.backFinishedDialog = true;
                            } else {
                                _this.doBackFinish();
                            }
                        } else {
                            this.$message.error(this.$lang(res.data.msg));
                        }
                        _this.backFinishedDataLoading = false;
                    }).catch(() => {})

                },
                doBackFinish: function() {
                    var _this = this;
                    _this.backFinishedDialog = false;
                    var param = {
                        relevance_id: this.relevance_id
                    };
                    _this.isLoaded = true;
                    axios.post('/index.php?m=order_detail&a=reverse_ship_end', param)
                        .then(function(response) {
                            if (response.data.code == 2000) {
                                _this.$message.success(_this.$lang(response.data.msg));
                                _this.getDetail();
                            } else {
                                _this.$message.error(_this.$lang(response.data.msg));
                            }
                            setTimeout(function() {
                                _this.isLoaded = false;
                            }, 100)
                        }).catch(function(err) {
                            _this.isLoaded = false;
                            console.log(err);
                        });
                }
            },
            filters: {
                separatNum: function(num) { //千分位方法
                    var num = Number(num).toFixed(2);
                    num = num + "";
                    var _arr = num.split(".");
                    return _arr[1] === "00" ? (num - 0).toLocaleString() + ".00" : (num - 0).toLocaleString();
                },
                percentage: function(num) {
                    return num ? ((num * 100).toFixed(2) + "%") : '';
                },
            }
        });

        //获取url参数
        function getQueryVariable(variable) {
            var query = window.location.search.substring(1);
            var vars = query.split("&");
            for (var i = 0; i < vars.length; i++) {
                var pair = vars[i].split("=");
                if (pair[0] == variable) {
                    return pair[1];
                }
            }
            return false;
        }

        //时间戳转日期
        function _formatDate(date, fmt) {
            if (/(y+)/.test(fmt)) {
                fmt = fmt.replace(RegExp.$1, (date.getFullYear() + '').substr(4 - RegExp.$1.length));
            }
            var o = {
                'M+': date.getMonth() + 1,
                'd+': date.getDate(),
                'h+': date.getHours(),
                'm+': date.getMinutes(),
                's+': date.getSeconds()
            };
            for (var k in o) {
                if (new RegExp('(' + k + ')').test(fmt)) {
                    var str = o[k] + '';
                    fmt = fmt.replace(RegExp.$1, RegExp.$1.length === 1 ? str : padLeftZero(str));
                }
            }
            return fmt;
        }

        function padLeftZero(str) {
            return ('00' + str).substr(str.length);
        };
    </script>
</body>

</html>