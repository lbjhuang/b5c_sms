<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="./Application/Tpl/Home/Public/utils/css/public.style.css?v=<{$Think.const.V}>">
    <link rel="stylesheet" href="./Application/Tpl/Home/Public/css/element-ui-2.2.css?v=<{$Think.const.V}>">
    <link rel="stylesheet" href="./Application/Tpl/Home/Public/css/normailize.css?v=<{$Think.const.V}>">
    <link rel="stylesheet" href="./Application/Tpl/Home/Public/icon/css/font-awesome.min.css?v=<{$Think.const.V}>">
    <link rel="stylesheet" href="./Application/Tpl/Oms/Public/css/list_common.css?v=<{$Think.const.V}>">
    <link rel="stylesheet" href="./Application/Tpl/Oms/Order/orderList.css?v=<{$Think.const.V}>">
    <link rel="stylesheet" href="./Application/Tpl/Home/Public/css/default.css?v=<{$Think.const.V}>">
    <title>现存量查询列表</title>
    <style>
        v-cloak {
            display: none;
        }

        .el-table__expand-icon--expanded {
            transform: rotate(0deg) !important;
        }

        .el-table__expand-icon.el-table__expand-icon--expanded .el-icon-arrow-right:before {
            content: '\E621';
            font-size: 18px;
        }

        .el-table .cell,
        .el-table th div,
        .el-table--border td:first-child .cell,
        .el-table--border th:first-child .cell {
            padding: 0px 2px;
        }

        .el-table__expand-icon .el-icon-arrow-right:before {
            content: '\E62B';
            /* border: 1px solid #4444; */
            padding: 4px;
            font-size: 18px;
            color: #fff;
            background: #1e7eb4;
        }

        .order-list-table.table-common tr td {
            padding: 8px 2px;
        }

        .el-table__expand-icon>.el-icon {
            position: absolute;
            left: 50%;
            top: 50%;
            margin-left: -12px;
            margin-top: -9px;
        }

        span.shopTag>span {
            position: absolute !important;
            top: 0px;
            left: 0px;
            border-radius: 0px;
            background-color: #f99c64;
            border: 1px solid rgb(231, 156, 116) !important;
        }

        .el-popover {
            text-align: left !important;
        }

        .guds-item {
            width: 156px;
            float: left;
            padding: 5px 0px;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }

        .count-item {
            padding: 5px 0px;
            float: right;
            font-weight: 600;
            font-size: 14px
        }

        .el-table .cell {
            word-break: break-word !important;
        }

        .ellipsis {
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
            cursor: pointer;
        }

        .sort-item {
            width: 420px;
        }

        .el-input {
            width: 320px;
        }

        .el-date-editor {
            width: 320px !important;
        }

        .title_info {
            display: inline-block;
            width: 80px;
        }

        .el-select {
            padding: 0;
        }

        .num-bold {
            font-style: normal;
        }

        .export-order {
            float: right;
        }

        #order-list {
            visibility: visible;
        }

        .small-img {
            width: 40px;
            height: 40px;
        }

        .child-list-table.table-common tr th {
            background-color: #f5fafe;
            color: #434343;
            font-size: 12px;
        }

        .preview-wrap {
            position: relative;
            display: inline-block;
            width: 100%;
        }

        .preview-wrap img {
            cursor: pointer;
        }

        .preview-wrap .big-img {
            position: absolute;
            bottom: 0px;
            left: 115px;
            z-index: 9999;
            background-color: #fff;
            box-shadow: 1px 1px 4px #606266;
        }

        .sort-item {
            display: flex;
            align-items: center;
        }

        .sort-item>span {
            padding-right: 10px;
        }

        .clickable-item {
            text-decoration: underline;
            color: #1E7EB4;
            cursor: pointer;
        }

        .clickable-item-child {
            text-decoration: underline;
            color: #e0152f;
            cursor: pointer;
        }

        .el-dialog__header {
            display: block;
        }

        .el-dialog__body,
        .el-tabs--border-card {
            padding: 10px 20px 30px !important;
        }

        .main-occupy-search .el-input {
            margin-right: 20px;
        }

        .btns .btn-reset.inner-reset,
        .btns .btn-search.inner-search {
            height: 32px;
            width: 80px;
            margin-right: 20px;
        }

        .el-pagination {
            float: none;
            margin-bottom: 20px;
            text-align: right;
        }

        .el-date-editor .el-range-input {
            width: 35%;
        }

        form input {
            visibility: hidden;
        }

        .icon-item {
            position: absolute;
            bottom: 0px;
            right: 0px;
            width: 32px;
            height: 18px;
            color: #fff;
            background-color: #f99c64;
        }

        .el-table__expanded-cell {
            overflow: auto !important;
        }
        .list-common-main > header {
            height: auto;
        }
        .downloadDialog .el-dialog__header{
            display: block;
        }
        .downloadDialog .el-dialog--center .el-dialog__body{
            text-align: center;
        }
        .el-loading-spinner {
            top: 300px;
            margin-top: -21px;
            position: fixed;
        }
        #ProductKey .has-gutter{
            display: none;
        }
        .white-space {
            /* white-space:pre */
            white-space:pre-wrap;
        }
    </style>
</head>

<body class="orderList">
<div id="order-list" class="list-common" style="margin-bottom:220px;" v-cloak v-loading="loading">
    <!-- 搜索查询 start-->
    <div class="orderList-search search-common">
        <div class="search-toggle">
            <el-row type="flex">
                <el-col :span="4" class="title-info-container">
                    <div class="title-info" style="line-height: 20px;color: #000000">{{$lang('总在库天数')}}</div>
                </el-col>
                <el-col :span="22" class="search-item-i">
                    <span :class="{active:!existed_daysData.length}" @click="selectDaysLevel()">{{$lang('全部')}}</span>
                    <span :class="{active:dayLevel.checked}" v-for="dayLevel in existed_days_level" :data-cd="dayLevel.cd" @click="selectDaysLevel(dayLevel)">{{$lang(dayLevel.cdVal)}}</span>
                </el-col>
            </el-row>
        </div>
        <div class='cls' style="height:auto;">
            <div class="fl sort-item">
                <span class="title_info ellipsis" :title="$lang('SKU/自编码/条形码')">{{$lang('SKU/自编码/条形码')}}</span>
                <el-input size="small" :placeholder="$lang('SKU/自编码/条形码')" v-model="multipleCodes"></el-input>
            </div>
            <div class="fl sort-item">
                <span class="title_info">{{$lang('商品名称')}}</span>
                <el-input size="small" :placeholder="$lang('商品名称')" v-model="gudsName"></el-input>
            </div>
            <div class="fl sort-item">
                <span class="title_info">{{$lang('归属仓库类型')}}</span>
                <el-select :popper-append-to-body=false filterable size="small" :multiple-limit=10 v-model="selectedType" multiple collapse-tags :placeholder="$lang('选择仓库')" style="width:300px" @change="filterWarehouses">
                    <el-option :disabled="selectedTypeStatus" v-for="item in warehouse_type" :key="item.cd" :label="$lang(item.cdVal)" :value="item.cd">
                    </el-option>
                </el-select>
            </div>
            <div class="fl sort-item">
                <span class="title_info">{{$lang('归属仓库运营方')}}</span>
                <el-select :popper-append-to-body=false filterable size="small" :multiple-limit=10 v-model="selectedOperator" multiple collapse-tags :placeholder="$lang('选择仓库')" @change="filterWarehouses" style="width:300px">
                    <el-option v-for="item in warehouse_operator" :key="item.cd" :label="$lang(item.cdVal)" :value="item.cd">
                    </el-option>
                </el-select>
            </div>
            <div class="fl sort-item">
                <span class="title_info">{{$lang('归属仓库')}}</span>
                <el-select :popper-append-to-body=false filterable size="small" :multiple-limit=10 v-model="selectedWarehouses" multiple collapse-tags :placeholder="$lang('选择仓库')" style="width:300px">
                    <el-option v-for="warehouseItem in warehouseList" :key="warehouseItem.CD" :label="$lang(warehouseItem.CD_VAL)" :value="warehouseItem.CD">
                    </el-option>
                </el-select>
            </div>
            <div class="fl sort-item">
                <span class="title_info">{{$lang('采购单号')}}</span>
                <el-input size="small" :placeholder="$lang('采购单号')" v-model="purchaseNo"></el-input>
            </div>
            <div class="fl sort-item">
                <span class="title_info">{{$lang('销售团队')}}</span>
                <el-select :popper-append-to-body=false filterable size="small" :multiple-limit=10 v-model="selectedSaleTeam" multiple collapse-tags :placeholder="$lang('销售团队')" style="width:300px">
                    <el-option v-for="(shippingMethodsItem,key) in saleTeamList" :key="key" :label="$lang(shippingMethodsItem)" :value="key">
                    </el-option>
                </el-select>
            </div>
            <div class="fl sort-item">
                <span class="title_info">{{$lang('采购团队')}}</span>
                <el-select :popper-append-to-body=false filterable size="small" :multiple-limit=10 v-model="selectedPurchaseTeam" multiple collapse-tags :placeholder="$lang('采购团队')" style="width:300px">
                    <el-option v-for="(salesTeamItem,key) in purchaseTeamList" :key="key" :label="$lang(salesTeamItem)" :value="key">
                    </el-option>
                </el-select>
            </div>
            <div class="fl sort-item">
                <span class="title_info">{{$lang('所属公司')}}</span>
                <el-select :popper-append-to-body=false filterable size="small" :multiple-limit=10 v-model="ownedComp" multiple collapse-tags :placeholder="$lang('所属公司')" style="width:300px">
                    <el-option v-for="salesTeamItem in compList" :key="salesTeamItem.cd" :label="$lang(salesTeamItem.cdVal)" :value="salesTeamItem.cd">
                    </el-option>
                </el-select>
            </div>
            <div class="fl sort-item">
                <span class="title_info">{{$lang('采购时间')}}</span>
                <el-date-picker value-format="yyyy-MM-dd" size="small" v-model="purchaseTime" type="daterange" align="right" unlink-panels>
                </el-date-picker>
            </div>
            <div class="fl sort-item">
                <span class="title_info">{{$lang('入库时间')}}</span>
                <el-date-picker value-format="yyyy-MM-dd" size="small" v-model="inTime" type="daterange" align="right" unlink-panels>
                </el-date-picker>
            </div>
            <div class="fl sort-item">
                <span class="title_info">{{$lang('到期时间')}}</span>
                <el-date-picker value-format="yyyy-MM-dd" size="small" v-model="endTime" type="daterange" align="right" unlink-panels>
                </el-date-picker>
            </div>
            <div class="fl sort-item">
                <span class="title_info">{{$lang('是否滞销')}}</span>
                <el-select :popper-append-to-body=false filterable size="small" :multiple-limit=10 v-model="unSalable" collapse-tags :placeholder="$lang('是否滞销')" style="width:300px">
                    <el-option v-for="salesTeamItem in unSalableList" :key="salesTeamItem.value" :label="$lang(salesTeamItem.label)" :value="salesTeamItem.value">
                    </el-option>
                </el-select>
            </div>
            <div class="fl sort-item">
                <span class="title_info">{{$lang('商品类型')}}</span>
                <el-select :popper-append-to-body=false filterable size="small" :multiple-limit=10 v-model="productType" collapse-tags :placeholder="$lang('全部')" style="width:300px">
                    <el-option v-for="product in productTypeList" :key="product.CD" :label="$lang(product.CD_VAL)" :value="product.CD">
                    </el-option>
                </el-select>
            </div>

            <!-- <div class="fl sort-item">
                <span class="title_info">{{$lang('归属店铺')}}</span>
                <el-select :popper-append-to-body=false multiple filterable size="small" :multiple-limit=10 v-model="ascription_store" collapse-tags :placeholder="$lang('选择归属店铺')" style="width:300px">
                    <el-option v-for="(ascription,index) in ascriptionstore_list" :key="index" :label="ascription.nickName" :value="ascription.realName">
                    </el-option>
                </el-select>
            </div> -->
            <div class="fl sort-item">
                <span class="title_info">{{$lang('销售小团队')}}</span>
                <el-select :popper-append-to-body=false multiple filterable size="small" :multiple-limit=10 v-model="sell_small_team_cd" collapse-tags :placeholder="$lang('选择销售小团队')" style="width:300px">
                    <el-option v-for="(item,index) in sell_small_team" :key="index" :label="$lang(item)" :value="index">
                    </el-option>
                </el-select>
            </div>
            <div class="fl sort-item">
                <span class="title_info">{{$lang('品牌类型')}}</span>
                <el-select :popper-append-to-body=false filterable size="small" :multiple-limit=10 v-model="is_oem_brand[0]" collapse-tags :placeholder="$lang('全部')" style="width:300px">
                    <el-option v-for="(v,k) in odm" :key="k" :label="$lang(v.v)" :value="v.k"></el-option>
                    </el-option>
                </el-select>
            </div>
            <!-- <div class="fl sort-item">
                <span class="title_info">{{$lang('总在库天数')}}</span>
                <div style="width: 320px;display: flex;line-height: 32px;">
                    <div class="el-input el-input--small">
                        <input ref="inStoreDaysOne" @input="checkInStoreDays($event.target,'1')" @blur="blurInStoreDays($event.target,'1')" @value="inStoreDays.one" size="small" type="text" class="el-input__inner">
                    </div>
                    <span style="padding: 0 8px;">-</span>
                    <div class="el-input el-input--small">
                        <input ref="inStoreDaysTwo" @input="checkInStoreDays($event.target,'2')" @blur="blurInStoreDays($event.target,'2')" @value="inStoreDays.two" size="small" type="text" class="el-input__inner">
                    </div>
                </div>
            </div> -->
        </div>
        <div style="margin-bottom:18px;">
            <el-checkbox v-model="showNoinfoData">{{$lang('显示无库存数据')}}</el-checkbox>
        </div>
        <div class="search-btn-container">
            <div class="btns">
                <button @click="doSearch" class="btn-search" name="search">{{$lang('搜索')}}</button>
                <button @click="doReset" class="btn-reset" name="reset">{{$lang('重置')}}</button>
            </div>
        </div>

        <!-- 搜索查询 end-->

    </div>
    <!-- 分割线 start-->
    <div class="orderList-line line-split"></div>
    <!-- 分割线 end-->

    <!-- 订单表格主体 start-->
    <div class="orderList-Main list-common-main">
        <header>
            <el-row type="flex">
                <el-col :span="22">
                    {{$lang('搜索结果')}}:{{$lang('共')}}
                    <span class="num-bold">{{totalCount}}</span> {{$lang('条记录')}}
                    <!-- <span style="margin-left:20px;">{{$lang('批次数据共')}} : {{batchCount}}</span> {{$lang('条记录')}} -->
                    <!-- 12-18 乐山  度厄要求去掉 -->
                    <span style="margin-left:20px;">{{$lang('SPU个数')}} : <i class="num-bold">{{amountSpu}}</i></span>
                    <span style="margin-left:20px;">{{$lang('SKU个数')}} : <i class="num-bold">{{amountSku}}</i></span>
                    <span style="margin-left:20px;">{{$lang('库存件数')}} : <i class="num-bold">{{amountNumber}}</i></span>
                    <span style="margin-left:20px;">{{$lang('库存总成本（CNY,含增值税）')}} : <i class="num-bold">¥{{amountMoney}}</i></span>
                    <span style="margin-left:20px;">{{$lang('库存总成本（CNY,不含增值税）')}} : <i class="num-bold">¥{{amountMoneyNoTax}}</i></span>
                    <span>{{$lang('库存总成本（USD,含增值税）')}} : <i class="num-bold">${{amountUsdMoney}}</i></span>
                    <span style="margin-left:20px;">{{$lang('库存总成本（USD,不含增值税）')}} : <i class="num-bold">${{amountUsdMoneyNoTax}}</i></span>
                </el-col>
                <el-col :span="8">
                    <button class="export-order" @click="exportCurrentAll">{{$lang('导出当前数据')}}</button>
                    <button class="export-order" @click="exportAll">{{$lang('全部导出')}}</button>
                    <button class="export-order" @click="getExtendExcel()">{{$lang('查看历史现存量')}}</button>
                    <!-- <button class="close-order" @click="closeOrder"><{$Think.lang.关闭订单}></button> -->
                </el-col>
            </el-row>

        </header>
        <el-dialog
            title="提示"
            :visible.sync="downloadDialog"
            width="30%"
            class="downloadDialog"
            center>
            <span>{{$lang('正在下载中，请前往“下载列表”页面查看')}}</span>
            <span slot="footer" class="dialog-footer">
                    <el-button @click="downloadDialog = false">{{$lang('知道了')}}</el-button>
                    <el-button type="primary" @click="toDownload">{{$lang('前往')}}</el-button>
                </span>
        </el-dialog>

        <el-table border show-header ref="multipleTable" :data="tableData" tooltip-effect="dark" style="width: 100%" class="order-list-table table-common main-list" v-loading="tableLoading" @expand-change="expandItem" highlight-current-row>
            <el-table-column width="55" :label="$lang('序号')">
                <template slot-scope="scope">
                    {{scope.$index+1 +(currentPage-1)*pageSize}}
                </template>
            </el-table-column>
            <el-table-column width="55" type="expand" :label="$lang('批次')">
                <template slot-scope="scope">
                    <el-table border show-header :data="scope.row.detail" tooltip-effect="dark" style="width: 100%;" v-loading="scope.row.tableInnerLoading"
                              class="child-list-table table-common">
                        <el-table-column :label="$lang('Product Key')" width="64">
                            <template slot-scope="scope">
                                <div><button @click="searchProductKey(scope.row)" class="btn-search inner-search">{{$lang('查看')}}</button></div>
                            </template>
                        </el-table-column>
                        <el-table-column :label="$lang('批次号')" width="64">
                            <template slot-scope="scope">
                                <div>{{scope.row.batchCode}}</div>
                            </template>
                        </el-table-column>
                        <!-- <el-table-column :label="$lang('是否滞销')" width="100">
                                        <template slot-scope="scope">
                                            <div>{{scope.row.isDrug}}</div>
                                        </template>
                                    </el-table-column> -->
                        <el-table-column :label="$lang('仓库')">
                            <template slot-scope="scope">
                                <div>{{scope.row.warehouse}}</div>
                            </template>
                        </el-table-column>
                        <el-table-column :label="$lang('采购公司')">
                            <template slot-scope="scope">
                                <div>{{scope.row.ourCompany}}</div>

                            </template>
                        </el-table-column>
                        <!-- <el-table-column :label="$lang('归属店铺')">
                            <template slot-scope="scope">
                                <div>{{scope.row.ascription_store_val}}</div>
                            </template>
                        </el-table-column> -->
                        <el-table-column :label="$lang('销售团队')">
                            <template slot-scope="scope">
                                <div>{{scope.row.saleTeam}}</div>

                            </template>
                        </el-table-column>
                        <el-table-column :label="$lang('销售小团队')">
                            <template slot-scope="scope">
                                <div>{{scope.row.smallSaleTeamVal}}</div>
                            </template>
                        </el-table-column>
                        <el-table-column :label="$lang('采购团队')">
                            <template slot-scope="scope">
                                <div>{{scope.row.purTeam}}</div>

                            </template>
                        </el-table-column>

                        <el-table-column :label="$lang('介绍团队')">
                            <template slot-scope="scope">
                                <div>{{scope.row.introTeam}}</div>
                            </template>
                        </el-table-column>
                        <el-table-column :label="$lang('采购单号')" width="84">
                            <template slot-scope="scope">
                                <div>{{scope.row.purNum}}</div>
                            </template>
                        </el-table-column>
                        <el-table-column :label="$lang('采购入库时间')" width="140">
                            <template slot-scope="scope">
                                <div>{{scope.row.purStorageDate}}</div>
                                <div v-if="scope.row.isDrug != 0" class="icon-item">{{scope.row.isDrug != 0 ? $lang('滞销') :''}}</div>
                            </template>
                        </el-table-column>
                        <el-table-column :label="$lang('总在库天数')" width="60">
                            <template slot-scope="scope">
                                <div>{{scope.row.existedDays}}</div>
                            </template>
                        </el-table-column>
                        <el-table-column :label="$lang('入库时间')" width="140">
                            <template slot-scope="scope">
                                <div>{{scope.row.addTime}}</div>
                            </template>
                        </el-table-column>
                        <el-table-column :label="$lang('当前仓在库天数')" width="60">
                            <template slot-scope="scope">
                                <div>{{scope.row.currentExistedDays}}</div>

                            </template>
                        </el-table-column>
                        <el-table-column :label="$lang('到期日')" width="140">
                            <template slot-scope="scope">
                                <div>{{scope.row.deadLineDate}}</div>

                            </template>
                        </el-table-column>
                        <el-table-column :label="$lang('商品类型')" width="90">
                            <template slot-scope="scope">
                                <div>{{scope.row.productType}}</div>

                            </template>
                        </el-table-column>
                        <el-table-column :label="$lang('在库')" width="60">
                            <template slot-scope="scope">
                                <div>{{scope.row.amountTotalNum}}</div>

                            </template>
                        </el-table-column>
                        <el-table-column :label="$lang('可售')" width="60">
                            <template slot-scope="scope">
                                <div>{{scope.row.amountSaleNum}}</div>

                            </template>
                        </el-table-column>
                        <el-table-column :label="$lang('占用')" width="60">
                            <template slot-scope="scope">
                                <div v-bind:class="{'clickable-item-child': (scope.row.amountOccupiedNum != '-' )}" @click="mainOccupy('child',scope.row)">{{scope.row.amountOccupiedNum}}</div>

                            </template>
                        </el-table-column>
                        <el-table-column :label="$lang('锁定')" width="60">
                            <template slot-scope="scope">
                                <div v-bind:class="{'clickable-item-child':(scope.row.amountLockingNum != '-')}" @click="mainLocking('child',scope.row)">{{scope.row.amountLockingNum}}</div>
                            </template>
                        </el-table-column>
                        <el-table-column :label="$lang('采购单价（CNY，不含增值税）')" min-width="120">
                            <template slot-scope="scope">
                                <div>CNY {{scope.row.unitPriceNoTax | numberFormat(4)}}</div>
                            </template>
                        </el-table-column>
                        <el-table-column :label="$lang('PO内费用单价（CNY）')" min-width="120">
                            <template slot-scope="scope">
                                <div>CNY {{scope.row.poLogCost}}</div>
                            </template>
                        </el-table-column>
                        <el-table-column :label="$lang('采购单价（CNY，含增值税）')" min-width="120">
                            <template slot-scope="scope">
                                <div>CNY {{scope.row.unitPrice | numberFormat(4)}}</div>
                            </template>
                        </el-table-column>
                        <el-table-column :label="$lang('批次成本')" v-if="false">
                            <template slot-scope="scope">
                                <div>{{scope.row.amountCost}}</div>
                            </template>
                        </el-table-column>
                        <el-table-column :label="$lang('po物流费')" v-if="false">
                            <template slot-scope="scope">
                                <div>{{scope.row.poLogCost}}</div>

                            </template>
                        </el-table-column>
                        <el-table-column :label="$lang('服务费用单价（CNY）')" width="75">
                            <template slot-scope="scope">
                                <div class="clickable-item-child" @click="mainSimpleClick('serviceCost',scope.row.stream_id)">CNY {{scope.row.logServiceCost}}</div>

                            </template>
                        </el-table-column>
                        <el-table-column :label="$lang('运输费用单价（CNY）')" width="75">
                            <template slot-scope="scope">
                                <div class="clickable-item-child" @click="mainSimpleClick('carryCost',scope.row.stream_id)">CNY {{scope.row.carryCost}}</div>

                            </template>
                        </el-table-column>
                        <el-table-column :label="$lang('仓储费用单价（CNY）')" width="75">
                            <template slot-scope="scope">
                                <div class="clickable-item-child" @click="mainSimpleClick('warehouseCost',scope.row.batchId)">CNY {{scope.row.warehouseCost}}</div>

                            </template>
                        </el-table-column>
                        <el-table-column :label="$lang('关税单价(CNY)')" min-width="120">
                            <template slot-scope="scope">
                                <div class="clickable-item-child" @click="mainSimpleClick('tariff',scope.row.batchId,scope.row)">CNY {{scope.row.tariff_cost}}</div>
                            </template>
                        </el-table-column>
                        <el-table-column :label="$lang('采购币种')" width="75">
                            <template slot-scope="scope">
                                <div >{{scope.row.pur_currency}}</div>

                            </template>
                        </el-table-column>
                        <el-table-column :label="$lang('采购单价（采购币种，含增值税）')" min-width="120">
                            <template slot-scope="scope">
                                <div >{{scope.row.pur_currency}} {{scope.row.unit_price_origin}}</div>

                            </template>
                        </el-table-column>
                        <el-table-column :label="$lang('采购单价（采购币种，不含增值税）')" min-width="120">
                            <template slot-scope="scope">
                                <div >{{scope.row.pur_currency}} {{scope.row.unit_price_no_tax_origin}}</div>

                            </template>
                        </el-table-column>
                        <el-table-column :label="$lang('PO内费用单价（采购币种）')" width="100">
                            <template slot-scope="scope">
                                <div>{{scope.row.pur_currency}} {{scope.row.po_cost_origin}}</div>

                            </template>
                        </el-table-column>
                        <el-table-column :label="$lang('采购单价（USD，含增值税）')" min-width="120">
                            <template slot-scope="scope">
                                <div>USD {{scope.row.unitPriceUsd | numberFormat(4)}}</div>
                            </template>
                        </el-table-column>
                        <el-table-column :label="$lang('采购单价（USD，不含增值税）')" min-width="120">
                            <template slot-scope="scope">
                                <div>USD {{scope.row.unitPriceUsdNoTax | numberFormat(4)}}</div>
                            </template>
                        </el-table-column>
                    </el-table>
                </template>
            </el-table-column>
            <el-table-column :label="$lang('商品图片')" width="100">
                <template slot-scope="scope">
                    <div class="preview-wrap">
                        <img :src="scope.row.imageUrl" width="40" height="40" @mouseover="previewImg(scope.row,'showImg',true)"
                             @mouseout="previewImg(scope.row,'showImg',false)">
                        <div v-if="scope.row.showImg">
                            <img :src="scope.row.imageUrl" width="300" height="300" class="big-img">
                        </div>
                    </div>
                </template>
            </el-table-column>
            <el-table-column :label="$lang('SKU编码')" width="120">
                <template slot-scope="scope">
                    <span>{{scope.row.skuId}}</span>
                </template>
            </el-table-column>
            <el-table-column :label="$lang('类目')" prop="sku_cat_level_name" width="170px"></el-table-column>
            <el-table-column :label="$lang('品牌类型')" width="120">
                <template slot-scope="scope">

                    <span style="white-space: pre-line">{{scope.row.is_oem_brand === '0'?$lang('非ODM品牌'):$lang('ODM品牌')}}</span>
                </template>
            </el-table-column>
            <el-table-column :label="$lang('条形码')" width="124">
                <template slot-scope="scope">
                    <span>{{scope.row.upcId}}</span>
                </template>
            </el-table-column>
            <el-table-column :label="$lang('商品名称')">
                <template slot-scope="scope">
                    <div class="white-space">{{scope.row.gudsName}}</div>
                </template>
            </el-table-column>
            <el-table-column :label="$lang('属性')" width="180">
                <template slot-scope="scope">
                    <div>{{scope.row.optAttr}}</div>
                </template>
            </el-table-column>
            <el-table-column :label="$lang('在库库存')" width="100">
                <template slot-scope="scope">
                    <div>{{scope.row.amountTotalNum}}</div>
                </template>
            </el-table-column>
            <el-table-column :label="$lang('可售库存')" width="80">
                <template slot-scope="scope">
                    <div>{{scope.row.amountSaleNum}}</div>
                </template>
            </el-table-column>
            <el-table-column :label="$lang('占用库存')" width="100">
                <template slot-scope="scope">
                    <div class="clickable-item" @click="mainOccupy('main',scope.row)">{{scope.row.amountOccupiedNum}}</div>
                </template>
            </el-table-column>
            <el-table-column :label="$lang('锁定库存')" width="80">
                <template slot-scope="scope">
                    <div class="clickable-item" @click="mainLocking('main',scope.row)">{{scope.row.amountLockingNum}}</div>
                </template>
            </el-table-column>
            <el-table-column :label="$lang('库存成本（CNY，含增值税）')" width="150">
                <template slot-scope="scope">
                    <div>￥{{scope.row.amountMoney | numberFormat(2)}}</div>
                </template>
            </el-table-column>
            <el-table-column :label="$lang('库存成本（CNY，不含增值税）')" width="150">
                <template slot-scope="scope">
                    <div>￥{{scope.row.amountMoneyNoTax | numberFormat(2)}}</div>
                </template>
            </el-table-column>
            <el-table-column :label="$lang('库存成本（USD，含增值税）')" width="150">
                <template slot-scope="scope">
                    <div>${{scope.row.amountUsdMoney | numberFormat(2)}}</div>
                </template>
            </el-table-column>
            <el-table-column :label="$lang('库存成本（USD，不含增值税）')" width="150">
                <template slot-scope="scope">
                    <div>${{scope.row.amountUsdMoneyNoTax | numberFormat(2)}}</div>
                </template>
            </el-table-column>
        </el-table>
        <el-dialog :title="dialogTitle" :visible.sync="dialogVisibleSimple" :append-to-body='true' :before-close="handleCloseSimple" :close-on-click-modal="false">
            <div>
                <div class="main-occupy-search btns">
                    <el-input size='small' v-model="mainSimpleInput" :placeholder="placeholderSimple"></el-input>
                    <button @click="doDialogSimpleSearch('locking')" class="btn-search inner-search">{{$lang('搜索')}}</button>
                    <button @click="doDialogSimpleReset('locking')" class="btn-reset inner-reset">{{$lang('重置')}}</button>
                </div>
                <p>结果：共{{mainSimpleTotal}}条记录</p>

                <el-table border :data="mainSimpleList" show-header tooltip-effect="dark" style="width: 100%" class="order-list-table table-common main-list" v-loading="dialogLoadingSimple">
                    <template v-if="dialogType === 'carryCost'">
                        <el-table-column :label="$lang('出入库单号')" >
                            <template  slot-scope="scope">
                                <div>{{scope.row.bill_id}}</div>
                            </template>
                        </el-table-column>
                        <el-table-column :label="$lang('均摊费用金额')">
                            <template slot-scope="scope">
                                <div>{{scope.row.carry_cost}}</div>
                            </template>
                        </el-table-column>
                        <el-table-column :label="$lang('费用细分类型')">
                            <template slot-scope="scope">
                                <div>{{scope.row.cost_breakdown_type}}</div>
                            </template>
                        </el-table-column>
                    </template>
                    <template v-else-if="dialogType === 'serviceCost'">
                        <el-table-column :label="$lang('入库单号')" >
                            <template slot-scope="scope">
                                <div>{{scope.row.bill_id}}</div>
                            </template>
                        </el-table-column>
                        <el-table-column :label="$lang('均摊费用金额')">
                            <template slot-scope="scope">
                                <div>{{scope.row.log_service_cost}}</div>
                            </template>
                        </el-table-column>
                        <el-table-column :label="$lang('费用细分类型')">
                            <template slot-scope="scope">
                                <div>{{scope.row.cost_breakdown_type}}</div>
                            </template>
                        </el-table-column>
                    </template>
                    <template v-else-if="dialogType === 'tariff'">
                        <el-table-column :label="$lang('入库单号')" >
                            <template slot-scope="scope">
                                <div>{{scope.row.order_id}}</div>
                            </template>
                        </el-table-column>
                        <el-table-column :label="$lang('均摊费用金额')">
                            <template slot-scope="scope">
                                <div>{{scope.row.amortization_fee_amount}}</div>
                            </template>
                        </el-table-column>
                        <el-table-column :label="$lang('费用细分类型')">
                            <template slot-scope="scope">
                                <div>{{scope.row.cost_breakdown_type}}</div>
                            </template>
                        </el-table-column>
                    </template>
                    <template v-else="dialogType === 'warehouseCost'">
                        <el-table-column :label="$lang('仓库')">
                            <template slot-scope="scope">
                                <div>{{scope.row.warehouse}}</div>
                            </template>
                        </el-table-column>

                        <el-table-column :label="$lang('在库时间')">
                            <template slot-scope="scope">
                                <div>{{scope.row.start_date}} ~ {{scope.row.end_date}}</div>
                            </template>
                        </el-table-column>
                        <el-table-column :label="$lang('本仓库存储均摊费用')">
                            <template slot-scope="scope">
                                <div>{{scope.row.warehouse_cost}}</div>
                            </template>
                        </el-table-column>
                    </template>


                    </template>


                </el-table>
            </div>
        </el-dialog>

        <el-dialog :title="$lang('占用查询')" :visible.sync="dialogVisible" :append-to-body='true' :before-close="handleClose" :close-on-click-modal="false">
            <div>
                <div class="main-occupy-search btns">
                    <el-input size='small' v-model="mainOccupyInput" :placeholder="$lang('按单据号查询')"></el-input>
                    <button @click="doDialogSearch('occupy')" class="btn-search inner-search">{{$lang('查询')}}</button>
                    <button @click="doDialogReset('occupy')" class="btn-reset inner-reset">{{$lang('重置')}}</button>
                </div>
                <p>结果：共{{mainOccupyTotal}}条记录</p>


                <el-table border show-header :data="mainOccupyList" tooltip-effect="dark" style="width: 100%" class="order-list-table table-common main-list" v-loading="dialogLoading">
                    <el-table-column :label="$lang('序号')" width="80">
                        <template slot-scope="scope">
                            <div>{{(scope.$index+1)+(currentPageOccupy-1)*10}}</div>
                        </template>
                    </el-table-column>
                    <el-table-column :label="$lang('单据号')">
                        <template slot-scope="scope">
                            <div style="color:#1E7EB4;cursor: pointer" @click="toDetail(scope.row)">{{scope.row.ordId}}</div>
                        </template>
                    </el-table-column>
                    <el-table-column :label="$lang('数量')" width="150">
                        <template slot-scope="scope">
                            <div>{{scope.row.batchAmountOccupiedNum}}</div>
                        </template>
                    </el-table-column>
                </el-table>
                <el-pagination v-if="mainOccupyPage" background @current-change="handleCurrentChangeOccupy" :current-page.sync="currentPageOccupy" :page-size='defaultPageSize' layout="prev, pager, next, jumper" :total="mainOccupyTotal">
                </el-pagination>
            </div>
        </el-dialog>
        <el-dialog :title="$lang('锁定查询')" :visible.sync="dialogVisibleLocking" :append-to-body='true' :before-close="handleCloseLocking" :close-on-click-modal="false">
            <div>
                <div class="main-occupy-search btns">
                    <el-input size='small' v-model="mainLockingInput" :placeholder="$lang('按订单编号搜索')"></el-input>
                    <button @click="doDialogSearch('locking')" class="btn-search inner-search">{{$lang('搜索')}}</button>
                    <button @click="doDialogReset('locking')" class="btn-reset inner-reset">{{$lang('重置')}}</button>
                </div>
                <p>结果：共{{mainLockingTotal}}条记录</p>


                <el-table border :data="mainLockingList" show-header tooltip-effect="dark" style="width: 100%" class="order-list-table table-common main-list" v-loading="dialogLoadingLocking">
                    <el-table-column :label="$lang('序号')" width="80">
                        <template slot-scope="scope">
                            <div>{{(scope.$index+1)+(currentPageLocking-1)*10}}</div>
                        </template>
                    </el-table-column>
                    <el-table-column :label="$lang('平台')">
                        <template slot-scope="scope">
                            <div>{{scope.row.channel}}</div>
                        </template>
                    </el-table-column>
                    <el-table-column :label="$lang('店铺')">
                        <template slot-scope="scope">
                            <div>{{scope.row.storeName}}</div>
                        </template>
                    </el-table-column>
                    <el-table-column :label="$lang('订单编号')" width="200">
                        <template slot-scope="scope">
                            <div style="color:#1E7EB4">{{scope.row.orderId}}</div>
                        </template>
                    </el-table-column>
                    <el-table-column :label="$lang('SKU编码')">
                        <template slot-scope="scope">
                            <div>{{scope.row.skuId}}</div>
                        </template>
                    </el-table-column>
                    <el-table-column :label="$lang('锁定仓库')">
                        <template slot-scope="scope">
                            <div>{{scope.row.warehouse}}</div>
                        </template>
                    </el-table-column>
                    <el-table-column :label="$lang('锁定数量')" width="100">
                        <template slot-scope="scope">
                            <div>{{scope.row.allTotalInventory}}</div>
                        </template>
                    </el-table-column>
                </el-table>
                <el-pagination v-if="mainLockingPage" background @current-change="handleCurrentChangeLocking" :current-page.sync="currentPageLocking" :page-size="defaultPageSize" layout="prev, pager, next, jumper" :total="mainLockingTotal">
                </el-pagination>
            </div>
        </el-dialog>
        <el-pagination background @size-change="handleSizeChange" @current-change="handleCurrentChange" :current-page.sync="currentPage" :page-sizes="[20, 30, 50, 100]" :page-size="pageSize" layout="sizes,prev, pager, next, jumper" :total="totalCount">
        </el-pagination>

    </div>
    <!-- 订单表格主体 end-->
    <el-dialog id="ProductKey" title="Product Key" :visible.sync="dialogTableVisible" width="900">
        <table style="border:1px #cccccc solid;border-collapse: collapse;text-align: center;width:100%">
            <tr v-for="(v,k) in ProductKeyData" style="border:1px #cccccc solid">
                <td style="border:1px #cccccc solid;padding: 10px;width: 20%;">{{v[0]?v[0].product_key:''}}</td>
                <td style="border:1px #cccccc solid;padding: 10px;width: 20%;">{{v[1]?v[1].product_key:''}}</td>
                <td style="border:1px #cccccc solid;padding: 10px;width: 20%;">{{v[2]?v[2].product_key:''}}</td>
                <td style="border:1px #cccccc solid;padding: 10px;width: 20%;">{{v[3]?v[3].product_key:''}}</td>
                <td style="border:1px #cccccc solid;padding: 10px;width: 20%;">{{v[4]?v[4].product_key:''}}</td>
            </tr>
        </table>
        <div v-if="ProductKeyData.length === 0" style="line-height: 60px;text-align: center">
            暂无数据
        </div>
    </el-dialog>
</div>
<!--引入js-->
<script type="text/javascript" src="./Application/Tpl/Home/Public/lib/jquery/1.9.1/jquery.min.js"></script>
<script type="text/javascript" src="./Application/Tpl/Home/Public/js/H-ui.js"></script>
<script type="text/javascript" src="./Application/Tpl/Home/Public/js/H-ui.admin.js?<{$Think.config.VER_NUM}>"></script>
<script type="text/javascript" src="./Application/Tpl/Home/Public/js/vue.2.5.13.js"></script>
<script type="text/javascript" src="./Application/Tpl/Home/Public/js/axios.min.js"></script>
<script type="text/javascript" src="./Application/Tpl/Home/Public/js/element-ui-2.6.3.js"></script>
<script type="text/javascript" src="./Application/Tpl/Home/Public/js/element-en.js"></script>
<script type="text/javascript" src="./Application/Tpl/Home/Public/utils/utils.js?v=<{$Think.config.VER_NUM}>"></script>
<script>
    if (getCookie('think_language') !== "zh-cn") {
        ELEMENT.locale(ELEMENT.lang.en)
    }
    var _extends = Object.assign || function(target) {
        for (var i = 1; i < arguments.length; i++) {
            var source = arguments[i];
            for (var key in source) {
                if (Object.prototype.hasOwnProperty.call(source, key)) {
                    target[key] = source[key];
                }
            }
        }
        return target;
    };
    var vm = new Vue({
        el: '#order-list',
        data: {
            is_oem_brand:[],
            odm:[{
                k:'1',
                v:'ODM品牌'
            },{
                k:'0',
                v:'非ODM品牌'
            }],
            prouductUrl:location.host === 'erp.gshopper.com'? '//data.gshopper.com/search/existStockProductKey':'//data.gshopper.stage.com/search/existStockProductKey',
            inStoreDays: { // 总在库天数 store
                'one': '',
                'two': ''
            },
            dialogTableVisible:false,
            ProductKeyData:[],
            dialogTitle: '',
            dialogType: '',
            dialogId: '',
            dialogVisibleSimple: false,
            mainSimpleInput: '',
            placeholderSimple: '',
            dialogLoadingSimple: '',
            mainSimpleList: [],
            dialogInfo: {},
            mainSimpleTotal: 0,
            amountMoneyNoTax: 0,
            // ---
            amountSpu: 0,
            batchCount: 0,
            amountSku: 0,
            saleTeams: [],
            innerTableData: {},
            activeNames: '1',
            tableData: [],
            totalCount: 0,
            loading: false,
            tableLoading: false,
            multipleCodes: "",
            gudsName: "",
            selectedWarehouses: [],
            purchaseNo: "",
            selectedSaleTeam: "",
            selectedPurchaseTeam: "",
            selectedOperator: "",
            selectedType: ["N002590100"],
            purchaseTime: [],
            inTime: [],
            ownedComp: '',
            endTime: [],
            unSalable: '',
            showNoinfoData: false,
            warehouseList: [],
            saleTeamList: [],
            purchaseTeamList: [],
            compList: [],
            unSalableList: [],
            warehouse_type: [],
            warehouse_operator: [],
            existed_daysData: [],
            existed_days_level: {},
            pageSize: 20,
            currentPage: 1,
            amountNumber: 0,
            amountMoney: 0,
            amountUsdMoney: 0,
            amountUsdMoneyNoTax: 0,
            productType: '',
            ascription_store: [], // 归属店铺
            sell_small_team_cd:[],//销售小团队
            ascriptionstore_list: [], // 归属店铺列表
            sell_small_team: [], // 销售小团队
            productTypeList: [{
                CD: 0,
                CD_VAL: '全部'
            }, {
                CD: 1,
                CD_VAL: '正品',
            }, {
                CD: 2,
                CD_VAL: '残次品'
            }],
            queryData: {
                mixedCode: "",
                gudsName: "",
                warehouse: [],
                purNum: "",
                saleTeam: [],
                purTeam: [],
                company: [],
                purDate: [],
                storageDate: [],
                dueDate: [],
                isDrug: '',
                showAll: false,
                productType: 0,
                ascription_store: [], // 归属店铺
                small_sale_team:[],
                pageIndex: 1,
                pageSize: 20,
                existed_days: [],
                existed_days_level: []
            },
            queryDataTemp: {},
            defaultPageSize: 10,
            dialogVisible: false,
            dialogVisibleLocking: false,
            downloadDialog: false,
            // 占用查询相关
            mainOccupyInput: '',
            mainOccupyList: [],
            dialogLoading: false,
            mainOccupyPage: false,
            postDataOccupy: {},
            postDataOccupyTemp: {},
            mainOccupyTotal: 0,
            currentPageOccupy: 1,
            // 锁定查询相关
            mainLockingList: [],
            mainLockingInput: '',
            dialogLoadingLocking: false,
            mainLockingPage: false,
            postDataLocking: {},
            postDataLockingTemp: {},
            mainLockingTotal: 0,
            currentPageLocking: 1,
            selectedTypeStatus:false,
        },
        created() {

            // console.log(team);
            // this.getAscriptionstoreList();
            // this.initData();
            // this.getBase();
            this.filterWarehouses();
            // this.getList();

            // // 如果是从团队库存汇总报表进入该页面，搜索参数取传入参数
            // var query = window.location.search.substring(1);
            // var vars = query.split("&");
            // if (vars[2] && vars[2].split("=")[0] === 'team') {
            //     var team = vars[2].split("=")[1];
            //     this.selectedSaleTeam = [team]; // 销售团队取传入的团队
            //     setTimeout(()=>{
            //         this.doSearch()
            //     },2500)
            // }
            var query = window.location.search.substring(1);
            var vars = query.split("&");
            if (vars[3] && vars[3].split("=")[0] === 'warehouse_cd') {  // 如果是从安全库存进入该页面，搜索参数取传入参数
                this.selectedWarehouses.push(vars[3].split("=")[1]);
                this.multipleCodes = vars[4].split("=")[1];
            }
        },
        watch: {
            //自动监测搜索条件的修改
            existed_daysData: {
                handler: function handler(newValue, oldValue) {
                    this.doSearch();
                },
                deep: true
            },
        },
        methods: {
            /**
             * 数组分割方法
             */
            spilt:function(arr){
                var result = [];
                for(var i=0,len=arr.length;i<len;i+=5){
                    result.push(arr.slice(i,i+5));
                }
                return result
            },
            /**
             *  查询ProductKey
             */
            searchProductKey:function(data){
                var _this = this;
                axios.post(this.prouductUrl,{
                    "search":{
                        "sku_id":data.skuId,
                        "batch_id":data.batchId
                    }}).then(function(res) {
                    if(res.data.code === 200){
                        _this.dialogTableVisible = true;
                        var arr = res.data.data.product_keys
                        _this.ProductKeyData = _this.spilt(arr)
                    }
                }).catch(function(err) {console.log(err)});
            },
            /**
             * 检查在库总天数，让它只能为正整数
             * @param {Object} event
             * @param {String} type
             * @author ziling 2019.5.21
             */
            checkInStoreDays: function(event, type) {
                var _this = this;
                var r = /^[1-9][0-9]*$/
                var num = event.value
                if (!r.test(event.value)) {
                    var n = Math.abs(parseInt(event.value))
                    if (isNaN(n)) {
                        num = '0'
                    } else {
                        num = n
                    }
                }
                if (event.value === '') {
                    num = ''
                }
                event.value = num
                switch (type) {
                    case '1':
                        _this.inStoreDays.one = num
                        break;
                    case '2':
                        _this.inStoreDays.two = num
                        break
                }
            },
            // 获取归属店铺列表
            getAscriptionstoreList: async function(){
                // getAscriptionstoreList() {
                let _this = this;
                await axios.post('/index.php?m=store&a=get_store').then(function(res) {
                    console.log(1);

                    console.log(res)
                    if (res.status === 200 && res.data.code == 200) {
                        var arr = [];
                        var obj = res.data.data;
                        for (let i in obj) {
                            var o = {
                                nickName:obj[i],
                                realName:Number(i)
                            };
                            arr.push(o); //属性
                        }
                        // console.log(arr);
                        _this.ascriptionstore_list = arr;
                        _this.ascriptionstore_list.unshift({
                            nickName: '无店铺归属',
                            realName: 0,
                        })
                    }
                }).catch(function(err) {console.log(err)});
            },
            blurInStoreDays: function(event, type) {
                if (!this.inStoreDays.two && this.inStoreDays.one && this.inStoreDays.two !== 0) {
                    this.$message({
                        message: '请输入正确的总在库天数',
                        type: 'warning'
                    });
                }
                if (this.inStoreDays.two && !this.inStoreDays.one && this.inStoreDays.one !== 0) {
                    this.$message({
                        message: '请输入正确的总在库天数',
                        type: 'warning'
                    });
                }
                if (Number(this.inStoreDays.two) - Number(this.inStoreDays.one) < 0) {
                    this.$message({
                        message: '请输入正确的总在库天数',
                        type: 'warning'
                    });
                }
            },
            // 初始化 数据
            initData: function initData() {
                console.log(2);

                this.unSalableList = [{
                    label: this.$lang('滞销'),
                    value: 1
                }, {
                    label: this.$lang('未滞销'),
                    value: 2
                }];
                this.dialogInfo = {
                    "serviceCost": {
                        "title": this.$lang('服务费用明细'),
                        "placeholder": this.$lang('请输入入库单号'),
                        "url": '/index.php?m=Stock&a=serviceCostList'
                    },
                    "carryCost": {
                        "title": this.$lang('运输费用明细'),
                        "placeholder": this.$lang('请输入出入库单号'),
                        "url": '/index.php?m=Stock&a=logCostList'

                    },
                    "warehouseCost": {
                        "title": this.$lang('仓储费用明细'),
                        "placeholder": this.$lang('请输入仓库名称'),
                        "url": '/index.php?m=Stock&a=warehouseCostList'
                    },
                    "tariff": {
                        "title": this.$lang('关税明细'),
                        "placeholder": this.$lang('请输入出入库单号'),
                        "url": '/index.php?m=Stock&a=existingList'

                    }
                }
            },
            getExtendExcel: function (){
                var dom = document.createElement('a');
                var _href = "/index.php?g=home&m=stock&a=existing_extend_excel";
                dom.setAttribute("onclick", "opennewtab(this,'" + this.$lang('历史现存量') + "')");
                dom.setAttribute("_href", _href);
                dom.click();
            },
            existingList: function(row) {
                var data = {
                    stream_id: row.stream_id,
                    sku_id: row.skuId,
                    batch_id: row.batchId
                }
                axios.post('/index.php?m=Stock&a=existingList', data).then(function(response) {
                    console.log(response)
                    if (response.data.code == 200) {

                    } else {}
                }).catch(function(err) {});
            },
            // 三个费用 的 点击事件
            mainSimpleClick: function mainSimpleClick(type, id, data) {
                this.dialogType = type;
                this.dialogId = id;
                this.dialogTitle = this.dialogInfo[type]['title'];
                this.placeholderSimple = this.dialogInfo[type]['placeholder'];
                this.getSimpleDetail(type, id, '', data);
            },
            // 三个费用 的 关闭弹窗事件
            handleCloseSimple: function handleCloseSimple() {
                var _this = this;
                this.dialogVisibleSimple = false;
                setTimeout(function() {
                    _this.mainSimpleList = [];
                    _this.mainSimpleInput = '';
                }, 40)

            },
            // 三个弹窗 的 搜索事件
            doDialogSimpleSearch: function doDialogSimpleSearch() {
                this.getSimpleDetail(this.dialogType, this.dialogId, this.mainSimpleInput);
            },
            // 三个弹窗 的重置事件
            doDialogSimpleReset: function doDialogSimpleReset() {
                this.mainSimpleInput = '';
                this.getSimpleDetail(this.dialogType, this.dialogId);
            },
            // 三个弹窗 的查看明细事件
            getSimpleDetail: function getSimpleDetail(type, id, searchInfo, data) {
                console.log(data)
                var _this = this;
                var url = this.dialogInfo[type]['url'];
                if (type === 'tariff') {
                    var postData = {
                        "stream_id": data.stream_id,
                        "batch_id": data.batchId,
                        "sku_id": data.skuId,
                    };
                    axios.post(url, postData).then(function(response) {
                        if (response.data.code == 2000) {
                            _this.mainSimpleList = response.data.data.length > 0 ? response.data.data : [];
                            _this.mainSimpleTotal = response.data.data.length;
                            _this.dialogVisibleSimple = true
                        } else {
                            _this.$message.error(_this.$lang(response.data.msg));
                        }

                    }).catch(function(err) {

                    });
                } else {
                    var postData = {
                        "data": {
                            "query": {
                                "stream_id": id,
                                "batch_id": id,
                                "warehouse": searchInfo,
                                "bill_id": searchInfo,
                            }
                        }
                    };
                    axios.post(url, postData).then(function(response) {
                        if (response.data.code == 2000) {
                            _this.mainSimpleList = response.data.data.length > 0 ? response.data.data : [];
                            _this.mainSimpleTotal = response.data.data.length;
                            _this.dialogVisibleSimple = true
                        } else {
                            _this.$message.error(_this.$lang(response.data.msg));
                        }

                    }).catch(function(err) {

                    });
                }

            },
            getHref: function(state, id) {
                var url = '';
                switch (state) {
                    case '待审核':
                        url = '/index.php?m=allocation_extend_new&a=allot_check&type=0&id=' + id;
                        break;
                    case '已完成':
                        url = '/index.php?m=allocation_extend_new&a=transportation&id=' + id;
                        break;
                    case '审核失败':
                        url = '/index.php?m=allocation_extend_new&a=allot_check&type=1&id=' + id;
                        break;
                    case '待提交':
                        url = '/index.php?m=allocation_extend_new&a=allot_check&type=1&id=' + id;
                        break;
                    case '待作业':
                        url = '/index.php?m=allocation_extend_new&a=warehouse_task&id=' + id;
                        break;
                    case '运输中':
                        url = '/index.php?m=allocation_extend_new&a=transportation&id=' + id;
                        break;
                }
                return url
            },

            //前往下载列表
            toDownload: function toDownload() {
                this.downloadDialog = false;
                var dom = document.createElement('a');
                var _href = "/index.php?g=Home&m=Excel&a=excel_list";
                dom.setAttribute("onclick", "opennewtab(this,'" + this.$lang('下载列表') + "')");
                dom.setAttribute("_href", _href);
                dom.click();
            },

            toDetail: function toDetail(id) {
                var _href = this.getHref(id.allo_state_val, id.allo_id)
                if (id.transfer_type == '0') {
                    _href = '/index.php?m=allocation_extend&a=confirm_outgoing&id=' + id.allo_id
                }
                var dom = document.createElement('a');
                dom.setAttribute("onclick", "opennewtab(this,'" + id.allo_state_val + "')");
                dom.setAttribute("_href", _href);
                dom.click();
            },

            // 分页
            handleCurrentChange: function handleCurrentChange(index) {
                this.queryData.pageIndex = index;
                var postData = {
                    "data": {
                        "query": this.queryData

                    }
                };
                this.getList(postData);
            },
            // 每页展示条数
            handleSizeChange: function handleSizeChange(index) {
                this.pageSize = index;
                this.currentPage = 1
                this.queryData.pageSize = index;
                this.queryData.pageIndex = 1;
                var data = {
                    "data": {
                        "query": this.queryData
                    }
                };
                this.getList(data);
            },
            // 展开批次
            expandItem: function expandItem(row, expandedRows) {
                var _this = this;
                this.$set(row, 'tableInnerLoading', true);
                this.queryDataTemp = JSON.parse(JSON.stringify(this.queryData));
                this.queryDataTemp.pageSize = 1000;
                this.queryDataTemp.pageIndex = 1;
                this.queryDataTemp.mixedCode = row.skuId;
                this.queryDataTemp.existed_days = []
                if (this.inStoreDays.one >= 0 && this.inStoreDays.two >= 0 && this.inStoreDays.two - this.inStoreDays.one >= 0) {
                    this.queryDataTemp.existed_days = [this.inStoreDays.one, this.inStoreDays.two]
                }
                var data = {
                    "data": {
                        "query": this.queryDataTemp
                    }
                };
                // 如果是第一次加载 或者 等接口获取到数据后再次 请求
                if (row.firstLoad || row.isFinishedLoad) {
                    _this.$set(row, 'isFinishedLoad', false);
                    _this.$set(row, 'firstLoad', false);

                    axios.post('/index.php?m=Stock&a=batchData', data).then(function(response) {

                        if (response.data.code == 2000) {
                            response.data.data.pageData.forEach(item => {
                                item.productType = _this.$lang(item.productType);
                                item.purTeam = _this.$lang(item.purTeam);
                                item.warehouse = _this.$lang(item.warehouse);
                                item.saleTeam = _this.$lang(item.saleTeam);
                            })
                            _this.$set(row, 'detail', response.data.data.pageData)
                        } else {
                            _this.$message.error(_this.$lang(response.data.msg));
                        }
                        setTimeout(function() {
                            _this.$set(row, 'isFinishedLoad', true);
                        }, 100)

                        _this.$set(row, 'tableInnerLoading', false);

                    }).catch(function(err) {
                        setTimeout(function() {
                            _this.$set(row, 'isFinishedLoad', true);
                        }, 100)
                        _this.$set(row, 'tableInnerLoading', false);

                    });
                }

            },
            previewImg: function previewImg(item, tag, type) {

                this.$set(item, tag, type);
            },
            //基础数据
            getBase: async function(){
                // getBase: function getBase() {
                var _this = this;
                var data = {
                    "data": {
                        "query": {
                            "warehouses": "true",
                            "saleTeams": "true",
                            "company": "true",
                            "purTeams": "true",
                            "warehouse_operator": "true",
                            "warehouse_type": "true",
                            "existed_days_level": "true"
                        },
                        "type": "sorting"
                    }
                };

                await axios.post('/index.php?g=oms&m=CommonData&a=commonData', data).then(function(response) {
                    console.log(3);

                    if (response.data.code == 2000) {
                        _this.saleTeamList = response.data.data.saleTeams;
                        _this.warehouse_operator = response.data.data.warehouse_operator;
                        _this.warehouse_type = response.data.data.warehouse_type;
                        _this.warehouseList = response.data.data.warehouses;
                        _this.compList = response.data.data.company;
                        _this.purchaseTeamList = response.data.data.purTeams;
                        _this.existed_days_level = response.data.data.existed_days_level;
                    } else {
                        _this.$message.error(_this.$lang(response.data.msg));
                    }
                }).catch(function(err) {
                    console.log(err);
                });

            },
            getsellSmallTeam: async function(){

                var _this = this
                var data = {
                    "field" : "",
                    "CD" : "",
                    "need_open" : "",
                    "need_default" : "Y"
                };

                await axios.post('/index.php?g=universal&m=dictionary&a=getListByField', data).then(function(res) {
                    console.log('res',res);
                    if(res.data.code == 200){
                        _this.sell_small_team = res.data.data
                    }
                }).catch(function(err) {
                    console.log(err);
                });
            },
            selectDaysLevel: function selectDaysLevel(item) {
                var _this = this;
                if (!item) {
                    _this.existed_daysData = [];
                    for (var i in _this.existed_days_level) {
                        _this.existed_days_level[i].checked = false;
                    }
                } else {
                    item.checked = !item.checked;
                    if (item.checked) {
                        _this.existed_daysData.push(item.cd);
                    } else {
                        _this.existed_daysData.forEach(function(val, index) {
                            if (val == item.cd) {
                                _this.existed_daysData.splice(index, 1);
                            }
                        });
                    }
                }
            },
            filterWarehouses: async function(){
                // filterWarehouses: function filterWarehouses() {
                //   debugger;
                var _this = this;
                _this.selectedTypeStatus = true
                await _this.getAscriptionstoreList();
                await _this.getsellSmallTeam()
                await _this.initData();
                await _this.getBase();

                var data = {
                    type_cd: this.selectedType,
                    operator_cds: this.selectedOperator
                };
                await axios.post('/index.php?m=warehouse&a=filterWarehouse', data).then(function(response) {
                    //   console.log(response.data)
                    console.log(4);

                    if (response.data.code == 2000) {
                        _this.warehouseList = response.data.list ? response.data.list : [{
                            CD: 'as',
                            CD_VAL: '无数据'
                        }];
                        //   console.log(_this.warehouseList)
                        //   console.log(Object.keys(_this.warehouseList))
                        // _this.getList({
                        //     "data": {
                        //         "query": {
                        //             warehouse: Object.keys(_this.warehouseList)
                        //                 // mixedCode:'8000000201'
                        //         }
                        //     }
                        // });
                        // 如果是从团队库存汇总报表进入该页面，搜索参数取传入参数
                        var query = window.location.search.substring(1);
                        var vars = query.split("&");
                        if (vars[2] && vars[2].split("=")[0] === 'team') {
                            var team = vars[2].split("=")[1];
                            _this.selectedSaleTeam = [team]; // 销售团队取传入的团队
                        }

                        // setTimeout(()=> {

                        _this.doSearch();
                        // },700)
                    } else {
                        _this.$message.error(_this.$lang(response.data.msg));
                    }

                }).catch(function(err) {
                    console.log(err);
                });

            },
            // 获取列表数据
            getList: async function(data){
                // getList: function getList(data) {
                console.log(data)
                var _this = this;
                _this.tableLoading = true;
                await axios.post('/index.php?m=Stock&a=standingData', data).then(function(response) {
                    console.log(response.data)
                    console.log(5);

                    if (response.data.code == 2000) {
                        _this.tableData = response.data.data.pageData;
                        _this.totalCount = parseInt(response.data.data.totalCount);
                        _this.amountSpu = response.data.data.amountSpu;
                        _this.amountSku = response.data.data.amountSku;
                        _this.amountNumber = response.data.data.amountNumber;
                        _this.amountMoney = response.data.data.amountMoney;
                        _this.amountMoneyNoTax = response.data.data.amountMoneyNoTax;
                        _this.amountUsdMoney = response.data.data.amountUsdMoney;
                        _this.amountUsdMoneyNoTax = response.data.data.amountUsdMoneyNoTax;
                        if (_this.tableData) {
                            _this.tableData.forEach(function(el) {
                                _this.$set(el, 'detail', [])
                                _this.$set(el, 'showImg', false)
                                _this.$set(el, 'isFinishedLoad', false)
                                _this.$set(el, 'firstLoad', true)
                                _this.$set(el, 'tableInnerLoading', false)
                                el.dialogVisible = false;
                            });
                        }

                    } else {
                        _this.$message.error(_this.$lang(response.data.msg));

                    }
                    _this.tableLoading = false;
                    _this.selectedTypeStatus = false
                }).catch(function(err) {
                    console.log(err);
                });
            },
            // 重置
            doReset: function doReset() {
                // debugger;
                this.is_oem_brand = []
                this.selectedType = ["N002590100"];
                this.multipleCodes = "";
                this.gudsName = "";
                this.selectedWarehouses = [];
                this.purchaseNo = "";
                this.selectedSaleTeam = [];
                this.selectedPurchaseTeam = [];
                this.ownedComp = [];
                this.purchaseTime = [];
                this.inTime = [];
                this.endTime = [];
                this.unSalable = '';
                this.showNoinfoData = false;
                this.productType = '';
                this.ascription_store = [];
                this.sell_small_team_cd = [];
                this.pageSize = 20;
                this.pageIndex = 1;
                this.queryData = {};
                this.selectedOperator = [];
                // this.selectedType = [];
                this.inStoreDays.one = '';
                this.inStoreDays.two = '';
                // this.$refs.inStoreDaysTwo.value = ''
                // this.$refs.inStoreDaysOne.value = ''
                this.filterWarehouses();
            },
            // 搜索
            doSearch: function doSearch() {
                console.log('搜索')
                this.currentPage = 1;
                this.queryData = {
                    mixedCode: this.trim(this.multipleCodes),
                    // gudsName: this.trim(this.gudsName),
                    gudsName: this.gudsName,
                    warehouse: this.selectedWarehouses.length ? this.selectedWarehouses : Object.keys(this.warehouseList),
                    purNum: this.trim(this.purchaseNo),
                    saleTeam: this.selectedSaleTeam,
                    purTeam: this.selectedPurchaseTeam,
                    company: this.ownedComp,
                    purDate: this.purchaseTime,
                    storageDate: this.inTime,
                    dueDate: this.endTime,
                    isDrug: this.unSalable,
                    showAll: this.showNoinfoData,
                    productType: this.productType,
                    ascription_store: this.ascription_store, //归属店铺
                    small_sale_team:this.sell_small_team_cd,
                    pageSize: this.pageSize,
                    pageIndex: 1,
                    existed_days: [],
                    existed_days_level: this.existed_daysData,
                    is_oem_brand:this.is_oem_brand
                };
                if (this.inStoreDays.one >= 0 && this.inStoreDays.two >= 0 && this.inStoreDays.two - this.inStoreDays.one >= 0) {
                    this.queryData.existed_days = [this.inStoreDays.one, this.inStoreDays.two]
                }
                this.getList({
                    "data": {
                        "query": this.queryData
                    }
                });
            },
            // 占用查询
            mainOccupy: function mainOccupy(type, data) {
                this.currentPageOccupy = 1;
                var _this = this;
                var postData = {};
                if (type === "main") {
                    this.postDataOccupy = {
                        "data": {
                            "query": {
                                "mixedCode": data.skuId,
                                "pageSize": 10,
                                "batchIds": data.batchIds
                            }
                        }
                    };
                } else if (type === "child") {
                    this.postDataOccupy = {
                        "data": {
                            "query": {
                                "skuId": data.skuId,
                                "batchId": data.batchId,
                                "pageSize": 10
                            }
                        }
                    }
                }
                this.postDataOccupyTemp = JSON.parse(JSON.stringify(this.postDataOccupy));
                this.getOccupy(this.postDataOccupy);
                this.dialogVisible = true;
            },
            // 锁定查询
            mainLocking: function mainLocking(type, data) {
                var _this = this;
                this.currentPageLocking = 1;
                var postData = {};
                if (type === "main") {
                    this.postDataLocking = {
                        "data": {
                            "query": {
                                "mixedCode": data.skuId,
                                "pageSize": 10,
                                "batchIds": data.batchIds
                            }
                        }
                    };
                } else if (type === "child") {
                    this.postDataLocking = {
                        "data": {
                            "query": {
                                "mixedCode": data.skuId,
                                "batchId": data.batchId,
                                "pageSize": 10
                            }
                        }
                    }
                }
                this.postDataLockingTemp = JSON.parse(JSON.stringify(this.postDataLocking));
                this.getLocking(this.postDataLocking);
                this.dialogVisibleLocking = true
            },
            // 关闭占用弹窗
            handleClose: function handleClose() {
                this.mainOccupyList = [];
                this.mainOccupyInput = '';
                this.mainOccupyPage = false;
                this.dialogVisible = false;
            },
            // 关闭锁定弹窗
            handleCloseLocking: function handleCloseLocking() {
                this.mainLockingList = [];
                this.mainLockingInput = '';
                this.mainLockingPage = false;
                this.dialogVisibleLocking = false;

            },
            // 弹窗 搜索
            doDialogSearch: function doDialogSearch(type) {
                if (type === "occupy") {
                    this.postDataOccupy.data.query.ordId = this.trim(this.mainOccupyInput);
                    this.getOccupy(this.postDataOccupy);
                } else if (type === "locking") {
                    this.postDataLocking.data.query.orderId = this.trim(this.mainLockingInput);
                    this.getLocking(this.postDataLocking);
                }
            },
            // 弹窗重置 搜索
            doDialogReset: function doDialogReset(type) {
                if (type === "occupy") {
                    this.currentPageOccupy = 1;
                    this.mainOccupyInput = '';
                    this.postDataOccupy = JSON.parse(JSON.stringify(this.postDataOccupyTemp));
                    this.getOccupy(this.postDataOccupy);
                } else if (type === "locking") {
                    this.currentPageLocking = 1;
                    this.mainLockingInput = '';
                    this.postDataLocking = JSON.parse(JSON.stringify(this.postDataLockingTemp));
                    this.getLocking(this.postDataLocking);
                }
            },
            // 占用查询修改页数
            handleCurrentChangeOccupy: function handleCurrentChangeOccupy(page) {
                this.currentPageOccupy = page;
                this.postDataOccupy.data.query.pageIndex = page;
                this.getOccupy(this.postDataOccupy);
            },
            handleCurrentChangeLocking: function handleCurrentChangeLocking(page) {
                this.currentPageLocking = page;
                this.postDataLocking.data.query.pageIndex = page;

                this.getLocking(this.postDataLocking);
            },
            // 占用接口调用
            getOccupy: function getOccupy(data) {
                var _this = this;
                _this.dialogLoading = true;
                axios.post('/index.php?m=Stock&a=occupySearch', data).then(function(response) {
                    if (response.data.code == 2000) {
                        _this.mainOccupyPage = response.data.data.totalPage > 1 ? true : false;
                        _this.mainOccupyTotal = parseInt(response.data.data.totalCount);
                        _this.mainOccupyList = response.data.data.pageData;
                    } else {
                        _this.$message.error(_this.$lang(response.data.msg));
                    }
                    _this.dialogLoading = false;
                }).catch(function(err) {
                    console.log(err);
                });
            },
            // 锁定接口调用
            getLocking: function getLocking(data) {
                var _this = this;
                _this.dialogLoadingLocking = true;
                axios.post('/index.php?m=Stock&a=lockingSearch', data).then(function(response) {
                    if (response.data.code == 2000) {
                        _this.mainLockingPage = response.data.data.totalPage > 1 ? true : false;
                        _this.mainLockingTotal = parseInt(response.data.data.totalCount);
                        _this.mainLockingList = response.data.data.pageData;
                    } else {
                        _this.$message.error(_this.$lang(response.data.msg));
                    }
                    _this.dialogLoadingLocking = false;
                }).catch(function(err) {
                    console.log(err);
                });
            },
            // 全部导出
            exportAll: function exportAll() {
                var _this = this;
                _this.loading = true;
                this.exportParam = JSON.parse(JSON.stringify(this.queryData));
                this.$delete(this.exportParam, 'pageIndex');
                this.$delete(this.exportParam, 'pageSize');
                axios.post('/index.php?m=Stock&a=checkExport', this.exportParam).then(function(res) {
                    _this.loading = false;
                    if (res.data.code == 200) {
                        if (res.data.is_hint) {
                            _this.downloadDialog = true;
                        } else {
                            var tempDom = document.createElement('form');
                            tempDom.action = '/index.php?m=Stock&a=export';
                            tempDom.method = 'post';
                            var opt = document.createElement('input');
                            opt.name = 'post_data';
                            opt.value = JSON.stringify(_this.exportParam);
                            tempDom.appendChild(opt);
                            document.body.appendChild(tempDom);
                            tempDom.submit();
                        }
                    } else {
                        _this.$message.error(res.data.info);
                    }
                }).catch(function(err) {
                    console.log(err);
                });
            },
            exportCurrentAll(){
                var _this = this;
                _this.loading = true;
                this.exportParam = JSON.parse(JSON.stringify(this.queryData));
                this.$delete(this.exportParam, 'pageIndex');
                this.$delete(this.exportParam, 'pageSize');
                const responseType = "blob";

                axios.post('/index.php?m=Stock&a=exportPresent', this.exportParam,{
                    responseType: responseType
                }).then(function(res) {
                    _this.loading = false;
                    let alink = document.createElement("a");
                    alink.href = URL.createObjectURL(res.data);
                    alink.download = 'download.csv';
                    alink.click();
                }).catch(function(err) {
                    console.log(err);
                });
            },
            // 去除前后空格
            trim: function trim(str) {
                return str.replace(/(^\s*)|(\s*$)/g, "");
            }
        },
        filters: {
            numberFormat: function(val, point) {
                var point = point || 2;
                if (val) {
                    var arr = utils.numberFormat(parseFloat(val).toFixed(point)).split(".");
                    return arr[0] + '.' + (arr[1] ? arr[1] + "0".repeat(point - arr[1].length) : "0".repeat(point));
                }
                return val;
            }
        }
    })
</script>

</body>

</html>