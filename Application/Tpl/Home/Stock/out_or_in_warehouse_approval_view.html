<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>查看出库审批</title>
  <link rel="stylesheet" href="./Application/Tpl/Home/Public/css/element-ui-2.13.0.css?v=<{$Think.const.V}>">
  <link rel="stylesheet" href="./Application/Tpl/Home/Public/css/default.css?v=<{$Think.const.V}>">

</head>
<style>
    #outWarehouseApprovalView {
        display: none;
    }

    .list {
        padding: 20px 20px 0 20px;
    }

    .summary__table {
        width: 100%;
        empty-cells: show;
        background-color: transparent;
        border-collapse: collapse;
        border-spacing: 0;
    }

    .summary__table-header {
        height: 38px;
        text-align: left !important;
        width: 100%;
        line-height: 38px;
        font-size: 16px;
        color: #FFFFFF !important;
        background: #546E7A !important;
        padding: 0px !important;
        text-indent: 20px;
    }

    .summary__table .summary__table-tbody td {
        font-size: 13px;
        color: #263238;
        letter-spacing: 0;
        border-bottom: 1px solid #ECEFF1;
        border-top: 1px solid #ECEFF1;
        border-left: 1px solid #CADEE7;
        border-right: 1px solid #CADEE7;
        padding: 0.65rem;
    }

    .summary__table .summary__table-tbody tr td:nth-child(odd) {
        background: #F7F9FB;
        color: #546E7A;
        letter-spacing: 0;
        text-align: center;
        width: 10%;
    }

    .summary__table-required-filed {
        /*color: #FF0000;*/
    }


    .list__data {
        display: flex;
        flex-direction: column;
        margin-top: 30px;
    }

    .list__data-header {
        display: flex;
        align-items: center;
        height: 38px;
        text-align: left !important;
        width: 100%;
        line-height: 38px;
        font-size: 16px;
        color: #FFFFFF !important;
        background: #546E7A !important;
        padding: 0px !important;
        text-indent: 20px;
        /*border-left: 1px solid #ffffff !important;*/
        /*border-right: 1px solid #ffffff !important;*/
        border-top: 1px solid #EBEEF5 !important;
    }

    .list__data-header-title {

    }

    .list__data-header-actions {
        display: flex;
        align-items: center;
        margin-left: 20px;
    }

    .list__data .el-table--border {
        /*border-left: 1px solid #EBEEF5 !important;*/
        /*border-right: 1px solid #EBEEF5 !important;*/
        /*border-bottom: 1px solid #EBEEF5 !important;*/
        border-top: none !important;

    }

    /*审批意见表格*/
    .approval__data {
        width: 100%;
        empty-cells: show;
        background-color: transparent;
        border-collapse: collapse;
        border-spacing: 0;
    }

    .approval__table {
        width: 100%;
        empty-cells: show;
        background-color: transparent;
        border-collapse: collapse;
        border-spacing: 0;
    }

    .approval__table-header {
        height: 38px;
        text-align: left !important;
        width: 100%;
        line-height: 38px;
        font-size: 16px;
        color: #FFFFFF !important;
        background: #546E7A !important;
        padding: 0px !important;
        text-indent: 20px;
    }


    .approval__table-required-filed {
        /*color: #FF0000;*/
    }

    .approval__table-tbody {

    }

    .approval__table-required-filed {

    }

    .approval__table .approval__table-tbody td {
        font-size: 13px;
        color: #263238;
        letter-spacing: 0;
        border-bottom: 1px solid #ECEFF1;
        border-top: 1px solid #ECEFF1;
        border-left: 1px solid #CADEE7;
        border-right: 1px solid #CADEE7;
        padding: 0.65rem;
    }

    .approval__table .approval__table-tbody tr td:nth-child(odd) {
        background: #F7F9FB;
        color: #546E7A;
        letter-spacing: 0;
        text-align: center;
        width: 10%;
    }

    /*日志详情表格*/
    .log__list-header {
        display: flex;
        align-items: center;
        height: 38px;
        text-align: left !important;
        width: 100%;
        line-height: 38px;
        font-size: 16px;
        color: #FFFFFF !important;
        background: #546E7A !important;
        padding: 0px !important;
        text-indent: 20px;
        /*border-left: 1px solid #ffffff !important;*/
        /*border-right: 1px solid #ffffff !important;*/
        border-top: 1px solid #EBEEF5 !important;
    }

    .log__list {
        padding: 20px 20px 0 20px;
    }

    .log__list-header-title {

    }

    .list__pagination {
        display: flex;
        align-items: center;
        justify-content: flex-end;
        padding: 10px;
    }

    .actions {
        display: flex;
        align-items: center;
        justify-content: center;
        margin-top: 20px;
    }
</style>
<body>
<div id="outWarehouseApprovalView">
  <el-tabs v-model="activeName">
    <el-tab-pane :label="$lang('查看详情-' + title)" name="list">
      <div class="list">
        <div class="summary__data">
          <table class="summary__table">
            <caption class="summary__table-header">{{$lang('基本信息')}}</caption>
            <tbody class="summary__table-tbody">
            <tr>
              <td>
                <span class="summary__table-required-filed">{{$lang('发起人*')}}</span>
              </td>
              <td>
                <span>{{pagedOutWarehouseApprovalSummaryData.create_by}}</span>
              </td>
              <td>
                <span class="summary__table-required-filed">{{$lang('当前审批人*')}}</span>
              </td>
              <td>
                <span>{{pagedOutWarehouseApprovalSummaryData.new_audit_by}}</span>
              </td>
            </tr>
            <tr>
              <td>
                <span class="summary__table-required-filed">{{$lang('审批单号*')}}</span>
              </td>
              <td>
                <span>{{pagedOutWarehouseApprovalSummaryData.audit_no}}</span>
              </td>
              <td>
                <span class="summary__table-required-filed">{{$lang('SKU种类*')}}</span>
              </td>
              <td>
                <span>{{pagedOutWarehouseApprovalSummaryData.sku_spec}}</span>
              </td>
            </tr>
            <tr>
              <td>
                <span class="summary__table-required-filed">{{$lang('出入库类型*')}}</span>
              </td>
              <td>
                <span>{{pagedOutWarehouseApprovalSummaryData.type_cd_val}}</span>
              </td>
              <td>
                <span class="summary__table-required-filed">{{$lang('货值总额*')}}</span>
              </td>
              <td>
                <span>{{pagedOutWarehouseApprovalSummaryData.sum_price_usd}}</span>
              </td>
            </tr>
            <tr>
              <td>
                <span class="summary__table-required-filed">{{$lang('审批流程节点*')}}</span>
              </td>
              <td>
                <span>{{pagedOutWarehouseApprovalSummaryData.status_cd_val}}</span>
              </td>
              <td>
                <span class="summary__table-required-filed">{{$lang('涉及团队')}}*</span>
              </td>
              <td>
                <span>{{pagedOutWarehouseApprovalSummaryData.team_cd_val}}</span>
              </td>
            </tr>
            </tbody>
          </table>
        </div>
        <div class="list__data">
          <div class="list__data-header">
            <span class="list__data-header-title">{{$lang('调整信息')}}</span>
          </div>
          <el-table
              :data="pagedOutWarehouseApprovals.data"
              class="list__data-table"
              border
          >
            <el-table-column
                fixed
                prop="sku_id"
                width="80px"
                align="center"
                :resizable="false"
                :label="$lang('SKU编号')"
            >
              <template slot-scope="scope">
                <span>{{ scope.row.sku_id }}</span>
              </template>
            </el-table-column>
            <el-table-column
                align="center"
                prop="storage_mark_cd_val	"
                :resizable="false"
                :label="$lang('出库类型')"
            >
              <template slot-scope="scope">
                <span>{{ scope.row.storage_mark_cd_val }}</span>
              </template>
            </el-table-column>
            <el-table-column
                width="80px"
                align="center"
                prop="upc_id"
                :resizable="false"
                :label="$lang('条形码')"
            >
              <template slot-scope="scope">
                <span>{{ scope.row.upc_id }}</span>
              </template>
            </el-table-column>
            <el-table-column
                align="center"
                prop="number"
                :resizable="false"
                :label="$lang('数量')"
            >
              <template slot-scope="scope">
                <span>{{ scope.row.number }}</span>
              </template>
            </el-table-column>
            <el-table-column
                align="center"
                prop="product_type_cd_val"
                :resizable="false"
                :label="$lang('商品类型')"
            >
              <template slot-scope="scope">
                <span>{{ $lang(scope.row.product_type_cd_val) }}</span>
              </template>
            </el-table-column>
            <el-table-column
                align="center"
                prop="dead_line"
                :resizable="false"
                :label="$lang('到期日')"
            >
              <template slot-scope="scope">
                <span>{{ scope.row.dead_line }}</span>
              </template>
            </el-table-column>
            <el-table-column
                align="center"
                prop="storage_warehouse_cd_val"
                :resizable="false"
                :label="$lang('出库仓库')"
            >
              <template slot-scope="scope">
                <span>{{ scope.row.storage_warehouse_cd_val }}</span>
              </template>
            </el-table-column>
            <el-table-column
                align="center"
                prop="batch_code"
                :resizable="false"
                :label="$lang('批次号')"
            >
              <template slot-scope="scope">
                <span>{{ scope.row.batch_code }}</span>
              </template>
            </el-table-column>
            <el-table-column
                align="center"
                prop="sale_team_cd_val	"
                :resizable="false"
                :label="$lang('销售团队')"
            >
              <template slot-scope="scope">
                <span>{{scope.row.sale_team_cd_val}}</span>
              </template>
            </el-table-column>
            <el-table-column
                align="center"
                prop="small_sale_team_cd_val	"
                :resizable="false"
                :label="$lang('销售小团队')"
            >
              <template slot-scope="scope">
                <span>{{ scope.row.small_sale_team_cd_val }}</span>
              </template>
            </el-table-column>
            <el-table-column
                align="center"
                prop="storage_log_cost"
                :resizable="false"
                :label="$lang('入库物流费用')"
            >
              <template slot-scope="scope">
                <span>{{ $lang(scope.row.storage_log_cost) }}</span>
              </template>
            </el-table-column>
            <el-table-column
                align="center"
                prop="log_service_cost"
                :resizable="false"
                :label="$lang('物流服务费用')"
            >
              <template slot-scope="scope">
                <span>{{ scope.row.log_service_cost }}</span>
              </template>
            </el-table-column>
            <el-table-column
                align="center"
                prop="storage_date"
                :resizable="false"
                :label="$lang('入库时间')"
            >
              <template slot-scope="scope">
                <span>{{ scope.row.storage_date }}</span>
              </template>
            </el-table-column>
            <el-table-column
                align="center"
                prop="pur_order_no"
                :resizable="false"
                :label="$lang('采购单号')"
            >
              <template slot-scope="scope">
                <span>{{ scope.row.pur_order_no }}</span>
              </template>
            </el-table-column>
            <el-table-column
                align="center"
                prop="price"
                :resizable="false"
                :label="$lang('单价')"
            >
              <template slot-scope="scope">
                <span>{{ scope.row.price_usd }}</span>
              </template>
            </el-table-column>
            <el-table-column
                align="center"
                prop="currency_cd_val"
                :resizable="false"
                :label="$lang('币种')"
            >
              <template slot-scope="scope">
                <span> USD </span>
              </template>
            </el-table-column>
            <el-table-column
                align="center"
                prop="pur_team_cd_val"
                :resizable="false"
                :label="$lang('采购团队')"
            >
              <template slot-scope="scope">
                <span>{{ scope.row.pur_team_cd_val }}</span>
              </template>
            </el-table-column>
            <el-table-column
                align="center"
                prop="pur_team_company_cd_val"
                :resizable="false"
                :label="$lang('采购团队所属公司')"
            >
              <template slot-scope="scope">
                <span>{{ scope.row.pur_team_company_cd_val }}</span>
              </template>
            </el-table-column>
            <el-table-column
                align="center"
                prop="pur_storage_date"
                :resizable="false"
                :label="$lang('采购入库时间')"
            >
              <template slot-scope="scope">
                <span>{{scope.row.pur_storage_date }}</span>
              </template>
            </el-table-column>
            <el-table-column
                align="center"
                prop="pur_invoice_tax_rate"
                :resizable="false"
                :label="$lang('采购发票税率')"
            >
              <template slot-scope="scope">
                <span>{{ scope.row.pur_invoice_tax_rate }}</span>
              </template>
            </el-table-column>
            <el-table-column
                align="center"
                prop="proportion_of_tax"
                :resizable="false"
                :label="$lang('退税比率')"
            >
              <template slot-scope="scope">
                <span>{{ scope.row.proportion_of_tax }}</span>
              </template>
            </el-table-column>
            <el-table-column
                align="center"
                prop="intro_team_cd_val"
                :resizable="false"
                :label="$lang('介绍团队')"
            >
              <template slot-scope="scope">
                <span>{{ scope.row.intro_team_cd_val }}</span>
              </template>
            </el-table-column>
            <el-table-column
                align="center"
                prop="intro_type_cd_val"
                :resizable="false"
                :label="$lang('介绍团队类型')"
            >
              <template slot-scope="scope">
                <span>{{ scope.row.intro_type_cd_val }}</span>
              </template>
            </el-table-column>
            <el-table-column
                align="center"
                prop="responsible"
                :resizable="false"
                :label="$lang('责任归属')"
            >
              <template slot-scope="scope">
                <span>{{ scope.row.responsible }}</span>
              </template>
            </el-table-column>
            <el-table-column
                fixed="right"
                align="center"
                prop="remark"
                :resizable="false"
                :label="$lang('详情备注')"
            >
              <template slot-scope="scope">
                <span>{{ scope.row.remark }}</span>
              </template>
            </el-table-column>
          </el-table>
        </div>
      </div>
    </el-tab-pane>
    <el-tab-pane :label="$lang('日志详情')" name="log">
      <div class="log__list">
        <div class="log__list-header">
          <span class="log__list-header-title">{{$lang('日志详情')}}</span>
        </div>
        <el-table
            :data="pagedOutWarehouseApprovalLogs.data"
            class="log__list-table"
            border
        >
          <el-table-column
              fixed
              prop="create_at"
              align="center"
              :resizable="false"
              :label="$lang('时间')"
          >
            <template slot-scope="scope">
              <span>{{ scope.row.create_at }}</span>
            </template>
          </el-table-column>
          <el-table-column
              fixed
              prop="create_by"
              align="center"
              :resizable="false"
              :label="$lang('提交人')"
          >
            <template slot-scope="scope">
              <span>{{ scope.row.create_by }}</span>
            </template>
          </el-table-column>
          <el-table-column
              fixed
              prop="message"
              align="center"
              :resizable="false"
              :label="$lang('详细信息')"
          >
            <template slot-scope="scope">
              <span>{{ scope.row.message }}</span>
            </template>
          </el-table-column>
        </el-table>
      </div>
    </el-tab-pane>
  </el-tabs>
</div>

<script type="text/javascript" src="../Public/lib/jquery/1.9.1/jquery.min.js?v=<{$tdink.config.VER_NUM}>"></script>
<script type="text/javascript" src="../Public/js/H-ui.js"></script>
<script type="text/javascript" src="../Public/js/H-ui.admin.js?<{$Think.config.VER_NUM}>"></script>
<script type="text/javascript" src="./Application/Tpl/Home/Public/js/vue-2.6.10.js"></script>
<script type="text/javascript" src="./Application/Tpl/Home/Public/js/axios.min.js"></script>
<script type="text/javascript" src="./Application/Tpl/Home/Public/js/element-ui-2.13.0.js"></script>
<script type="text/javascript" src="./Application/Tpl/Home/Public/js/element-en.js"></script>
<script src="./Application/Tpl/Home/Public/js/lodash-4.17.15.js"></script>
<script src="./Application/Tpl/Home/Public/warehouse/js/utils.js?v=<{$Think.const.V}>"></script>
<script type="text/javascript" src="./Application/Tpl/Home/Store/bus.js"></script>
<script>
    if (getCookie('think_language') !== "zh-cn") {
        ELEMENT.locale(ELEMENT.lang.en)
    }
</script>
<script>

    const PMS_HOST = "<{$PMS_HOST}>";
    const storeId = "<{$id}>";

    const vueApp = new Vue({
        el: '#outWarehouseApprovalView',
        components: {},
        data() {
            return {
                filter: {
                    status_cd: [],
                },
                pagination: {
                    current_page: 1,
                    per_page: 10,
                },
                activeName: "list",
                pagedOutWarehouseApprovalSummaryData: {},
                pagedOutWarehouseApprovals: {
                    data: []
                },
                pagedOutWarehouseApprovalLogs: {
                    data: []
                },
                improtBillAuditStatus: [],
                approvalTypeDialogVisible: false,
                type: null,
                auditNo: getUrlParameterByName('auditNo'),
                searching: false,
                loading: false,
                improtLoading: false,
                title: getUrlParameterByName('operName'),
            }
        },
        computed: {},
        watch: {
            activeName: {
                handler: function (value, oldValue) {
                    console.log("监听值", value);
                    if (value === 'log') { //切换到日志列表时

                    } else if (value === 'list') { //切换到列表时

                    }
                }
            }
        },
        created() {
            this.type = getUrlParameterByName('type')
            this.search();
            this.getLogs();
        },
        mounted() {
            document.getElementById("outWarehouseApprovalView").style.display = "block";
        },
        methods: {
            getLogs() {
                axios.get(`/index.php?g=Warehouse&m=ImprotBillAudit&a=getLog&audit_no=${this.auditNo}`).then((res) => {
                    console.log("列表日志", res);
                    this.pagedOutWarehouseApprovalLogs.data = res.data.data;
                })
            },
            search() {
                console.log(444);
                axios.get(`/index.php?g=Warehouse&m=ImprotBillAudit&a=getDetailList&audit_no=${this.auditNo}`).then(res => {
                    let data = res.data.data;
                    this.pagedOutWarehouseApprovalSummaryData = data.info_data;
                    if (data.detail_data) {
                        this.pagedOutWarehouseApprovals.data = data.detail_data;
                    }
                });
            },
        }
    });

</script>
</body>
</html>