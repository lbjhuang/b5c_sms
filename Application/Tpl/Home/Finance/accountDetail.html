<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>账户详情</title>
    <link rel="stylesheet" href="../Public/utils/css/public.style.css?v=<{$Think.config.VER_NUM}>">
    <link rel="stylesheet" href="../Public/css/element-ui-2.2.css?v=<{$Think.config.VER_NUM}>?v=<{$Think.config.VER_NUM}>">
    <link rel="stylesheet" href="../Public/../Hr/hrstyle.css?v=<{$Think.config.VER_NUM}>?v=<{$Think.config.VER_NUM}>">
    <link rel="stylesheet" href="../Public/icon/css/font-awesome.min.css?v=<{$Think.config.VER_NUM}>">
    <link rel="stylesheet" href="./Application/Tpl/Home/Public/css/default.css?v=<{$Think.const.V}>">
</head>

<style>
    [v-cloak] {
        display: none;
    }

    .active {
        color: #263238;
    }

    .tab {
        color: #c8d2d7;
    }

    .tab span {
        cursor: pointer;
    }

    .tab span:hover {
        color: #48576a;
    }
    .el-pagination{
        margin-bottom: 180px;
    }

    .export-wrap{
        white-space: nowrap;
    }

    .export-wrap .occupy{
        display: inline-block;
        width: 49.5%;
    }
    .basicInformation .basicInformation_title{
        background: #546e7a;
        color: #fff;
        font-size: 16px;
        height: 40px;
        line-height: 40px;
        padding-left: 20px;
    }
    .basicInformation ul{
        margin: 0;
        padding: 0;
    }
    .basicInformation ul li{
        width: 100%;
        display: flex;
        border-left: 1px solid rgb(236, 239, 241);
        border-right: 1px solid rgb(236, 239, 241);
        border-bottom: 1px solid rgb(236, 239, 241);
    }
    .basicInformation ul li div{
        display: flex;
        flex: 1;
        justify-content: center;
        font-size: 14px;
        padding: 15px 10px;
        align-items: center;
        border-right: 1px solid rgb(236, 239, 241);
    }
    .basicInformation ul li div:last-child{
        border-right: 0;
    }
    .basicInformation ul li div:nth-child(odd){
        background: #f5fafe;
    }
</style>

<body>
    <div id="bankLog" class="show-list" v-cloak>
        <div class="use-title tab">
            <span style="margin-right: 35px;" :class="{'active':type == 'acc'}" @click="viewAcc()">{{$lang('账户详情')}}</span>
            <span :class="{'active':type == 'log'}" @click="viewLog()">{{$lang('操作日志')}}</span>
        </div>
        <div class="baseline"></div>
        <div v-if="type == 'acc'">
            <div class="use-row">
                <div class="col-100">
                    <!-- <table class="table-list">
                        <thead>
                            <tr>
                                <th>{{$lang('公司名称')}}</th>
                                <th>{{$lang('账户类型')}}</th>
                                <th>{{$lang('')}}</th>
                                <th>{{$lang('')}} </th>
                                <th </th>
                                <th>{{$lang('')}}</th>
                                <th></th>
                                <th></th>
                                <th>{{$lang('')}}</th>
                                <th>{{$lang('')}}</th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td></td>
                                <td>{{bankData.reason}}</td>
                                <td></td>
                            </tr>
                        </tbody>
                    </table> -->
                    <div class="basicInformation">
                        <div class="basicInformation_title">
                            <span>{{$lang('基本信息')}}</span>
                        </div>
                        <ul>
                            <li>
                                <div>
                                    <span>{{$lang('账户归属')}}</span>
                                </div>
                                <div>
                                    <span>{{$lang(getValue('account_class_cd', bankData.accountClassCd))}}</span>
                                </div>
                                <div>
                                    <span>{{$lang('公司名称')}}</span>
                                </div>
                                <div>
                                    <span>{{$lang(getValue(bankData.accountClassCd === 'N003510001' ? 'company' : 'supplier' , bankData.companyCode))}}</span>
                                </div>
                                <div>
                                    <span>{{$lang('账户类型')}}</span>
                                </div>
                                <div>
                                    <span>{{$lang(getValue('account',bankData.accountType))}}</span>
                                </div>
                            </li>
                            <li>
                                <div>
                                    <span>{{$lang('平台名称')}}</span>
                                </div>
                                <div>
                                    <span>{{$lang(bankData.payment_channel_cd_val)}}</span>
                                </div>
                                <div>
                                    <span>{{$lang('银行名称')}}</span>
                                </div>
                                <div>
                                    <span>{{$lang(bankData.openBank)}}</span>
                                </div>
                                <div>
                                    <span>{{$lang('银行简称')}}</span>
                                </div>
                                <div>
                                    <span>{{$lang(bankData.bank_short_name)}}</span>
                                </div>
                                
                            </li>
                            <li>
                                <div>
                                    <span>{{$lang('银行/平台账号')}}</span>
                                </div>
                                <div>
                                    <span>{{bankData.accountBank}}</span>
                                </div>
                                <div>
                                    <span>{{$lang('币种')}}</span>
                                </div>
                                <div>
                                    <span>{{getValue('currency',bankData.currencyCode)}}</span>
                                </div>
                                <div>
                                    <span>SWIFT Code</span>
                                </div>
                                <div>
                                    <span>{{bankData.swiftCode}}</span>
                                </div>
                                
                            </li>
                            <li>
                                <div>
                                    <span>BSB No.</span>
                                </div>
                                <div>
                                    <span>{{bankData.bsbNo}}</span>
                                </div>
                                <div>
                                    <span>{{$lang('账户备注')}}</span>
                                </div>
                                <div>
                                    <span>{{$lang(bankData.reason)}}</span>
                                </div>
                                <div>
                                    <span>{{$lang('状态')}}</span>
                                </div>
                                <div>
                                    <span>{{$lang(getValue('accountListState',bankData.state))}}</span>
                                </div>
                                
                            </li>
                            <li>
                                <div>
                                    <span>{{$lang('本地结算代码')}}</span>
                                </div>
                                <div>
                                    <span>{{$lang(bankData.bank_settlement_code)}}</span>
                                </div>
                                <div>
                                    <span>{{$lang('银行地址')}}</span>
                                </div>
                                <div>
                                    <span>{{$lang(bankData.bank_address)}}</span>
                                </div>
                                <div>
                                    <span>{{$lang('银行详细地址')}}</span>
                                </div>
                                <div>
                                    <span>{{$lang(bankData.bank_address_detail)}}</span>
                                </div>
                                
                            </li>
                            <li>
                                <div>
                                    <span>{{$lang('银行邮编')}}</span>
                                </div>
                                <div>
                                    <span>{{$lang(bankData.bank_postal_code)}}</span>
                                </div>
                                <div>
                                    <span>{{$lang('账户种类')}}</span>
                                </div>
                                <div>
                                    <span>{{$lang(bankData.bank_account_type_val)}}</span>
                                </div>
                                <div>
                                    <span></span>
                                </div>
                                <div>
                                    <span></span>
                                </div>
                                <!-- <div>
                                    <span></span>
                                </div>
                                <div>
                                    <span></span>
                                </div> -->
                            </li>
                        </ul>
                    </div>
                    

                </div>
            </div>
            <div class="baseline"></div>
            <div class="use-row">
                <div class="col-100">
                    <span style="padding: 0 0.6rem 0 0" class="el-form-item__label">{{$lang('时间筛选')}}</span>
                    <el-date-picker v-model="billTimes" type="daterange" align="right" unlink-panels :range-separator="$lang('至')" :start-placeholder="$lang('开始日期')" :end-placeholder="$lang('结束日期')" :picker-options="pickerOptions"> </el-date-picker>
                    <el-button type="primary" style="margin-left:20px;" @click="viewAcc()">{{$lang('查询')}}</el-button>
                    <el-button @click="reset()">{{$lang('重置')}}</el-button>
                </div>
            </div>
            <div class="use-row export-wrap">
                <div class="col-50 result-num occupy">
                    {{$lang('搜索结果')}} :&nbsp;&nbsp;{{$lang('共')}}
                    <b>{{billCount}}</b> {{$lang('条')}}
                </div>
                <div class="col-50 text-right occupy">
                    <el-button type="primary" @click="exportBills()"> {{$lang('导出')}} </el-button>
                </div>
            </div>
            <div class="use-row" v-if="type == 'acc'">
                <div class="col-100">
                    <table class="table-list" id="billList">
                        <thead>
                            <tr>
                                <th>{{$lang('流水ID')}}</th>
                                <th>{{$lang('流水类型')}}</th>
                                <th>{{$lang('收支方向')}}</th>
                                <th>{{$lang('金额')}}</th>
                                <th>{{$lang('发生日期')}}</th>
                                <th>{{$lang('创建时间')}}</th>
                                <th>{{$lang('操作')}}</th>

                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="item in billList">
                                <td>{{item.accountTransferNo}}</td>
                                <td>{{item.transactionType}}</td>
                                <td>{{getValue('transfer',item.transferType)}}</td>
                                <td>{{numberFormat(fixedNum(item.amountMoney,2))}}</td>
                                <td>{{item.transferTime}}</td>
                                <td>{{item.createTime}}</td>
                                <td><el-button type="primary" @click="viewDetail(item)">查看</el-button></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="use-row">
                <div class="col-100 text-right">
                    <el-pagination @size-change="handleSizeChange" @current-change="handleCurrentChange" :current-page.sync="billPage" :page-sizes="[20, 50, 100, 200,300]" :page-size="billPageSize" layout="sizes, prev, pager, next,jumper" :total="billCount"></el-pagination>
                </div>
            </div>
        </div>
        <div v-else>
            <div class="use-row">
                <div class="col-100 result-num">
                    {{$lang('搜索结果')}}: &nbsp;&nbsp;{{$lang('共')}}
                    <b>{{logCount}}</b> {{$lang('条')}}
                </div>
            </div>
            <div class="use-row">
                <div class="col-100">
                    <table class="table-list">
                        <thead>
                            <tr>
                                <th>{{$lang('时间')}}</th>
                                <th>{{$lang('操作人')}}</th>
                                <th>{{$lang('详细信息')}} </th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr v-for="(item,index) in logList">
                                <td>{{item.create_time}}</td>
                                <td>{{item.create_user}}</td>
                                <td>{{$lang(item.msg)}}</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="use-row">
                <div class="col-100 text-right">
                    <el-pagination @size-change="handleSizeChange" @current-change="handleCurrentChange" :current-page.sync="billPage" :page-sizes="[20, 50, 100, 200,300]" :page-size="logPageSize" layout="sizes, prev, pager, next,jumper" :total="logCount"></el-pagination>
                </div>
            </div>
        </div>
    </div>
    <iframe name="txtArea1" style="display: none"></iframe>
    <script type="text/javascript" src="../Public/lib/jquery/1.9.1/jquery.min.js"></script>
    <script type="text/javascript" src="../Public/utils/utils.js"></script>
    <script type="text/javascript" src="../Public/lib/jquery.table2excel.js"></script>
    <script src="../Public/js/H-ui.js"></script>
    <script src="../Public/js/H-ui.admin.js?v=<{$Think.config.VER_NUM}>"></script>
    <script type="text/javascript" src="../Public/js/vue.2.5.13.js"></script>
    <script type="text/javascript" src="../Public/js/axios.min.js"></script>
    <script type="text/javascript" src="../Public/js/element-ui-2.2.js"></script>
    <script type="text/javascript" src="./Application/Tpl/Home/Public/js/element-en.js"></script>
    <script>    
        if(getCookie('think_language') !== "zh-cn" ){
            ELEMENT.locale(ELEMENT.lang.en)
        }
        var log = new Vue({
            el: '#bankLog',
            data: {
                type: 'acc',
                bankData: {},
                logList: [],
                billList: [],
                baseData: {},
                logPage: 1,
                billPage: 1,
                logPageSize: 20,
                billPageSize: 20,
                logCount: 10,
                billCount: 10,
                billTimes: [],
                fixedNum: function(param, num) {
                    num = num || 0;
                    var floatNum = parseFloat(param);
                    if (!isNaN(floatNum)) {
                        return floatNum.toFixed(num);
                    }
                },
                numberFormat:utils.numberFormat.bind(utils),
                pickerOptions: {},
                getValue: function(dataName, key) {
                    var result = '';
                    for (var i in this.baseData[dataName]) {
                        if (dataName !== 'supplier') {
                            if (this.baseData[dataName][i].cd == key) {
                                result = this.baseData[dataName][i].cdVal
                                break;
                            }
                        } else {
                            // 获取供应商公司名称
                            if (this.baseData[dataName][i].ID == key) {
                                result = this.baseData[dataName][i].SP_NAME
                                break;
                            }
                        }
                    }
                    return result ? result : '-';
                }
            },
            created: function() {
                this.pickerOptions = {
                    shortcuts: [{
                        text: this.$lang('最近一周'),
                        onClick: function(picker) {
                            var end = new Date(),
                                start = new Date();
                            start.setTime(start.getTime() - 3600 * 1000 * 24 * 7);
                            picker.$emit('pick', [start, end]);
                        }
                    }, {
                        text: this.$lang('最近一个月'),
                        onClick: function(picker) {
                            var end = new Date(),
                                start = new Date();
                            start.setTime(start.getTime() - 3600 * 1000 * 24 * 30);
                            picker.$emit('pick', [start, end]);
                        }
                    }, {
                        text: this.$lang('最近三个月'),
                        onClick: function(picker) {
                            var end = new Date(),
                                start = new Date();
                            start.setTime(start.getTime() - 3600 * 1000 * 24 * 90);
                            picker.$emit('pick', [start, end]);
                        }
                    }]
                }
                this.search();
            },
            methods: {
                search: function() {
                    var _this = this;
                    var param = {
                        "data": {
                            "query": {
                                "company": "true",
                                "currency": "true",
                                "accountListState": "true",
                                "account": "true",
                                "transfer": "true",
                                "account_class_cd": "true",
                                "supplier": "true"
                            }
                        }
                    }
                    axios.post("/index.php?m=finance&a=commonData", param).then(function(res) {
                        if (res.data.code == 2000) {
                            log.baseData = res.data.data;
                            log.bankData = JSON.parse(sessionStorage.getItem('backAccount'));
                            log.viewAcc()                            
                        } else {
                            _this.$message({
                                message: _this.$lang('基础数据查询失败'),
                                type: 'warning'
                            });
                        }
                    })
                },
                viewAcc: function() {
                    var _this = this;
                    this.type = "acc";
                    var param = {
                        data: {
                            query: {
                                accountBank: log.bankData.accountBank,
                                createStartTime: this.billTimes.length ? utils.dateFormat(this.billTimes[0], 'yyyy-MM-dd') : null,
                                createEndTime: this.billTimes.length ? utils.dateFormat(this.billTimes[1], 'yyyy-MM-dd') : null,
                                pageIndex: log.billPage,
                                pageSize: log.billPageSize
                            }
                        }
                    }
                    axios.post("/index.php?m=finance&a=turnover", param).then(function(res) {
                        var result = res.data;
                        if (result.code == 2000) {     
                            log.billList = result ? result.data.pageData : []
                            log.billCount = +result.data.totalCount;                    
                        } else {
                            _this.$message({
                                message:  _this.$lang('订单数据查询失败'),
                                type: 'warning'
                            });
                        }
                    })
                },
                viewDetail:function(item){
                    newTab("/index.php?m=finance&a=billing_detail&turnover_id=" + item.turnoverId,'日记账详情');
                },
                viewLog: function() {
                    var _this = this;
                    this.type = "log";
                    var param = {
                        data: {
                            query: {
                                orderNo: this.bankData.id,
                                pageIndex: this.logPage,
                                pageSize: this.logPageSize,
                            }
                        }
                    }

                    axios.post("/index.php?m=finance&a=operationLog", param).then(function(res) {
                        var result = res.data;
                        if (result.code == 2000) {
                            log.logList = result ? result.data.pageData : []
                            log.logCount = +result.data.totalCount;
                        } else {
                            _this.$message({
                                message: _this.$lang('获取数据失败'),
                                type: 'warning'
                            });
                        }
                    })


                },
                handleSizeChange: function(size) {
                    if (this.type == 'acc') {
                        this.billPageSize = size;
                        this.viewAcc();
                    } else {
                        this.logPageSize = size;
                        this.viewLog();
                    }
                },
                handleCurrentChange: function(currentPage) {
                    if (this.type == 'acc') {
                        this.billPage = currentPage;
                        this.viewAcc();
                    } else {
                        this.logPage = currentPage;
                        this.viewLog();
                    }
                },
                reset: function() {
                    this.billTimes = [];
                    this.viewAcc()
                },
                //导出模版
                exportBills:function(){
                    $("#billList").table2excel({
                        filename : this.$lang("订单列表") + ".xls", //文件名称
                        name: "Excel Document Name.xlsx",
                    });
                }
            }
        })
    </script>
</body>

</html>