<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="./Application/Tpl/Home/Public/utils/css/public.style.css?v=<{$Think.const.V}>">
    <link rel="stylesheet" href="./Application/Tpl/Home/Public/css/element-ui-2.2.css?v=<{$Think.const.V}>">
    <link rel="stylesheet" href="./Application/Tpl/Home/Public/css/default.css?v=<{$Think.const.V}>">
    <title>订单核销详情</title>
</head>
<style> 
    [v-cloak]{
        display: none;
    }
    h4{
        margin: 0;
        line-height: 40px;
    }
    .entry-info{
        width: 100%;
        text-align: center;
        border-left: 1px solid #E0E0E0;
        border-bottom: 1px solid #E0E0E0;
        font-size: 15px;
        margin-bottom:20px;
    }
    .entry-info caption{
        height: 40px;
        background-color: #546E7A;
        color: white;
        text-align: left;
        font-size: 15px;
        line-height: 40px;
        padding-left: 20px;
    }
    .entry-info tr td{
        border-right: 1px solid #E0E0E0;
        border-top: 1px solid #E0E0E0;
        padding: 10px 15px;
        font-size: 14px;
    }
    .entry-info tr td:nth-child(odd){
        width: 13.333%;
        background: #f5fafe;
    }
    .entry-info tr td:nth-child(even){
        width: 20%;
        /* background: #f5fafe; */
    }
    .entry-info tr td .el-input__inner{
        height: 35px;
    }
    .input-with-select .el-input-group__prepend {
        background-color: #fff;
    }
    .currency{
        width: 90px;
    }
   .el-select .el-input__inner{
        width: 100%;
    }
    .width-100{
        width: 100% !important;
    }
    .required::after{
        content: "*";
        color:red;
        margin-left: 5px;
    }
    .order-list{
        width: 100%;
        text-align: center;
        border-left: 1px solid #E0E0E0;
        border-bottom: 1px solid #E0E0E0;
        font-size: 15px;
        /* margin-top: -20px */
    }
    .order-list tr th{
        border-right: 1px solid #E0E0E0;
        border-top: 1px solid #E0E0E0;
        padding: 10px 15px;
        font-size: 14px;
        background: #546E7A;
        color: white;
    }
    .order-list tr td{
        border-right: 1px solid #E0E0E0;
        border-top: 1px solid #E0E0E0;
        padding: 10px 15px;
        font-size: 14px;
    }
</style>
<body>
    <div id="receipt" v-cloak>
        <el-container>
            <el-header>
                <el-row>
                    <el-col :span="12"> 
                        <h4>{{$lang('订单核销详情')}}</h4> 
                    </el-col>
                </el-row>
            </el-header>
            <el-main>
                <table class="entry-info" border="0" cellpadding="0" cellspacing="0" >
                    <caption>{{$lang('基本信息')}}</caption>
                    <tbody>
                        <tr>
                            <td>{{$lang('平台')}}</td>
                            <td>
                                <span v-if="detail.bill_cancellation">{{detail.bill_cancellation.platform_name}}</span>
                            </td>
                            <td>{{$lang('站点')}}</td>
                            <td>
                                <span v-if="detail.bill_cancellation">{{detail.bill_cancellation.site_name}}</span>
                            </td>
                            <td>{{$lang('店铺')}}</td>
                            <td>
                                <span v-if="detail.bill_cancellation">{{detail.bill_cancellation.store_name}}</span>
                            </td>
                        </tr>
                        <tr>                           
                            <td>{{$lang('店铺注册公司')}}</td>
                            <td>
                                <span v-if="detail.bill_cancellation">{{detail.bill_cancellation.company_name}}</span>
                            </td>
                            <td>{{$lang('销售团队')}}</td>
                            <td>
                                <span v-if="detail.bill_cancellation">{{detail.bill_cancellation.sale_team_name}}</span>
                            </td>
                            <td>{{$lang('平台订单号')}}</td>
                            <td>
                                <span v-if="detail.bill_cancellation">{{detail.bill_cancellation.thr_order_no}}</span>
                            </td>
                        </tr>
                        <tr>
                            <td>{{$lang('交易币种')}}</td>
                            <td>
                                <span v-if="detail.bill_cancellation">{{detail.bill_cancellation.currency}}</span>
                            </td>
                            <td>{{$lang('订单状态')}}</td>
                            <td>
                                <span v-if="detail.bill_cancellation">{{detail.bill_cancellation.bwc_order_status_val}}</span>
                            </td>
                            <td>{{$lang('待核销收入')}}</td>
                            <td>
                                <span v-if="detail.bill_cancellation">{{detail.bill_cancellation.wait_cancellation_amount}}</span>
                            </td>
                        </tr>
                    </tbody>
                </table>

                <table style="margin: 0;" class="entry-info" border="0" cellpadding="0" cellspacing="0" >
                    <caption>{{$lang('ERP收入信息')}}</caption>
                    <tbody>
                        <tr>
                            <td>{{$lang('ERP收入总金额(交易币种)')}}</td>
                            <td>
                                <span v-if="detail.bill_cancellation">{{detail.bill_cancellation.in_come_amount}}</span>
                            </td>
                            <td>{{$lang('ERP收入更新时间')}}</td>
                            <td>
                                <span v-if="detail.bill_cancellation">{{detail.bill_cancellation.zd_date}}</span>
                            </td>
                        </tr>
                    </tbody>
                </table>
                <table border="0" cellpadding="0" cellspacing="0" class="order-list">
                    <thead>
                        <tr>
                            <th>{{$lang('关联出入库ID')}}</th>
                            <th>{{$lang('仓库')}}</th>
                            <th>{{$lang('SKU编码')}}</th>
                            <th>{{$lang('条形码')}}</th>
                            <th>{{$lang('商品名称')}}</th>
                            <th>{{$lang('商品属性')}}</th>
                            <th>{{$lang('图片')}}</th>
                            <th>{{$lang('批次号')}}</th>
                            <th>{{$lang('数量')}}</th>
                            <th>{{$lang('不含税收入（原币种）')}}</th>
                            <th>{{$lang('增值税率')}}</th>
                            <th>{{$lang('销项增值税额（原币种）')}}</th>
                            <th>{{$lang('累计收入')}}</th>
                            <th>{{$lang('操作人')}}</th>
                            <th>{{$lang('生成时间')}}</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-for="item in detail.in_come_data">
                            <td>{{item.bill_no}}</td>
                            <td>{{item.warehouse}}</td>
                            <td>{{item.sku_id}}</td>
                            <td>{{item.upc_id}}</td>
                            <td>{{item.spu_name}}</td>
                            <td>{{item.attributes}}</td>
                            <td style="position: relative;">
                            <img v-if="!!item.image_url" :src="item.image_url" style="cursor: pointer;" width="80" height="80" @mouseenter="showImg(item)" @mouseleave="showImg(item)">
                            <div style="position: absolute; top: 10px; left: 100px; box-shadow: 0 0 5px #536d7a;z-index:999" v-if="item.bigImg">
                                <img :src="item.image_url" width="200" height="200">
                            </div>
                            </td>
                            <td>{{item.batch_code}}</td>
                            <td>{{item.send_num}}</td>
                            <td>{{item.sale_amount_no_tax}}</td>
                            <td>{{item.tax_rate}}</td>
                            <td>{{item.tax}}</td>
                            <td>{{item.amount_sum}}</td>
                            <td>{{item.zd_user}}</td>
                            <td>{{item.zd_date}}</td>
                        </tr>
                    </tbody>
                </table>

                <table style="margin: 20px 0 0 0;" class="entry-info" border="0" cellpadding="0" cellspacing="0" >
                    <caption>{{$lang('导入账单信息')}}</caption>
                    <tbody>
                        <tr>
                            <td>{{$lang('已核销总金额(交易币种)')}}</td>
                            <td>
                                <span v-if="detail.bill_cancellation">{{detail.bill_amount_counts}}</span>
                            </td>
                            <td>{{$lang('核销金额更新时间')}}</td>
                            <td>
                                <span v-if="detail.bill_cancellation">{{detail.bill_cancellation.created_at}}</span v-if="detail.bill_cancellation">
                            </td>
                        </tr>
                    </tbody>
                </table>
                <table border="0" cellpadding="0" cellspacing="0" class="order-list">
                    <thead>
                        <tr>
                            <th>{{$lang('账单ID')}}</th>
                            <th>{{$lang('账单时间区间')}}</th>
                            <th>{{$lang('账单金额')}}</th>
                            <th>{{$lang('导入人')}}</th>
                            <th>{{$lang('业务审核人')}}</th>
                            <th>{{$lang('财务审核人')}}</th>
                            <th>{{$lang('生效时间')}}</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr v-for="item in detail.bill_cancellation_list">
                            <td>{{item.platform_bill_no}}</td>
                            <td>{{item.s_bill_time}} {{$lang('至')}} {{item.e_bill_time}}</td>
                            <td>
                            <span v-if="item.bill_amount > 0" style="color:green;">+{{item.bill_amount}}</span>
                            <span v-else-if="item.bill_amount < 0" style="color:red;">{{item.bill_amount}}</span>
                            <span v-else>{{item.bill_amount}}</span>
                            </td>
                            <td>{{item.created_by}}</td>
                            <td>{{item.business_audit_man}}</td>
                            <td>{{item.finance_audit_man}}</td>
                            <td>{{item.created_at}}</td>
                        </tr>
                    </tbody>
                </table>
            </el-main>
        </el-container>
    </div>
    
<!--引入js-->
<script type="text/javascript" src="./Application/Tpl/Home/Public/lib/jquery/1.9.1/jquery.min.js"></script>
<script type="text/javascript" src="./Application/Tpl/Home/Public/js/H-ui.js"></script>
<script type="text/javascript" src="./Application/Tpl/Home/Public/utils/utils.js"></script>
<script type="text/javascript" src="./Application/Tpl/Home/Public/js/H-ui.admin.js?v=<{$Think.config.VER_NUM}>"></script>
<script type="text/javascript" src="./Application/Tpl/Home/Public/js/vue.2.5.13.js"></script>
<script type="text/javascript" src="./Application/Tpl/Home/Public/js/axios.min.js"></script>
<script type="text/javascript" src="./Application/Tpl/Home/Public/js/element-ui-2.2.js"></script>
<script type="text/javascript" src="./Application/Tpl/Home/Public/js/element-en.js"></script>
<script type="text/javascript" src="./Application/Tpl/Home/Public/js/queryString.js?v=<{$Think.config.VER_NUM}>"></script>
<script>
    if (getCookie('think_language') !== "zh-cn") {
        ELEMENT.locale(ELEMENT.lang.en)
    }

    var  vm = new Vue({
        el:'#receipt',
        data:{
            detail:{},
            baseData: {},
            getValue: function(dataName, key) {
                var result = "";
                for (var i in this.baseData[dataName]) {
                    if (this.baseData[dataName][i].cd == key) {
                        result = this.baseData[dataName][i].cdVal;
                        break;
                    }
                }
                return result ? result : "";
            }
        },
        created:function(){
            this.getDate();
            this.search();
        },
        methods: {
            showImg: function showImg(item) {
                Vue.set(item, 'bigImg', !item.bigImg);
            },
            search: function() {
                var _this = this;
                var param = {
                    data: {
                        query: {
                            bill_status: "true",
                        }
                    }
                };
                axios.post("/index.php?g=oms&m=CommonData&a=commonData", param)
                    .then(function(res) {
                        if (res.data.code == 2000) {
                            _this.baseData = res.data.data;
                        } else {
                            _this.$message.warning(_this.$lang("数据查询失败"));
                        }
                    });
            },
            getDate: function () {
                axios.defaults.headers.post['Content-Type'] = 'application/x-www-form-urlencoded';
                var param = utils.parseQuery(window.location.search);
                var data = {
                    data:{
                        query:{
                            thr_order_no:param.thr_order_no
                        }
                    }
                }
                var _this = this;

                axios.post("/index.php?m=finance&a=platform_bill_cancellation_detail", data)
                    .then(function(res) {
                        var result = res.data;
                        if (result.code == 2000) {
                            _this.detail = result.data;
                        } else {
                            _this.$message.warning(_this.$lang("详情数据查询失败"));
                        }
                    });
            },
        },
    })
</script>
</body>
</html>

 