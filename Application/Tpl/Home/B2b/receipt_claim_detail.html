<!doctype html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="/Application/Tpl/Home/Public/utils/css/public.style.css?v=<{$Think.const.V}>">
    <link rel="stylesheet" href="/Application/Tpl/Home/Public/css/element-ui-2.2.css?v=<{$Think.const.V}>">
    <link rel="stylesheet" href="/Application/Tpl/Home/Public/css/normailize.css?v=<{$Think.const.V}>">
    <link rel="stylesheet" href="/Application/Tpl/Home/Public/icon/css/font-awesome.min.css?v=<{$Think.const.V}>">
    <link rel="stylesheet" href="/Application/Tpl/Home/B2b/css/detail.css?v=<{$Think.const.V}>">
    <!--    <link rel="stylesheet" href="./Application/Tpl/Home/Public/css/default.css?v=<{$Think.const.V}>">-->
    <title>收款认领详情</title>
    <style>
        [v-cloak] {
            display: none;
        }

        .is_added_btn {
            display: inline-block;
            width: 70px;
            height: 40px;
            line-height: 40px;
        }

        .order_dialog .el-dialog {
            max-height: 720px;
            overflow: hidden;
        }

        .order_dialog .el-dialog table {
            max-width: 500px;
            overflow: auto
        }

        .order_dialog .inline-td td {
            padding: 8px 6px;
        }

        .order_dialog .inline-td td span {
            white-space: normal;
        }

        .table_box {
            overflow: auto;
            height: 400px;
        }

        .input-with-select .el-input-group__prepend {
            background-color: #fff;
        }

        .main-basic-table td.info-title {
            width: 200px !important;
        }

        .main-basic-table tbody td,
        .child-basic-table tbody td {
            white-space: normal;
        }
    </style>
    <style>
        .big__order-list{

        }
        .big__order-list .list__data{

        }
        .big__order-list .list__data .el-table__header-wrapper tr th{
            background-color: #F6F9FA;
            color: #566F7B;
        }

        .big__order-data{

        }
        .big__order-dialog .el-table__body-wrapper{
            height: 325px !important;
            overflow: auto !important;
        }

        .big__order-data .actions{
            display: flex;
            justify-content: center;
            align-items: center;
            margin-top: 20px;
        }
        .order__info-table {
            width: 100%;
            empty-cells: show;
            background-color: transparent;
            border-collapse: collapse;
            border-spacing: 0;
        }
        .main__basic-info-big-order{
            margin-top: 20px;
        }

        .order__info-table-header {
            height: 38px;
            text-align: left !important;
            width: 100%;
            line-height: 38px;
            font-size: 16px;
            color: #FFFFFF !important;
            background: #546E7A !important;
            padding: 0px !important;
            text-indent: 20px;
        }

        .order__info-table .order__info-table-tbody td {
            font-size: 13px;
            color: #263238;
            letter-spacing: 0;
            border-bottom: 1px solid #ECEFF1;
            border-top: 1px solid #ECEFF1;
            border-left: 1px solid #CADEE7;
            border-right: 1px solid #CADEE7;
            padding: 0.65rem;
        }

        .order__info-table .order__info-table-tbody tr td:nth-child(odd) {
            background: #F7F9FB;
            color: #546E7A;
            letter-spacing: 0;
            text-align: center;
            width: 10%;
        }

        .order__info-table-required-filed {
            /*color: #FF0000;*/
        }


        .summary__table {
            width: 100%;
            empty-cells: show;
            background-color: transparent;
            border-collapse: collapse;
            border-spacing: 0;
        }

        .summary__table-header {
            height: 38px;
            text-align: left !important;
            width: 100%;
            line-height: 38px;
            font-size: 16px;
            color: #FFFFFF !important;
            background: #546E7A !important;
            padding: 0px !important;
            text-indent: 20px;
        }

        .summary__table .summary__table-tbody td {
            font-size: 13px;
            color: #263238;
            letter-spacing: 0;
            border-bottom: 1px solid #ECEFF1;
            border-top: 1px solid #ECEFF1;
            border-left: 1px solid #CADEE7;
            border-right: 1px solid #CADEE7;
            padding: 0.65rem;
        }

        .summary__table .summary__table-tbody tr td:nth-child(odd) {
            background: #F7F9FB;
            color: #546E7A;
            letter-spacing: 0;
            text-align: center;
            width: 10%;
        }

        .summary__table-required-filed {
            /*color: #FF0000;*/
        }

    </style>
</head>

<body>
<div id="main-detail" v-cloak style="padding:0px 0px 50px;overflow: hidden;box-sizing: border-box;height: 100%;">
    <div class="main-content" style="height:100%;overflow: auto;padding: 20px 20px 20px 30px;" v-if="detailData.basis">
        <div class="main-basic-info">
            <header style="margin-top:10px">
                {{$lang('基本信息')}}
            </header>
            <table border="0" cellspacing="0" cellpadding="0" class="main-basic-table" style="table-layout: auto;width: 100%;">
                <tbody>
                <tr>
                    <td class="info-title">
                        <div class="cell">
                            {{$lang('流水ID')}}
                        </div>
                    </td>
                    <td>
                        <span>{{detailData.basis.account_transfer_no}}</span>
                    </td>
                    <td class="info-title">
                        <div class="cell">
                            {{$lang('流水类型')}}
                        </div>
                    </td>
                    <td>
                        <span>{{$lang(detailData.basis.pay_or_rec_val)}}</span>
                    </td>
                </tr>
                <tr>
                    <td class="info-title">
                        <div class="cell">
                            {{$lang('币种')}}
                        </div>
                    </td>
                    <td>
                        <span>{{detailData.basis.currency_code_val}}</span>
                    </td>
                    <td class="info-title">
                        <div class="cell">
                            {{$lang('金额')}}
                        </div>
                    </td>
                    <td>
                        <span>{{detailData.basis.amount_money | separatNum}}</span>
                    </td>
                </tr>
                <tr>
                    <td class="info-title">
                        <div class="cell">
                            {{$lang('我方账户名')}}
                        </div>
                    </td>
                    <td>
                        <span>{{detailData.basis.company_code_val}}</span>
                    </td>
                    <td class="info-title">
                        <div class="cell">
                            {{$lang('对方账户名')}}
                        </div>
                    </td>
                    <td>
                        <span>{{detailData.basis.opp_company_name}}</span>
                    </td>
                </tr>
                <tr>
                    <td class="info-title">
                        <div class="cell">
                            {{$lang('我方银行或平台名称')}}
                        </div>
                    </td>
                    <td>
                        <span>{{$lang(detailData.basis.our_bank)}}</span>
                    </td>
                    <td class="info-title">
                        <div class="cell">
                            {{$lang('对方银行或平台名称')}}
                        </div>
                    </td>
                    <td>
                        <span>{{detailData.basis.opp_account_bank}}</span>
                    </td>
                </tr>
                <tr>
                    <td class="info-title">
                        <div class="cell">
                            {{$lang('我方银行账号')}}
                        </div>
                    </td>
                    <td>
                        <span>{{detailData.basis.our_open_bank}}</span>
                    </td>
                    <td class="info-title">
                        <div class="cell">
                            {{$lang('对方银行账号')}}
                        </div>
                    </td>
                    <td>
                        <span>{{detailData.basis.opp_open_bank}}</span>
                    </td>
                </tr>
                <tr>
                    <td class="info-title">
                        <div class="cell">
                            {{$lang('我方银行SWIFT CODE')}}
                        </div>
                    </td>
                    <td>
                        <span>{{detailData.basis.our_swift_code}}</span>
                    </td>
                    <td class="info-title">
                        <div class="cell">
                            {{$lang('对方银行SWIFT CODE')}}
                        </div>
                    </td>
                    <td>
                        <span>{{detailData.basis.other_swift_code}}</span>
                    </td>
                </tr>
                <tr>
                    <td class="info-title">
                        <div class="cell">
                            {{$lang('凭证文件')}}
                        </div>
                    </td>
                    <td>
                        <div v-for="item in detailData.basis.credentials_file">
                            <a class="file_type" :href="'/index.php?m=order_detail&a=download&file='+item.savename">{{item.name}}</a>
                        </div>

                    </td>
                    <td class="info-title">
                        <div class="cell">
                            {{$lang('发生日期')}}
                        </div>
                    </td>
                    <td>
                        <span>{{detailData.basis.transfer_time}}</span>
                    </td>
                </tr>
                <tr>
                    <td class="info-title">
                        <div class="cell">
                            {{$lang('创建人')}}
                        </div>
                    </td>
                    <td>
                        <span>{{detailData.basis.create_user}}</span>
                    </td>
                    <td class="info-title">
                        <div class="cell">
                            {{$lang('创建时间')}}
                        </div>
                    </td>
                    <td>
                        <span>{{detailData.basis.create_time}}</span>
                    </td>
                </tr>
                <tr>
                    <td class="info-title">
                        <div class="cell">
                            {{$lang('预分方向')}}
                        </div>
                    </td>
                    <td>
                        <span>{{$lang(detailData.basis.transfer_type_val)}}</span>
                    </td>
                    <td class="info-title">
                        <div class="cell">
                            {{$lang('付款细节')}}
                        </div>
                    </td>
                    <td>
                        <span>{{detailData.basis.remark}}</span>
                    </td>
                </tr>
                <tr>
                    <td class="info-title">
                        <div class="cell">
                            {{$lang('备注')}}
                        </div>
                    </td>
                    <td>
                        <span>{{detailData.basis.our_remark}}</span>
                    </td>
                    <td class="info-title">
                    </td>
                    <td>
                    </td>
                </tr>
                </tbody>
            </table>
        </div>
        <div class="main-basic-info" v-if="detailData.amount">
            <header>
                {{$lang('金额信息')}}
            </header>
            <table border="0" cellspacing="0" cellpadding="0" class="child-basic-table">
                <tbody>
                <tr>
                    <td class="info-title">
                        <div class="cell">
                            {{$lang('付款方原始付款金额')}}
                        </div>
                    </td>
                    <td>
                        <span>{{detailData.amount.original_currency_val}} {{detailData.amount.original_amount | separatNum}}</span>
                    </td>
                    <td class="info-title">
                        <div class="cell">
                            {{$lang('收款方实收金额')}}
                        </div>
                    </td>
                    <td>
                        <span>{{detailData.amount.currency_code_val}} {{detailData.amount.amount_money | separatNum}}</span>
                    </td>
                </tr>
                <tr>
                    <td class="info-title">
                        <div class="cell">
                            {{$lang('其他费用')}}
                        </div>
                    </td>
                    <td>
                        <span>{{detailData.amount.other_currency_val}} {{detailData.amount.other_cost | separatNum}}</span>
                    </td>
                    <td class="info-title">
                        <div class="cell">
                            {{$lang('汇款人费用')}}
                        </div>
                    </td>
                    <td>
                        <span>{{detailData.amount.remitter_currency_val}} {{detailData.amount.remitter_cost | separatNum}}</span>
                    </td>
                </tr>
                </tbody>

            </table>
        </div>
        <div class="main-basic-info" v-if="detailData.claim">
            <header>
                {{$lang('认领信息')}}
            </header>
            <table border="0" cellspacing="0" cellpadding="0" class="main-basic-table">
                <tbody v-if="status == 'addOrder' || status == 'hasOrder' || status == 'editSingle'">
                <tr>
                    <td class="info-title"> {{$lang('总应认领金额')}} </td>
                    <td> <span>{{detailData.claim.original_currency_val}} {{detailData.claim.original_amount | separatNum}}</span> </td>
                    <td class="info-title"> {{$lang('已认领金额（除本次认领之外）')}} </td>
                    <td> <span>{{detailData.claim.original_currency_val}} {{detailData.claim.claimed_amount | separatNum}}</span> </td>
                </tr>
                <tr>
                    <td class="info-title"> {{$lang('本次认领金额')}} </td>
                    <td> <span>{{detailData.claim.original_currency_val}} {{(detailData.claim.currentAmount || 0 ) |separatNum}}</span> </td>
                    <td class="info-title"> {{$lang('待认领金额')}} </td>
                    <td> <span>{{detailData.claim.original_currency_val}} {{detailData.claim.waiting_claimed_amount |separatNum}}</span> </td>
                </tr>
                </tbody>
                <tbody v-else>
                <tr>
                    <td class="info-title"> {{$lang('总应认领金额')}} </td>
                    <td> <span>{{detailData.claim.original_currency_val}} {{detailData.claim.original_amount | separatNum}}</span> </td>
                    <td class="info-title"> {{$lang('认领状态')}} </td>
                    <td> <span>{{$lang(detailData.claim.claim_status_val)}}</span> </td>
                </tr>
                <tr>
                    <td class="info-title"> {{$lang('已认领金额')}} </td>
                    <td> <span>{{detailData.claim.original_currency_val}} {{detailData.claim.claimed_amount | separatNum}}</span> </td>
                    <td class="info-title"> {{$lang('待认领金额')}} </td>
                    <td> <span>{{detailData.claim.original_currency_val}} {{detailData.claim.waiting_claimed_amount |separatNum}}</span> </td>
                </tr>
                <tr v-if="status == 'finished'">
                    <td class="info-title"> {{$lang('标记完结操作人')}}</td>
                    <td> <span>{{detailData.claim.tag_by}}</span> </td>
                    <td class="info-title"> {{$lang('标记完结操作时间')}} </td>
                    <td> <span>{{detailData.claim.tag_at}}</span> </td>
                </tr>
                </tbody>
            </table>
        </div>
        <!--        <div class="main-basic-info main__basic-info-big-order">-->
        <!--            <div class="big__order-data">-->
        <!--                <table class="order__info-table">-->
        <!--                    <caption class="order__info-table-header">{{$lang('基本信息')}}</caption>-->
        <!--                    <tbody class="order__info-table-tbody">-->
        <!--                    <tr>-->
        <!--                        <td>-->
        <!--                            <span class="order__info-table-required-filed">{{$lang('订单类型')}}</span>-->
        <!--                        </td>-->
        <!--                        <td>-->
        <!--                            <span>{{bigOrderSummaryData.create_by}}</span>-->
        <!--                        </td>-->
        <!--                        <td>-->
        <!--                            <span class="order__info-table-required-filed">{{$lang('店铺')}}</span>-->
        <!--                        </td>-->
        <!--                        <td>-->
        <!--                            <span>{{bigOrderSummaryData.new_audit_by}}</span>-->
        <!--                        </td>-->
        <!--                    </tr>-->
        <!--                    <tr>-->
        <!--                        <td>-->
        <!--                            <span class="order__info-table-required-filed">{{$lang('订单号')}}</span>-->
        <!--                        </td>-->
        <!--                        <td>-->
        <!--                            <span>{{bigOrderSummaryData.audit_no}}</span>-->
        <!--                        </td>-->
        <!--                        <td>-->
        <!--                            <span class="order__info-table-required-filed">{{$lang('应认领金额')}}</span>-->
        <!--                        </td>-->
        <!--                        <td>-->
        <!--                            <span>{{bigOrderSummaryData.sku_spec}}</span>-->
        <!--                        </td>-->
        <!--                    </tr>-->
        <!--                    <tr>-->
        <!--                        <td>-->
        <!--                            <span class="order__info-table-required-filed">{{$lang('本次认领金额')}}</span>-->
        <!--                        </td>-->
        <!--                        <td>-->
        <!--                            <span>{{bigOrderSummaryData.type_cd_val}}</span>-->
        <!--                        </td>-->
        <!--                        <td>-->
        <!--                            <span class="order__info-table-required-filed">{{$lang('')}}</span>-->
        <!--                        </td>-->
        <!--                        <td>-->
        <!--&lt;!&ndash;                            <span>{{bigOrderSummaryData.sum_price_usd}}</span>&ndash;&gt;-->
        <!--                        </td>-->
        <!--                    </tr>-->
        <!--                    </tbody>-->
        <!--                </table>-->
        <!--                <table class="summary__table">-->
        <!--                    <caption class="summary__table-header">{{$lang('订单汇总')}}</caption>-->
        <!--                    <tbody class="summary__table-tbody">-->
        <!--                    <tr>-->
        <!--                        <td>-->
        <!--                            <span class="summary__table-required-filed">{{$lang('(换算后)本次认领收款金额')}}</span>-->
        <!--                        </td>-->
        <!--                        <td>-->
        <!--                            <span>{{bigOrderSummaryData.create_by}}</span>-->
        <!--                        </td>-->
        <!--                        <td>-->
        <!--                            <span class="summary__table-required-filed">{{$lang('剩余应收')}}</span>-->
        <!--                        </td>-->
        <!--                        <td>-->
        <!--                            <span>{{bigOrderSummaryData.new_audit_by}}</span>-->
        <!--                        </td>-->
        <!--                    </tr>-->
        <!--                    </tbody>-->
        <!--                </table>-->
        <!--            </div>-->
        <!--        </div>-->
    </div>
    <div class="use-btn">
        <el-button type="primary" @click="sureDialog=true" v-if="status == 'unClaimed' || status == 'claimed'">{{$lang('标记认领完结')}}</el-button>
        <el-dialog title="提示" :visible.sync="sureDialog" width="40%" :before-close="handleClose('Y')">
            <div v-if="dialogType == 'toFinished'">{{$lang('确定要标记这笔流水认领完结吗？标记后将不可再认领或编辑之前的认领结果哦。')}}
            </div>
            <div v-else>{{$lang('确定要改为未完结吗？修改后，其他人也可以继续认领这笔流水哦。')}}</div>
            <span slot="footer">
                        <el-button type="primary" @click="doSureFinish(dialogType)">{{$lang('确定')}}</el-button>
                        <el-button @click="sureDialog=false">{{$lang('取消')}}</el-button>
                    </span>
        </el-dialog>
        <el-button type="primary" v-show="status =='addOrder' || status == 'hasOrder'" @click="openDialogOrder(true)">{{$lang('新增B2B收款认领')}}</el-button>
        <el-button v-show="status =='addOrder' || status == 'hasOrder'" @click="openDialogOrder(false)">{{$lang('新增采购退款认领')}}</el-button>
        <el-button v-show="status =='addOrder' || status == 'hasOrder'" @click="openDialogByBigOrder">{{$lang('新增GP大额订单认领')}}</el-button>
        <el-button v-show="status == 'unClaimed' || status == 'claimed'" @click="status = 'addOrder';showOrder = false">{{$lang('认领')}}</el-button>

        <el-dialog :title="newClaimType ? '收款认领-订单选择':'收款认领-采购单选择'" :visible.sync="dialogVisible" width="1200px" :before-close="handleClose" class="order_dialog">
            <div class="text-left">
                <!-- <el-input :placeholder="$lang('请选择')" v-model="orderSearchData.search_value" class="input-with-select" style="width:380px;">
                    <el-select v-model="orderSearchData.search_type" slot="prepend" placeholder="请选择" style="width:120px;">
                        <el-option v-for="queryItem in queryType" :key="queryItem.CD" :label="$lang(queryItem.CD_VAL)" :value="queryItem.CD"> </el-option>
                    </el-select>
                </el-input> -->
                <span>
                    {{newClaimType ? $lang('B2B订单号/销售PO单号') : $lang('采购单号/采购PO单号')}}
                    <el-input :placeholder="newClaimType? $lang('请输入B2B订单号/销售PO单号'):$lang('请输入采购单号/采购PO单号')" v-model="orderSearchData.search_value" class="input-with-select" style="width:200px;margin-left:10px;"> </el-input>
                </span>
                <span style="margin-left: 30px;">
                    {{newClaimType ? $lang('客户名称') : $lang('供应商名称')}}
                    <el-input style="width:200px;margin-left:10px;" v-model="orderSearchData.client_name" :placeholder='$lang("请输入名称")'> </el-input>
                </span>
                <span style="margin-left: 30px;">
                            {{newClaimType ? $lang('销售同事') : $lang('采购同事 ')}}
                            <el-input style="width:200px;margin-left:10px;" v-model="orderSearchData.sale_pur_person" :placeholder='$lang("请输入名称")'> </el-input>
                        </span>
            </div>
            <div class="cls">
                <el-button type="primary" size="small" @click="searchOrder">{{$lang('查询')}}</el-button>
                <el-button size="small" @click="resetOrder">{{$lang('重置')}}</el-button>
            </div>
            <div class="baseline"></div>
            <div :class="{'table_box':search_order_list.length}">
                <table v-if="newClaimType" border="0" cellspacing="0" cellpadding="0" class="child-basic-table" v-loading="searchLoading" style="width:1140px;table-layout: fixed">
                    <thead>
                    <th>{{$lang('B2B订单号')}} </th>
                    <th>{{$lang('PO单号')}}</th>
                    <th>{{$lang('客户名称')}}</th>
                    <th>{{$lang('销售同事')}}</th>
                    <th width="60">{{$lang('PO币种')}}</th>
                    <th>{{$lang('PO金额')}}</th>
                    <th width="60">{{$lang('发货状态')}}</th>
                    <th width="60">{{$lang('理货状态')}}</th>
                    <th>{{$lang('应收金额')}}</th>
                    <th>{{$lang('操作')}}</th>
                    </thead>
                    <tbody>
                    <tr class="inline-td" v-for="(item,index) in search_order_list">
                        <td>{{item.PO_ID}}</td>
                        <td>{{item.THR_PO_ID}}</td>
                        <td>{{item.CLIENT_NAME}}</td>
                        <td>{{item.PO_USER}}</td>
                        <td>{{item.po_currency_val}}</td>
                        <td>{{item.po_amount}}</td>
                        <td>{{item.ship_state_val}}</td>
                        <td>{{item.warehousing_state_val}}</td>
                        <td>{{item.current_remaining_receivable}}</td>
                        <td>
                            <el-button size="small" v-if="!item.isAdded" type="primary" @click="doAddOrderItem(item,index,'')">{{$lang('添加')}}</el-button>
                            <span class="is_added_btn" v-if="item.isAdded">{{$lang('已添加')}}</span>
                        </td>
                    </tr>
                    </tbody>
                </table>
                <table v-else border="0" cellspacing="0" cellpadding="0" class="child-basic-table" v-loading="searchLoading" style="width:1140px;table-layout: fixed">
                    <thead>
                    <th>{{$lang('采购单号')}} </th>
                    <th>{{$lang('PO单号')}}</th>
                    <th>{{$lang('供应商名称')}}</th>
                    <th>{{$lang('采购同事')}}</th>
                    <th width="60">{{$lang('PO币种')}}</th>
                    <th>{{$lang('PO金额')}}</th>
                    <th width="80">{{$lang('入库状态')}}</th>
                    <th width="60">{{$lang('应付状态')}}</th>
                    <!-- <th>{{$lang('已付款金额')}}</th> -->
                    <th>{{$lang('操作')}}</th>
                    </thead>
                    <tbody>
                    <tr class="inline-td" v-for="(item,index) in search_order_list">
                        <td>{{item.procurement_number}}</td>
                        <td>{{item.online_purchase_order_number}}</td>
                        <td>{{item.supplier_id}}</td>
                        <td>{{item.prepared_by}}</td>
                        <td>{{item.amount_currency_val}}</td>
                        <td>{{item.amount}}</td>
                        <td>{{item.warehouse_status_val}}</td>
                        <td>{{item.payment_status_val}}</td>
                        <!-- <td>{{item.amount_pay_ori || 0.00}}</td> -->
                        <td>
                            <el-button size="small" v-if="!item.isAdded" type="primary" @click="doAddOrderItem(item,index,'N002630200')">{{$lang('添加')}}</el-button>
                            <span class="is_added_btn" v-if="item.isAdded">{{$lang('已添加')}}</span>
                        </td>
                    </tr>
                    </tbody>
                </table>
            </div>
            <div class="baseline"></div>
            <span slot="footer">
                        <el-button type="primary" @click="handleClose">{{$lang('确定')}}</el-button>
                    </span>
        </el-dialog>
        <el-dialog
            class="big__order-dialog"
            :title="$lang('收款认领-GP大额订单认领')"
            v-if="isVisibleBigOrderDialog"
            :visible.sync="isVisibleBigOrderDialog"
            width="1200px"
            center>
            <div class="big__order-list">
                <div class="list__filter">
                    <el-form @submit.native.prevent ref="form">
                        <el-row :gutter="20">
                            <el-col :md="4">
                                <el-form-item>
                                    <el-input
                                        v-model="bigOrderFilter.third_order_no"
                                        clearable
                                        :placeholder="$lang('请输入第三方订单号')"
                                        @keyup.enter.native="onSearchByBigOrder"
                                    />
                                </el-form-item>
                            </el-col>
                            <el-col :md="4">
                                <el-form-item>
                                    <el-select v-model="bigOrderFilter.shop_id" :placeholder="$lang('请输入店铺名称')"  filterable   clearable   @keyup.enter.native="onSearchByBigOrder">
                                        <el-option
                                            v-for="item in shopNames"
                                            :key="item.id"
                                            :label="item.store_name"
                                            :value="item.id">
                                        </el-option>
                                    </el-select>
                                    <!--                                    <el-autocomplete-->
                                    <!--                                        :placeholder="$lang('请输入店铺名称')"-->
                                    <!--                                        class="inline-input"-->
                                    <!--                                        :fetch-suggestions="getShopNames"-->
                                    <!--                                        v-model="bigOrderFilter.shop_id"-->
                                    <!--                                    />-->
                                </el-form-item>
                            </el-col>
                            <el-col :md="4">
                                <el-form-item>
                                    <el-button
                                        type="primary"
                                        class="button button--search"
                                        :loading="searching"
                                        @click="onSearchByBigOrder"
                                    >{{$lang('查询')}}
                                    </el-button
                                    >
                                    <el-button
                                        type="primary"
                                        @click="onResetByBigOrder"
                                        class="button"
                                        :loading="searching"
                                    >{{$lang('重置')}}
                                    </el-button
                                    >
                                </el-form-item>
                            </el-col>
                        </el-row>
                    </el-form>
                </div>
                <div class="list__data">
                    <el-table
                        :data="pagedBigOrders.data"
                        border>
                        <el-table-column
                            prop="name"
                            align="center"
                            :resizable="false"
                            :label="$lang('第三方订单号')"
                        >
                            <template slot-scope="scope">
                                <span>{{scope.row.order_no}}</span>
                            </template>
                        </el-table-column>
                        <el-table-column
                            prop="name"
                            align="center"
                            :resizable="false"
                            :label="$lang('GP店铺名称')"
                        >
                            <template slot-scope="scope">
                                <span>{{scope.row.store_name}}</span>
                            </template>
                        </el-table-column>
                        <el-table-column
                            prop="name"
                            align="center"
                            :resizable="false"
                            :label="$lang('应收币种')"
                        >
                            <template slot-scope="scope">
                                <span>{{scope.row.pay_currency}}</span>
                            </template>
                        </el-table-column>
                        <el-table-column
                            prop="name"
                            align="center"
                            :resizable="false"
                            :label="$lang('应收金额')"
                        >
                            <template slot-scope="scope">
                                <span>{{ scope.row.pay_total_price.replace(/(\d)(?=(\d{3})+(?!\d))/g, '$&,')}}</span>
                            </template>
                        </el-table-column>
                        <el-table-column
                            prop="name"
                            width="100px"
                            align="center"
                            :resizable="false"
                            :label="$lang('操作')"
                        >
                            <template slot-scope="scope">
                                <el-button type="primary" @click="doAddOrderItem(scope.row,scope.$index,'N002630201')">{{$lang('添加')}}</el-button>
                            </template>
                        </el-table-column>
                    </el-table>
                </div>
            </div>
            <span slot="footer" class="actions">
              <el-button @click="onCloseBigOrder">取 消</el-button>
              <el-button type="primary" @click="onConfirmBigOrder">确 定</el-button>
           </span>
        </el-dialog>

    </div>

    <div class="main-basic-info" v-for="(orderItem,index) in detailData.clime_order" v-if="detailData.clime_order && showOrder">
        <header style="margin-top:10px">
            <span v-if="status == 'editSingle'">{{$lang('订单信息')}}</span>
            <span v-else>{{$lang('订单信息')}}（{{index+1}}/{{detailData.clime_order.length}}）</span>
            <div class="use-btn" style="float:right;margin: 0 20px;">
                <el-button v-if="status == 'hasOrder'" size='small' type="primary" @click="doDelete(orderItem,index)">{{$lang('删除')}}</el-button>
                <!--               //采购退款认领 -->
                <div v-if="orderItem.claim_type == 'N002630200'">
                    <el-button v-if="!(status == 'addOrder' || status == 'finished'|| status == 'hasOrder'|| status =='editSingle')" size='small' type="primary" @click="doEditSingle(orderItem)">{{$lang('编辑')}}</el-button>
                </div>
                <!--               //B2B收款认领 -->
                <div v-if="!orderItem.claim_type">
                    <el-button v-if="!(status == 'addOrder' || status == 'finished'|| status == 'hasOrder'|| status =='editSingle') && orderItem.order_info.receivable_status_val == '待提交'" size='small' type="primary" @click="doEditSingle(orderItem)">{{$lang('编辑')}}</el-button>
                </div>

                <!--               //GP大额订单认领 -->
                <div v-if="orderItem.claim_type === 'N002630201'">
                    <el-button v-if="!(status == 'addOrder' || status == 'finished'|| status == 'hasOrder'|| status =='editSingle')" size='small' type="primary" @click="doEditSingle(orderItem)">{{$lang('编辑')}}</el-button>
                </div>

            </div>
        </header>
        <!--               //采购退款认领 -->

        <table v-if="orderItem.claim_type == 'N002630200'" border="0" cellspacing="0" cellpadding="0" class="main-basic-table">
            <tbody>
            <tr>
                <td class="info-title"> {{$lang('认领类型')}} </td>
                <td> {{orderItem.order_info.claim_code_val}} </td>
                <td class="info-title"> {{$lang('采购单号')}}</td>
                <td> <a style="cursor: pointer;" href="javascript:void(0)" @click="viewPurchase('/index.php?m=order_detail&a=purchase_order_detail&relevance_id=' + orderItem.order_info.relevance_id,'订单详情')">{{orderItem.order_info.procurement_number}}</a></td>
            </tr>
            <tr>
                <td class="info-title"> {{$lang('PO单号')}} </td>
                <td> {{orderItem.order_info.online_purchase_order_number}} </td>
                <td class="info-title"> {{$lang('供应商名称')}} </td>
                <td> {{orderItem.order_info.supplier_id}} </td>
            </tr>
            <tr>
                <td class="info-title"> {{$lang('采购人员')}} </td>
                <td> {{orderItem.order_info.prepared_by}} </td>
                <td class="info-title"> {{$lang('采购团队')}} </td>
                <td> {{orderItem.order_info.payment_company_val}} </td>
            </tr>
            <tr>
                <td class="info-title"> {{$lang('应付状态')}} </td>
                <td> {{orderItem.order_info.payment_status_val}} </td>
                <td class="info-title"> {{$lang('入库状态')}} </td>
                <td> {{orderItem.order_info.warehouse_status_val}} </td>
            </tr>
            <tr>
                <td class="info-title"> {{$lang('退货状态')}} </td>
                <td> {{orderItem.order_info.has_return_goods_val}} </td>
                <td class="info-title"> {{$lang('退款状态')}} </td>
                <td> {{orderItem.order_info.has_refund_val}} </td>
            </tr>
            <tr>
                <td class="info-title"> {{$lang('')}}
                    <span :class="{required:(status == 'addOrder' || status == 'hasOrder'|| status =='editSingle' )}">
                                    {{$lang('本次认领退款金额')}}
                                </span>
                </td>
                <td>
                    {{detailData.amount.original_currency_val}}
                    <el-input v-if="status == 'addOrder' || status == 'hasOrder'|| status =='editSingle'" size="small" :placeholder="$lang('以客户付款的原始金额为基准')" v-model="orderItem.order_info.claim_amount" style="width:300px" @blur="changeClaimAmount(orderItem)"></el-input>
                    <span v-else>{{orderItem.order_info.claim_amount}}</span>
                </td>
                <td class="info-title"></td>
                <td></td>
            </tr>
            <tr>
                <td colspan="4" class="header-td">
                    <span class="td-left">{{$lang('订单汇总')}}</span>
                </td>
            </tr>
            <tr>
                <td class="info-title"> {{$lang('（换算后）本次认领退款金额')}} </td>
                <td> {{orderItem.order_info.amount_currency_val}} {{orderItem.order_summary.summary_amount | separatNum}} </td>
                <td class="info-title"> {{$lang('剩余在途库存金额')}} </td>
                <td> {{orderItem.order_info.amount_currency_val}} {{orderItem.order_summary.current_remaining_receivable | separatNum}} </td>
            </tr>
            <tr v-if="orderItem.order_summary.updated_by">
                <td class="info-title"> {{$lang('认领人')}}</td>
                <td>{{orderItem.order_summary.updated_by}}</td>
                <td class="info-title"> {{$lang('认领时间')}} </td>
                <td>{{orderItem.order_summary.updated_at}}</td>
            </tr>
            </tbody>
        </table>
        <!--               //B2B收款认领 -->

        <table v-if="!orderItem.claim_type" border="0" cellspacing="0" cellpadding="0" class="main-basic-table">
            <tbody>
            <tr>
                <td class="info-title"> {{$lang('认领类型')}} </td>
                <td> {{orderItem.order_info.claim_code_val}} </td>
                <td class="info-title"> {{$lang('B2B订单号')}} </td>
                <td> <a style="cursor: pointer;" href="javascript:void(0)" @click="viewPurchase('/index.php?m=b2b&a=order_list&order_id=' + orderItem.order_info.ORDER_ID + '#/b2bsend','订单详情')">{{orderItem.order_info.PO_ID}}</a></td>
            </tr>
            <tr>
                <td class="info-title"> {{$lang('PO单号')}}</td>
                <td> {{orderItem.order_info.THR_PO_ID}} </td>
                <td class="info-title"> {{$lang('客户名称')}} </td>
                <td> {{orderItem.order_info.CLIENT_NAME}} </td>
            </tr>
            <tr>
                <td class="info-title"> {{$lang('销售人员')}} </td>
                <td> {{orderItem.order_info.PO_USER}}</td>
                <td class="info-title"> {{$lang('销售团队')}} </td>
                <td> {{orderItem.order_info.SALES_TEAM_val}} </td>

            </tr>
            <tr>
                <td class="info-title"> {{$lang('发货状态')}} </td>
                <td> {{orderItem.order_info.order_state_val ? orderItem.order_info.order_state_val : orderItem.order_info.ship_state_val}} </td>
                <td class="info-title"> {{$lang('理货状态')}} </td>
                <td> {{orderItem.order_info.warehousing_state_val}} </td>
            </tr>
            <tr>
                <td class="info-title"> {{$lang('应收状态')}} </td>
                <td> {{orderItem.order_info.receivable_status_val}} </td>
                <td class="info-title">
                            <span :class="{required:(status == 'addOrder' || status == 'hasOrder'|| status =='editSingle' )}">
                                    {{$lang('本次认领')}}
                                </span>
                </td>
                <td>
                            <span v-if="status == 'addOrder' || status == 'hasOrder'|| status =='editSingle'">{{detailData.amount.original_currency_val}}
                                    <el-input size="small" style="width:70%" :placeholder="$lang('以客户付款的原始金额为基准')" @blur="changeClaimAmount(orderItem)"
                                              v-model="orderItem.order_info.claim_amount">
                                    </el-input>
                                </span>
                    <span v-else>{{detailData.amount.original_currency_val}} {{orderItem.order_info.claim_amount | separatNum}}</span>
                </td>
            </tr>
            <tr v-if="(orderItem && orderItem.deductions.length) || status =='editSingle' || status == 'hasOrder'">
                <td colspan="4" class="header-td">
                    <span class="td-left">{{$lang('扣费')}}</span>
                    <el-button class="td-right" size="small" type="primary" @click="addDeduction(orderItem.deductions)" v-if="status=='hasOrder' || status=='editSingle'">{{$lang('新增扣费')}}</el-button>
                </td>
            </tr>
            <tr v-if="(orderItem && orderItem.deductions.length) || status =='editSingle' || status == 'hasOrder'">
                <td colspan="4" class="no-wrap">
                    <table border="0" cellspacing="0" cellpadding="0" class="child-basic-table inline-basic-table">
                        <thead>
                        <th><span :class="{required:(status == 'addOrder' || status == 'hasOrder' || status == 'editSingle')}">{{$lang('扣费类型')}}</span></th>
                        <th><span :class="{required:(status == 'addOrder' || status == 'hasOrder' || status == 'editSingle')}">{{$lang('扣费金额')}}</span></th>
                        <th>{{$lang('扣费凭证')}}</th>
                        <th>{{$lang('扣费说明')}}</th>
                        <th v-if="status == 'addOrder' || status == 'hasOrder' || status == 'editSingle'">{{$lang('操作')}}</th>
                        </thead>
                        <tbody>
                        <tr v-if=" status!= 'editSingle' && status!= 'addOrder' && status!= 'hasOrder'" class="inline-td" v-for="(deduction,index) in orderItem.deductions">
                            <td>{{deduction.deduction_type_val}}</td>
                            <td>{{orderItem.order_info.po_currency_val}} {{deduction.deduction_amount | separatNum}}</td>
                            <td>
                                <a style="margin:8px 0px;display:block;" v-for="item in deduction.credentials_path" class="file_type" :href="'/index.php?m=order_detail&a=download&file='+item.savename">{{item.name ? item.name : item.savename}}</a>
                            </td>
                            <td>{{deduction.instructions}}</td>
                        </tr>
                        <tr v-if="status == 'addOrder' || status == 'hasOrder' || status == 'editSingle'" class="inline-td" v-for="(deduction,index) in orderItem.deductions">
                            <td>
                                <el-select size="small" collapse-tags :placeholder="$lang('请选择扣费类型【除残次以外】')" v-model="deduction.deduction_type" clearable style="width:80%;" @change="changeDeductionType(orderItem.deductions,index)">
                                    <el-option :key="item.CD" :label="item.CD_VAL" :value="item.CD" v-for="item in baseData.deduction_type"></el-option>
                                </el-select>
                            </td>
                            <td>
                                {{orderItem.order_info.po_currency_val}}
                                <el-input style="width:70%;" size="small" v-model="deduction.deduction_amount" @blur="changeClaimAmount(orderItem)"> </el-input>
                            </td>
                            <td>
                                <el-upload class="upload-demo" action="/index.php?m=order_detail&a=file_upload" :on-preview="handlePreview" :on-remove="(file,fileList)=> {return handleRemove(file,fileList,index,orderItem.deductions)}" :before-remove="beforeRemove" :on-success="(res,file,fileList)=>{return handleSuccess(res,file,fileList, index,orderItem.deductions)}"
                                           :file-list="deduction.fileList">
                                    <el-button size="small" type="primary">{{$lang('上传凭证')}}</el-button>
                                </el-upload>
                            </td>
                            <td>
                                <el-input size="small" v-model="deduction.instructions" :placeholder="$lang('和扣费凭证至少填写一项')"> </el-input>
                            </td>
                            <td>
                                <el-button size="small" type="primary" @click="$delete(orderItem.deductions,index)">{{$lang('删除')}}</el-button>
                            </td>
                        </tr>
                        </tbody>
                    </table>
                </td>
            </tr>
            <tr>
                <td colspan="4" class="header-td">
                    <span class="td-left">{{$lang('订单汇总')}}</span>
                </td>
            </tr>
            <tr>
                <td colspan="4" class="no-wrap">
                    <table border="0" cellspacing="0" cellpadding="0" class="main-basic-table inline-basic-table">
                        <tbody>
                        <tr>
                            <td class="info-title"> {{$lang('（换算后）本次认领+扣费总金额')}} </td>
                            <td> {{orderItem.order_info.po_currency_val}} {{orderItem.order_summary.summary_amount | separatNum}} </td>
                            <td class="info-title"> {{$lang('剩余应收')}} </td>
                            <td> {{orderItem.order_info.po_currency_val}} {{orderItem.order_summary.current_remaining_receivable | separatNum}} </td>
                        </tr>
                        <tr v-if="status == 'claimed' || status == 'unClaimed' || status == 'finished'">
                            <td class="info-title"> {{$lang('认领人')}} </td>
                            <td> {{orderItem.order_summary.updated_by}} </td>
                            <td class="info-title"> {{$lang('认领时间')}} </td>
                            <td> {{orderItem.order_summary.updated_at}} </td>
                        </tr>
                        </tbody>
                    </table>
                </td>
            </tr>
            </tbody>
        </table>

        <!--               //GP大额订单认领 -->
        <table v-if="orderItem.claim_type === 'N002630201'" border="0" cellspacing="0" cellpadding="0" class="main-basic-table">
            <tbody>
            <tr>
                <td class="info-title"> {{$lang('订单类型')}} </td>
                <td> {{$lang('GP大额订单') }}</td>
                <td class="info-title"> {{$lang('店铺')}} </td>
                <td>{{orderItem.order_info.store_name}}</td>
            </tr>
            <tr>
                <td class="info-title"> {{$lang('订单号')}}</td>
                <td> {{orderItem.order_info.order_no}} </td>
                <td class="info-title"> {{$lang('应认领金额')}} </td>
                <td>  {{orderItem.order_info.pay_currency}} {{orderItem.order_info.pay_total_price.replace(/(\d)(?=(\d{3})+(?!\d))/g, '$&,')}} </td>
            </tr>
            <tr>
                <td class="info-title"> {{$lang('本次认领金额')}} </td>
                <td>
                    <span v-if="status == 'addOrder' || status == 'hasOrder'|| status =='editSingle'">
                                   {{detailData.claim.original_currency_val}}
                        <el-input size="small" style="width:70%" :placeholder="$lang('以客户付款的原始金额为基准')" @blur="changeClaimAmount(orderItem,index)"
                                  v-model="orderItem.order_info.claim_amount">
                        </el-input>
                    </span>
                    <span v-else> {{detailData.claim.original_currency_val}} {{orderItem.order_info.claim_amount | separatNum}}</span>
                </td>
                <td class="info-title"> {{$lang('')}} </td>
                <td> </td>
            </tr>
            <tr>
                <td colspan="4" class="header-td">
                    <span class="td-left">{{$lang('订单汇总')}}</span>
                </td>
            </tr>
            <tr>
                <td colspan="4" class="no-wrap">
                    <table border="0" cellspacing="0" cellpadding="0" class="main-basic-table inline-basic-table">
                        <tbody>
                        <tr>
                            <td class="info-title"> {{$lang('（换算后）本次认领收款金额')}} </td>
                            <td>{{orderItem.order_info.pay_currency}} {{orderItem.order_summary.summary_amount | separatNum}} </td>
                            <td class="info-title"> {{$lang('剩余应收')}} </td>
                            <td> {{orderItem.order_info.pay_currency}} {{orderItem.order_summary.current_remaining_receivable | separatNum}} </td>
                        </tr>
                        <tr v-if="status == 'claimed' || status == 'unClaimed' || status == 'finished'">
                            <td class="info-title"> {{$lang('认领人')}} </td>
                            <td> {{orderItem.order_summary.updated_by}} </td>
                            <td class="info-title"> {{$lang('认领时间')}} </td>
                            <td> {{orderItem.order_summary.updated_at}} </td>
                        </tr>
                        </tbody>
                    </table>
                </td>
            </tr>
            </tbody>
        </table>
    </div>
    <div class="use-btn">
        <el-button v-if="status == 'editSingle'" @click="beforeDeleteOrder(detailData)">{{$lang('删除')}}</el-button>
        <el-button v-if="status == 'finished'" @click="sureDialog=true" type="primary">{{$lang('改为未完结')}}</el-button>
        <el-button v-if="(status == 'hasOrder'  || status == 'editSingle') && detailData.clime_order.length" type="primary" @click="submit('common')">{{$lang('提交')}}</el-button>
        <el-button v-if="(status == 'hasOrder'  || status == 'editSingle') && detailData.clime_order.length" @click="submit('sure')">{{$lang('提交并确认这笔流水认领完结')}}</el-button>
    </div>

</div>
</div>
<!--引入js-->
<script type="text/javascript" src="/Application/Tpl/Home/Public/lib/jquery/1.9.1/jquery.min.js"></script>
<script type="text/javascript" src="/Application/Tpl/Home/Public/js/H-ui.js"></script>
<script type="text/javascript" src="/Application/Tpl/Home/Public/js/H-ui.admin.js?v=<{$Think.config.VER_NUM}>"></script>
<script type="text/javascript" src="/Application/Tpl/Home/Public/js/vue.2.5.13.js"></script>
<script type="text/javascript" src="/Application/Tpl/Home/Public/js/axios.min.js"></script>
<script type="text/javascript" src="/Application/Tpl/Home/Public/js/element-ui-2.2.js"></script>
<script src="./Application/Tpl/Home/Public/js/lodash-4.17.15.js"></script>

<script>
    /**
     *  sessionStorage  receipt_claim_detail 改变的时候 刷新
     */
    $(window).on("storage", function(e) {
        if (e.originalEvent.key === 'receipt_claim_detail') {
            if (e.originalEvent.newValue === 'f5') {
                window.location.reload()
                sessionStorage.removeItem('receipt_claim_detail')
            }
        }
    });
    var VM = new Vue({
        el: '#main-detail',
        components: {},
        data: {
            button: false,
            // unClaimed => 未认领
            // claimed => 已认领
            // addOrder => 未添加订单
            // hasOrder => 已添加订单
            // editSingle => 认领结果编辑（编辑单个订单）
            // finished => 已完结
            temporaryAmount: 0, //当重新编辑时已经存的值
            status: 'unClaimed',
            showOrder: true,
            rate: 1,
            hadOrders: false,
            sureDialog: false,
            dialogVisible: false,
            bigOrderFilter:{},
            isVisibleBigOrderDialog:false,
            searching:false,
            dialogType: 'toFinished',
            transfer_no: '',
            search_order_list: [],
            detailData: {
                basis: {},
                amount: {},
                claim: {},
                clime_order: [],
            },
            bigOrders:[],
            bigOrderItem:{},
            queryType: [{
                CD: 'PO_ID',
                CD_VAL: 'B2B订单号'
            }, {
                CD: 'THR_PO_ID',
                CD_VAL: 'PO单号'
            }],
            orderSearchData: {
                search_value: '',
                search_type: 'THR_PO_ID',
                client_name: ''
            },
            pagedBigOrders:{
                data:[]
            },
            shopNames:[],
            bigOrderSummaryData:{},
            searchLoading: false,
            newClaimType: true, //true 收款,false 退款
        },
        created() {
            this.transfer_no = getQueryVariable('account_transfer_no')
            this.getBaseData();
            this.getDetail();
        },
        methods: {
            getShopNames() {
                axios.post(`/index.php?m=b2b&a=getGPStoreData`).then((res) => {
                    this.shopNames = res.data.data;
                    this.shopNames.forEach((obj) => {
                        obj.value = obj.store_name
                    })
                })
            },
            // 计算剩余应收
            changeClaimAmount: function(data) {
                var currentAmount = 0,
                    total = 0;
                if (isNaN(data.order_info.claim_amount) || data.order_info.claim_amount < 0) {
                    data.order_info.claim_amount = 0;
                    this.$message.error('只可填写数字 且 金额不为负数');
                    this.$set(data.order_info, 'claim_amount', 0);
                    return false;
                }
                this.detailData.clime_order.forEach(function(el, ind) {
                    currentAmount += +el.order_info.claim_amount;
                })

                this.$set(this.detailData.claim, 'currentAmount', currentAmount);

                if (data.claim_type == 'N002630200') {  //采购退款认领
                    data.order_summary.summary_amount = (data.order_summary.rate || 0) * data.order_info.claim_amount;
                    data.order_summary.current_remaining_receivable = (+data.order_info.amount_pay_ori || 0) + (+data.order_info.return_goods_amount_ori || 0) - (+data.order_info.amount_in_warehouse_ori || 0) - (+data.order_info.amount_claim_ori || 0) - (+data.order_summary.summary_amount || 0) + this.temporaryAmount;
                } else if(!data.claim_type){ //B2B收款认领
                    var total = 0;
                    data.deductions.forEach(function(e, i) {
                        total += +e.deduction_amount;
                    })
                    data.order_summary.summary_amount = (data.order_info.claim_amount ? data.order_summary.rate * data.order_info.claim_amount : 0) + total;
                    data.order_summary.current_remaining_receivable = data.order_summary.total - data.order_summary.summary_amount;
                }else if(data.claim_type == 'N002630201'){ //GP大额订单认领
                    // 该剩余金额已包含减去的历史金额                                                                                     当前的转换汇率后的金额
                    if(!this.bigOrderItem.isEdit){ //新增
                        data.order_summary.summary_amount = (data.order_info.claim_amount ? data.order_summary.rate * data.order_info.claim_amount : 0);
                        //在编辑的时候没有should_receive这个字段，直接取用current_remaining_receivable
                        data.order_summary.current_remaining_receivable = data.order_info.should_receive - data.order_summary.summary_amount;
                        // if(data.order_summary.current_remaining_receivable<0){
                        //     data.order_summary.current_remaining_receivable=0;
                        // }
                    }else { //编辑
                        data.order_summary.summary_amount = (data.order_info.claim_amount ? data.order_summary.rate * data.order_info.claim_amount : 0);
                        //在编辑的时候没有should_receive这个字段，直接取用current_remaining_receivable
                        data.order_summary.current_remaining_receivable = (this.bigOrderItem.order_summary.total - data.order_summary.summary_amount);
                        // if(data.order_summary.current_remaining_receivable<0){
                        //     data.order_summary.current_remaining_receivable=0;
                        // }
                    }

                }
            },
            changeClaimAmountByBigOrder(orderItem,index){

            },
            viewPurchase: function(url, title) {
                newTab(url, title);
            },
            // 获取基础数据
            getBaseData: function() {
                var _this = this;
                var param = {
                    cd_type: {
                        deduction_type: false
                    }
                }
                axios.post("/index.php?g=common&m=index&a=get_cd", param).then(function(res) {
                    if (res.data.code == 2000) {
                        _this.baseData = res.data.data;
                    }
                })
            },
            // 获取详情信息
            getDetail: function getDetail(data) {
                var _this = this;
                axios.post('/index.php?m=B2b&a=claimDetail&account_transfer_no=' + _this.transfer_no,
                    data)
                    .then(function(response) {
                        if (response.data.code == 200000) {
                            _this.detailData = response.data.data;

                            if (_this.detailData.claim.claim_status == 'N002550200') {
                                _this.status = 'finished';
                                _this.dialogType = 'toUnfinished';
                            }
                            if (_this.detailData.clime_order && _this.detailData.clime_order.length) {
                                _this.hadOrders = true;
                            }
                            _this.detailData.clime_order.forEach(function(el, ind) {
                                el.order_summary.total = +el.order_summary.current_remaining_receivable + +el.order_summary.summary_amount;
                                // 认购   GP大额订单  B2B收款
                                var currency = el.claim_type === 'N002630200' ? el.order_info.amount_currency_val : el.claim_type === 'N002630201'?el.order_info.pay_currency:el.order_info.po_currency_val;
                                _this.dstCurrency(currency, el.order_summary, el.order_info.po_time)
                            })
                        } else {
                            _this.$message.error(_this.$lang(response.data.info));
                        }
                    }).catch(function(err) {
                    console.log(err);
                });
            },
            // 标记认领完结 确认
            doSureFinish: function doSureFinish(type) {
                var _this = this;
                if (type == "toFinished") {
                    var postData = {
                        "account_turnover_id": this.detailData.basis.account_transfer_id,
                        "claim_status": "N002550200"
                    }
                } else {
                    var postData = {
                        "account_turnover_id": this.detailData.basis.account_transfer_id,
                        "claim_status": "N002550100"
                    }
                }
                axios.post('/index.php?m=B2b&a=updateClaimStatus', postData)
                    .then(function(response) {
                        if (response.data.code == 200000) {
                            _this.$message.success(_this.$lang(response.data.msg));
                            sessionStorage.setItem('receipt_claim_detail', 'f5')
                        } else {
                            _this.$message.error(_this.$lang(response.data.msg));
                        }
                        this.sureDialog = false;
                        window.location.reload();
                    }).catch(function(err) {
                    console.log(err);
                    this.sureDialog = false;
                    window.location.reload();
                });
            },

            // 关闭按钮
            handleClose: function handleClose(type) {
                if (type != 'Y') {
                    this.orderSearchData = {
                        search_value: '',
                        search_type: "THR_PO_ID",
                        client_name: ''
                    }
                    this.dialogVisible = false;
                }
            },

            // 订单搜索 查询
            searchOrder: function searchOrder() {
                var _this = this;
                this.searchLoading = true;
                var searchData = {}
                for (var key in this.orderSearchData) {
                    if (this.orderSearchData[key]) {
                        searchData[key] = this.orderSearchData[key]
                    }
                }
                searchData.account_turnover_id = this.detailData.basis.account_transfer_id;
                searchData.account_transfer_id = this.detailData.basis.account_transfer_id;
                searchData.claim_type = this.newClaimType ? '' : 'N002630200';


                axios.post('/index.php?m=B2b&a=orderSelectSearch', searchData)
                    .then(function(response) {
                        if (response.data.code == 200000) {
                            _this.search_order_list = response.data.data;
                        } else {
                            _this.$message.error(_this.$lang(response.data.msg));
                        }
                        _this.searchLoading = false
                    }).catch(function(err) {
                    _this.searchLoading = false
                    console.log(err);
                });
            },
            // 订单搜索 重置
            resetOrder: function resetOrder() {
                this.orderSearchData = {
                    search_value: '',
                    search_type: 'THR_PO_ID',
                    client_name: ''
                }
                this.searchOrder();
            },
            // 删除订单
            doDelete: function doDelete(item,index) {
                this.$delete(this.detailData.clime_order, index)
            },
            // 添加订单
            doAddOrderItem: function doAddOrderItem(it, index, type) {
                // const B2B_CLAIM_CODE = '';      //B2B收款认领
                // const PUR_REFUND_CLAIM_CODE = 'N002630200';//采购退款认领
                // const GP_BIG_ORDER_CLAIM_CODE = 'N002630201';//GP大额订单认领
                var field = type === 'N002630200' ? 'procurement_number' : !type ? 'PO_ID' : type==='N002630201' ? 'order_id' : ''; //唯一标识字段

                it.claim_amount = '';
                it.isAdded = true;

                var flag = true;
                this.showOrder = true;
                if(type==='N002630201'){ //GP大额订单需要传入该ID值
                    it.account_transfer_id   =  this.detailData.basis.account_transfer_id
                }

                var item = {
                    order_info: it,
                    deductions: [],
                    order_summary: {
                        summary_amount: 0, //根据汇率换算后的本次认领金额
                        total: it.current_remaining_receivable?it.current_remaining_receivable:0,
                        current_remaining_receivable: 0
                    },
                    claim_type: type
                };

                if (type == 'N002630200') { //采购退款认领
                    this.dstCurrency(it.amount_currency_val, item.order_summary, it.po_time);
                } else if(!type){  //B2B收款认领
                    this.dstCurrency(it.po_currency_val, item.order_summary, it.po_time);
                }else if(type === 'N002630201'){ //GP大额订单认领
                    this.dstCurrency(it.pay_currency, item.order_summary, this.detailData.basis.transfer_time);

                }

                if (this.detailData.clime_order == null) {
                    this.detailData.clime_order = []
                }
                if (this.hadOrders) {
                    var temp = this.detailData.clime_order;
                    this.detailData.clime_order = [];
                    this.hadOrders = !this.hadOrders;

                }
                // 判断是否重复添加
                if (this.hadOrders && temp.length) {
                    temp.forEach(function(el, ind) {
                        if (el.order_info[field] == item.order_info[field]) {
                            flag = false;
                        }
                    })
                }
                this.detailData.clime_order.forEach(function(el, ind) {
                    if (el.order_info[field] == item.order_info[field]) {
                        flag = false;
                    }
                })
                if (flag) {
                    this.changeClaimAmount(item)
                    this.detailData.clime_order.push(item);
                    this.status = 'hasOrder';
                } else {
                    this.$message.error(this.$lang('请勿重复添加'))
                }
            },

            /*
            ** 删除订单前弹框提示用户
            ** 删除的订单方法涉及两种情况：
            ** 1.删除【b2b收款认领】 data.claim_type === 'N002630100' ，此情况下 没有弹框提示
            ** 2.删除【采购退款认领】 data.claim_type === 'N002630200'
            */
            beforeDeleteOrder(item) {
                var _this = this;
                var data = {
                    claim_id: [item.clime_order[0].order_info.claim_id],
                    claim_type: item.clime_order[0].claim_type,
                };
                if (data.claim_type === 'N002630200') {
                    const postData = {
                        action_type_cd: 'N002870010',
                        money_type: '2',
                        money_id: item.clime_order[0].order_info.claim_id
                    }
                    let tipString = this.$lang('本操作将生成采购余额')+'：'

                    // 通过接口获取抵扣金
                    axios.post('/index.php?m=order_detail&a=get_operation_amount', postData).then((res) => {
                        const resData = res.data.data
                        if (res.data.code === 200) {

                            // 弹框提示本次操作将产生的抵扣金
                            tipString = tipString + resData.end_pay_info.currency_type + resData.end_pay_info.amount
                            if (resData.is_show == '1') {
                                this.$confirm(tipString, '提示', {
                                    confirmButtonText: '确定',
                                    cancelButtonText: '取消',
                                    type: 'info'
                                }).then(() => {

                                    // 确定后删除订单
                                    this.deleteOrder(item)
                                }).catch(() => { });
                            } else {
                                // resData.is_show == '0'表示无需弹框提示，直接删除订单
                                this.deleteOrder(item)
                            }
                        } else {
                            this.$message.error(this.$lang(res.data.msg));
                        }
                    }).catch(() => { })
                } else {
                    // 删除【b2b收款认领】订单时 ，此情况下 无需弹框提示，直接删除
                    this.deleteOrder(item)
                }
            },
            // 删除订单
            deleteOrder: function deleteOrder(item) {
                var _this = this;
                var data = {
                    claim_id: [item.clime_order[0].order_info.claim_id],
                    claim_type: item.clime_order[0].claim_type,
                };

                axios.post('/index.php?m=B2b&a=deleteClaim', data)
                    .then(function (response) {
                        if (response.data.code == 200000) {
                            _this.$message.success(_this.$lang(response.data.msg));
                            window.location.reload();
                        } else {
                            _this.$message.error(_this.$lang(response.data.msg));
                        }
                    }).catch(function (err) {
                    console.log(err);
                });
            },

            submit: async function submit(type) {
                if (this.button) {
                    this.$message({
                        message: '请不要重复提交',
                        type: 'warning'
                    });
                }
                this.button = true;

                var _this = this;
                this.temporaryAmount = 0;
                var flag = true;
                var orderList = this.detailData.clime_order;
                var orders = []
                orderList.forEach(function(el, i) {
                    orders.push({
                        order_info: {
                            claim_id: el.order_info.claim_id,
                            PO_ID: el.claim_type == 'N002630200' ? el.order_info.procurement_number : el.order_info.PO_ID,
                            ORDER_ID: el.claim_type == 'N002630200' ? el.order_info.order_id : el.order_info.ORDER_ID,
                            order_no:el.claim_type === 'N002630201'?el.order_info.order_no:'',
                            order_id:el.claim_type === 'N002630201'?el.order_info.order_id:'',
                            plat_cd:el.claim_type === 'N002630201'?el.order_info.plat_cd:'',
                            claim_amount: el.order_info.claim_amount, //本次认领金额 输入完该值后会计算订单汇总相关的信息
                            sale_team: el.claim_type == 'N002630200' ? el.order_info.sale_team : el.order_info.SALES_TEAM,
                            summary_amount: Number(el.order_summary.summary_amount), //根据某天汇率计算后的当前认领金额
                            current_remaining_receivable: el.order_summary.current_remaining_receivable, //当前剩余应收
                            amount_currency_val: el.order_info.amount_currency_val
                        },
                        deductions: el.deductions,
                        claim_type: el.claim_type
                    })
                })

                var data = {
                    account_transfer_no: this.transfer_no,
                    account_transfer_id: this.detailData.basis.account_transfer_id,
                    is_end: type == 'common' ? 0 : 1,
                    orders: orders
                };

                data.orders.forEach(function(el, ind) {

                    if (!el.deductions.length && el.order_info.claim_amount <= 0) {
                        _this.$message.info(_this.$lang('请填写本次认领'))
                        flag = false;
                    }

                    if (el.deductions.length && el.order_info.claim_amount < 0) {
                        _this.$message.info(_this.$lang('请填写本次认领'))
                        flag = false;
                    }
                    el.deductions.forEach(function(e, i) {
                        if ((!e.deduction_type || !e.deduction_amount && e.deduction_amount != 0) || e.deduction_amount <= 0) {
                            _this.$message.info(_this.$lang('请填写扣费信息'))
                            flag = false;
                        }
                        if (!e.instructions && e.credentials_path.length == 0) {
                            _this.$message.info(_this.$lang('扣费凭证和扣费说明必须填写一个'))
                            flag = false;
                        }
                    })

                })
                if (flag) {

                    /*
                    ** 提交前弹框提示用户
                    ** 本方法涉及三种情况：
                    ** 1.b2b收款认领 data.orders[0].claim_type === 'N002630100' : 没有弹框提示
                    ** 2.采购退款认领 data.orders[0].claim_type === 'N002630200'
                    ** 2a.新增采购退款认领：       弹框提示用户本次操作将产生的应付金额，（应付金额=订单信息中【（换算后）本次认领退款金额】，按换算后的币种分类展示）
                    ** 2b.编辑采购退款认领(data.orders[0].order_info.claim_id有值)：
                        弹框提示用户本次操作将产生的应付金额应付金额=新提交的认领的金额）和抵扣金（从接口获取）
                    */
                    if (data.orders[0].claim_type === 'N002630200') { //采购退款认领
                        let tipString = ''
                        let dialogShow = true
                        if (data.orders[0].order_info.claim_id) {
                            const postData = {
                                action_type_cd: 'N002870009',
                                money_type: '2',
                                money_id: data.orders[0].order_info.claim_id
                            }
                            const res = await axios.post('/index.php?m=order_detail&a=get_operation_amount', postData)
                            const resData = res.data.data
                            if (res.data.code === 200) {
                                dialogShow = resData.is_show == '1' ? true : false
                                tipString =
                                    `本操作将，<br>生成采购余额:<br>(${data.orders[0].order_info.amount_currency_val})${data.orders[0].order_info.summary_amount.toFixed(2)}<br>扣减采购余额：<br>(${resData.end_pay_info.currency_type})${resData.end_pay_info.amount}`
                            } else {
                                this.$message.error(this.$lang(res.data.msg));
                            }
                        } else {
                            data.orders.forEach(item => {
                                this.$delete(item.order_info, "claim_id")
                            })

                            tipString = this.$lang('本操作将扣减采购余额')+'：<br>'
                            // 利用数组去重算法，将表格中【（换算后）本次认领退款金额】数据，按币种分类
                            let paymentObj = {}
                            this.detailData.clime_order.forEach( (item) => {
                                if (!paymentObj[item.order_info.amount_currency_val]) {
                                    paymentObj[item.order_info.amount_currency_val] = item.order_summary.summary_amount
                                } else {
                                    paymentObj[item.order_info.amount_currency_val] = this.accAdd(paymentObj[item.order_info.amount_currency_val], item.order_summary.summary_amount)
                                }
                            })

                            for (const currency in paymentObj) {
                                tipString = tipString + '(' + currency + ')' + paymentObj[currency].toFixed(2) + '<br>'
                            }
                            // const amountPayable = this.detailData.claim.currentAmount || 0
                            // tipString = '本操作将生成应付金额：' + '(' + this.detailData.claim.original_currency_val + ')' + amountPayable
                        }
                        if (dialogShow) {
                            this.$confirm(tipString, '提示', {
                                confirmButtonText: '确定',
                                cancelButtonText: '取消',
                                dangerouslyUseHTMLString: true,
                                type: 'info'
                            }).then(() => {
                                // 确定后提交
                                axios.post('/index.php?m=B2b&a=claimSubmit', data)
                                    .then(function (response) {
                                        _this.button = false
                                        if (response.data.code == 200000) {
                                            _this.$message.success(_this.$lang(response.data.msg));
                                            window.location.reload();
                                        } else {
                                            _this.$message.error(_this.$lang(response.data.msg));
                                        }
                                    }).catch(function (err) {
                                    _this.button = false
                                    console.log(err);
                                });

                            }).catch(() => { });
                        }else {
                            axios.post('/index.php?m=B2b&a=claimSubmit', data)
                                .then(function (response) {
                                    if (response.data.code == 200000) {
                                        _this.$message.success(_this.$lang(response.data.msg));
                                        window.location.reload();
                                    } else {
                                        _this.$message.error(_this.$lang(response.data.msg));
                                    }
                                }).catch(function (err) {
                                console.log(err);
                            });
                        }
                        _this.button = false
                    }else if(!data.orders[0].claim_type){ //B2B收款认领
                        for(var x = 0;x<data.orders.length;x++){
                            if(!data.orders[x].order_info.claim_id){
                                delete data.orders[x].order_info.claim_id
                            }
                        }
                        axios.post('/index.php?m=B2b&a=claimSubmit', data)
                            .then(function(response) {
                                _this.button = false
                                if (response.data.code == 200000) {
                                    _this.$message.success(_this.$lang(response.data.msg));
                                    window.location.reload();
                                } else {
                                    _this.$message.error(_this.$lang(response.data.msg));
                                }
                            }).catch(function(err) {
                            _this.button = false
                        });
                    }else if(data.orders[0].claim_type === 'N002630201'){ //GP大额订单
                        for(let x = 0;x<data.orders.length;x++){
                            if(!data.orders[x].order_info.claim_id){
                                delete data.orders[x].order_info.claim_id
                            }
                        }
                        axios.post('/index.php?m=B2b&a=claimSubmit', data)
                            .then(function(response) {
                                _this.button = false
                                if (response.data.code == 200000) {
                                    _this.$message.success(_this.$lang(response.data.msg));
                                    window.location.reload();
                                } else {
                                    _this.$message.error(_this.$lang(response.data.msg));
                                }
                            }).catch(function(err) {
                            _this.button = false
                        });
                    }
                }

            },


            /**
             ** 加法函数，用来得到精确的加法结果
             ** 说明：javascript的加法结果会有误差，在两个浮点数相加的时候会比较明显。这个函数返回较为精确的加法结果。
             ** 调用：accAdd(arg1,arg2)
             ** 返回值：arg1加上arg2的精确结果
             **/
            accAdd(arg1, arg2) {
                var r1, r2, m, c;
                try {
                    r1 = arg1.toString().split(".")[1].length;
                } catch (e) {
                    r1 = 0;
                }
                try {
                    r2 = arg2.toString().split(".")[1].length;
                } catch (e) {
                    r2 = 0;
                }
                c = Math.abs(r1 - r2);
                m = Math.pow(10, Math.max(r1, r2));
                if (c > 0) {
                    var cm = Math.pow(10, c);
                    if (r1 > r2) {
                        arg1 = Number(arg1.toString().replace(".", ""));
                        arg2 = Number(arg2.toString().replace(".", "")) * cm;
                    } else {
                        arg1 = Number(arg1.toString().replace(".", "")) * cm;
                        arg2 = Number(arg2.toString().replace(".", ""));
                    }
                } else {
                    arg1 = Number(arg1.toString().replace(".", ""));
                    arg2 = Number(arg2.toString().replace(".", ""));
                }
                return (arg1 + arg2) / m;
            },
            // 删除 文件 处理
            handleRemove(file, fileList, ind, item) {
                item[ind].credentials_path = [];
                // 如果是编辑扣费凭证
                if (fileList[0] && fileList[0].uid) {
                    fileList.forEach(function(el, i) {
                        item[ind].credentials_path.push({
                            savename: el.savename,
                            savepath: el.savepath,
                            name: el.name
                        })
                    })
                } else {
                    fileList.forEach(function(el, i) {
                        item[ind].credentials_path.push({
                            savename: el.response.info.savename,
                            savepath: el.response.info.savepath,
                            name: el.response.info.name
                        })
                    })
                }
            },
            handlePreview(file) {
                console.log(file);
            },
            beforeRemove(file, fileList) {
                return this.$confirm(this.$lang('确定移除') + file.name);
            },
            // 上传 文件 成功处理
            handleSuccess(res, file, fileList, ind, item) {
                if (!item[ind].credentials_path) {
                    item[ind].credentials_path = []
                }
                item[ind].credentials_path.push({
                    savepath: res.info.savepath,
                    savename: res.info.savename,
                    name: res.info.name
                })
            },
            // 打开查询订单弹窗
            openDialogOrder(type) {
                this.dialogVisible = true;
                this.orderSearchData.client_name = this.detailData.basis.opp_company_name;
                this.newClaimType = type;
                this.queryType = [{
                    CD: 'PO_ID',
                    CD_VAL: type ? 'B2B订单号' : '采购单号',
                }, {
                    CD: 'THR_PO_ID',
                    CD_VAL: type ? 'PO单号' : 'PO单号/网站订单号',
                }];
                this.searchOrder();
            },
            // 增加 扣费信息
            addDeduction(item) {
                item.push({
                    deduction_type: "",
                    deduction_amount: 0,
                    credentials_path: [],
                    instructions: ""
                })
            },
            // 编辑单个订单
            doEditSingle(item) {
                if(item.claim_type==='N002630201'){ //GP大额订单
                    this.bigOrderItem = _.cloneDeep(item);
                    this.bigOrderItem.isEdit = true;
                }
                this.status = 'editSingle'
                this.detailData.clime_order = [];
                this.detailData.clime_order[0] = item;
                this.temporaryAmount = +item.order_summary.summary_amount;
                this.detailData.clime_order[0].deductions.forEach(function(el, ind) {
                    el.fileList = []
                    el.credentials_path.forEach(function(e, i) {
                        el.fileList.push({
                            name: e.name ? e.name : e.savename,
                            savename: e.savename,
                            url: e.savepath,
                            savepath: e.savepath
                        })
                    })
                })
            },
            // 转化汇率
            dstCurrency(dst, target, date) {
                var _this = this;
                axios.get('index.php?m=ExchangeRate&a=conversion&date=' + date + '&src_currency=' + this.detailData.amount.original_currency_val + '&dst_currency=' + dst)
                    .then(function(response) {
                        if (response.data.code == 200) {
                            _this.$set(target, 'rate', response.data.data.rate)
                        } else {
                            _this.$message.error(_this.$lang(response.data.msg));
                        }
                    }).catch(function(err) {
                    console.log(err);
                });
            },
            // 切换扣费类型，清空数据
            changeDeductionType(item, index) {
                item[index].deduction_amount = 0;
                item[index].credentials_path = []
                item[index].instructions = '';
                item[index].fileList = []

            },
            // GP大额订单搜索
            onSearchByBigOrder(){
                axios.post('/index.php?m=b2b&a=getGPOrders',{
                    third_order_no:this.bigOrderFilter.third_order_no,
                    shop_id:this.bigOrderFilter.shop_id,
                }).then((res)=>{
                    let reg =/(\d)(?=(\d{3})+(?!\d))/g;
                    this.pagedBigOrders.data = res.data.data;
                    this.getShopNames();

                })
            },
            // GP大额订单重置
            onResetByBigOrder(){
                Object.keys(this.bigOrderFilter).forEach((key) => {
                    this.bigOrderFilter[key] = null
                });
                this.onSearchByBigOrder();
            },
            openDialogByBigOrder(){
                this.isVisibleBigOrderDialog =true;
                this.onSearchByBigOrder();
            },
            onCloseBigOrder(){
                this.isVisibleBigOrderDialog = false;
            },
            onConfirmBigOrder(){
                this.isVisibleBigOrderDialog = false;

            },
            // 添加GP大额订单
            onAddByBigOrder(item,type){
                let data = {
                    ...item,
                    claim_type:type
                }

                this.showOrder = true;
                this.status = 'hasOrder';

                this.bigOrders.push(data);

                for(let i = 0; i < this.bigOrders.length; i++) {
                    for(let j = i + 1; j < this.bigOrders.length; j++){
                        if (this.bigOrders[i].order_id === this.bigOrders[j].order_id){
                            this.bigOrders.splice(i,1)
                            this.$message.error(this.$lang('该GP大额订单已经存在'))
                        }
                    }
                }
                // this.$message.error(this.$lang('该GP大额订单已经存在'))


                // claim_type  表示是不是GP大额订单
                // this.detailData.clime_order
            },
            //GP大额订单提交
            onCurrentSubmitByBigOrder(){

            },
            // 确认并提交认领完结
            onConfirmCurrentSubmitByBigOrder(){

            }
        },
        filters: {
            separatNum: function(num) { //千分位方法
                var num = Number(num).toFixed(2);
                if(num==='-0.00'){
                    num = '0.00'
                }
                num = num + "";
                var _arr = num.split(".");
                return _arr[1] === "00" ? (num - 0).toLocaleString() + ".00" : (num - 0).toLocaleString();
            },
            percentage: function(num) {

                return num ? ((num * 100).toFixed(2) + "%") : '';
            },
        }
    });

    //获取url参数
    function getQueryVariable(variable) {
        var query = window.location.search.substring(1);
        var vars = query.split("&");
        for (var i = 0; i < vars.length; i++) {
            var pair = vars[i].split("=");
            if (pair[0] == variable) {
                return pair[1];
            }
        }
        return false;
    }
    //时间戳转日期
    function _formatDate(date, fmt) {
        if (/(y+)/.test(fmt)) {
            fmt = fmt.replace(RegExp.$1, (date.getFullYear() + '').substr(4 - RegExp.$1.length));
        }
        var o = {
            'M+': date.getMonth() + 1,
            'd+': date.getDate(),
            'h+': date.getHours(),
            'm+': date.getMinutes(),
            's+': date.getSeconds()
        };
        for (var k in o) {
            if (new RegExp('(' + k + ')').test(fmt)) {
                var str = o[k] + '';
                fmt = fmt.replace(RegExp.$1, RegExp.$1.length === 1 ? str : padLeftZero(str));
            }
        }
        return fmt;
    }

    function padLeftZero(str) {
        return ('00' + str).substr(str.length);
    };
</script>
</body>

</html>