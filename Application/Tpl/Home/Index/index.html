<!DOCTYPE HTML>
<html id="html">
<head>
    <!-- <meta charset="utf-8"> -->
    <meta http-equiv="content-type" content="text/html;charset=utf-8">
    <meta name="renderer" content="webkit|ie-comp|ie-stand">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1.0,maximum-scale=1.0,user-scalable=no" />
    <meta http-equiv="Cache-Control" content="no-siteapp" />
    <!-- <meta http-equiv="Cache-Control" content="no-cache" /> -->
    <!--[if lt IE 9]>
    <script type="text/javascript" src="../Public/lib/html5.js"></script>
    <script type="text/javascript" src="../Public/lib/respond.min.js"></script>
    <script type="text/javascript" src="../Public/lib/PIE_IE678.js"></script>
    <![endif]-->
    <link href="../Public/../Index/jquery.mCustomScrollbar.css?=20191104" rel="stylesheet" type="text/css" />
    <link href="../Public/css/H-ui.min.css" rel="stylesheet" type="text/css" />
    <link href="../Public/css/H-ui.admin.css?v=20191104" rel="stylesheet" type="text/css" />
    <link href="../Public/skin/default/skin.css?v=20210105" rel="stylesheet" type="text/css" />
    <link href="../Public/lib/Hui-iconfont/1.0.1/iconfont.css" rel="stylesheet" type="text/css" />
    <link href="../Public/lib/Hui-iconfont/sms-iconfont/iconfont.css" rel="stylesheet" type="text/css" />
    <link href="../Public/css/style.css?v=20191104" rel="stylesheet" type="text/css" />
    <link rel="stylesheet" href="../Public/lib/icon/css/font-awesome.min.css">

    <link rel="stylesheet" href="../Public/css/iconfont/iconfont.css?<{$Think.config.VER_NUM}>">
    <link rel="stylesheet" href="./Application/Tpl/Home/Public/css/default.css?v=<{$Think.const.V}>">
    <link rel="shortcut icon" href="../Public/images/favicon-logo.ico" type="image/x-icon">
    <!--<script>var skin_dir = "../Public/";</script>-->
    <title><{$host}></title>
    <link href="../Public/../Index/index.css?=20191104" rel="stylesheet" type="text/css" />
    <style type="text/css">
        #langS{
            background-color:#1E7EB4;
            color:white;
            border:none;
            font-size:14px;
        }
        #mCSB_1_dragger_vertical{
            right: 0;width: 4px;
        }
        .mCSB_dragger_bar{
            margin: 0 !important;    background-color: rgb(30, 126, 180) !important;
        }
        #mCSB_1_scrollbar_vertical{margin: 0 !important; width: 3px}
        .menu-text{
            white-space: normal;
        }
        .icon-z{
            font-size: 26px !important;
            margin-left: 5px;
        }
        body{
            overflow: hidden;
        }
        #mCSB_2_scrollbar_horizontal{
            height: 3px;
            z-index: 100000;
        }
    </style>
    <style type="text/css">
        #mainHeader{
            display: flex;
            align-items: center;
            justify-content: space-between;
        }
        .scroll__logs{
            /*width:59%;*/
            height: 50px;
            overflow: hidden;
            display: flex;
            justify-content: center;
            align-self: auto;
            flex: 1;
        }
        .navbar__logs{
            position: relative;
            /*transition: top 0.5s;*/
        }
        .navbar__logs li{
            color: #000000;
            height: 50px;
            display: flex;
            align-items: center;
            cursor: pointer;
        }
        .top__animate {
            transition: all 0.5s;
            margin-top: -50px;
        }
    </style>
    <style  type="text/css">
        #main{
            height: 100vh;
            z-index: 2000;
        }
        #mask__layer{
            display: none;
            height: 100vh;
            width: 100%;
            z-index: 1000;
            position: absolute;
        }
        .user__help__center {
            background: #0f9ae0;
            position: absolute;
            top: 0px;
            right: -40px;
            z-index: 10000;
            width: 56px;
            height: 100px;
            border-radius: 8px;
            display: flex;
            justify-content: center;
            cursor: pointer;
            flex-direction: column;
            align-items: center;
        }
        .user__help__center-title {
            color: #ffffff;
            display: flex;
            width: 50px;
            /* width: 20px; */
            height: 100%;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }
        .user__help__center-name {
            display:none;
        }
        .user__help__center:hover .user__help__center-name{
            position: absolute;
            top: 30px;
            /*left: -60px;*/
            width: 60px;
            height: 40px;
            display: flex;
            justify-content: center;
            align-items: center;
            background: #0f9ae0;
            border-top-left-radius: 8px;
            border-bottom-left-radius: 8px;
        }
        .user__help__center-name-left{
            left: 40px !important;
            border-top-left-radius: 0px !important;
            border-bottom-left-radius: 0px !important;
            border-top-right-radius: 8px;
            border-bottom-right-radius: 8px;
        }
        .Hui-userbar{
            position: relative;
            top: 0;
            right: 0;
        }

    </style>
    <style type="text/css">
        .log__message{
            position: absolute;
            top: 4px;
            right: 20px;
        }
        .log__message span{
            width: 20px;
            height: 20px;
            color: #ffffff;
            border-radius: 50%;
            background: #ff0000;
            display: flex;
            align-items: center;
            justify-content: center;
            position: absolute;
            right: -7px;
        }
        .log__message-unread-count-submenu{
            width: 20px;
            height: 20px;
            color: #ffffff;
            border-radius: 50%;
            background: #ff0000;
            display: flex;
            align-items: center;
            justify-content: center;
            position: absolute;
            top: 0px;
            right: 10px;
        }
    </style>
    <script>
        let uid = <?php echo $_SESSION['user_id']?>;
        document.cookie = "userId="+uid;
        let own_permissions = "<?php echo json_encode(array_keys($_SESSION['actlist'])); ?>";
        let role_id = <?php echo json_encode($_SESSION['role_id'])?>;
        if(role_id[0] == 1){
            own_permissions = JSON.parse(own_permissions)
            own_permissions.push(10000);
            own_permissions.push(10001);
            own_permissions.push(10002);
            own_permissions = String(own_permissions)
        }
    </script>
</head>
<body>

<header v-cloak id="mainHeader" class="Hui-header cl">
    <div>
        <a class="Hui-logo l cus-logo-font" title="H-ui.admin v2.3" href="javascript:window.location.reload()"><img src="../Public/images/ERP_logo_system.png" height="30" alt="" class="cus-logo-img" style="margin-top: 7px"></a>
        <a class="Hui-logo-m l" href="/" title="H-ui.admin"></a> <span class="Hui-subtitle l"></span>
    </div>
    <!--    <div class="scroll__logs">-->
    <!--            <ul class="navbar__logs" :class="{'top__animate': topAnimate}">-->
    <!--                <template v-for="(item,index) in updateLogList">-->
    <!--                    <li @click="onView" class="inactive__item" >{{item.created_log_at + $lang('更新日志')+'：'+ item.log_name}}</li>-->
    <!--                </template>-->
    <!--            </ul>-->
    <!--    </div>--> 跑马灯效果
    <div>
        <ul class="Hui-userbar navbar">
            <!--onclick="opennewtab(this,'在线反馈')"-->
            <li class="navber_question"><a  id="toQuestion" onclick='tab(this,"在线反馈",true)'><img src="../Public/images/question.png" alt="">
                <{$Think.lang.在线反馈}>
            </a></li>
            <li class="navbar_print navbar_userInfo"><a href="#" onclick="Print()"><img src="../Public/images/print.png" alt="" />
                <{$Think.lang.打印}>
            </a></li>
            <li class="navbar_userInfo">
                <span><span id="languagesType"><?= BaseModel::languages()[$current_language][ETC] ?> </span><i>▼</i></span>
                <dl>
                    <foreach name="languages" item="vo" key="idx">
                        <dd><a href="<{:U('', ['l' => $idx])}>"><{$Think.lang.$vo[ETC]}></a></dd>
                    </foreach>
                </dl>
            </li>
            <li class="navbar_userInfo">
                <span><span id="scName"><{$Think.session.m_loginname}></span> <i>▼</i></span>   <!-- 花名展示 -->
                <dl>
                    <!--<dd><a href="#" onclick="admin_edit('<{$Think.lang.个人信息}>','<{:U("admin/admin_edit")}>&m_id=<{$Think.session.user_id}>', '', '800', '500')"><{$Think.lang.个人信息}></a></dd>-->
                    <dd><a href="#" onclick="admin_edit('Modify Password','<{:U("admin/admin_password")}>&m_id=<{$Think.session.user_id}>','<{$Think.session.user_id}>','500','300')" >
                        <{$Think.lang.修改密码}>
                        </a></dd>
                    <dd><a href="<{:U('public/logout')}>">
                        <{$Think.lang.退出}>
                    </a></dd>
                </dl>
            </li>
            <li id="Hui-msg" style="display: none"> <a href="#" title="消息"><span class="badge badge-danger">1</span><i class="Hui-iconfont" style="font-size:18px">&#xe68a;</i></a> </li>
        </ul>
        <a aria-hidden="false" class="Hui-nav-toggle Hui-iconfont visible-xs" href="#">&#xe681;</a>
    </div>
</header>
<div class="slideBar hide"></div>
<aside id="menuAside" class="Hui-aside light">
    <input runat="server" id="divScrollValue" type="hidden" value="" />
    <div class="menu_dropdown bk_2">
        <dl style="border-bottom: rgb(14,57,97) 1px solid;" onclick="displaynavbar(this)" bool="false">
            <dt style="padding: 0 10px;">
                <div>
                    <span id="iconshouqix" class="iconfont iconcaidanlanshouqix" style="line-height: 68px;font-size: 25px !important;margin-left: 3px;"></span>
                </div>
            </dt>
        </dl>
        <?php foreach($module as $l){
                if(in_array($l['ID'], array_keys($_SESSION['actlist']))){?>
        <dl id="menu-article" tabid="<?php echo $l['ID']?>">
            <dt>
                <?php if($l['NAME']==='系统指南'){  ?>
                <div class="log__message" v-if="unReadCount!==0">
                    <span class="log__message-unread-count">{{unReadCount}}</span>
                </div>
                <?php } ?>
                <div>
                    <i <?php if(in_array($l['ICON'],['&#xe717;','&#xe601;'])){echo 'class="iconfont"';}else{echo 'class="iconfont icon-z"';}?> > <?php echo $l['ICON']; ?></i>
                </div>
                <div class="menu-text"><?php echo L($l['NAME']) ?></div>
            </dt>
        </dl>
        <?php }}
        ?>


        <!-- 如果是超级管理员 -->

        <dl tabid="10000" <?php if(!in_array(1,$_SESSION['role_id'])){?> style="display: none" <?php }?> >
        <dt><div><i class="Hui-iconfont">&#xe62d;</i></div><div class="menu-text"><{$Think.lang.管理员管理}></div></dt>
        </dl>

    </div>
</aside>
<section class="Hui-article-box">
    <div id="Hui-tabNav" class="Hui-tabNav" style="overflow: hidden">
        <div id="homePage" class="active"  title="Home Page" style="padding-right:12px !important; width: 90px;float: left;    margin-right: 2px;"><span data-href="welcome.html">Home Page</span><div class="radis-right"></div><div class="radis-right-background"></div></div>
        <div class="Hui-tabNav-wp" style="width:calc(100% - 170px) ; float: left">
            <ul id="min_title_list" class="acrossTab cl" style="width: max-content !important;">
                <li class="active" id="menuTest" title="Home Page" style="padding-right:12px !important; display: none"><span data-href="welcome.html">Home Page</span><div class="radis-right"></div><div class="radis-right-background"></div></li>
            </ul>
        </div>
        <!-- <div class="Hui-tabNav-more btn-group" ><a id="js-tabNav-prev" class="btn radius btn-default size-S" href="javascript:;"><i class="Hui-iconfont">&#xe6d4;</i></a><a id="js-tabNav-next" class="btn radius btn-default size-S" href="javascript:;"><i class="Hui-iconfont">&#xe6d7;</i></a></div> -->
        <div class="index_reload"><button  type="button" style="width:84px;"><i class="Hui-iconfont" style="top: 20%;">&#xe68f</i>
            <{$Think.lang.刷新}>
        </button></div>
    </div>
    <div id="iframe_box" class="Hui-article">
        <div class="show_iframe">
            <div style="display:none" class="loading"></div>
            <iframe scrolling="yes" frameborder="0" src="<{:U('Index/welcome')}>"></iframe>
        </div>
    </div>
    <div class="hide" id="closeAll">
        <div style="display: flex;height: 105px">
            <div class="icon-div">
                <i class="Hui-iconfont Hui-iconfont-close"></i>
                <i>其</i>
                <i>All</i>
            </div>
            <div class="but-div">
                <span>关闭当前标签页</span>
                <span>关闭其他标签页</span>
                <span>关闭全部标签页</span>
            </div>
        </div>
        <div class="cancel">
            取消
        </div>
    </div>
</section>
<div id="mean-box" class="mean-box" style="display: none">
    <div class="Hui-nav-triangle"></div>
    <div class="nav-box">
    </div>
</div>

<div id="mask__layer"></div>

<div><?php print_r($langArray); ?></div>
<div  id="main">
    <div  ref="userHelpCenter"  @mousedown="onMousedown($event)"   @mouseup="onMouseUp($event)" class="user__help__center">
        <span class="user__help__center-title">{{$lang('帮助')}}</span>
        <span class="user__help__center-title">{{$lang('中心')}}</span>
    </div>
</div>

<script type="text/javascript" src="../Public/lib/jquery/1.9.1/jquery.min.js"></script>
<script type="text/javascript" src="../Public/lib/layer/1.9.3/layer.js"></script>
<!-- <script type="text/javascript" src="../Public/js/H-ui.js?<{$Think.config.VER_NUM}>"></script> -->
<script type="text/javascript" src="../Public/js/H-ui.js"></script>
<!-- <script type="text/javascript" src="../Public/js/H-ui.admin.js?<{$Think.config.VER_NUM}>"></script> -->
<script type="text/javascript" src="../Public/js/H-ui.admin.js?<{$Think.config.VER_NUM}>"></script>
<script type="text/javascript" src="./Application/Tpl/Home/Public/utils/utils.js?v=<{$Think.config.VER_NUM}>"></script>
<script type="text/javascript" src="../Public/../Index/index.js?<{$Think.config.VER_NUM}>"></script>
<script type="text/javascript" src="../Public/../Index/index.js?<{$Think.config.VER_NUM}>"></script>
<script type="text/javascript" src="../Public/../Index/jquery.mCustomScrollbar.concat.min.js?<{$Think.config.VER_NUM}>"></script>
<script type="text/javascript" src="./Application/Tpl/Home/Public/js/vue.2.5.13.js"></script>
<script type="text/javascript" src="./Application/Tpl/Home/Public/js/axios.min.js?v=201907011048"></script>

<script>
    let unReadCount =0;
</script>
<script>
    let lan = $.trim('<?php echo $current_language; ?>');
    if(lan === 'en-us'){
        $('.menu-text').css({'line-height':'12px','font-size':10})
        $('.menu-text').css('line-height','12px !important')
    }
    <?php $m = []; foreach($module as $x){$x['NAME'] = L($x['NAME']);$a = [];foreach($x['child'] as $c){$c['NAME'] = L($c['NAME']);array_push($a,$c);};$x['child'] = $a;array_push($m,$x);};?>
    let list =  <?php echo json_encode($m)?>;
    let admin = <?php if(!in_array(1,$_SESSION['role_id'])){ echo 'false';}else{echo 'true';}?>;
    if(admin){
        admin = {
            ACT: "",
            CTL: "",
            ICON: "&#xe616;",
            ID: "10000",
            LEVEL: "1",
            NAME: "管理员管理",
            PID: "0",
            REMARK: null,
            SORT: "0",
            STATUS: "0",
            TITLE: "顶级菜单",
            TYPE: "000",
            UPDATED: "0",
            child: [{
                ACT: "gp_channel",
                CTL: "Management",
                ICON: "&#xe616;",
                ID: "10001",
                LEVEL: "2",
                NAME: "<{$Think.lang.菜单配置}>",
                PID: "10001",
                REMARK: null,
                SORT: "0",
                STATUS: "0",
                TITLE: "<{$Think.lang.管理员管理}>",
                TYPE: "000",
                UPDATED: "0",
                mapping_system: "ERP",
                mapping_url: "",
                url: "<{:U('Menu/menu_list')}>"
            },{
                ACT: "gp_channel",
                CTL: "Management",
                ICON: "&#xe616;",
                ID: "10001",
                LEVEL: "2",
                NAME: "<{$Think.lang.角色管理}>",
                PID: "10002",
                REMARK: null,
                SORT: "0",
                STATUS: "0",
                TITLE: "<{$Think.lang.管理员管理}>",
                TYPE: "000",
                UPDATED: "0",
                mapping_system: "ERP",
                mapping_url: "",
                url: "<{:U('Role/role_list')}>"
            },{
                ACT: "gp_channel",
                CTL: "Management",
                ICON: "&#xe616;",
                ID: "10001",
                LEVEL: "2",
                NAME: "<{$Think.lang.用户管理}>",
                PID: "10002",
                REMARK: null,
                SORT: "0",
                STATUS: "0",
                TITLE: "<{$Think.lang.管理员管理}>",
                TYPE: "000",
                UPDATED: "0",
                mapping_system: "ERP",
                mapping_url: "",
                url: "<{:U('Admin/admin_list')}>"
            }],
            mapping_system: "",
            mapping_url: ""
        }
        list[10000] = admin
    }
    let scrollHeight = 0;
    $('#iconshouqix').html('')
    let model = []
    for(let x in list){
        model.push(list[x])
    }
    $(window).on("storage", function (e) {
        if (e.originalEvent.key === 'closeWindow') {
            $("[data-href='" + e.originalEvent.newValue + "']").parent().find('b').click();
            sessionStorage.removeItem('closeWindow');
        }
    });
    /*   $(window).on('click',function(){
           setTimeout(function(){
               $(".Hui-tabNav-wp").mCustomScrollbar("update");
           },100)
       })*/
    $(window).on('load',function(){
        $(".Hui-aside").mCustomScrollbar({
            theme:"minimal-dark",
            scrollInertia:20,
            callbacks:{
                onScroll:function(){
                    scrollHeight = this.mcs.top
                }
            }
        });
        $(".Hui-tabNav-wp").mCustomScrollbar({
            axis:"x",
            theme:"minimal-dark",
            scrollInertia:20,
            callbacks:{
                onScroll:function(){
                    // console.log(this.mcs.left)
                }
            }
        });
        $('.Hui-aside dl[tabid]').on('mouseover',function(event){
            if($('dl[bool]').attr('bool') !== 'true'){
                clickNav(event)
            }
        }).on('mouseout',function(event){
            if($('dl[bool]').attr('bool') !== 'true'){
                hideNav(event)
            }
        })
        $('.Hui-aside dl[tabid]').click(clickNav)
        /* $(window).click(function(event){
             if(!$(event.target).parents('[tabid]').length && !$(event.target).parents('#mean-box').length && $('dl[bool]').attr('bool') === 'false'){
                 hideNav(event)
             }
         })*/
        $('.mean-box').on('mouseover',function(){
            $('.mean-box').show()
        }).on('mouseout',function(){
            $('.mean-box').hide()
        })
    })

    function getQueryVariable(val){
        var query = window.location.search.substring(1);
        var vars = query.split("&");
        for (var i=0;i<vars.length;i++) {
                var pair = vars[i].split("=");
                if(pair[0] == val){return pair[1];}
        }
        return(false);
    }


    $(window).on('load',function(){
        if(getQueryVariable('source') == 'email'){
            if(getQueryVariable('actionType') == 'contract'){
                var idd = getQueryVariable('id')
                newTab("/index.php?m=contract&a=show&ID="+idd, "<{$Think.lang.合同详情页}>");
            }else if(getQueryVariable('actionType') == 'dispatch'){
                newTab("/index.php?g=oms&m=patch&a=lists", "<{$Think.lang.待派单}>");
            }else if(getQueryVariable('actionType') == 'transportation'){
                var idd = getQueryVariable('id')
                newTab("/index.php?m=allocation_extend_new&a=transportation&id="+idd, "<{$Think.lang.运输中}>");
            }
            else if(getQueryVariable('actionType') == 'orderList'){
                newTab("/index.php?g=oms&m=order&a=orderList", "<{$Think.lang.订单列表}>");
            }
            else if(getQueryVariable('actionType') == 'listPage'){
                newTab("/index.php?g=oms&m=out_storage&a=listPage", "<{$Think.lang.已出库}>");
            }else if(getQueryVariable('actionType') == 'promotionTask'){
                var idd = getQueryVariable('id')
                newTab("/index.php?m=management&a=promotion_task_list&id="+idd, "<{$Think.lang.推广任务列表}>");
            }else if(getQueryVariable('actionType') == 'promotionDemand'){
                var idd = getQueryVariable('id')
                newTab("/index.php?m=management&a=promotion_demand_list&id="+idd, "<{$Think.lang.推广需求列表}>");
            }else if(getQueryVariable('actionType') == 'paymentDetails'){
                var payment_audit_id = getQueryVariable('payment_audit_id')
                var source_cd = getQueryVariable('source_cd')
                newTab("/index.php?m=finance&a=pay_order_detail&payment_audit_id="+payment_audit_id+'&source_cd='+source_cd, "<{$Think.lang.付款单详情}>");
            }else if(getQueryVariable('actionType') == 'generalPaymentDetails'){
                var payment_audit_id = getQueryVariable('payment_audit_id')
                var source_cd = getQueryVariable('source_cd')
                newTab("/index.php?m=finance&a=general_payment_detail&payment_audit_id="+payment_audit_id+'&source_cd='+source_cd, "<{$Think.lang.一般付款单详情}>");
            }else if(getQueryVariable('actionType') == 'purchase'){
                var idd = getQueryVariable('id')
                newTab("/index.php?g=scm&m=display&a=purchases&type="+idd, "<{$Think.lang.采购详情}>");
            }else if(getQueryVariable('actionType') == 'erpOpertionMore'){
                newTab("/index.php?m=data_center&a=erp_opertion_more", "<{$Think.lang.系统使用详情}>");
            }else if (getQueryVariable('actionType') == 'promotionDetail') {
                var idd = getQueryVariable('id')
                newTab("/index.php?m=hr&a=promotionDetail&id=" + idd, "<{$Think.lang.晋升详情}>");
            }
            window.history.pushState(null, null, '/index.php?m=index&a=index');
        }
    })


    function getElementViewTop(element){
        // console.log("获取当前元素的html",element);
        let actualTop = element.offsetTop;
        let current = element.offsetParent;
        let elementScrollTop=null;
        while (current !== null){
            actualTop += current. offsetTop;
            current = current.offsetParent;
        }

        if (document.compatMode == "BackCompat"){
            elementScrollTop=document.body.scrollTop;
        } else {
            elementScrollTop=document.documentElement.scrollTop;
        }

        return actualTop-elementScrollTop;
    }

    function setNavList (id){
        let list = findArr(id,'ID',model);
        let html = '';
        let url = getTab();
        for(let x = 0;x<list.child.length;x++){
            let u = '';
            let l = ''
            if(list.child[x].url === url){
                u = 'nav-text-weight'
                l = '<div class="nav-text-click"></div>'
            }
            if (own_permissions.indexOf(list.child[x].ID) !== -1) {
                //权限判断
                if(list.child[x].NAME==='更新日志' && unReadCount!==0){ //如果是更新日志
                    html += '<div class="nav-text ' + u + '">\n' +
                        '<span class="log__message-unread-count-submenu"> '+ unReadCount +' </span>\n'+
                        '<a _href="' + list.child[x].url + '" title="' + list.child[x].NAME + '" href="javascript:void(0)" onclick="tab(this, \'' + list.child[x].NAME + '\')">' + list.child[x].NAME + '</a>\n' + l +
                        '</div>'
                }else {
                    html += '<div data-pid="' + list.child[x].PID + '" class="nav-text ' + u + '">\n' +
                        '      <a _href="' + list.child[x].url + '" title="' + list.child[x].NAME + '" href="javascript:void(0)" onclick="tab(this, \'' + list.child[x].NAME + '\')">' + list.child[x].NAME + '</a>\n' + l +
                        '   </div>'
                }

            }
        }
        $('#mean-box').attr('tab-list-id',list.ID)
        $('#mean-box .nav-box').html('').append(html)

    }
    function tab(obj,name,type) {
        if(!type){
            $('.nav-text-click').remove()
            $('.nav-text-weight').removeClass('nav-text-weight')
            $(obj).parent().append('<div class="nav-text-click"></div>').addClass('nav-text-weight')
        }
        var pid = $(obj).parent().attr('data-pid');
        $('.aside-menu-active').removeClass('aside-menu-active');
        $('[tabid='+ pid +']').addClass('aside-menu-active')
        opennewtab(obj,name,true)
        hideNav('tab')
        $('#homePage').removeClass('active')
        setTimeout(function(){
            $(".Hui-tabNav-wp").mCustomScrollbar("update");
        },100)
        setTimeout(function(){
            $('iframe').contents().unbind('click').on('click',function(){
                hideNav()
            })
        },1000)
    }

    function clickNav(event){
        $('.mean-box').find('.nav-box').css('max-height', 'none')
        $('.mean-box').find('.nav-box').css('overflow-y','auto')


        $('.nav-tab-click').removeClass('nav-tab-click')
        $(event.currentTarget).addClass('nav-tab-click')
        let top = getElementViewTop(event.currentTarget);
        let id = $(event.currentTarget).attr('tabid');

        setNavList(id)
        $('.mean-box').css('top',top+10).show()


        if($('dl[bool]').attr('bool') === 'false'){
            let window_h = $(window).height();
            let box_h = $('.mean-box').height();
            // console.log("当前可视区域及元素的高度",window_h,box_h);

            if(box_h + top + 10 > window_h && top +(0 - box_h + 80) >= 0){
                $('.mean-box').find('.nav-box').css('top',0 - box_h + 80)
                // console.log("1");
            }else  if(box_h + top + 10 > window_h && top +(0 - box_h + 80) < 0){
                $('.mean-box').find('.nav-box').css('top',0- box_h/2+236)
                // console.log("2");
            }else{
                $('.mean-box').find('.nav-box').css('top',0)
                // console.log("3");
            }
        }

        let navMaxHeight =  document.body.clientHeight - $('.mean-box').find('.nav-box').offset().top -50

        $('.mean-box').find('.nav-box').css('max-height',navMaxHeight + 'px')
        $('.mean-box').find('.nav-box').css('overflow-y','scroll')


    }

    function hideNav(event){

        if(event !== 'tab' || $('dl[bool]').attr('bool') !== 'true'){
            $('.nav-tab-click').removeClass('nav-tab-click')
        }
        $('.mean-box').hide()
    }

    function findArr(v,type,arr){
        let t = {}
        for(let x = 0;x<arr.length;x++){
            if(arr[x]){
                if(arr[x][type] === v){
                    t = arr[x]
                }
            }
        }
        return t
    }

    // function getQueryVariable(variable)
    // {
    //     let query = window.location.search.substring(1);
    //     console.log("参数",query);
    //     let vars = query.split("&");
    //     for (let i=0;i<vars.length;i++) {
    //         let pair = vars[i].split("=");
    //         if(pair[0] == variable){return pair[1];}
    //     }
    //     return(false);
    // }

    /**
     * 模拟点击homepage，为了兼容插件本身的方法
     */
    $('#homePage').click(function(){
        $(this).addClass('active')
        $('#menuTest').click()
    })

    $('#min_title_list').click(function(event){
        if($(event.target).attr('id') !== 'menuTest' && $(event.target).parent().attr('id') !== 'menuTest'){
            $('#homePage').removeClass('active')
        }
    })
</script>
<script>
    const vueApp = new Vue({
        el: '#main',
        data() {
            return {
                saving:false,
                htmlClientHeight:0,
                htmlClientWidth:0,
                moveDataelse: {
                    x: null,
                    y: null
                },
                isShowLeft:false,
                moveLeft:0,
                moveTop:0,
                isDrag:false,
                timmerHandle:null,
                clickTime:0,
                maskLayer:null

            }
        },
        mounted() {
            this.init();
            window.onresize=this.onresize
        },
        methods: {
            onresize(){
                this.init();
                this.isShowLeft=false;
            },
            init(){
                const html = document.getElementsByTagName('html');
                this.htmlClientHeight = html[0].clientHeight;
                this.htmlClientWidth = html[0].clientWidth;

                //将帮助中心右边居中显示
                this.$refs.userHelpCenter.style.top = ((this.htmlClientHeight/2)-(this.$refs.userHelpCenter.offsetHeight/2)) +'px';
                this.$refs.userHelpCenter.style.left = this.htmlClientWidth-this.$refs.userHelpCenter.offsetWidth +'px';

                this.moveTop = ((this.htmlClientHeight/2)-(this.$refs.userHelpCenter.offsetHeight/2)) +'px';
                this.moveLeft = this.htmlClientWidth-this.$refs.userHelpCenter.offsetWidth +'px';

            },
            onMousedown(event){
                this.maskLayer =document.getElementById('mask__layer');
                this.maskLayer.style.display = 'block';

                this.moveDataelse.x = event.pageX - this.$refs.userHelpCenter.offsetLeft
                this.moveDataelse.y = event.pageY - this.$refs.userHelpCenter.offsetTop

                this.timmerHandle = setInterval(()=>{
                    this.clickTime+=20;
                },20)
                window.onmousemove = this.onMousemove;
            },
            onMousemove(event){
                this.moveLeft = event.pageX - this.moveDataelse.x
                this.moveTop = event.pageY - this.moveDataelse.y

                let moveLeft = event.pageX - this.moveDataelse.x + 'px'
                let moveTop = event.pageY - this.moveDataelse.y + 'px'

                this.$refs.userHelpCenter.style.left = moveLeft
                this.$refs.userHelpCenter.style.top = moveTop


            },
            onMouseUp(event){
                //首先判断用户是点击操作还是移动行为
                if(this.clickTime>=200){
                    console.log("用户拖动");
                    // 根据用户拖到到地方判断时悬停在左边还是右边
                    if((this.moveLeft+parseInt(this.$refs.userHelpCenter.offsetWidth/2)) <= parseInt(this.htmlClientWidth/2)){
                        this.$refs.userHelpCenter.style.left=92+'px';
                        this.isShowLeft=true;

                    }else { //右边
                        this.$refs.userHelpCenter.style.left=this.htmlClientWidth-this.$refs.userHelpCenter.offsetWidth +'px';
                        this.isShowLeft=false;
                    }

                    //当拖动到屏幕底部距离超出可视区域屏幕高度时
                    if(this.htmlClientHeight<=(this.moveTop+this.$refs.userHelpCenter.offsetHeight)){
                        this.$refs.userHelpCenter.style.top = this.htmlClientHeight-this.$refs.userHelpCenter.offsetHeight+'px';
                    }else if(this.moveTop<=0){   //当拖动到屏幕顶部距离超出可视区域屏幕高度时
                        this.$refs.userHelpCenter.style.top = 0+'px';
                    }
                    this.isDrag=false;
                    window.onmousemove = null;
                    clearInterval(this.timmerHandle);

                    this.clickTime=0;
                    this.maskLayer.style.display = 'none';
                }else {
                    // console.log("用户点击");
                    window.onmousemove = null;
                    this.isDrag=false;
                    clearInterval(this.timmerHandle);
                    this.clickTime=0;
                    this.maskLayer.style.display = 'none';

                    let href = "/index.php?m=user_help_center&a=userHelpCenterList";
                    let a = document.createElement('a');
                    a.setAttribute("style","display: none");
                    a.setAttribute("onclick", "opennewtab(this,'" + this.$lang('帮助中心') + "')" );
                    a.setAttribute("_href",href);
                    a.onclick();

                }
            },
        }
    });
</script>
<script>
    const vueHeaderApp = new Vue({
        el: '#mainHeader',
        data() {
            return {
                OPEN_HOST: '<{$OPEN_HOST}>',
                user_name: '<{$user_name}>',
                updateLogList:[],
                activedItem:0,
                topAnimate: false,
                autoPlayTimer:null,
                unreadLogTimer:null
            }
        },
        computed: {
            top() {
                return - this.activedItem * 50 + 'px';
            },
            transition() {
                return this.activedItem === 0 ? 'none' : 'top 0.5s';
            }
        },
        created() {
        },
        mounted() {
            // this.getUnreadLog();

            this.unreadLogTimer = setInterval(()=>{
                // this.getUnreadLog();
                clearInterval(this.autoPlayTimer);
                clearInterval(this.unreadLogTimer);
            },30000);
        },
        methods: {
            getUnreadLog() {
                axios.post(`${this.OPEN_HOST}/api/queryNotReadLog`,{M_NAME:this.user_name}).then((res) => {
                    this.updateLogList = res.data.data.list || [];
                    this.autoPlayTimer =  setInterval(()=>{
                        this.autoPlay();
                    },2000)
                    // console.log("详情数据", res);
                })
            },
            autoPlay(){
                this.topAnimate = true;
                // console.log("当前值", this.topAnimate);

                setTimeout(()=>{
                    this.updateLogList.push(this.updateLogList[0])
                    this.updateLogList.shift(); //删除第一个元素
                    this.topAnimate = false;
                },1000)

            },
            onView(){
                let href = "/index.php?m=update_log&a=updateLogList";
                let a = document.createElement('a');
                a.setAttribute("style", "display: none");
                a.setAttribute("onclick", "opennewtab(this,'" + this.$lang('更新日志') + "')");
                a.setAttribute("_href", href);
                a.onclick();
            }
        }
    });
</script>
<script>
    const vueMenuAside = new Vue({
        el: '#menuAside',
        data() {
            return {
                OPEN_HOST: '<{$OPEN_HOST}>',
                user_name: '<{$user_name}>',
                unReadCount:0
            }
        },
        computed: {

        },
        created() {
            this.getUnreadLog();
        },
        mounted() {
            // let rootElement = document.getElementById("#mean-box");
            // console.log("唯一元素",rootElement);
            // let currentElement =    rootElement.querySelector('.nav-box .nav-text a[title="更新日志"]');
            // console.log("当前元素",currentElement);
        },
        methods: {
            getUnreadLog() {
                axios.post(`${this.OPEN_HOST}/api/updateLogMsgCount`,{M_NAME:this.user_name}).then((res) => {
                    this.unReadCount = res.data.data.unread_count;
                    unReadCount = this.unReadCount;
                })
            }
        }
    });
</script>
<script>
    jQuery(document).ready(function($) {
    <?php if ($tab_data): ?>
        newTab("<?php echo $tab_data['url'] ?>", "<?php echo (L($tab_data['name'])); ?>");
        window.history.pushState(null, null, '/index.php?m=index&a=index');
    <?php endif ?>
    });
</script>

</body>
</html>