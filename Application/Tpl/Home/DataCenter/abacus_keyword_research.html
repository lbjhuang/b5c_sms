<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Keyword Research</title>
    <link rel="stylesheet" href="./Application/Tpl/Home/Public/css/element-ui-2.13.0.css?v=<{$Think.config.VER_NUM}>">
    <link rel="stylesheet" href="./Application/Tpl/Home/Public/css/normailize.css?v=<{$Think.config.VER_NUM}>">
    <link rel="stylesheet" href="./Application/Tpl/Home/Public/css/default.css?v=<{$Think.config.VER_NUM}>">
    <link rel="stylesheet" href="./Application/Tpl/Home/DataCenter/css/element-ui-custom.css?v=<{$Think.config.VER_NUM}>">
    <style>
        [v-cloak] {
            display: none;
        }
        div{
            box-sizing: border-box;
        }
        .keyword-research{
            font-size: 14px;
            color: rgba(0, 0, 0, 0.85);
            background: rgba(244,244,244,1);;
        }
        .search-box{
            padding: 20px 20px;
            background: #fff;
        }
        .search-box .search-box-row{
            margin-bottom: 10px;
        }
        .search-box .search-label{
            text-align: right;
            line-height: 38px;
            width: 120PX;
        }
        .search-box .search-option .el-date-editor.el-input{
            width: 235px;
            margin-top: 3px;
        }
        .search-box .search-option  .el-input--small{
            width: 485px;
        }
        .search-box .search-option .search-option-box{
            font-weight: bold;
            background: #f4f4f4;
            border-radius: 14px;
            width: 150px;
            height: 28px;
            line-height: 28px;
            text-align: center;
            margin-right: 15px;
            float: left;
            cursor: pointer;
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
            /* padding: 0 5px; */
            font-size: 14px;
            color: rgba(0, 0, 0, 0.65);
            margin-top: 5px;
            margin-bottom: 5px;
            padding: 0 6px;
        }
        .search-box .search-option .search-option-box.active{
            background: rgba(3, 117, 222, 1);
            color: #fff;
        }
        .search-box .search-box-row .btn-box{
            padding-left: 45px;
        }
        .el-button--primary {
            background: #0375DE;
            border-color: #0375DE;
        }
        .el-button--primary:focus{
            background: #0375DE;
            border-color: #0375DE;
        }
        .el-button--primary:hover{
            background: #0375DE;
            border-color: #0375DE;
        }
        .table-box{
            margin-top: 20px;
            background: #fff;
            padding: 20px;
        }
        .table-box .tbale-box-top{
            margin-bottom: 15px;
            overflow: hidden;
            padding-right: 40px;
        }
        .table-box .tbale-box-top .tbale-box-top-left{
            float: left;
        }
        .table-box .tbale-box-top .tbale-box-top-right{
            float: right;
        }
        .el-table th.is-leaf {
            background: #f4f4f4;
            color: rgba(0, 0, 0, 0.65);
        }
        .table-box .table-box-main .custom-header-item-wrap{
            padding-right: 0;
            position: absolute;
            top: 0;
            right: 30px;
        }
        .table-box .table-box-main .custom-header-item{
            line-height: 16px;
            display: block;
            padding-right: 0;
        }
        .table-box .table-box-main .custom-header-icon{
            position: absolute;
            top: 0px;
            right: 15px;
        }
        .table-box .table-box-main .custom-header-icon .el-icon-caret-top{
            position: absolute;
            top: 6px;
            cursor: pointer;
            color: #c0c4cc;
            font-size: 16px;
        }
        .table-box .table-box-main .custom-header-icon .el-icon-caret-bottom{
            position: absolute;
            top: 16px;
            cursor: pointer;
            color: #c0c4cc;
            font-size: 16px;
        }
        .table-box .table-box-main .custom-header-icon .active{
            color: #409eff;
        }
        .table-box .data-none {
            margin: 100px auto 0;
            width: 850px;
        }
        .table-box .data-none .text-box{
            display: inline-block;
            margin-left: 60px;
        }
        .table-box .data-none .text-box .text-box-title{
            font-size: 24px;
            font-weight: 600;
            line-height: 28px;
            color: rgba(0, 0, 0, 0.65);
            padding-bottom: 15px;
        }
        .table-box .data-none .text-box .text-box-subtitle{
            font-size: 14px;
            line-height: 18px;
            color: rgba(0, 0, 0, 0.65);
            padding-top: 10px;
        }
        .table-box .el-table__body-wrapper{
            overflow: visible;
        }
        .table-box .el-table .cell{
            overflow: visible;
            line-height: 14px;
        }
        .table-box .el-table .cell .cell-content{
            margin-bottom: 8px;
        }
        .trend-dialog__info .erp-el-radio .el-radio__label {
            width: 160px;
        }
        .popo-box .popo-box-title {
            font-weight: 600;
            margin-bottom: 15px;
        }
        .popo-box .popo-box-item{
            text-indent: 2em;
        }
    </style>
</head>
<body>
    <div class="keyword-research" id="keyword-research-box" v-cloak>
        <div class="search-box">
            <el-row  :gutter="30" class="search-box-row">
                <el-col :span="2" class="search-label">Month</el-col>
                <el-col :span="21" class="search-option">
                    <el-date-picker
                            v-model="searchFrom.month"
                            type="month"
                            value-format="yyyy-MM"
                            placeholder="Please select a month"
                            :picker-options="pickerOptions"
                            size="small">
                    </el-date-picker>
                </el-col>
            </el-row>
            <el-row  :gutter="30" class="search-box-row">
                <el-col :span="2" class="search-label">Marketplace</el-col>
                <el-col :span="21" class="search-option">
                    <el-tooltip :value="true" :disabled="item.disabled" :content="item.marketplace" placement="top" effect="dark" v-for="(item,index) in marketplaceArray" :key="index">
                        
                        <div class="search-option-box" :class="item.id == searchFrom.marketplace ? 'active' : ''" @click="marketplaceClick(item)">
                            <span :ref="item.ref" @mouseenter.stop="mouseenter(item.ref,item)" style="padding: 0 5px;">{{item.marketplace}}</span>
                        </div>
                    </el-tooltip>
                </el-col>
            </el-row>
            <el-row  :gutter="30" class="search-box-row">
                <el-col :span="2" class="search-label">Categories</el-col>
                <el-col :span="21" class="search-option">
                    <div class="search-option-box" :class="searchFrom.category.length == 0 ? 'active' : ''" @click="categoryAll">All</div>
                    <el-tooltip :value="true" :disabled="item.disabled" :content="item.category" placement="top" effect="dark" v-for="(item,index) in categoryArray" :key="index">
                        
                        <div class="search-option-box" :class="categoryFlg(item.id)  ? 'active' : ''" @click="categoryClick(item)">
                            <span :ref="item.ref" @mouseenter.stop="mouseenter(item.ref,item)" style="padding: 0 5px;">{{item.category}}</span>
                        </div>
                    </el-tooltip>
                </el-col>
            </el-row>
            <el-row  :gutter="30" class="search-box-row">
                <el-col :span="2" class="search-label">Keyword</el-col>
                <el-col :span="21" class="search-option">
                    <el-input v-model="searchFrom.keyword" size="small"></el-input>
                </el-col>
            </el-row>
            <el-row  :gutter="30" class="search-box-row">
                <div class="btn-box">
                    <el-button type="primary" @click="doSearch" size="small">Search</el-button>
                </div>
            </el-row>
        </div>
        <div class="table-box" v-loading="tableLoading">
            <div class="data-none" v-show="total == 0">
                <img src="./Application/Tpl/Home/DataCenter/img/search.png" alt="">
                <div class="text-box">
                    <div class="text-box-title">Sorry! It Seems that search results are empty.</div>
                    <div class="text-box-title">There are some tips might help.</div>
                    <div class="text-box-subtitle">1. Reduce screening criteria.</div>
                    <div class="text-box-subtitle"> 2. Use fuzzy keywords instead of precise keywords Let us know when you need support.</div>
                </div>
            </div>
            <div v-show="total > 0">
                <div class="tbale-box-top">
                    <span class="tbale-box-top-left">Search results: {{total}}</span>
                    <el-button class="tbale-box-top-right" type="primary" @click="doExport" size="small">Export</el-button>
                </div>
                <div class="table-box-main">
                    <el-table :data="tableData" stripe @sort-change="tableSortChange">
                        <el-table-column align="right" width="15"></el-table-column>       
                        <el-table-column label="Keyword" align="left" width="180px">
                            <template slot-scope="scope">
                                    <div style="cursor: pointer;" @click="opItemsDialogVisible = false" class="goods-name">{{scope.row.keyword}}</div>

                            </template>
                        </el-table-column>
                        <el-table-column label="Searches Trend" align="left" width="160">
                            <template slot="header" slot-scope="scope">
                                Searches Trend<el-tooltip class="item" effect="dark" :content="$lang('The monthly searches trend for this keyword over the last 2-3 years')" placement="right"><i class="el-icon-question"></i></el-tooltip>
                            </template>
                            <template slot-scope="scope">
                                <div style="cursor: pointer;" @click="itemChartsChange(scope.row)">
                                    <searches-charts v-if="scope.row.searchesTrend.length>0" :data="scope.row.searchesTrend"></searches-charts>
                                    <span v-else>-</span>
                                </div>
                                
                            </template>
                        </el-table-column>
                        <el-table-column align="right" sortable="custom" width="185" label="Searches">
                            <template slot="header" slot-scope="scope">
                                <div class="custom-header-item-wrap">
                                    <span class="custom-header-item">Searches/M</span>
                                    <span class="custom-header-item">Daily Searches</span>
                                </div>
                                    <el-tooltip style="margin-right: -34px;" class="item" effect="dark"  placement="right">
                                        <span v-html="'Upside:The number of searches for this keyword on Amazon in a natural month <br>Down: The number of daily searches for this keyword on Amazon in a natural month'" slot="content"></span>
                                        <i class="el-icon-question"></i></el-tooltip>
                            </template>
                            <template slot-scope="scope">
                                <div class="cell-content">{{scope.row.searchesMonth | format}}</div>
                                <div>{{scope.row.searchesDaily | format}}</div>
                            </template>
                        </el-table-column>
                        <el-table-column align="right" sortable="custom" width="170" label="Purchase">
                            <template slot="header" slot-scope="scope">
                                <div class="custom-header-item-wrap">
                                    <div class="custom-header-item">Purchase/M</div>
                                    <div class="custom-header-item">Purchase/R</div>
                                </div>
                                <el-tooltip style="margin-right: -34px;" class="item" effect="dark" placement="right">
                                    <span v-html="'Upside:The number of units sold in a natural month, such as July 2019, after searching for this keyword on Amazon <br>Down: Percentage of monthly purchases and monthly searches'" slot="content"></span>
                                    <i class="el-icon-question"></i></el-tooltip>
                            </template>
                            <template slot-scope="scope">
                                <div class="cell-content">{{scope.row.purchaseValue | format}}</div>
                                <div>{{scope.row.purchasePercent | format(true)}}</div>
                            </template>
                        </el-table-column>
                        <el-table-column align="right" sortable="custom" width="170" label="Growth">
                            <template slot="header" slot-scope="scope">
                                <div class="custom-header-item-wrap">
                                    <div class="custom-header-item">Growth/M</div>
                                    <div class="custom-header-item">Growth Rate</div>
                                </div>
                                <el-tooltip style="margin-right: -34px;" class="item" effect="dark"  placement="right">
                                    <span v-html="'Upside：Growth is the search volume increase from the previous month <br>Down：Growth Rate is the percentage of search volume increase from the previous month'" slot="content"></span>
                                    <i class="el-icon-question"></i>
                                </el-tooltip>
                            </template>
                            <template slot-scope="scope">
                                <div class="cell-content">{{scope.row.position | format}}</div>
                                <div>{{scope.row.rate | format(true)}}</div>
                            </template>
                        </el-table-column>
                        <el-table-column align="right" label="YoY" sortable="custom">
                            <template slot="header" slot-scope="scope">
                                <span style="margin-right: 20px;">YoY</span> <el-tooltip style="margin-right: -34px;" class="item" effect="dark"  placement="right"><span v-html="'Upside:Year-on-year searches growth <br>Down: Year-on-year searches growth rat'" slot="content"></span><i class="el-icon-question"></i></el-tooltip>
                            </template>
                            <template slot-scope="scope">
                                <div class="cell-content">{{scope.row.searchesMonthLastYear | format}}</div>
                                <div>{{scope.row.searchesMonthLastYearPercent | format(true)}}</div>
                            </template>
                        </el-table-column>
                        <el-table-column align="right" label="Near" sortable="custom">
                            <template slot="header" slot-scope="scope">
                                <span style="margin-right: 20px;"> Near </span><el-tooltip style="margin-right: -34px;" class="item" effect="dark" placement="right"><span v-html="'Upside: minimum Monthly searches growth in the last 3 months <br> Down: minimum Monthly searches growth rate in the last 3 months'" slot="content"></span><i class="el-icon-question"></i></el-tooltip>
                            </template>
                            <template slot-scope="scope" sortable="custom">
                                <div class="cell-content">{{scope.row.searchesLastThreeMonths | format}}</div>
                                <div>{{scope.row.searchesLastThreeMonthsPercent | format(true)}}</div>
                            </template>
                        </el-table-column>
                        <el-table-column align="right" width="190" label="Click Concentration" sortable="custom">
                            <template slot="header" slot-scope="scope">
                                <span style="margin-right: 20px;">Click Concentration</span> <el-tooltip style="margin-right: -34px;" class="item" effect="dark" :content="$lang('Click Concentration = the top three ASINs clicks / total clicks * 100%')" placement="right"><i class="el-icon-question"></i></el-tooltip>
                            </template>
                            <template slot-scope="scope">
                                <div>{{scope.row.clicks | format(true)}}</div>
                            </template>
                        </el-table-column>
                        <el-table-column align="right" label="PPC Bid" sortable="custom" width="110">
                            <template slot="header" slot-scope="scope">
                                <span style="margin-right: 20px;">PPC Bid</span>
                                <el-tooltip style="margin-right: -34px;" class="item" effect="dark" placement="right">
                                    <span v-html="'The bid price of advertisements on Amazon. <br>Our system provides the suggested bid price and range of [Phrase Match].'" slot="content"></span>
                                    <i class="el-icon-question"></i></el-tooltip>
                            </template>
                            <template slot-scope="scope">
                                <div v-if="scope.row.bidCurrency === 'N/A'">{{scope.row.bidCurrency}}</div>
                                <div v-else>
                                    <div class="cell-content">{{scope.row.bidCurrency}} {{scope.row.bidAvgPrice | format}}</div>
                                    <div>{{scope.row.bidPriceMin | format}} - {{scope.row.bidPriceMax | format}}</div>
                                </div>
                            </template>
                        </el-table-column>
                        <el-table-column align="right" label="Market Analysis" width="170">
                            <template slot="header" slot-scope="scope">
                                <span >Market Analysis</span>
                                <el-tooltip  class="item" effect="dark"  placement="right">
                                    <span v-html="'The average price/review/rating of products after searching this keyword <br> on the first 3 pages of Amazon search results(natural search results).'" slot="content"></span>
                                    <i class="el-icon-question"></i></el-tooltip>
                            </template>
                            <template slot-scope="scope">
                                <div class="cell-content">{{scope.row.marketCurrency}} {{scope.row.marketPrice | format}}</div>
                                <div>{{scope.row.marketReviews | format}} ({{scope.row.marketRating | format}})</div>
                            </template>
                        </el-table-column>
                        <el-table-column align="right" label="Hotness" width="100">
                            <template slot="header" slot-scope="scope">
                                <span >Hotness</span>
                                <el-tooltip  class="item" effect="dark"  placement="right">
                                    <span v-html="'Hotness represents an indicator of keyword popularity.<br> Calculated from multiple related basic indicators in the table'" slot="content"></span>
                                    <i class="el-icon-question"></i></el-tooltip>
                            </template>
                            <template slot-scope="scope">
                                <el-popover placement="right" width="350" trigger="hover">
                                    <div class="popo-box">
                                        <div class="popo-box-title">Data source weight and score:</div>
                                        <div class="popo-box-item">* {{commentsMap.searches_daily}} ({{weightsMap.searches_daily}}): {{scope.row.hotnessMap.searches_daily | format}}</div>
                                        <div class="popo-box-item">* {{commentsMap.purchase_value}} ({{weightsMap.purchase_value}})：{{scope.row.hotnessMap.purchase_value | format}}</div>
                                        <div class="popo-box-item">* {{commentsMap.purchase_percent}} ({{weightsMap.purchase_percent}})：{{scope.row.hotnessMap.purchase_percent | format}}</div>
                                        <div class="popo-box-item">* {{commentsMap.rate}} ({{weightsMap.rate}})：{{scope.row.hotnessMap.rate | format}}</div>
                                        <div class="popo-box-item">* {{commentsMap.searches_last_three_month}} ({{weightsMap.searches_last_three_month}})：{{scope.row.hotnessMap.searches_last_three_month | format}}</div>
                                        <div class="popo-box-item">* {{commentsMap.searches_last_three_month_percent}} ({{weightsMap.searches_last_three_month_percent}})：{{scope.row.hotnessMap.searches_last_three_month_percent | format}}</div>
                                        <div class="popo-box-item">* {{commentsMap.clicks}} ({{weightsMap.clicks}})：{{scope.row.hotnessMap.clicks | format}}</div>
                                        <div class="popo-box-item">* {{commentsMap.market_price}} ({{weightsMap.market_price}})：{{scope.row.hotnessMap.market_price | format}}</div>
                                        <div class="popo-box-item">* {{commentsMap.market_reviews}} ({{weightsMap.market_reviews}})：{{scope.row.hotnessMap.market_reviews | format}}</div>
                                        <div class="popo-box-item">* {{commentsMap.market_rating}} ({{weightsMap.market_rating}})：{{scope.row.hotnessMap.market_rating | format}}</div>
                                        
                                    </div>
                                    <div slot="reference">{{scope.row.hotnessMap.hotness | format}}</div>
                                </el-popover>
                            </template>
                        </el-table-column>
                        <el-table-column align="right" label="Opertaion">
                            <template slot-scope="scope">
                                <div style="color: #0375DE;cursor: pointer;" @click="itemChartsChange(scope.row)">trend</div>
                            </template>
                        </el-table-column>
                        <el-table-column align="right" width="15px"></el-table-column>
                    </el-table>
                    <div class="page" style="width: 700px;margin: 20px auto;" v-if="total>10">
                        <el-pagination
                        background
                        @size-change="handleSizeChange"
                        @current-change="handleCurrentChange"
                        :current-page="pageNo"
                        :page-sizes="[10, 30, 50, 100]"
                        :page-size="pageSize"
                        layout="sizes, prev, pager, next, jumper"
                        :total="total">
                        </el-pagination>
                    </div>
                </div>
            </div>
        </div>
        <el-dialog
            title="Trend"
            :visible.sync="chartsDialogVisible"
            width="1280px"
            center
            @close="chartClose"
            @opened="trendDialogOpened">
            <section class="trend-dialog__info">
                <el-radio-group v-model="trendChartType" @change="getTrendChartData">
                    <el-radio label="svt" class="erp-el-radio">Search Volume Trend</el-radio>
                    <el-radio label="gt" class="erp-el-radio">Google Trend</el-radio>
                    <el-radio label="cc" class="erp-el-radio">Click Concentration</el-radio>
                </el-radio-group>
            </section>
            <div class="charts-box">
                <div id="charts-center" ref="refcharts" style="width: 100%;height:420px;">

                </div>
            </div>
        </el-dialog>
        <el-dialog title="The top 10 items on the search results page" :visible.sync="topItemsDialogVisible" center >
            <div>
                展示该关键词下搜索结果页的前10商品，<span style="color: red;">点击商品图片跳转到商品详情页</span>
            </div>
            <section style="display: grid;grid-template-columns: repeat(5, 100px); gap: 10px 10px;">
                <el-image style="width: 100px; height: 100px" src="" v-for="n in 10"></el-image>
            </section>
            
        </el-dialog>
    </div>
</body>
</html>
<script type="text/javascript" src="/Application/Tpl/Home/Public/lib/jquery/1.9.1/jquery.min.js?v=<{$Think.const.V}>"></script>
<script type="text/javascript" src="./Application/Tpl/Home/Public/js/vue.2.5.13.js?v=<{$Think.const.V}>"></script>
<script type="text/javascript" src="/Application/Tpl/Home/Public/js/axios.min.js?v=<{$Think.const.V}>"></script>
<script type="text/javascript" src="./Application/Tpl/Home/Public/js/element-ui-2.13.0.js?v=<{$Think.const.V}>"></script>
<script type="text/javascript" src="\Application\Tpl\Home\Public\js\H-ui.admin.js?v=<{$Think.const.V}>"></script>
<script type="text/javascript" src="./Application/Tpl/Home/Public/js/echarts-4.7.0.js?v=<{$Think.config.VER_NUM}>"></script>
<script type="text/javascript" src="./Application/Tpl/Home/Public/js/element-en.js"></script>
<script>
    ELEMENT.locale(ELEMENT.lang.en)
    var VM = new Vue({
        el: '#keyword-research-box',
        data() {
            return {
                pickerOptions:{
                    disabledDate:(time)=> {
                        return time.getTime() > new Date(this.doHandleDate()).getTime()
                    },
                },
                searchFrom: {
                    month: this.doHandleDate(),
                    marketplace: 'us',
                    category: [],
                    keyword: '',
                    sortCondition: '',
                    upOrDown: '',
                },
                pageNo: 1,
                pageSize: 10,
                access_token: 'Y2xpZW50OnBAc3N3b3Jk',
                marketplaceArray: [
                    {id: 'us',marketplace: 'United State',disabled: true,ref: 'refMarket1'},
                ],
                categoryArray: [],
                tableLoading: false,
                tableData: [],
                total: 0,
                chartsDialogVisible: false,
                myChart: null,
                tableSelectedRowData: {},
                trendChartType: 'svt',
                trendChartData: {},
                topItemsDialogVisible: false,
                commentsMap: {},
                weightsMap: {}
            }
        },
        filters: {
            // 数字加上千分位
            format :function format(num,addrate) {
                if(num === undefined || num === null || num == '-') {
                    return '-';
                }
                num = Number(num).toFixed(2)
                var num1=num.split('.')[0]+''; 
                var str="";
                for(var i=num1.length- 1,j=1;i>=0;i--,j++){  
                    if(j%3==0 && i!=0 && num1[i-1] != '-'){
                        str+=num1[i]+",";
                        continue;
                    }
                    str+=num1[i];
                }
                if(addrate) {
                    return `${str.split('').reverse().join("")}${num.split('.')[1] == '00' ? '' : '.' + num.split('.')[1]}%`;
                }
                return `${str.split('').reverse().join("")}${num.split('.')[1] == '00' ? '' : '.' + num.split('.')[1]}`;
            },
        },
        created() {
            this.login();
        },
        mounted() {
        },
        methods: {
            requestGet(url,param) {
                var host = '//mtapi.gshopper.com';
                return axios.get(host + url, {params: param,headers: { "Authorization": `Bearer ${this.access_token}`}});
            },
            requestPost(url,param) {
                var headers = {
                    headers: {
                        "Authorization": `Basic ${this.access_token}`
                    }
                };
                var host = '//mtapi.gshopper.com';
                return axios.post(host + url, param, headers);
            },
            search() {
                this.tableLoading = true;
                this.tableData = [];
                var param = {
                    Keyword: this.searchFrom.keyword,
                    categoryList: this.searchFrom.category.length == 0 ? 'ALL' : this.searchFrom.category.join(','),
                    countryCode: this.searchFrom.marketplace,
                    month: this.searchFrom.month,
                    page: this.pageNo,
                    pageSize: this.pageSize,
                    sortCondition: this.searchFrom.sortCondition,
                    upOrDown: this.searchFrom.upOrDown,
                }
                console.log(param);
                this.requestGet("/api/erp/keywordOfSeller",param).then((res) => {
                    console.log(res);
                    this.tableLoading = false;
                    if(res.status === 200) {
                        this.tableData = res.data.pageList.content;
                        this.total = res.data.pageList.totalElements;
                        this.commentsMap = res.data.commentsMap;
                        this.weightsMap = res.data.weightsMap;
                    } else {
                        this.$message.error('系统错误');
                    }
                }).catch((error) =>{
                    this.$message.error(error);
                })
            },
            getCategoryArray() {
                var param = {
                    countryCode: this.searchFrom.marketplace
                }
                this.requestGet("/api/erp/categoryOfSellerSprite", param).then((res) => {
                    console.log(res);
                    if(res.status === 200) {
                        this.categoryArray = res.data.map((item,index)=> {
                            return{
                                id:item,
                                category: item,
                                disabled: true,
                                ref: 'refCate' + index
                            }
                        })
                    } else {
                        this.$message.error('系统错误');
                    }
                }).catch((error) =>{
                    this.$message.error(error);
                })
            },
            login() {
                var param = {}
                this.requestPost("/login?username=test@gshopper.com&password=izene123&grant_type=password", param).then((res) => {
                    console.log(res);
                    if(res.status === 200) {
                        
                        this.access_token = res.data.access_token;
                        this.getCategoryArray();
                        this.search();
                    } else {
                        this.$message.error('鉴权失败');
                    }
                }).catch((error) =>{
                    this.$message.error(error);
                })
                
            },
            // 超出长度则显示tooltip,不超出不显示
            mouseenter(refStr,item){
                if(this.$refs[refStr][0].offsetWidth >= this.$refs[refStr][0].parentNode.offsetWidth){
                    item.disabled = false;
                } else {
                    item.disabled = true;
                }
            },
            // marketplace  选择
            marketplaceClick(item) {
                this.searchFrom.marketplace = item.id;
            },
            // category选择
            categoryClick(item) {
                let flg = this.searchFrom.category.find(categ => {
                    return categ == item.id;
                });
                if(!flg) {
                    this.searchFrom.category.push(item.id);
                } else {
                    var index = this.searchFrom.category.indexOf(flg);
                    this.searchFrom.category.splice(index,1);
                }
            },
            categoryAll() {
                this.searchFrom.category = [];
            },
            categoryFlg(id) {
                let flg = this.searchFrom.category.find(categoryId => {
                    return categoryId == id;
                })
                return flg;
            },
            // 搜索
            doSearch() {
                this.pageNo = 1;
                this.pageSize = 10;
                this.search();
            },
            // 导出
            doExport() {

            },
            // 排序
            tableSortChange(column, prop, order) {
                console.log(column, prop, order);
                if(column.column){
                    switch (column.column.label){
                        case 'Searches':
                        this.searchFrom.sortCondition = 'searches_month';
                        this.searchFrom.upOrDown = column.order == 'ascending' ? 'ASC' : 'DESC';
                        break;
                        case 'Purchase':
                        this.searchFrom.sortCondition = 'purchase_value';
                        this.searchFrom.upOrDown = column.order == 'ascending' ? 'ASC' : 'DESC';
                        break;
                        case 'Growth':
                        this.searchFrom.sortCondition = 'rate';
                        this.searchFrom.upOrDown = column.order == 'ascending' ? 'ASC' : 'DESC';
                        break;
                        case 'YoY':
                        this.searchFrom.sortCondition = 'searches_month_last_year';
                        this.searchFrom.upOrDown = column.order == 'ascending' ? 'ASC' : 'DESC';
                        break;
                        case 'Near':
                        this.searchFrom.sortCondition = 'searches_last_three_months';
                        this.searchFrom.upOrDown = column.order == 'ascending' ? 'ASC' : 'DESC';
                        break;
                        case 'Click Concentration':
                        this.searchFrom.sortCondition = 'clicks';
                        this.searchFrom.upOrDown = column.order == 'ascending' ? 'ASC' : 'DESC';
                        break;
                        case 'PPC Bid':
                        this.searchFrom.sortCondition = 'bid_avg_price';
                        this.searchFrom.upOrDown = column.order == 'ascending' ? 'ASC' : 'DESC';
                        break;
                        default:
                        this.searchFrom.sortCondition = '';
                        this.searchFrom.upOrDown = '';
                    }
                } else {
                    
                    this.searchFrom.sortCondition = '';
                    this.searchFrom.upOrDown = '';
                }
                this.doSearch();
            },
            // 分页
            handleSizeChange(size) {
                this.pageNo = 1;
                this.pageSize = size;
                this.search();
            },
            handleCurrentChange(page) {
                this.pageNo = page;
                this.search();
            },
            // 图表弹窗关闭
            chartClose() {
                this.myChart.clear();
            },
            // 打开图表弹窗
            itemChartsChange(rowData) {
                this.tableSelectedRowData = rowData
                this.chartsDialogVisible = true;
            },

            // 创建图表
            initCharts(data) {
                var searchVolumeOption = {
                    tooltip: {
                        trigger: 'axis',
                    },
                    legend: {
                        icon: 'rect',
                        bottom: 20,
                        itemWidth: 10,
                        itemHeight: 10,
                    },
                    xAxis: {
                        type: 'category',
                        axisTick: {
                            show: false
                        },
                        axisLabel: {
                            interval: 0,
                            rotate:40,
                            showMaxLabel: true
                        },
                    },
                    yAxis: [
                        {
                            type: 'value',
                            splitLine: {
                                lineStyle: {
                                    type: 'dotted',
                                    color: '#F0F0F0'
                                }
                            },
                            axisLine: {
                                show: false
                            },
                            axisTick: {
                                show: false
                            },
                        },
                        {
                            type: 'value',
                            splitLine: {
                                lineStyle: {
                                    type: 'dotted',
                                    color: '#F0F0F0'
                                }
                            },
                            axisLine: {
                                show: false
                            },
                            axisTick: {
                                show: false
                            },
                            axisLabel: {
                                formatter: '{value}%'
                            }
                        }
                    ],
                    grid: {
                        right: 20,
                        left: 20,
                        containLabel: true
                    },
                    dataset: {
                        source: data,
                    },
                    series: [
                        {
                        type: 'line',
                        seriesLayoutBy: 'row',
                    },
                    {
                        type: 'line',
                        seriesLayoutBy: 'row',
                    },
                    {
                        type: 'line',
                        seriesLayoutBy: 'row',
                        yAxisIndex: 1,
                    }
                ]
                };
                var googleTrendOption = {
                    tooltip: {
                        trigger: 'axis',
                    },
                    legend: {
                        icon: 'rect',
                        bottom: 20,
                        itemWidth: 10,
                        itemHeight: 10,
                    },
                    xAxis: {
                        type: 'category',
                        axisTick: {
                            show: false
                        },
                        axisLabel: {
                            rotate: 40,
                            showMaxLabel: true
                        },
                    },
                    yAxis: {
                        type: 'value',
                        splitLine: {
                            lineStyle: {
                                type: 'dotted',
                                color: '#F0F0F0'
                            }
                        },
                        axisLine: {
                            show: false
                        },
                        axisTick: {
                            show: false
                        },
                    },
                    grid: {
                        right: 20,
                        left: 20,
                        containLabel: true
                    },
                    dataset: {
                        source: data,
                    },
                    series: [{
                        type: 'line',
                        seriesLayoutBy: 'row',
                    },
                    ]
                };
                var clickConcentrationOption = {
                    tooltip: {
                        trigger: 'axis',
                    },
                    legend: {
                        icon: 'rect',
                        bottom: 20,
                        itemWidth: 10,
                        itemHeight: 10,
                    },
                    xAxis: {
                        type: 'category',
                        axisTick: {
                            show: false
                        },
                        axisLabel: {
                            rotate: 40,
                            showMaxLabel: true
                        },
                    },
                    yAxis: {
                        type: 'value',
                        splitLine: {
                            lineStyle: {
                                type: 'dotted',
                                color: '#F0F0F0'
                            }
                        },
                        axisLine: {
                            show: false
                        },
                        axisTick: {
                            show: false
                        },
                        axisLabel: {
                            formatter: '{value}%'
                        }
                    },
                    grid: {
                        right: 20,
                        left: 20,
                        containLabel: true
                    },
                    dataset: {
                        source: data,
                    },
                    series: [{
                        type: 'line',
                        seriesLayoutBy: 'row',
                    },
                    ]
                };
                
                switch (this.trendChartType) {
                    case 'svt':
                        this.myChart.setOption(searchVolumeOption, true);
                        break;
                    case 'gt':
                        this.myChart.setOption(googleTrendOption, true);
                        break;
                    case 'cc':
                        this.myChart.setOption(clickConcentrationOption, true);
                        break;
                    default:
                        break;
                }
            },
            // 获取当前月份
            doHandleDate() {
                var myDate = new Date();
                var tYear = myDate.getFullYear();
                var tMonth = myDate.getMonth();
            
                var m = tMonth;
                if(m == 0) {
                    m = 12;
                    tYear = tYear - 1;
                }
                if (m.toString().length == 1) {
                    m = "0" + m;
                }
                return tYear +'-'+ m;
            },

            // Trend图表对话框打开动画结束时的回调
            trendDialogOpened() {
                this.myChart = echarts.init(this.$refs.refcharts);
                this.getTrendChartData()
            },
            // Trend图表数据获取
            getTrendChartData() {
                this.myChart.showLoading({
                    text: ''
                })
                var param = {
                    Keyword: this.tableSelectedRowData.keyword,
                    countryCode: this.tableSelectedRowData.countryCode,
                    graphName: this.trendChartType
                }
                this.requestGet("/api/erp/searchTrendGraphOfSellerSprite", param).then((res) => {
                    if (res.status === 200) {
                        this.trendChartData = res.data;
                        this.initCharts(res.data)
                    } else {
                        this.$message.error('系统错误');
                    }
                    this.myChart.hideLoading()
                }).catch((error) => {
                    this.$message.error(error);
                })
            }

        },

    })
    
    Vue.component('searches-charts', {
        props: ['data'],
        template: '<div ref="tableChart" style="width:140px;height:70px;z-index:99"></div>',
        mounted() {
            let data = this.data.map(item => {
                return {
                    date: item.date,
                    search: item.search,
                    rate: item.rate,
                    purchase: item.purchase,
                    keyword: item.keyword,
                    countryCode: item.countryCode,
                    createdAt: item.createdAt,
                    id: item.id
                }
            })
            let myChart = echarts.init(this.$refs.tableChart);
            let options = {
                    tooltip: {
                        trigger: 'axis',
                    },
                    xAxis: {
                        type: 'category',
                        show: false,
                        boundaryGap: false,
                    },
                    yAxis: {
                        type: 'value',
                        splitLine: {
                            lineStyle: {
                                type: 'dotted',
                                color: '#F0F0F0'
                            }
                        },
                        splitNumber:4,
                        axisLine: {
                            show: false
                        },
                        axisTick: {
                            show: false
                        },
                        show: false
                    },
                    grid: {
                        left: 0,
                        right: 0,
                    },
                    dataset: {
                        source: data,
                    },
                    series: [{
                        name:'Searches',
                        type: 'line',
                        symbol: 'none',
                        smooth: true,
                        color: '#0375DE',
                        areaStyle: {
                            color: "rgba(3,117,222,0.35)"
                        },
                    }]
                };
            myChart.setOption(options);
        },
    })
</script>