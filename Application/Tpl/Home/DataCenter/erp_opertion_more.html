<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>系统使用详情</title>
    <link rel="stylesheet" href="./Application/Tpl/Home/Public/css/normailize.css?v=<{$Think.config.VER_NUM}>">
    <link rel="stylesheet" href="./Application/Tpl/Home/Public/css/element-ui-2.13.0.css">
    <link rel="stylesheet" href="./Application/Tpl/Home/Public/css/default.css?v=<{$Think.config.VER_NUM}>">
    <link rel="stylesheet" href="./Application/Tpl/Home/DataCenter/css/element-ui-custom.css?v=<{$Think.config.VER_NUM}>">
    <link rel="stylesheet" href="./Application/Tpl/Home/DataCenter/css/erp_opertion_more.css?v=<{$Think.config.VER_NUM}>">
    <style>
        .more-box{
            background: #F4F4F4;
        }
        .more-box .search-box{
            padding: 18px 20px 0 20px;
            background: #fff;
            margin-bottom: 20px;
            border-radius:0px 0px 8px 8px;
        }
        .more-box .search-box .el-select{
            width: 265px;
        }
        .more-box .search-box  .el-date-editor{
            width: 265px !important;
        }
        .more-box .search-box .el-form-item__label{
            padding: 0;
            margin-right: 12px;
        }
        .more-box .box-main .box-top .box-top-left{
            box-sizing: border-box;
            border-radius: 8px;
            background: #fff;
            height: 353px;
            padding: 20px;
        }
        .more-box .box-main .title-txt{
            font-size: 16px;
            font-weight: 500;
            color: rgba(0, 0, 0, 0.85);
        }
        .more-box .box-main .title-txt .subTitle {
            font-size: 12px;
            color:rgba(0,0,0,0.65);
            margin-left: 20px;
            font-weight: normal;
        }
        .more-box .box-main .box-top .box-top-left .title-txt .tip__img{
            width: 16px;
            height: 16px;
            cursor: pointer;
        }
        .more-box .box-main .box-top .box-top-left .detail-box{
            margin-top: 10px;
        }
        .more-box .box-main .box-top .box-top-left .detail-box .box-item{
            box-sizing: border-box;
            border-bottom: 1px solid rgba(0,0,0,0.1);
            height: 95px;
            padding-top: 20px;
            padding-left: 40px;
        }
        .more-box .box-main .box-top .box-top-left .detail-box .box-item:last-child{
            border-bottom: none;
        }
        .more-box .box-main .box-top .box-top-left .detail-box .box-item .label{
            font-size: 12px;
            color: rgba(0,0,0,0.65);
            margin-bottom: 8px;
        }
        .more-box .box-main .box-top .box-top-left .detail-box .box-item .num-txt{
            font-size: 32px;
            font-weight: 500;
            color: rgba(0, 0, 0, 0.85);
        }
        .more-box .box-main .box-top .box-top-left .detail-box .box-item .see-txt{
            float: right;
            font-size: 12px;
            color: #0375DE;
            text-decoration: underline;
            cursor: pointer;
            margin-top: 20px;
        }
        .more-box .box-main .charts-boxs{
            box-sizing: border-box;
            width: 100%;
            height: 320px;
            border-radius: 8px;
            background: #fff;
            margin-top: 20px;
            position: relative;
            padding: 20px 20px 0 20px;
        }
        .more-box .box-main .charts-boxs .button-box{
            position: absolute;
            top: 15px;
            right: 25px;
            z-index: 10;
        }
        .more-box .box-main .charts-boxs .title-box{
            
            margin-top: 25px;
            margin-left: 25px;
            font-size: 18px;
            font-weight: 900;
        }
        .more-box .box-main .charts-boxs .table-box{
            width: 100%;
            height: 100%;
            margin-top: 20px;
            padding-bottom: 10px;
        }
        .more-box .box-main .charts-boxs .subtitle-box{
            margin-top: 10px;
            margin-left: 25px;
            margin-bottom: 10px;
            font-size: 12px;
        }
        .more-box .box-main .totalTable-boxs{
            width: 100%;
            padding: 20px;
            border-radius: 8px;
            background: #fff;
            margin-top: 20px;
        }
        .totalTable-boxs .el-table__body tr:hover>td{
            cursor: default;
        }
        .more-box .page-box{
            margin-top: 32px;
        }
        .more-box .category{
            margin-bottom: 20px;
        }
        .more-box .category .category-item{
            margin-right: 45px;
        }
        .more-box .category .category-item .item-label{
            color:rgba(0,0,0,0.45);
        }
        .more-box .category .category-item .item-txt{
            color:rgba(0,0,0,0.65);
            font-weight: 500;
        }
        .el-table__body tr:hover>td{
            background-color: #ecf5ff !important;
            cursor: pointer;
        }
        .el-table .el-table__header-wrapper thead tr th{
            background: #F4F4F4;
            color: rgba(0,0,0,0.65);
        }
        .el-table{
            color: rgba(0,0,0,0.65);
        }
        .el-dialog__header .el-dialog__title{
            font-weight:600;
            color:rgba(0,0,0,0.85);
            font-size: 16px;
        }
        .el-dialog__body{
            padding-top: 20px;
        }
    </style>
</head>
<body>
    <div class="more-box" id="more" v-cloak>
        <div class="search-box">
            <el-form ref="form" inline :model="form" label-width="80px" size="mini">
                <el-row>
                    <el-col :span="6">
                        <el-form-item :label="$lang('时间')">
                            <el-date-picker
                                v-model="form.dateRange"
                                type="daterange"
                                :range-separator="$lang('至')"
                                :start-placeholder="$lang('选择日期')"
                                :end-placeholder="$lang('选择日期')"
                                value-format="yyyy-MM-dd"
                                @change="searchChange"
                                :clearable="false"
                                :picker-options="pickerOptions">
                            </el-date-picker>
                        </el-form-item>
                    </el-col>
                    <el-col :span="6">

                        <el-form-item :label="$lang('模块')">
                            <el-select filterable v-model="form.modular" :placeholder="$lang('请选择模块')" clearable @change="searchChange">
                              <el-option :label="$lang(item.module_name)" :value="item.module_id" :key="index" v-for="(item,index) in searchParam.module"></el-option>
                            </el-select>
                        </el-form-item>
                    </el-col>
                    <el-col :span="6">
                        <el-form-item :label="$lang('页面')">
                            <el-select filterable v-model="form.page" :placeholder="$lang('请选择页面')" clearable @change="searchChange">
                              <el-option :label="$lang(item.page_name)" :value="item.page_id" :key="index" v-for="(item,index) in searchParam.page"></el-option>
                            </el-select>
                        </el-form-item>
                    </el-col>
                    <!-- <el-col :span="6">
                        <el-form-item :label="$lang('按钮')">
                            <el-select v-model="form.btn" :placeholder="$lang('请选择按钮')" clearable @change="searchChange">
                              <el-option label="按钮一" value="shanghai"></el-option>
                              <el-option label="按钮二" value="beijing"></el-option>
                            </el-select>
                        </el-form-item>
                    </el-col> -->
                    <el-col :span="6">
                        <el-form-item :label="$lang('部门')">
                            <el-select filterable v-model="form.department" :placeholder="$lang('请选择部门')" clearable @change="searchChange">
                              <el-option :label="item.department_name" :value="item.department_id" :key="index" v-for="(item,index) in searchParam.department"></el-option>
                            </el-select>
                        </el-form-item>
                    </el-col>
                </el-row>
                <el-row>
                    <el-col :span="6">
                        <el-form-item :label="$lang('操作人')">
                            <el-select filterable v-model="form.operator" :placeholder="$lang('请选择操作人')" clearable @change="searchChange">
                              <el-option :label="item.user_name" :value="item.user_id" :key="index" v-for="(item,index) in searchParam.operation"></el-option>
                            </el-select>
                        </el-form-item>
                    </el-col>
                </el-row>
            </el-form>
        </div>
        <div class="box-main">
            <div class="box-top">
                <el-row :gutter="20">
                    <el-col :span="8">
                        <div class="box-top-left" v-loading="totalDataLoading">
                            <div class="title-txt">
                                <span>{{$lang('使用情况')}}</span>
                                <el-popover popper-class="erp-el-popover" :visible-arrow="false" placement="right-end" trigger="hover">
                                    <div>
                                        <p>{{$lang('在职员工的系统使用情况')}}</p>
                                    </div>
                                    <el-image class="tip__img" slot="reference" src="./Application/Tpl/Home/DataCenter/img/tip.png"></el-image>
                                </el-popover>
                            </div>
                            <div class="detail-box">
                                <div class="box-item">
                                    <div class="label">{{$lang('账号数量')}}</div>
                                    <div class="num-txt">{{totalData.account_num}}</div>
                                </div>
                                <div class="box-item">
                                    <div class="label">{{$lang('有操作记录')}}</div>
                                    <div class="num-txt">{{totalData.yes_operation}}</div>
                                </div>
                                <div class="box-item">
                                    <div class="label">{{$lang('无操作记录')}}</div>
                                    <div class="num-txt">
                                        <span>{{totalData.no_opeartion}}</span>
                                        <span class="see-txt" @click='seeDetail'>{{$lang('查看明细')}}</span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </el-col>
                    <el-col :span="16">
                        <chart-wrapper :title="$lang('系统操作次数')" class="system-operate" chart-height="312px" v-loading="systemDataLoading" ref="refChartsSystem">
                        </chart-wrapper>
                    </el-col>
                </el-row>
            </div>
            <div class="charts-boxs" v-show="ailyBtnShow" v-loading="ailyTimesLoading">
                
                <div class="button-box">
                    <el-button plain class="erp-el-button" @click="ailyTomore">{{$lang('更多')}}</el-button>
                    <el-button plain class="erp-el-button" @click="ailyToback">{{$lang('返回')}}</el-button>
                </div>
                
                <div class="title-txt">
                    <span>{{$lang('日均操作次数')}}</span>
                    <span class="subTitle">{{departmentName}}</span>
                </div>
                
                <div class="not-point" ref="departmentTimesCharts"  style="width: 100%;height:278px;"></div>
            </div>
            <div class="charts-boxs" v-show="ailyTableShow" v-loading="ailyTimesLoading">
                <div class="button-box">
                    <el-button plain class="erp-el-button" @click="ailyTableback">{{$lang('返回')}}</el-button>
                </div>
                <div class="title-txt">
                    <span>{{$lang('日均操作次数')}}</span>
                    <span class="subTitle">{{departmentName}}</span>
                </div>
                <div class="table-box">
                        
                    <el-table ref="operatorRef" class="erp-el-table" :data="ailyTableData" :height="225" highlight-current-row @current-change='operatorChange'>
                        <el-table-column :label="$lang('#')" width="50px" align="center" type="index"></el-table-column>
                        <el-table-column align="center"></el-table-column>
                        <el-table-column prop="name" :label="$lang('账号')" align="left"></el-table-column>
                        <el-table-column :label="$lang('日均操作次数')" align="right">
                            <template slot-scope="scope">
                                <div>
                                    <span>{{scope.row.value | format}}</span>
                                </div>
                            </template>
                        </el-table-column>
                        
                        <el-table-column align="center">
                            <template slot-scope="scope">
                                <div>
                                    <i class="el-icon-close" v-if="scope.row.id == operatorCurrentId" @click.stop="clearOperator"></i>
                                </div>
                            </template>
                            
                        </el-table-column>
                    </el-table>
                </div>
            </div>
            <div class="charts-boxs" v-show="!ailyBtnShow && !ailyTableShow" v-loading="ailyTimesLoading">
                <div class="title-txt">
                    <span>{{$lang('日均操作次数')}}</span>
                </div>
                <div ref="ailyTimesCharts"  style="width: 100%;height:278px;" v-show="!ailyTableShow"></div>
            </div>

            <chart-wrapper v-show="pageBtnShow" v-loading="pageTimesLoading" :title="$lang('页面操作次数')" class="page-operation">
                <template #header-right>
                    <el-button plain class="erp-el-button" @click="pageToback">
                        {{ $lang('返回') }}
                    </el-button>
                </template>

                <el-table class="erp-el-table" ref="pageTableRef" :data="pageTableData" :height="240" highlight-current-row
                    @current-change='pageTableChange'>
                    <el-table-column :label="$lang('#')" width="120" align="center" type="index"></el-table-column>
                    <el-table-column align="center"></el-table-column>
                    <el-table-column :label="$lang('模块')" align="left">
                        <template slot-scope="scope">
                            {{$lang(scope.row.first_menu)}}
                        </template>
                    </el-table-column>
                    <el-table-column :label="$lang('页面')" align="left">
                        <template slot-scope="scope">
                            {{$lang(scope.row.second_menu)}}
                        </template>
                    </el-table-column>
                    <el-table-column :label="$lang('操作次数')" align="right">
                        <template slot-scope="scope">
                            <div>
                                <span>{{scope.row.operation_num | format}}</span>
                            </div>
                        </template>
                    </el-table-column>
                    <el-table-column align="center">
                        <template slot-scope="scope">
                            <div>
                                <i class="el-icon-close" v-if="scope.row.page_code == pageCurrentId" @click.stop="clearPageCurren"></i>
                            </div>
                        </template>
                    </el-table-column>
                </el-table>
            </chart-wrapper>

            <chart-wrapper v-show="!pageBtnShow" v-loading="pageTimesLoading" :title="$lang('页面操作次数')" class="page-operation" chart-height="260px" ref="pageTimesCharts">
                <template #header-right>
                    <el-button plain class="erp-el-button"  @click="pageTomore">
                        {{ $lang('更多') }}
                    </el-button>
                </template>
            </chart-wrapper>

            <chart-wrapper :title="$lang('请求平均耗时')" chart-height="250px" ref="requestTime" v-loading="requestTimeLoading" class="request-time">
                <template #header-right>
                    <el-button plain class="erp-el-button" @click="toggleRequestTimeTable">
                        {{ requestTimeTableShow ? $lang('返回') : $lang('更多') }}
                    </el-button>
                </template>
                <el-table v-if="requestTimeTableShow" :data="requestTimeListData" stripe class="erp-el-table" 
                    height="238px" highlight-current-row @current-change="requestTimeTableCurrentChange" ref="requestTimeTable">
                    <el-table-column label="#" type="index" width="120">
                    </el-table-column>
                    <el-table-column :label="$lang('模块')" prop="title" :render-header="renderTableHeader">
                    </el-table-column>
                    <el-table-column :label="$lang('页面')" prop="name" :render-header="renderTableHeader">
                    </el-table-column>
                    <el-table-column :label="$lang('前端平均耗时（秒）')" align="right" prop="f_avg" :render-header="renderTableHeader">
                        <template slot-scope="scope">
                            {{scope.row.f_avg | format}}
                        </template>
                    </el-table-column>
                    <el-table-column :label="$lang('非前端平均耗时（秒）')" align="right" prop="b_avg" :render-header="renderTableHeader">
                        <template slot-scope="scope">
                            {{scope.row.b_avg | format}}
                        </template>
                    </el-table-column>
                    <el-table-column :label="$lang('请求平均耗时（秒）')" align="right" prop="total_avg" :render-header="renderTableHeader">
                        <template slot-scope="scope">
                            {{scope.row.total_avg | format}}
                        </template>
                    </el-table-column>
                    <el-table-column align="center">
                        <template slot-scope="scope">
                            <div>
                                <i class="el-icon-close" v-if="scope.row.module_id == form.modular && scope.row.page_id == form.page" @click.stop="setRequestTimeCurrent()"></i>
                            </div>
                        </template>
                    </el-table-column>
                </el-table>
            </chart-wrapper>

            <div class="totalTable-boxs">
                <el-table :data="totalTableData" v-loading="totalTableLoading" class="erp-el-table">
                    <el-table-column :label="$lang('模块')" align="left">
                        <template slot-scope="scope">
                            {{$lang(scope.row.module)}}
                        </template>
                    </el-table-column>
                    <el-table-column align="left"></el-table-column>
                    <el-table-column :label="$lang('页面')" align="left">
                        <template slot-scope="scope">
                            {{$lang(scope.row.page)}}
                        </template>
                    </el-table-column>
                    <el-table-column :label="$lang('操作次数')" align="right">
                        <template slot-scope="scope">
                            {{scope.row.operation_num | format}}
                        </template>
                    </el-table-column>
                    <el-table-column align="left"></el-table-column>
                    <el-table-column :label="$lang('操作人数')" align="right">
                        <template slot-scope="scope">
                            {{scope.row.operation_pepole_num | format}}
                        </template>
                    </el-table-column>
                    <el-table-column :label="$lang('操作人')" align="center">
                        <template slot-scope="scope">
                            <el-button type="button" @click='seePeople(scope.row)' size="small">{{$lang('查看')}}</el-button>
                        </template>
                    </el-table-column>
                </el-table>
                <div class="page-box">
                    <el-pagination
                    background
                    layout="total, sizes, prev, pager, next, jumper"
                    :page-sizes="[10, 25, 50, 100]"
                    :total="total"
                    :page-size="pageSize"
                    :current-page="page"
                    @size-change="pagesizeChange"
                    @current-change="pageChange"
                    class="erp-el-pagination">
                    </el-pagination>
                </div>
            </div>
        </div>
        <!-- 无操作记录弹窗 -->
        <el-dialog
        :title="$lang('无操作记录账号')"
        :visible.sync="recordVisible"
        width="980px">
        
            <el-table :data="recordTableData" v-loading="recordTableLoading" :height="345">
                <el-table-column :label="$lang('#')" width="50px" align="center" type="index"></el-table-column>
                <el-table-column align="center"></el-table-column>
                <el-table-column prop="account" :label="$lang('账号')" align="left"></el-table-column>
            </el-table>
        </el-dialog>
        <!-- 操作记录弹窗 -->
        <el-dialog
        :title="$lang('操作记录')"
        :visible.sync="peopleVisible"
        width="980px">
            <div class="category">
                <span class="category-item">
                    <span class="item-label">{{$lang('模块')}}：</span>
                    <span class="item-txt">{{$lang(rowItem.module)}}</span>
                </span>
                <span class="category-item">
                    <span class="item-label">{{$lang('页面')}}：</span>
                    <span class="item-txt">{{$lang(rowItem.page)}}</span>
                </span>
                <!-- <span class="category-item">
                    <span class="item-label">按钮：</span>
                    <span class="item-txt">操作性按钮</span>
                </span> -->
            </div>
            <el-table class="erp-el-table" :data="peopleTableData" v-loading="peopleTableLoading">
                <el-table-column prop="datetime" :label="$lang('操作时间')" align="left"></el-table-column>
                <el-table-column prop="user_name" :label="$lang('操作人')" align="left"></el-table-column>
            </el-table>
            <div class="page-box">
                <el-pagination
                background
                layout="total, sizes, prev, pager, next, jumper"
                :page-sizes="[10, 25, 50, 100]"
                :total="peopletotal"
                :page-size="peoplePageSize"
                :current-page="peoplePage"
                @size-change="peoplePagesizeChange"
                @current-change="peoplePageChange"
                class="erp-el-pagination">
                </el-pagination>
            </div>
        </el-dialog>
    </div>

<script src="./Application/Tpl/Home/Public/lib/jquery/1.9.1/jquery.min.js"></script>
<script src="./Application/Tpl/Home/Public/js/vue-2.6.10.js"></script>
<script src="./Application/Tpl/Home/Public/js/axios.min.js"></script>
<script src="./Application/Tpl/Home/Public/js/H-ui.admin.js?v=<{$Think.config.VER_NUM}>"></script>
<script src="./Application/Tpl/Home/Public/js/element-ui-2.13.0.js"></script>
<script src="./Application/Tpl/Home/Public/js/queryString.js"></script>
<script src="./Application/Tpl/Home/Public/js/element-en.js"></script>
<script src="./Application/Tpl/Home/Public/js/echarts-4.7.0.js"></script>
<script src="./Application/Tpl/Home/DataCenter/components/ChartWrapper.js?v=<{$Think.config.VER_NUM}>">
</script>
<script src="./Application/Tpl/Home/DataCenter/utils/globalConstAndFunc.js?v=<{$Think.config.VER_NUM}>">
</script>
<script>
    if (getCookie('think_language') !== "zh-cn") {
        ELEMENT.locale(ELEMENT.lang.en)
    }
    var VM = new Vue({
        el: '#more',
        components: {
            'chart-wrapper': ChartWrapper
        },
        data() {
            return {
                apiHost: GlobalConstAndFunc.api(),
                language: getCookie('think_language') === 'zh-cn' ? 'cn' : 'us',
                pickerOptions:{
                    disabledDate(time) {
                        return time.getTime() > Date.now() - 86400000 || time.getTime() < new Date('2016-12-31').getTime();
                    },
                },
                form: {
                    dateRange: [this.getBeforeDate(7), this.getBeforeDate(1)],
                    modular: '',
                    page: '',
                    btn: '',
                    department: '',
                    operator: '',
                },
                searchParam: {}, // 搜索参数
                operatorCurrentId: "",
                pageCurrentId: "",
                systemChart: null, // 系统操作次数图表
                systemCharOptions: null, // 系统操作次数图表配置项
                systemDataLoading: true,
                ailyTimesChart: null, // 日均操作次数图表
                ailyTimesChartOption: null, // 日均操作次数图表配置项
                departmentTimesChart: null, // 日均操作次数部门员工图表
                departmentTimesChartOption: null, // 日均操作次数部门员工图表配置项
                ailyTimesLoading: true,
                ailyBtnShow: false,
                ailyTableShow: false,
                departmentName: '',
                departmentId: '',
                ailyTableData: [],
                pageTimesChart: null, // 页面操作次数图表
                pageTimesChartOption: null, // 页面操作次数图表配置项
                pageBtnShow: false,
                pageTimesLoading: true,
                pageTableData: [],
                totalTableData: [],
                totalTableLoading: true,
                total: 0,
                page: 1,
                pageSize: 10,
                recordVisible: false, //无操作记录账号弹窗
                recordTableData: [],
                recordTableLoading: true,
                peopleVisible: false, // 操作人记录弹窗
                rowItem: {},
                peopleTableData: [],
                peopleTableLoading: true,
                peopletotal: 0,
                peoplePageSize: 10,
                peoplePage: 1,
                totalData: {}, // 使用情况汇总数据
                totalDataLoading: true,
                requestTimeChart: null,
                requestTimeListData: [],
                requestTimeLoading: false,
                requestTimeTableShow: false,
            }
        },
        created() {
            this.getSearchData()
        },
        mounted() {
            this.systemChart = echarts.init(this.$refs.refChartsSystem.$refs.chart);
            this.ailyTimesChart = echarts.init(this.$refs.ailyTimesCharts);
            this.pageTimesChart = echarts.init(this.$refs.pageTimesCharts.$refs.chart);
            this.pageTimesChart.on('click',(param)=> {
                
                this.form.page = Number(param.data.page_code);
                this.form.modular = Number(param.data.module_code);
                this.pageSearch();
                this.getSearchData();
                this.getRequestTimeChartData()
                
                this.getPageTimesData().then(datas=> {
                    let data = datas.map(item=>{
                        return {
                            name: this.$lang(item.first_menu) + '\n' + this.$lang(item.second_menu),
                            value: item.operation_num,
                            module_code: item.module_code,
                            page_code: item.page_code
                        }
                    })
                    this.setPageTimesOpt(data);
                })
                // this.pageTableChange(param.data);
                // console.log(param);
            })
            this.initCharts();
            // 监听日均操作次数图表点击事件
            this.ailyTimesChart.on('click',(param)=>{
                this.ailyBtnShow = true;
                this.departmentName = param.data.name;
                this.departmentId = param.data.department_id;
                this.form.department = Number(param.data.department_id);
                this.userSearch();
                this.getSearchData();
                this.getRequestTimeChartData()
                this.getAilyTimesData('staff',param.data.department_id).then(datas=>{
                    let data = datas.map(item=>{
                        return {
                            name: item.name,
                            value: item.value,
                            user_id: item.user_id
                        }
                    })
                    
                    this.departmentTimesChart = echarts.init(this.$refs.departmentTimesCharts);
                    this.setDepartmentTimesOpt(data)
                    this.departmentTimesChart.on('click', (param)=> {
                        // console.log(param);
                        this.form.operator = Number(param.data.user_id);
                        this.userSearch();
                        this.getRequestTimeChartData()
                        this.getAilyTimesData('staff',this.form.department).then(datas => {
                            let data = datas.map(item=>{
                            return {
                                    name: item.name,
                                    value: item.value,
                                    user_id: item.user_id
                                }
                            })
                            this.setDepartmentTimesOpt(data)
                        })
                    })
                })
                
            })

            this.requestTimeChart = echarts.init(this.$refs.requestTime.$refs.chart)
            this.requestTimeChart.on('click', (params) => {
                this.form.modular = Number(params.data[4])
                this.form.page = Number(params.data[5])
                this.searchChange()
            })
        },
        filters: {
            // 数字加上千分位
            format :function format(num) {
                if(num == '-') {
                    return '-';
                } else {
                    
                    num = Number(num).toFixed(2)
                    var num1=num.split('.')[0]+'';  
                    var str=""; 
                    for(var i=num1.length- 1,j=1;i>=0;i--,j++){  
                        if(j%3==0 && i!=0 && num1[i-1] != '-'){//每隔三位加逗号，过滤正好在第一个数字的情况 过滤负数情况 
                            str+=num1[i]+",";//加千分位逗号  
                            continue;  
                        }  
                        str+=num1[i];//倒着累加数字
                    }
                    return `${str.split('').reverse().join("")}${num.split('.')[1] == '00' ? '' : '.' + num.split('.')[1]}`
                }
                // return str.split('').reverse().join("") + '.' +  : '';//字符串=>数组=>反转=>字符串  
            },
        },
        methods: {
            // 表格表头不换行,溢出则隐藏，鼠标悬浮显示完整文本
            renderTableHeader(h, obj) {
                return GlobalConstAndFunc.Element.renderTableHeader(h, obj)
            },
            queryPost(url, param) {
                var headers = {
                    headers: {
                    'erp-req': true,
                    'erp-cookie': 'PHPSESSID=' + getCookie('PHPSESSID') + ';',
                    'Content-Type': 'application/x-www-form-urlencoded;charset=UTF-8'
                    }
                }
                
                return axios.post(this.apiHost + '/erpSystemUse' + url, Qs.stringify(param), headers);
            },
            // 获取使用情况数据
            getUsageData() {
                var param = {
                    'erp-req': true,
                    'erp-cookie': 'PHPSESSID=' + getCookie('PHPSESSID') + ';',
                    beginDate: this.form.dateRange[0],
                    endDate: this.form.dateRange[1],
                    module_id: this.form.modular,
                    page_id: this.form.page,
                    department_id: this.form.department,
                    user_id: this.form.operator,
                }
                this.totalDataLoading = true;
                this.queryPost('/erpSystemUseCondition',param).then(res=>{
                    this.totalDataLoading = false;
                    if(res.status == 200 && res.data.success) {
                        this.totalData = res.data.datas[0];
                    } else {
                        this.$message.error(res.data.msg);
                    }
                })
            },
            
            // 获取系统操作次数图表数据
            getSystemData() {
                var param = {
                    'erp-req': true,
                    'erp-cookie': 'PHPSESSID=' + getCookie('PHPSESSID') + ';',
                    beginDate: this.form.dateRange[0],
                    endDate: this.form.dateRange[1],
                    module_id: this.form.modular,
                    page_id: this.form.page,
                    // button: this.form.btn,
                    department_id: this.form.department,
                    user_id: this.form.operator,
                }
                this.systemDataLoading = true;
                this.queryPost('/erpOperationNum',param).then(res=>{
                    this.systemDataLoading = false;
                    if(res.status == 200 && res.data.success) {
                        let data = [res.data.datas.dateTime,res.data.datas.operation_num];
                        this.setSystemOpt(data);
                    } else {
                        this.$message.error(res.data.msg);
                    }
                })
            },
            // 获取日均操作次数图表数据
            getAilyTimesData(flag,department,table) {
                var param = {
                    'erp-req': true,
                    'erp-cookie': 'PHPSESSID=' + getCookie('PHPSESSID') + ';',
                    beginDate: this.form.dateRange[0],
                    endDate: this.form.dateRange[1],
                    module_id: this.form.modular,
                    page_id: this.form.page,
                    // button: this.form.btn,
                    namespace: '',
                    department_id: department,
                    user_id: this.form.operator,
                    flag: flag,
                    table: table
                }
                this.ailyTimesLoading = true;
                return new Promise((resolve,reject)=>{
                    this.queryPost('/erpAverageDailyOperationNum',param).then(res=>{
                        this.ailyTimesLoading = false;
                        if(res.status==200 && res.data.success) {
                            resolve(res.data.datas);
                        } else {
                            this.$message.error(res.data.msg);
                        }
                    })
                })
                
            },
            // 获取页面操作次数图表数据
            getPageTimesData(table) {
                var param = {
                    'erp-req': true,
                    'erp-cookie': 'PHPSESSID=' + getCookie('PHPSESSID') + ';',
                    beginDate: this.form.dateRange[0],
                    endDate: this.form.dateRange[1],
                    module_id: this.form.modular,
                    page_id: this.form.page,
                    namespace: '',
                    // button: this.form.btn,
                    department_id: this.form.department,
                    user_id: this.form.operator,
                    table:table
                }
                this.pageTimesLoading = true;
                return new Promise((resolve,reject)=>{
                    this.queryPost('/erpPageAndRequest',param).then(res=>{
                        this.pageTimesLoading = false;
                        if(res.status == 200 && res.data.success) {
                            resolve(res.data.datas);
                        } else {
                            this.$message.error(res.data.msg);
                        }
                    })
                })
                
            },
            // 获取操作统计表格数据
            getOperaTableData() {
                var param = {
                    'erp-req': true,
                    'erp-cookie': 'PHPSESSID=' + getCookie('PHPSESSID') + ';',
                    beginDate: this.form.dateRange[0],
                    endDate: this.form.dateRange[1],
                    namespace: '',
                    module_id: this.form.modular,
                    page_id: this.form.page,
                    // button: this.form.btn,
                    department_id: this.form.department,
                    user_id: this.form.operator,
                    page: this.page,
                    pageSize: this.pageSize
                }
                this.totalTableLoading = true;
                this.queryPost('/erpOperationStatisticsTable',param).then(res=>{
                    this.totalTableLoading = false;
                    if(res.status == 200 && res.data.success){
                        
                        this.totalTableData = res.data.datas;
                        this.total = res.data.totalCount;
                    } else {
                        this.$message.error(res.data.msg)
                    }
                })
            },
            // 获取搜索参数
            getSearchData() {
                var param = {
                    'erp-req': true,
                    'erp-cookie': 'PHPSESSID=' + getCookie('PHPSESSID') + ';',
                    department_id: this.form.department,
                    module_id: this.form.modular,
                }
                this.queryPost('/queryParma',param).then(res=>{
                    if(res.status == 200 && res.data.success) {
                        this.searchParam = res.data.datas;
                    } else {
                        this.$message.error(res.data.msg)
                    }
                })
            },
            // 获取无操作记录账号表格数据
            getAccountTableData() {
                var param = {
                    'erp-req': true,
                    'erp-cookie': 'PHPSESSID=' + getCookie('PHPSESSID') + ';',
                    beginDate: this.form.dateRange[0],
                    endDate: this.form.dateRange[1],
                    module_id: this.form.modular,
                    page_id: this.form.page,
                    namespace: '',
                    department_id: this.form.department,
                    user_id: this.form.operator,
                }
                this.queryPost('/erpOperationRecordAccount',param).then(res=>{
                    this.recordTableLoading = false
                    if(res.status == 200 && res.data){
                        this.recordTableData = res.data.datas;
                    } else {
                        this.$message.error(res.data.msg)
                    }
                })
            },
            // 获取操作记录表格数据
            getOperaRecordData(item) {
                var param = {
                    'erp-req': true,
                    'erp-cookie': 'PHPSESSID=' + getCookie('PHPSESSID') + ';',
                    beginDate: this.form.dateRange[0],
                    endDate: this.form.dateRange[1],
                    namespace: '',
                    module_id: item.module_code,
                    page_id: item.page_code,
                    page: this.peoplePage,
                    pageSize: this.peoplePageSize,
                    user_id: this.form.operator,
                    department_id: this.form.department,
                }
                this.peopleTableLoading = true;
                this.queryPost('/erpOperationRecord',param).then(res=>{
                    this.peopleTableLoading = false;
                    if(res.data.success) {
                        this.peopleTableData = res.data.datas;
                        this.peopletotal = res.data.totalCount;
                    } else {
                        this.$message.error(res.data.msg)
                    }
                })
            },
            // 计算搜索时间
            getBeforeDate(n){
                var n = n;
                var d = new Date();
                var year = d.getFullYear();
                var mon=d.getMonth()+1;
                var day=d.getDate();
                if(day <= n){
                    if(mon>1) {
                        mon=mon-1;
                    }
                    else {
                        year = year-1;
                        mon = 12;
                    }
                }
                d.setDate(d.getDate()-n);
                year = d.getFullYear();
                mon=d.getMonth()+1;
                day=d.getDate();
                s = year+"-"+(mon<10?('0'+mon):mon)+"-"+(day<10?('0'+day):day);
                return s;
            },
            // 获取页面所有数据，并初始化各图表
            // requestTimeTableClick 请求平均耗时模块的表格行有无被点击选中，有的情况下，不请求表格数据
            initCharts(requestTimeTableClick = false) {
                this.ailyTableShow = false;
                this.ailyBtnShow = false;
                this.pageBtnShow = false;
                this.pageSize = 10;
                this.page = 1;
                this.pageCurrentId = '';
                this.operatorCurrentId = '';
                
                this.getUsageData();
                this.getOperaTableData();
                this.getSystemData();
                this.getAilyTimesData('department',this.form.department,'yes').then(datas => {
                    let data = datas.map(item=>{
                        return {
                            name: item.name,
                            value: item.value,
                            department_id: item.department_id
                        }
                    })
                    this.setAilyTimesOpt(data);
                });
                this.getPageTimesData().then(datas=> {
                    let data = datas.map(item=>{
                        return {
                            name: this.$lang(item.first_menu) + '\n' + this.$lang(item.second_menu),
                            value: item.operation_num,
                            module_code: item.module_code,
                            page_code: item.page_code
                        }
                    })
                    this.pageTimesChart.clear();
                    this.setPageTimesOpt(data);
                })

                if (this.requestTimeTableShow && !requestTimeTableClick) {
                    this.getRequestTimeListData()
                } else if (!this.requestTimeTableShow) {
                    this.getRequestTimeChartData()
                }
                
            },
            // 系统操作次数图表配置
            setSystemOpt(data) {
                this.systemCharOptions = {
                    tooltip: {
                        ...GlobalConstAndFunc.Echarts.tooltipStyle,
                        trigger: 'axis',
                        formatter: (param) => {
                            const { name, color } = param[0]
                            const marker = `<span class="marker" style="background-color:${color};"></span>`
                            var value = this.$options.filters['format'](param[0].value[1]);
                            const contentArr = [`<div class="item">${marker}<span class="value">${this.$lang('系统操作次数')}</sapn><span class="value">${value}</sapn></div>`]
                            return GlobalConstAndFunc.Echarts.tooltipFormatter(contentArr, name)
                        }
                    },
                    xAxis: {
                        type: 'category',
                        // data: ['2020-05-04', '2020-05-05', '2020-05-06', '2020-05-07','2020-05-08', '2020-05-09', '2020-05-10',],
                        axisTick: {
                            show: false
                        },
                    },
                    yAxis: {
                        type: 'value',
                        name: this.$lang('次'),
                        axisLine: {
                            show: false
                        },
                        axisTick: {
                            show: false
                        },
                        splitLine: {
                            lineStyle: {
                                type: 'dotted',
                                color: '#F0F0F0'
                            }
                        },
                        splitNumber:4
                    },
                    grid: {
                        left: 5,
                        right: 10,
                        bottom: 40,
                        containLabel: true
                    },
                    dataset: {
                        sourceHeader: true,
                        source: data,
                    },
                    series: [
                        {
                            type: 'line',
                            symbol: 'none',
                            color: '#0375DE',
                            seriesLayoutBy: 'row',
                        },
                    ]
                };
                
                this.systemChart.setOption(this.systemCharOptions);
            },
            // 日均操作次数图表配置
            setAilyTimesOpt(data) {
                this.ailyTimesChartOption = {
                    tooltip: {
                        ...GlobalConstAndFunc.Echarts.tooltipStyle,
                        trigger: 'axis',
                        formatter: (param) => {
                            const { name, color } = param[0];
                            const marker = `<span class="marker" style="background-color:${color};"></span>`
                            var value = this.$options.filters['format'](param[0].value.value);
                            let contentArr = [`<div class="item">${marker}<span>${this.$lang('日均操作次数')}</span><span>${value}</span></div>`]
                            return GlobalConstAndFunc.Echarts.tooltipFormatter(contentArr, name)
                        }
                    },
                    xAxis: {
                        type: 'category',
                        // data: ['部门1', '部门2', '部门3', '部门4','部门5', '部门6', '部门7', '部门8','部门9', '部门10',],
                        axisTick: {
                            show: false
                        },
                        axisLabel: {
                            interval: 0,
                            formatter: value => {
                                let name = value.replace(/ -/g,'-').replace(/ &/g,'&');
                                return  name.replace(/ /g,'\n')
                            },
                            showMaxLabel: true
                        },
                    },
                    yAxis: {
                        name: this.$lang('次'),
                        type: 'value',
                        splitLine: {
                            lineStyle: {
                                type: 'dotted',
                                color: '#F0F0F0'
                            }
                        },
                        splitNumber:4,
                        axisLine: {
                            show: false
                        },
                        axisTick: {
                            show: false
                        },
                    },
                    grid: {
                        left: 10,
                        right: 10,
                        bottom: 40,
                        containLabel: true
                    },
                    dataset: {
                        sourceHeader: true,
                        source: data,
                    },
                    series: [
                        {
                            // data: [1520, 1332, 1101, 934, 720, 532, 401, 334, 201, 121],
                            type: 'bar',
                            color: '#0375DE',
                            barWidth: '30%',
                            seriesLayoutBy: 'column',
                        },
                    ]
                };
                this.ailyTimesChart.setOption(this.ailyTimesChartOption);
            },
            // 部门日均操作次数图表配置
            setDepartmentTimesOpt(data) {
                this.departmentTimesChartOption = {
                    tooltip: {
                        ...GlobalConstAndFunc.Echarts.tooltipStyle,
                        trigger: 'axis',
                        formatter: (param) => {
                            const { name, color } = param[0];
                            const marker = `<span class="marker" style="background-color:${color};"></span>`
                            var value = this.$options.filters['format'](param[0].value.value);
                            let contentArr = [`<div class="item">${marker}<span>${this.$lang('日均操作次数')}</span><span>${value}</span></div>`]
                            return GlobalConstAndFunc.Echarts.tooltipFormatter(contentArr, name)
                        }
                    },
                    xAxis: {
                        type: 'category',
                        // data: ['员工1','员工2','员工3','员工4','员工5','员工6','员工7','员工8','员工9','员工10'],
                        axisTick: {
                            show: false
                        },
                        axisLabel: {
                            interval: 0, 
                            
                        }
                    },
                    yAxis: {
                        name: this.$lang('次'),
                        type: 'value',
                        splitLine: {
                            lineStyle: {
                                type: 'dotted',
                                color: '#F0F0F0'
                            }
                        },
                        splitNumber:4,
                        axisLine: {
                            show: false
                        },
                        axisTick: {
                            show: false
                        },
                    },
                    dataset: {
                        sourceHeader: true,
                        source: data,
                    },
                    grid: {
                        left: 10,
                        right: 10,
                        bottom: 40,
                        containLabel: true
                    },
                    series: [
                        {
                            // data: [1220, 832, 701, 634, 620, 532, 401, 334, 201, 121],
                            type: 'bar',
                            color: '#0375DE',
                            barWidth: '30%',
                            seriesLayoutBy: 'column',
                        },
                    ]
                };
                this.departmentTimesChart.setOption(this.departmentTimesChartOption);
            },
            // 页面操作次数图表配置
            setPageTimesOpt(data) {
                this.pageTimesChartOption = {
                    tooltip: {
                        ...GlobalConstAndFunc.Echarts.tooltipStyle,
                        trigger: 'axis',
                        formatter: (param) => {
                            let { name, color } = param[0];
                            name = name.replace(/\n/g, '<br/>');

                            const marker = `<span class="marker" style="background-color:${color};"></span>`
                            var value = this.$options.filters['format'](param[0].value.value);
                            let contentArr = [`<div class="item">${marker}<span>${this.$lang('操作次数')}</span><span>${value}</span></div>`]
                            return GlobalConstAndFunc.Echarts.tooltipFormatter(contentArr, name)
                        }
                    },
                    xAxis: {
                        type: 'category',
                        // data: ['订单中心\n订单列表', '供应链管理\n需求列表', '模块3\n页面3', '模块4\n页面4','模块5\n页面5', '模块6\n页面6', '模块7\n页面7', '模块8\n页面8','模块9\n页面9', '模块10\n页面10',],
                        axisTick: {
                            show: false
                        },
                        axisLabel: {
                            interval: 0, 
                            formatter: value => {
                                let name = value.replace(/&amp;/g,'&');
                                return name;
                            },
                        }
                    },
                    yAxis: {
                        name: this.$lang('次'),
                        type: 'value',
                        splitLine: {
                            lineStyle: {
                                type: 'dotted',
                                color: '#F0F0F0'
                            }
                        },
                        splitNumber:4,
                        axisLine: {
                            show: false
                        },
                        axisTick: {
                            show: false
                        },
                    },
                    grid: {
                        left: 10,
                        right: 10,
                        bottom: 22,
                        containLabel: true,
                    },
                    dataset: {
                        sourceHeader: true,
                        source: data,
                    },
                    series: [
                        {
                            // data: [120, 532, 301, 734, 320, 532, 901, 734, 101, 421],
                            type: 'bar',
                            color: '#0375DE',
                            barWidth: '30%',
                            seriesLayoutBy: 'column',
                        },
                    ]
                };
                this.pageTimesChart.setOption(this.pageTimesChartOption);
            },
        
            // 请求平均耗时，图表数据获取
            getRequestTimeChartData() {
                this.requestTimeLoading = true
                const postData = {
                    'erp-req': true,
                    'erp-cookie': 'PHPSESSID=' + getCookie('PHPSESSID') + ';',
                    beginDate: this.form.dateRange[0],
                    endDate: this.form.dateRange[1],
                    module_id: this.form.modular,
                    page_id: this.form.page,
                    department_id: this.form.department,
                    user_id: this.form.operator,
                    language: this.language
                }
                this.queryPost('/erpRequestAvgTime', postData).then(res => {
                    if (res.data.success) {
                        this.initRequestTimeChart(res.data.datas)
                    } else {
                        this.$message.error(res.data.msg)
                    }
                    this.requestTimeLoading = false
                }).catch(err => {
                    console.log(err)
                });
            },
            // 请求平均耗时，图表配置
            initRequestTimeChart(data) {
                const option = {
                    tooltip: {
                        ...GlobalConstAndFunc.Echarts.tooltipStyle,
                        trigger: 'axis',
                        formatter: (params) => {
                            const title = params[0].name.split('\n').join('<br />')
                            const avgVal = this.$options.filters['format'](params[0].data[3])
                            let contentArr = [`<div style="font-weight: 500;margin-bottom: 4px;"><span>${this.$lang('请求平均耗时')}</span><span style="margin-left: 4px;">${avgVal} s</span></div>`]
                            let arrTemp = []
                            for (const item of params) {
                                const { color, seriesName, encode, value } = item
                                const marker = `<span class="marker" style="background-color:${color};"></span>`
                                const formatVal = this.$options.filters['format'](value[encode.y[0]])
                                arrTemp.unshift(`<div class="item">${marker}<span>${this.$lang(seriesName)}</span><span>${formatVal} s</span></div>`)
                            }
                            const contentStr = contentArr.concat(arrTemp).join('')
                            return `
                                    <section class="echarts-tooltip">
                                        <div class="title">${title}</div>
                                        <section class="content-lt12">
                                        ${contentStr}
                                        </section>
                                    </section>
                                    `
                        },
                    },
                    legend: {
                        ...GlobalConstAndFunc.Echarts.legendStyle,
                        icon: 'rect',
                        bottom: 2,
                        formatter: (name) => {
                            return this.$lang(name)
                        }
                    },
                    grid: {
                        left: 10,
                        right: 10,
                        top: 47,
                        bottom: 62,
                        containLabel: true
                    },
                    color: ['#0375DE', '#FFC30F'],
                    dataset: {
                        sourceHeader: true,
                        source: data
                    },
                    xAxis: {
                        ...GlobalConstAndFunc.Echarts.xAxisStyle,
                        type: 'category',
                        axisLabel: {
                            interval: 0,
                        },
                    },
                    yAxis: {
                        ...GlobalConstAndFunc.Echarts.yAxisStyle,
                        type: 'value',
                        name: this.$lang('秒')
                    },
                    series: [
                        {
                            type: 'bar',
                            encode: {
                                seriesName: 2,
                                x: 0,
                                y: 2
                            },
                            stack: 'sum',
                        },
                        {
                            type: 'bar',
                            encode: {
                                seriesName: 1,
                                x: 0,
                                y: 1
                            },
                            stack: 'sum',
                        }
                    ]
                }

                this.requestTimeChart.setOption(option, true)
            },
            // 请求平均耗时，表格数据获取
            getRequestTimeListData() {
                this.requestTimeLoading = true
                const postData = {
                    'erp-req': true,
                    'erp-cookie': 'PHPSESSID=' + getCookie('PHPSESSID') + ';',
                    beginDate: this.form.dateRange[0],
                    endDate: this.form.dateRange[1],
                    module_id: this.form.modular,
                    page_id: this.form.page,
                    department_id: this.form.department,
                    user_id: this.form.operator,
                    language: this.language
                }
                this.queryPost('/erpRequestAvgTimeList', postData).then(res => {
                    if (res.data.success) {
                        this.requestTimeListData = res.data.datas
                    } else {
                        this.$message.error(res.data.msg)
                    }
                    this.requestTimeLoading = false
                }).catch(err => {
                    console.log(err)
                });
            },
            // 请求平均耗时，表格行单击选中
            requestTimeTableCurrentChange(curRow) {
                if (curRow) {
                    this.form.modular = Number(curRow.module_id)
                    this.form.page = Number(curRow.page_id)
                    this.getSearchData();
                    this.initCharts(true)
                }
            },
            // 请求平均耗时，表格行取消选中
            setRequestTimeCurrent(row) {
                this.$refs.requestTimeTable.setCurrentRow(row)
                this.form.modular = ''
                this.form.page = ''
                this.getSearchData();
                this.initCharts()
            },
            // 请求平均耗时,表格与图表之间切换
            toggleRequestTimeTable() {
                this.requestTimeTableShow = !this.requestTimeTableShow
                if (this.requestTimeTableShow) {
                    this.getRequestTimeListData()
                    this.$refs.requestTime.$refs.chart.style.display = 'none'
                } else {
                    this.getRequestTimeChartData()
                    this.$refs.requestTime.$refs.chart.style.display = 'block'
                }
            },
            // 日均操作次数图表按钮操作
            ailyTomore() {

                this.ailyTableShow = true;
                this.ailyBtnShow = false;
                this.getAilyTimesData('staff',this.departmentId,'yes').then(datas=>{
                    this.ailyTableData = datas;
                })
            },
            ailyToback() {
                
                this.ailyBtnShow = false;
                this.form.department = '';
                this.form.operator = '';
                this.userSearch();
                this.getSearchData();
                // 清除搜索条件同时更新日均操作次数柱状图
                this.getAilyTimesData('department',this.form.department,'yes').then(datas => {
                    let data = datas.map(item=>{
                        return {
                            name: item.name,
                            value: item.value,
                            department_id: item.department_id
                        }
                    })
                    this.setAilyTimesOpt(data);
                });
            },
            ailyTableback() {
                this.ailyTableShow = false;
                this.ailyBtnShow = true;
                if(this.operatorCurrentId) {
                    
                    this.clearOperator();
                }
            },
            // 页面操作次数图表按钮操作
            pageTomore() {
                this.pageBtnShow = true;
                this.getPageTimesData('yes').then(datas=>{
                    this.pageTableData = datas;
                })
            },
            pageToback() {
                
                this.pageBtnShow = false;
                if(this.pageCurrentId){
                    
                    this.clearPageCurren();
                }
            },
            // 查看操作人
            seePeople(row) {
                this.peopleVisible = true;
                this.rowItem = row;
                this.peoplePage = 1;
                this.peoplePageSize = 10;
                this.getOperaRecordData(row);
            },
            pagesizeChange(size) {
                this.pageSize = size;
                this.getOperaTableData();
            },
            pageChange(page){
                this.page = page;
                this.getOperaTableData();
            },
            peoplePagesizeChange(size) {
                this.peoplePageSize = size;
                this.getOperaRecordData(this.rowItem);
            },
            peoplePageChange(page) {
                this.peoplePage = page;
                this.getOperaRecordData(this.rowItem);
            },
            // 查看明细
            seeDetail() {
                this.recordVisible = true;
                this.getAccountTableData();
            },
            searchChange() {
                this.initCharts();
                this.getSearchData();
            },
            operatorChange(currentRow) {
                if(currentRow){
                    this.operatorCurrentId = currentRow.id;
                    this.form.operator = Number(currentRow.user_id);
                    this.userSearch();
                }
            },
            // 点击员工搜索
            userSearch() {
                
                this.pageBtnShow = false;
                this.pageSize = 10;
                this.page = 1;
                this.getPageTimesData().then(datas=> {
                    let data = datas.map(item=>{
                        return {
                            name: this.$lang(item.first_menu) + '\n' + this.$lang(item.second_menu),
                            value: item.operation_num,
                            module_code: item.module_code,
                            page_code: item.page_code
                        }
                    })
                    this.setPageTimesOpt(data);
                })
                this.getOperaTableData();
                this.getSystemData();
                this.getUsageData();
            },
            clearOperator() {
                this.$refs.operatorRef.setCurrentRow();
                this.form.operator = '';
                this.operatorCurrentId = '';
                this.userSearch();
                // 清除搜索条件同时更新日均操作次数柱状图
                this.getAilyTimesData('staff',this.form.department).then(datas=>{
                    let data = datas.map(item=>{
                        return {
                            name: item.name,
                            value: item.value,
                            user_id: item.user_id
                        }
                    })
                    
                    // this.departmentTimesChart = echarts.init(this.$refs.departmentTimesCharts);
                    this.setDepartmentTimesOpt(data)
                })
            },
            pageTableChange(currentRow) {
                if(currentRow){
                    this.pageCurrentId = currentRow.page_code;
                    this.form.page = Number(currentRow.page_code);
                    this.form.modular = Number(currentRow.module_code);
                    this.pageSearch();
                }
            },
            // 点击页面搜索,
            pageSearch() {
                this.ailyTableShow = false;
                this.ailyBtnShow = false;
                this.pageSize = 10;
                this.page = 1;
                this.getAilyTimesData('department',this.form.department).then(datas => {
                    let data = datas.map(item=>{
                        return {
                            name: item.name,
                            value: item.value,
                            department_id: item.department_id
                        }
                    })
                    this.setAilyTimesOpt(data);
                });
                this.getSearchData();
                this.getOperaTableData();
                this.getSystemData();
                this.getUsageData();

            },
            clearPageCurren() {
                this.$refs.pageTableRef.setCurrentRow();
                this.form.page = '';
                this.form.modular = '';
                this.pageCurrentId = '';
                this.pageSearch();
                // 清除搜索条件的同时更新柱形图
                this.getPageTimesData().then(datas=> {
                    let data = datas.map(item=>{
                        return {
                            name: this.$lang(item.first_menu) + '\n' + this.$lang(item.second_menu),
                            value: item.operation_num,
                            module_code: item.module_code,
                            page_code: item.page_code
                        }
                    })
                    this.setPageTimesOpt(data);
                })
            }
        },
    })
</script>
</body>

</html>